[{"categories":["dotnet"],"content":"åœ¨ dockerfile å…§ä½¿ç”¨ alpine çš„ dotnet sdk image å»ºç½® dotnet æœå‹™","date":"2025-07-16","objectID":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/","series":[],"tags":["dotnet","docker","containerize"],"title":"åœ¨ dockerfile å…§ä½¿ç”¨ alpine çš„ dotnet sdk image å»ºç½® dotnet æœå‹™","uri":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/"},{"categories":["dotnet"],"content":"åœ¨æˆ‘ä»¥å‰çš„å·¥ä½œç’°å¢ƒä¸­ï¼Œç”±æ–¼å»ºç½®æ©Ÿæ¡ç”¨åœ°ç«¯ç®¡ç†ï¼Œä¸”æœ‰å„²å­˜å®¹é‡ç­‰é™åˆ¶ï¼Œå¦‚ä½•åˆ©ç”¨ docker çš„ build cache ä¾†å¢åŠ å„²å­˜ç©ºé–“çš„åˆ©ç”¨ç‡æˆäº†å¿…é ˆæ€è€ƒçš„è­°é¡Œã€‚ ä¹Ÿå› ç‚ºæˆ‘åœ¨è¦åŠƒ åŒ…å« opentelemetry auto instrumentation çš„ base image æ™‚ï¼Œä¹Ÿæœƒéœ€è¦åŒæ™‚ç™¼å¸ƒå¤šç¨®ä¸åŒ linux ç‰ˆæœ¬çš„ imageï¼Œå› æ­¤ï¼Œé€™é‚Šç‰¹åˆ¥ç ”ç©¶äº†å¤šç¨®ä¸åŒ linux ç™¼è¡Œç‰ˆçš„ dotnet build åƒæ•¸ä¸¦æ‡‰ç”¨åœ¨ dockerfile ä¹‹ä¸­ï¼Œä¾†è®“ä¸€ä»½ dockerfile å¯ä»¥ç™¼å¸ƒå¤šç¨®ä¸åŒçš„æˆå“ï¼Œä¸¦ä¸”ä½¿ç”¨ç›¸åŒçš„å»ºç½®éšæ®µã€‚ é€™é‚Šä½¿ç”¨çš„ github repo ç‚º YuChia-Wei/otel-dotnet-auto-instrumentation ","date":"2025-07-16","objectID":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/:0:0","series":[],"tags":["dotnet","docker","containerize"],"title":"åœ¨ dockerfile å…§ä½¿ç”¨ alpine çš„ dotnet sdk image å»ºç½® dotnet æœå‹™","uri":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/#"},{"categories":["dotnet"],"content":" 1 åˆ©ç”¨å»ºç½®è®Šæ•¸æ§åˆ¶ dotnet ç‰ˆæœ¬èˆ‡ os ç‰ˆæœ¬dockerfile å¯ä»¥åˆ©ç”¨è®Šæ•¸ä¾†æ§åˆ¶è¨±å¤šéƒ¨ä»½ï¼Œåœ¨é€™é‚Šå°±åˆ©ç”¨äº†è®Šæ•¸ä¾†æ§åˆ¶å»ºç½®çš„ dotnet ç‰ˆæœ¬ä»¥åŠè¦å»ºç½®çš„ os ç‰ˆæœ¬ï¼Œæœ€çµ‚å¯ä»¥é”åˆ°åˆ©ç”¨ä»¥ä¸‹çš„ docker build å‘½ä»¤ä¾†è®Šæ›å»ºç½®æˆå“çš„ dotnet ç‰ˆæœ¬èˆ‡ os é¡å‹ã€‚ shell docker build --build-arg dotnetVersion=8.0 --build-arg releaseOsType=linux -t my-app:latest . ","date":"2025-07-16","objectID":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/:1:0","series":[],"tags":["dotnet","docker","containerize"],"title":"åœ¨ dockerfile å…§ä½¿ç”¨ alpine çš„ dotnet sdk image å»ºç½® dotnet æœå‹™","uri":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/#åˆ©ç”¨å»ºç½®è®Šæ•¸æ§åˆ¶-dotnet-ç‰ˆæœ¬èˆ‡-os-ç‰ˆæœ¬"},{"categories":["dotnet"],"content":" 1.1 OS åƒæ•¸ linux = debian / ubuntu linux-musl = alpine ","date":"2025-07-16","objectID":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/:1:1","series":[],"tags":["dotnet","docker","containerize"],"title":"åœ¨ dockerfile å…§ä½¿ç”¨ alpine çš„ dotnet sdk image å»ºç½® dotnet æœå‹™","uri":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/#os-åƒæ•¸"},{"categories":["dotnet"],"content":" 1.2 dockerfile - å»ºç½®éšæ®µ dockerfile FROM mcr.microsoft.com/dotnet/sdk:8.0-alpine AS build ARG dotnetVersion=8.0 ARG releaseOsType=linux WORKDIR /src COPY [\"OpenTelemetry.AutoInstrumentation.AspNetCore.Plugins/OpenTelemetry.AutoInstrumentation.AspNetCore.Plugins.csproj\", \"OpenTelemetry.AutoInstrumentation.AspNetCore.Plugins/\"] RUN dotnet restore \"OpenTelemetry.AutoInstrumentation.AspNetCore.Plugins/OpenTelemetry.AutoInstrumentation.AspNetCore.Plugins.csproj\" \\ COPY . . WORKDIR \"/src/OpenTelemetry.AutoInstrumentation.AspNetCore.Plugins\" RUN dotnet build \"OpenTelemetry.AutoInstrumentation.AspNetCore.Plugins.csproj\" \\ -c Release \\ -o /app/build \\ -f net${dotnetVersion} \\ --os ${releaseOsType} \\ --arch x64 FROM build AS publish ARG dotnetVersion=8.0 ARG releaseOsType=linux RUN dotnet publish \"OpenTelemetry.AutoInstrumentation.AspNetCore.Plugins.csproj\" \\ -c Release \\ -o /app/publish \\ -f net${dotnetVersion} \\ --os ${releaseOsType} \\ --arch x64 ","date":"2025-07-16","objectID":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/:1:2","series":[],"tags":["dotnet","docker","containerize"],"title":"åœ¨ dockerfile å…§ä½¿ç”¨ alpine çš„ dotnet sdk image å»ºç½® dotnet æœå‹™","uri":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/#dockerfile---å»ºç½®éšæ®µ"},{"categories":["dotnet"],"content":" 1.3 åƒè€ƒè³‡æ–™ dotnet build åƒè€ƒæ–‡ä»¶ dotnet publish åƒè€ƒæ–‡ä»¶ os rid åƒè€ƒæ–‡ä»¶ os type list (rid list) ","date":"2025-07-16","objectID":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/:1:3","series":[],"tags":["dotnet","docker","containerize"],"title":"åœ¨ dockerfile å…§ä½¿ç”¨ alpine çš„ dotnet sdk image å»ºç½® dotnet æœå‹™","uri":"/2025/07/use-dotnet-sdk-alpine-in-docker-file/#åƒè€ƒè³‡æ–™"},{"categories":[],"content":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 3 : å…¶ä»–åŒ…è£æ–¹æ³•","date":"2025-07-16","objectID":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 3 : å…¶ä»–åŒ…è£æ–¹æ³•","uri":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/"},{"categories":[],"content":"å…ˆå‰åœ¨æ’°å¯« wrapping response action filter çš„æ™‚å€™å…¶å¯¦æœ‰åˆ©ç”¨ ChatGPT é€²è¡Œè¼”åŠ©ï¼Œåœ¨èˆ‡ ChatGPT å°è©±çš„éç¨‹ä¸­ä¹Ÿæœ‰è¨è«–åˆ°ä½¿ç”¨ Middleware è™•ç†å›æ‡‰åŒ…è£çš„éƒ¨åˆ†ï¼Œæˆ‘æƒ³åˆ©ç”¨é€™ä¸€ç¯‡è¨˜éŒ„ä¸€ä¸‹ç•¶æ™‚çš„å°è©±å…§å®¹ä»¥åŠçµè«–ã€‚ å› æ­¤ï¼Œæœ¬æ–‡å¤§éƒ¨åˆ†å…§å®¹éƒ½æ˜¯ç”± AI ç”¢å‡ºï¼Œæˆ‘å†é€²è¡Œæ•´ç†èˆ‡èª¿æ•´ã€‚ è­¦å‘Š æœ¬æ–‡ä¸­æ‰€ä½¿ç”¨çš„æ–¹å¼æˆ‘ä¸¦æ²’æœ‰åœ¨æ­£å¼ç’°å¢ƒä¸­ä½¿ç”¨ï¼Œåƒ…æ˜¯å› ç‚ºåœ¨å…ˆå‰èˆ‡ ChatGPT è¨è«–çš„éç¨‹ä¸­æœ‰é‡å°é€™ç¨®åšæ³•é€²è¡Œè¨è«–ï¼Œç„¶å¾Œè¦ºå¾—é€™æ®µé©åˆä¿ç•™ä¸‹ä¾†è€Œæœ‰é€™ä¸€ç¯‡æ–‡ç« ã€‚ åœ¨ ASP.NET Core ä¸­çµ±ä¸€åŒ…è£ API å›æ‡‰å…§å®¹æ˜¯è¨±å¤šé–‹ç™¼åœ˜éšŠæœƒæ¡ç”¨çš„å·¥ç¨‹å¯¦è¸ï¼Œç‰¹åˆ¥æ˜¯ç•¶æˆ‘å€‘å¸Œæœ›æ‰€æœ‰å›å‚³çµæœéƒ½æœ‰ä¸€è‡´æ ¼å¼ã€æ”œå¸¶è¿½è¹¤è³‡è¨Šï¼ˆå¦‚ traceIdï¼‰ã€ä»¥åŠèƒ½æ˜ç¢ºæ¨™ç¤ºæˆåŠŸèˆ‡å¦çš„æƒ…æ³ä¸‹ã€‚ æˆ‘åœ¨å¯¦å‹™ä¸­å·²ç¶“æ¡ç”¨ Action Filter ä½œç‚ºä¸»è¦çš„å¯¦ä½œæ–¹å¼ï¼Œé€™ç¯‡æ–‡ç« æœƒè£œå……èªªæ˜é™¤äº† Action Filter å¤–ï¼Œé‚„æœ‰å“ªäº›å¯è¡Œæ–¹æ¡ˆï¼Œä»¥åŠæ¯ç¨®æ–¹å¼çš„ç‰¹æ€§èˆ‡é™åˆ¶ï¼Œå¹«åŠ©åœ˜éšŠé¸æ“‡æœ€é©åˆçš„æ•´åˆé»ã€‚ ","date":"2025-07-16","objectID":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/:0:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 3 : å…¶ä»–åŒ…è£æ–¹æ³•","uri":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/#"},{"categories":[],"content":" 4 âœ… å·²æ¡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ Action Filter åŒ…è£ API å›æ‡‰é€™è£¡ä¸è´…è¿°å¯¦ä½œç´°ç¯€ï¼Œä½†ä½¿ç”¨ ActionFilterAttribute å¯¦ä½œçš„å„ªé»åŒ…æ‹¬ï¼š å¯ä»¥åœ¨ OnActionExecuted ä¸­å–å¾— Result ä¸¦é‡æ–°åŒ…è£ å¯è®€å– HttpContextï¼ˆä¾‹å¦‚ traceId headerï¼‰ å®¹æ˜“è¨»å†Šç‚ºå…¨åŸŸ filterï¼Œæˆ–ç”¨ [ServiceFilter]ã€[TypeFilter] å¥—ç”¨åˆ°ç‰¹å®š controller/action æ­é…æ³›å‹ ApiResponse\u003cT\u003e å¯è®“ Swagger ç”¢ç”Ÿæ­£ç¢ºæ–‡ä»¶ ä¸éï¼Œé€™ç¨®æ–¹å¼åªèƒ½è™•ç† Action æˆåŠŸåŸ·è¡Œå¾Œçš„å›æ‡‰ï¼Œä¾‹å¤–è™•ç†ä»éœ€é¡å¤–è£œå¼·ã€‚ ","date":"2025-07-16","objectID":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/:1:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 3 : å…¶ä»–åŒ…è£æ–¹æ³•","uri":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/#-å·²æ¡ç”¨æ–¹æ¡ˆä½¿ç”¨-action-filter-åŒ…è£-api-å›æ‡‰"},{"categories":[],"content":" 5 ğŸš€ æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ Middleware åŒ…è£ API Responseå¦ä¸€ç¨®å¸¸è¦‹æ–¹å¼æ˜¯åœ¨ ASP.NET Core çš„ Middleware pipeline ä¸­é€²è¡ŒåŒ…è£ã€‚ é€™ç¨®æ–¹å¼å…·æœ‰è¼ƒä½éšã€å…¨åŸŸã€å¯æŒæ§ä¾‹å¤–èˆ‡æ‰€æœ‰å›æ‡‰å…§å®¹çš„ç‰¹æ€§ã€‚ ","date":"2025-07-16","objectID":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/:2:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 3 : å…¶ä»–åŒ…è£æ–¹æ³•","uri":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/#-æ›¿ä»£æ–¹æ¡ˆä½¿ç”¨-middleware-åŒ…è£-api-response"},{"categories":[],"content":" 5.1 å„ªé»ï¼š èƒ½è™•ç†æ‰€æœ‰ HTTP å›æ‡‰ï¼ŒåŒ…å«ä¾‹å¤–ï¼ˆExceptionï¼‰ èƒ½å®Œæ•´æ””æˆªä¸¦æ”¹å¯« Response.Body èˆ‡ Action ç„¡é—œï¼Œä¸éœ€ä¾è³´ MVC æˆ–æ§åˆ¶å™¨é‚è¼¯ ","date":"2025-07-16","objectID":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/:2:1","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 3 : å…¶ä»–åŒ…è£æ–¹æ³•","uri":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/#å„ªé»"},{"categories":[],"content":" 5.2 ç¼ºé»ï¼š éœ€è¤‡è£½/æš«å­˜ Response.Bodyï¼ˆMemoryStreamï¼‰ ç„¡æ³•é€éæ³›å‹ç›´æ¥å»ºç«‹ Swagger æ–‡ä»¶ éœ€è‡ªè¡Œåˆ¤æ–·ä½•æ™‚ä¸åŒ…è£ï¼ˆå¦‚ Swagger, health check, åœ–ç‰‡ç­‰ï¼‰ ","date":"2025-07-16","objectID":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/:2:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 3 : å…¶ä»–åŒ…è£æ–¹æ³•","uri":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/#ç¼ºé»"},{"categories":[],"content":" 5.3 ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼ˆç°¡åŒ–ç‰ˆï¼‰ï¼š csharp public class ApiResponseMiddleware : IMiddleware { public async Task InvokeAsync(HttpContext context, RequestDelegate next) { var originalBody = context.Response.Body; using var tempStream = new MemoryStream(); context.Response.Body = tempStream; try { await next(context); tempStream.Seek(0, SeekOrigin.Begin); var bodyText = await new StreamReader(tempStream).ReadToEndAsync(); tempStream.Seek(0, SeekOrigin.Begin); var wrapped = new ApiResponse\u003cobject\u003e { Success = context.Response.StatusCode is \u003e= 200 and \u003c 300, Data = JsonConvert.DeserializeObject\u003cobject\u003e(bodyText), TraceId = context.TraceIdentifier }; context.Response.ContentType = \"application/json\"; var result = JsonConvert.SerializeObject(wrapped); await context.Response.WriteAsync(result); } catch (Exception ex) { context.Response.StatusCode = 500; var error = new ApiResponse\u003cstring\u003e { Success = false, Message = \"Internal Server Error\", Data = ex.Message, TraceId = context.TraceIdentifier }; await context.Response.WriteAsync(JsonConvert.SerializeObject(error)); } finally { tempStream.Seek(0, SeekOrigin.Begin); await tempStream.CopyToAsync(originalBody); } } } è¨»ï¼šå¯¦å‹™ä¸Šå»ºè­°åŠ å…¥åˆ¤æ–· Request.Path æ˜¯å¦ç‚º /swagger, /health, æª¢æŸ¥ Content-Type æ˜¯å¦ç‚ºé application/jsonï¼Œä»¥ç•¥éé API å‘¼å«ã€‚ ","date":"2025-07-16","objectID":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/:2:3","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 3 : å…¶ä»–åŒ…è£æ–¹æ³•","uri":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/#ç¯„ä¾‹ç¨‹å¼ç¢¼ç°¡åŒ–ç‰ˆ"},{"categories":[],"content":" 6 ğŸ“š çµèªï¼šå¦‚ä½•é¸æ“‡ï¼Ÿ æŠ€è¡“ èƒ½è™•ç†ä¾‹å¤– èƒ½åŒ…è£é Controller Swagger æ”¯æ´ å¯è®€å– traceId Action Filter âŒï¼ˆéœ€é… ExceptionFilterï¼‰ âŒ âœ…ï¼ˆæ­é…æ³›å‹ï¼‰ âœ… Exception Filter âœ…ï¼ˆController ä¾‹å¤–ï¼‰ âŒ âŒ âœ… Middleware âœ… âœ…ï¼ˆå…¨åŸŸï¼‰ âŒ âœ… å¯¦å‹™å»ºè­°ï¼š è‹¥ä½ çš„æ‡‰ç”¨ç‚ºç´” APIï¼Œå»ºè­° ActionFilter + ExceptionFilter ç‚ºä¸»é«”ï¼ŒMiddleware åšä¾‹å¤–è£œå¼· è‹¥ä½ æƒ³ç¢ºä¿æ‰€æœ‰ response éƒ½æœ‰ä¸€è‡´æ ¼å¼ã€åŒ…å«ä¾‹å¤–æƒ…å¢ƒã€æˆ–ä¸ä¾è³´ MVCï¼Œå¯è€ƒæ…® Middleware å…¨åŒ…è£ç­–ç•¥ æœªä¾†å¯æŒçºŒè§€å¯Ÿ ASP.NET Core åœ¨ ProblemDetailsã€IResultFilterã€UseExceptionHandler ç­‰å…¶ä»–æ©Ÿåˆ¶ä¸Šçš„æ•´åˆæ¼”é€²ã€‚ ","date":"2025-07-16","objectID":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/:3:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 3 : å…¶ä»–åŒ…è£æ–¹æ³•","uri":"/2025/07/aspnetcore-webapi-custom-response-model-part3-wrapping-api-response-the-other-way/#-çµèªå¦‚ä½•é¸æ“‡"},{"categories":[],"content":"ä»Šå¤©æ˜¯ 2024 å¹´çš„æœ€å¾Œä¸€å¤©ï¼Œé›–ç„¶ä¸å¤šï¼Œä½†é‚„æ˜¯å°å°çš„å›é¡§ä¸€ä¸‹ã€‚ ","date":"2024-12-31","objectID":"/2024/12/2024-yearly-retrospective/:0:0","series":["Yearly-Retrospective"],"tags":[],"title":"2024 å¹´åº¦å›é¡§","uri":"/2024/12/2024-yearly-retrospective/#"},{"categories":[],"content":" 2024 å¹´å›é¡§","date":"2024-12-31","objectID":"/2024/12/2024-yearly-retrospective/:0:0","series":["Yearly-Retrospective"],"tags":[],"title":"2024 å¹´åº¦å›é¡§","uri":"/2024/12/2024-yearly-retrospective/#2024-å¹´å›é¡§"},{"categories":[],"content":" 1 è·å ´ç™¼å±•","date":"2024-12-31","objectID":"/2024/12/2024-yearly-retrospective/:1:0","series":["Yearly-Retrospective"],"tags":[],"title":"2024 å¹´åº¦å›é¡§","uri":"/2024/12/2024-yearly-retrospective/#è·å ´ç™¼å±•"},{"categories":[],"content":" 1.1 æ•æ·æ–‡åŒ–ä»Šå¹´å¹´åˆçš„è¾²æ›†å¹´éå¾Œæˆ‘åˆ°äº†ä¸€å€‹å¯¦æ–½ scrum çš„æ•æ·åœ˜éšŠï¼Œé›–ç„¶æ˜¯ä¸€å€‹å¾ˆæƒ³è¦å˜—è©¦èˆ‡å­¸ç¿’çœ‹çœ‹çš„ç’°å¢ƒï¼Œä½†æ˜¯å¿ƒè£¡å¾ˆå¿å¿‘ï¼Œæ“”å¿ƒè‡ªå·±ç„¡æ³•é©æ‡‰ã€‚ ç¶“éé€™å°‡è¿‘ä¸€å¹´çš„åƒèˆ‡ï¼Œé«”æœƒåˆ°äº†å…¨æ•æ·æ–‡åŒ–çš„å¥½è™•ï¼Œé›–ç„¶ä¹Ÿä»æœ‰ä¸€äº›éœ€è¦å†é©æ‡‰æˆ–æ˜¯èˆ‡åœ˜éšŠè¨è«–ä½œæ³•çš„éƒ¨åˆ†ï¼Œä½†æ•´é«”ä¾†èªªèˆ‡è‡ªå·±å°æ•æ·æ–‡åŒ–çš„æœŸå¾…æ˜¯å·®ä¸å¤šçš„ï¼Œäº‹å¯¦ä¸Šä¹Ÿä¸æ˜¯å¾ˆæƒ³å›åˆ°ä»¥å¾€é‚£ç¨®å°ˆæ¡ˆç®¡ç†æ¨¡å¼èˆ‡ç€‘å¸ƒçš„æ–‡åŒ–äº†ã€‚ ","date":"2024-12-31","objectID":"/2024/12/2024-yearly-retrospective/:1:1","series":["Yearly-Retrospective"],"tags":[],"title":"2024 å¹´åº¦å›é¡§","uri":"/2024/12/2024-yearly-retrospective/#æ•æ·æ–‡åŒ–"},{"categories":[],"content":" 1.2 æŠ€è¡“é‹ç”¨é€™ä¸€å¹´åœ¨æŠ€è¡“çš„å­¸ç¿’èˆ‡å¯¦éš›é‹ç”¨æ¯”èµ·å‰å…©å¹´ä¾†èªªæœ‰è‘—ä¸å°çš„è®ŠåŒ–ï¼Œæ•´é«”ä¾†èªªæ›´åå‘äº†è»Ÿé«”åŠŸèƒ½çš„è¨è«–èˆ‡åƒ¹å€¼äº¤ä»˜ç›¸é—œçš„éƒ¨åˆ†ã€‚ é™¤äº†å› ç‚ºç”¢å“è¦æ¨¡èˆ‡ç‰¹æ€§å°è‡´è¨±å¤šä»¥å‰å­¸ç¿’çš„æ¶æ§‹å±¤é¢çš„æ±è¥¿ç”¨ä¸ä¸Šå¤–ï¼Œä¹Ÿå› ç‚ºåœ˜éšŠæ—¢æœ‰çš„å…±è­˜èˆ‡è»Ÿé«”çµæ§‹çš„å½±éŸ¿ä¸‹ï¼Œç›¸æ¯”ä»¥å‰è‡ªå·±ç ”ç©¶ã€é–‹ç™¼ã€æ±ºç­–çš„æ™‚å€™å½ˆæ€§å°‘äº†ä¸å°‘ã€‚ ç¨å¾®æœ‰é»æ‡·å¿µå°å–®ä¸€è»Ÿé«”ä»¥åŠåº•å±¤æ¶æ§‹ã€æŠ€è¡“ã€æœå‹™ç­‰é‹ç”¨éƒ½ç›¸å°å½ˆæ€§çš„æ™‚å€™å‘¢ã€‚ ","date":"2024-12-31","objectID":"/2024/12/2024-yearly-retrospective/:1:2","series":["Yearly-Retrospective"],"tags":[],"title":"2024 å¹´åº¦å›é¡§","uri":"/2024/12/2024-yearly-retrospective/#æŠ€è¡“é‹ç”¨"},{"categories":[],"content":" 2 ç¤¾ç¾¤åƒèˆ‡ä»Šå¹´ä¾ç„¶æŒçºŒåƒèˆ‡å„ç¨®ç¤¾ç¾¤æ´»å‹•ï¼Œé™¤äº†æ¯å‘¨å››æ™šä¸Šçš„ TwMVC å°èšå¤–ï¼Œé‚„åƒèˆ‡äº† DevOps Taipei 2024 / Kubernetes Conf 2024 / COSCUP 2024 / dotnet Conf Taiwan 2024 ç­‰ç­‰ã€‚ å› ç‚ºå»å¹´ ChatGPT çš„èˆˆèµ·ä»¥åŠè¿‘æœŸ AI é‹ç”¨è¶Šä¾†è¶Šæˆç†Ÿï¼Œé€™äº›ç¤¾ç¾¤æ´»å‹•ä¸Šé—œæ–¼ AI çš„é‹ç”¨çœŸçš„æ˜¯è¶Šä¾†è¶Šå¤šäº†å‘¢â€¦â€¦ã€‚ ","date":"2024-12-31","objectID":"/2024/12/2024-yearly-retrospective/:2:0","series":["Yearly-Retrospective"],"tags":[],"title":"2024 å¹´åº¦å›é¡§","uri":"/2024/12/2024-yearly-retrospective/#ç¤¾ç¾¤åƒèˆ‡"},{"categories":[],"content":" 3 è‡ªå­¸ä»Šå¹´è‡ªå­¸çš„éƒ¨åˆ†ï¼Œç¨å¾®å›æƒ³äº†ä¸€ä¸‹ä¼¼ä¹è¶¨è¿‘æ–¼é›¶ï¼Œæ˜æ˜ AI å¾ˆç†±é–€ä½†ä¹Ÿæ²’ç‰¹åˆ¥å»å­¸ï¼Œé€™ä¸€å¹´å¥½åƒæ€ æƒ°çš„å¤šäº†å‘¢â€¦â€¦ã€‚ ","date":"2024-12-31","objectID":"/2024/12/2024-yearly-retrospective/:3:0","series":["Yearly-Retrospective"],"tags":[],"title":"2024 å¹´åº¦å›é¡§","uri":"/2024/12/2024-yearly-retrospective/#è‡ªå­¸"},{"categories":[],"content":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/"},{"categories":[],"content":"é€™ç¯‡ç‚º ã€Œå¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelã€ çš„ç¬¬äºŒéƒ¨åˆ† ã€ŒåŒ…è£ä¾‹å¤–ã€ã€‚ æˆ‘å°‡ä»‹ç´¹å¦‚ä½•åœ¨ ASP.NET Core Web API ä¸­çµ±ä¸€è™•ç†ä¾‹å¤–ç‹€æ³ï¼Œä¸¦å°‡å…¶åŒ…è£æˆæ¨™æº–åŒ–çš„å›æ‡‰æ ¼å¼ã€‚ æˆ‘æœƒä»‹ç´¹ä»¥ä¸‹å…©ç¨®ä¾‹å¤–è³‡æ–™çš„åŒ…è£æ–¹æ³•ï¼š ä½¿ç”¨ UseExceptionHandler Middleware ä½¿ç”¨ IExceptionFilter ä»‹é¢ è³‡è¨Š ä»¥ä¸‹å…§å®¹ä½¿ç”¨ dotnet 9 çš„ AspNetCore WebApi é€²è¡Œæ¸¬è©¦èˆ‡é–‹ç™¼ï¼Œç›¸é—œç¯„ä¾‹ç¨‹å¼ç¢¼å¯ä»¥åœ¨æˆ‘çš„ github repo æ‰¾åˆ° ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:0:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#"},{"categories":[],"content":" 2 AspNetCore WebApi çš„ä¾‹å¤–è™•ç†åœ¨ä¸Šä¸€ç¯‡çš„ä»‹ç´¹å¯ä»¥ç†è§£åˆ°ï¼Œè¦è™•ç† api çš„å›æ‡‰è³‡æ–™æ™‚ä½¿ç”¨ ActionFilter æ˜¯æœ€ä¾¿æ·çš„åšæ³•ï¼Œé‚£å¦‚æœç³»çµ±ç™¼ç”Ÿä¾‹å¤–çš„è©±æ˜¯ä¸æ˜¯ä¹Ÿèƒ½ç”¨ ActionFilter è™•ç†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚ åœ¨å¾®è»Ÿçš„ ActionFilter ç³»åˆ—çš„ä»‹é¢ä¸­ï¼Œæœ‰ä¸€å€‹ä»‹é¢å«åš IExceptionFilterï¼Œé€™ä¸€å€‹ ActionFilter å°±æ˜¯å°ˆè·è™•ç†ä¾‹å¤–çš„å·¥å…·ï¼Œæˆ‘å€‘åªè¦å¯¦ä½œé€™å€‹ä»‹é¢å°±å¯ä»¥å»ºç«‹ä¸€å€‹å°ˆé–€è™•ç† api å…§éƒ¨å‡ºç¾ä¾‹å¤–æ™‚è©²æ€éº¼å›æ‡‰çš„ ActionFilterã€‚ è³‡è¨Š Filter é¡åˆ¥çš„åŸ·è¡Œé †åºå¯ä»¥æŸ¥é–± MS Learn ï¼Œé€™é‚Šä¸å¦å¤–èªªæ˜ã€‚ ä¸éï¼Œåœ¨é–‹å§‹ä¹‹å‰æˆ‘æƒ³å…ˆä»‹ç´¹å¦å¤–ä¸€å€‹è¼ƒç‚ºæš´åŠ›çš„ä¾‹å¤–è™•ç†æ©Ÿåˆ¶ UseExceptionHandler é€™å€‹ middlewareï¼Œä¸¦ä¸”åˆ©ç”¨é€™å€‹ middleware åŒ…è£ä¾‹å¤–å›æ‡‰è³‡æ–™ã€‚ ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#aspnetcore-webapi-çš„ä¾‹å¤–è™•ç†"},{"categories":[],"content":" 2.1 ä½¿ç”¨ UseExceptionHandler è™•ç†ä¾‹å¤–ä¸¦åŒ…è£å›æ‡‰è³‡æ–™UseExceptionHandler é€™å€‹ middleware æ˜¯åœ¨ dotnet 8 æ‰é–‹å§‹æ”¯æ´çš„ middlewareï¼Œé€™å€‹ middleware å¯ä»¥æ•æ‰ç³»çµ±å…§çš„æ‰€æœ‰ä¾‹å¤–ï¼Œä¸¦ä¸”è‡ªè¨‚ä¾‹å¤–è™•ç†çš„è¡Œç‚ºï¼Œæ‰€ä»¥ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨é€™å€‹ middleware ä¾†åŒ…è£å›æ‡‰è³‡æ–™ã€‚ é—œæ–¼å…¶ä»–è‡ªè¨‚ UseExceptionHandler é€™å€‹ middleware çš„ç´°ç¯€å¯ä»¥åœ¨å¾®è»Ÿçš„ MS Learn - ASP.NET Core éŒ¯èª¤è™•ç† ä¸­å¯ä»¥æŸ¥é–±ã€‚ æˆ‘é€™é‚Šè¦ç”¨çš„æ–¹å¼æ˜¯æ¯”è¼ƒç°¡å–®çš„åœ¨ UserExceptionHandler ä¸­ç›´æ¥ç”¨ lambda è¨­å®šè™•ç†æ–¹æ³•ï¼Œå…¶ä»–è©³ç´°èªªæ˜å¯ä»¥åƒé–± å¾®è»Ÿå®˜æ–¹èªªæ˜é€£çµã€‚ 2.1.1 å–å¾—ä¾‹å¤–è³‡è¨Šåœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ context.Features.Get\u003cIExceptionHandlerPathFeature\u003e(); å–å¾—è©²æ¬¡ä¾‹å¤–çš„è³‡è¨Šï¼Œé€™å€‹è³‡è¨ŠåŒ…å«è©²æ¬¡ä¾‹å¤–ç™¼ç”Ÿçš„è·¯å¾‘ã€ä¾‹å¤–è³‡è¨Šã€ä¾‹å¤–ç‰©ä»¶ç­‰è³‡è¨Šã€‚ é€™é‚Šæœƒè¦æ³¨æ„çš„æ˜¯ï¼Œcontext.Features.Get\u003cIExceptionHandlerPathFeature\u003e(); é€™å€‹æ–¹æ³•å–å‡ºçš„ IExceptionHandlerPathFeature å¯èƒ½ç‚º nullï¼Œæ‰€ä»¥é€™é‚Šå»ºè­°å¦å¤–æª¢æŸ¥ä¸€æ¬¡ï¼Œä¸éï¼Œå› ç‚ºæ˜¯ç™¼ç”Ÿä¾‹å¤–ç‹€æ³æ‰é€²å…¥é€™å€‹ middlewareï¼Œç†è«–ä¸Šä¸æœƒæœ‰å–ä¸åˆ°çš„ç‹€æ³ï¼Œæ‰€ä»¥ï¼Œæ˜¯å¦è¦æª¢æŸ¥ null ç«¯çœ‹å€‹äººã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get\u003cIExceptionHandlerPathFeature\u003e(); var exception = exceptionHandlerPathFeature?.Error; Console.Error.WriteLine(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exceptionMessage, exception?.ToString()); }); }); 2.1.2 å–å¾—æ³¨å…¥ç‰©ä»¶åœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨ context.RequestServices.GetRequiredService\u003cT\u003e(); æ–¹æ³•ä¾†å–å¾—å·²æ³¨å…¥çš„ç‰©ä»¶ï¼Œå¦‚ AutoMapper çš„ IMapperï¼Œæˆ–æ˜¯ ILogger ç­‰ï¼Œä¹Ÿå¯ä»¥æ‹¿ä¾†å–å¾— IOption ä¸­çš„è‡ªè¨‚è¨­å®šã€‚ æ‰€ä»¥é€™é‚Šæˆ‘åˆ©ç”¨ context.RequestServices.GetRequiredService\u003cILogger\u003e(); ä¾†å–å¾— ILogger ç‰©ä»¶ï¼Œä¸¦ä¸”åˆ©ç”¨å®ƒä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šï¼Œæ›¿æ›æ‰å‰é¢æˆ‘å€‘åœ¨ console ä¸­è¨˜éŒ„ä¾‹å¤–è³‡è¨Šçš„åšæ³•ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService\u003cILogger\u003e(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get\u003cIExceptionHandlerPathFeature\u003e(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); }); }); 2.1.3 å»ºç«‹å›æ‡‰è³‡æ–™åˆ©ç”¨ ILogger ç´€éŒ„å¥½äº†éŒ¯èª¤å¾Œï¼Œæˆ‘å€‘æ¥è‘—ä¾†èª¿æ•´å›æ‡‰è³‡æ–™ã€‚ é¦–å…ˆï¼Œæˆ‘å€‘è¦ä½¿ç”¨åœ¨å‰ä¸€ç« ç¯€ä¸­å»ºç«‹çš„ ApiResponse\u003cT\u003e ç‰©ä»¶ä¾†å»ºç«‹æ¨™æº–åŒ–çš„å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”ä½¿ç”¨ ApiErrorInformation é€™å€‹ç‰©ä»¶ä¾†ä½œç‚ºæˆ‘å€‘çš„éŒ¯èª¤å›æ‡‰å…§å®¹ï¼Œä»¥ä¸‹æ˜¯ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š ApiErrorInformation ä¸­çš„ ErrorCode é€™å€‹å±¬æ€§ï¼Œæ‰€ä»¥é€™é‚Šæˆ‘å€‘å…ˆå®šç¾©ä¸€å€‹éŒ¯èª¤ä»£ç¢¼ err-unknown ä¾†ä½œç‚ºéŒ¯èª¤çš„ä»£ç¢¼ã€‚ å¦å¤–ï¼ŒApiResponse\u003cT\u003e ä¸­çš„ Id é€™å€‹å±¬æ€§ï¼Œä¹Ÿèˆ‡ ç¬¬ä¸€éƒ¨åˆ† ä¸€æ¨£ï¼Œæ˜¯åˆ©ç”¨ Activity.Current?.TraceId.ToString() ä¾†å–å¾—è©²æ¬¡éŒ¯èª¤çš„è¿½è¹¤ç·¨è™Ÿï¼Œä¸¦ä¸”è¨­å®šåˆ° Id é€™å€‹å±¬æ€§ä¸­ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService\u003cILogger\u003e(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get\u003cIExceptionHandlerPathFeature\u003e(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); // å»ºç«‹åŒ…å«éŒ¯èª¤è³‡è¨Šçš„ api response ç‰©ä»¶ var failResultViewModel = new ApiResponse\u003cApiErrorInformation\u003e { Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.Request.Path}.{context.Request.Method}\", Data = new ApiErrorInformation { ErrorCode = \"err-unknown\", Message = exception?.Message, Description = exception?.ToString() } }; await context.Response.WriteAsJsonAsync(failResultViewModel); }); }); 2.1.4 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨å‰é¢ç« ç¯€æˆ‘å€‘åœ¨è¨­å®š ApiErrorInformation çš„ Description å±¬æ€§æ™‚ï¼Œæˆ‘å€‘æ˜¯ç›´æ¥ä½¿ç”¨ exception?.ToString() ä¾†å–å¾—ä¾‹å¤–è³‡è¨Šï¼Œé€™æ¨£åšé›–ç„¶å¯ä»¥å–å¾—è¼ƒå®Œæ•´çš„ä¾‹å¤–è³‡è¨Šï¼Œä½†æ˜¯ï¼Œé€™æ¨£çš„ä½œæ³•æœƒå°‡ç³»çµ±çš„å¯¦ä½œç´°ç¯€æš´éœ²çµ¦èª¿ç”¨ç«¯ï¼Œé€™æ¨£çš„ä½œæ³•åœ¨æ­£å¼ç’°å¢ƒä¸­æ˜¯çµ•å°ä¸è¢«å…è¨±çš„ã€‚ æ‰€ä»¥ï¼Œåœ¨é€™é‚Šæˆ‘å€‘å¯ä»¥åˆ©ç”¨ app.Environment.IsProduction() é€™å€‹å±¬æ€§ä¾†åˆ¤æ–·ç›®å‰ç³»çµ±çš„é‹ä½œç’°å¢ƒä¸¦ä¸” api è¦å›å‚³çš„è³‡è¨Šï¼Œé¿å…æ­éœ²ä¸æ‡‰è©²æš´éœ²çš„è³‡è¨Šã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService\u003cILogger\u003e(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get\u003cIExceptionHandlerPathFeature\u003e(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Excep","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:1","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#ä½¿ç”¨-useexceptionhandler-è™•ç†ä¾‹å¤–ä¸¦åŒ…è£å›æ‡‰è³‡æ–™"},{"categories":[],"content":" 2.1 ä½¿ç”¨ UseExceptionHandler è™•ç†ä¾‹å¤–ä¸¦åŒ…è£å›æ‡‰è³‡æ–™UseExceptionHandler é€™å€‹ middleware æ˜¯åœ¨ dotnet 8 æ‰é–‹å§‹æ”¯æ´çš„ middlewareï¼Œé€™å€‹ middleware å¯ä»¥æ•æ‰ç³»çµ±å…§çš„æ‰€æœ‰ä¾‹å¤–ï¼Œä¸¦ä¸”è‡ªè¨‚ä¾‹å¤–è™•ç†çš„è¡Œç‚ºï¼Œæ‰€ä»¥ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨é€™å€‹ middleware ä¾†åŒ…è£å›æ‡‰è³‡æ–™ã€‚ é—œæ–¼å…¶ä»–è‡ªè¨‚ UseExceptionHandler é€™å€‹ middleware çš„ç´°ç¯€å¯ä»¥åœ¨å¾®è»Ÿçš„ MS Learn - ASP.NET Core éŒ¯èª¤è™•ç† ä¸­å¯ä»¥æŸ¥é–±ã€‚ æˆ‘é€™é‚Šè¦ç”¨çš„æ–¹å¼æ˜¯æ¯”è¼ƒç°¡å–®çš„åœ¨ UserExceptionHandler ä¸­ç›´æ¥ç”¨ lambda è¨­å®šè™•ç†æ–¹æ³•ï¼Œå…¶ä»–è©³ç´°èªªæ˜å¯ä»¥åƒé–± å¾®è»Ÿå®˜æ–¹èªªæ˜é€£çµã€‚ 2.1.1 å–å¾—ä¾‹å¤–è³‡è¨Šåœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ context.Features.Get(); å–å¾—è©²æ¬¡ä¾‹å¤–çš„è³‡è¨Šï¼Œé€™å€‹è³‡è¨ŠåŒ…å«è©²æ¬¡ä¾‹å¤–ç™¼ç”Ÿçš„è·¯å¾‘ã€ä¾‹å¤–è³‡è¨Šã€ä¾‹å¤–ç‰©ä»¶ç­‰è³‡è¨Šã€‚ é€™é‚Šæœƒè¦æ³¨æ„çš„æ˜¯ï¼Œcontext.Features.Get(); é€™å€‹æ–¹æ³•å–å‡ºçš„ IExceptionHandlerPathFeature å¯èƒ½ç‚º nullï¼Œæ‰€ä»¥é€™é‚Šå»ºè­°å¦å¤–æª¢æŸ¥ä¸€æ¬¡ï¼Œä¸éï¼Œå› ç‚ºæ˜¯ç™¼ç”Ÿä¾‹å¤–ç‹€æ³æ‰é€²å…¥é€™å€‹ middlewareï¼Œç†è«–ä¸Šä¸æœƒæœ‰å–ä¸åˆ°çš„ç‹€æ³ï¼Œæ‰€ä»¥ï¼Œæ˜¯å¦è¦æª¢æŸ¥ null ç«¯çœ‹å€‹äººã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; Console.Error.WriteLine(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exceptionMessage, exception?.ToString()); }); }); 2.1.2 å–å¾—æ³¨å…¥ç‰©ä»¶åœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨ context.RequestServices.GetRequiredService(); æ–¹æ³•ä¾†å–å¾—å·²æ³¨å…¥çš„ç‰©ä»¶ï¼Œå¦‚ AutoMapper çš„ IMapperï¼Œæˆ–æ˜¯ ILogger ç­‰ï¼Œä¹Ÿå¯ä»¥æ‹¿ä¾†å–å¾— IOption ä¸­çš„è‡ªè¨‚è¨­å®šã€‚ æ‰€ä»¥é€™é‚Šæˆ‘åˆ©ç”¨ context.RequestServices.GetRequiredService(); ä¾†å–å¾— ILogger ç‰©ä»¶ï¼Œä¸¦ä¸”åˆ©ç”¨å®ƒä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šï¼Œæ›¿æ›æ‰å‰é¢æˆ‘å€‘åœ¨ console ä¸­è¨˜éŒ„ä¾‹å¤–è³‡è¨Šçš„åšæ³•ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); }); }); 2.1.3 å»ºç«‹å›æ‡‰è³‡æ–™åˆ©ç”¨ ILogger ç´€éŒ„å¥½äº†éŒ¯èª¤å¾Œï¼Œæˆ‘å€‘æ¥è‘—ä¾†èª¿æ•´å›æ‡‰è³‡æ–™ã€‚ é¦–å…ˆï¼Œæˆ‘å€‘è¦ä½¿ç”¨åœ¨å‰ä¸€ç« ç¯€ä¸­å»ºç«‹çš„ ApiResponse ç‰©ä»¶ä¾†å»ºç«‹æ¨™æº–åŒ–çš„å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”ä½¿ç”¨ ApiErrorInformation é€™å€‹ç‰©ä»¶ä¾†ä½œç‚ºæˆ‘å€‘çš„éŒ¯èª¤å›æ‡‰å…§å®¹ï¼Œä»¥ä¸‹æ˜¯ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š ApiErrorInformation ä¸­çš„ ErrorCode é€™å€‹å±¬æ€§ï¼Œæ‰€ä»¥é€™é‚Šæˆ‘å€‘å…ˆå®šç¾©ä¸€å€‹éŒ¯èª¤ä»£ç¢¼ err-unknown ä¾†ä½œç‚ºéŒ¯èª¤çš„ä»£ç¢¼ã€‚ å¦å¤–ï¼ŒApiResponse ä¸­çš„ Id é€™å€‹å±¬æ€§ï¼Œä¹Ÿèˆ‡ ç¬¬ä¸€éƒ¨åˆ† ä¸€æ¨£ï¼Œæ˜¯åˆ©ç”¨ Activity.Current?.TraceId.ToString() ä¾†å–å¾—è©²æ¬¡éŒ¯èª¤çš„è¿½è¹¤ç·¨è™Ÿï¼Œä¸¦ä¸”è¨­å®šåˆ° Id é€™å€‹å±¬æ€§ä¸­ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); // å»ºç«‹åŒ…å«éŒ¯èª¤è³‡è¨Šçš„ api response ç‰©ä»¶ var failResultViewModel = new ApiResponse { Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.Request.Path}.{context.Request.Method}\", Data = new ApiErrorInformation { ErrorCode = \"err-unknown\", Message = exception?.Message, Description = exception?.ToString() } }; await context.Response.WriteAsJsonAsync(failResultViewModel); }); }); 2.1.4 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨å‰é¢ç« ç¯€æˆ‘å€‘åœ¨è¨­å®š ApiErrorInformation çš„ Description å±¬æ€§æ™‚ï¼Œæˆ‘å€‘æ˜¯ç›´æ¥ä½¿ç”¨ exception?.ToString() ä¾†å–å¾—ä¾‹å¤–è³‡è¨Šï¼Œé€™æ¨£åšé›–ç„¶å¯ä»¥å–å¾—è¼ƒå®Œæ•´çš„ä¾‹å¤–è³‡è¨Šï¼Œä½†æ˜¯ï¼Œé€™æ¨£çš„ä½œæ³•æœƒå°‡ç³»çµ±çš„å¯¦ä½œç´°ç¯€æš´éœ²çµ¦èª¿ç”¨ç«¯ï¼Œé€™æ¨£çš„ä½œæ³•åœ¨æ­£å¼ç’°å¢ƒä¸­æ˜¯çµ•å°ä¸è¢«å…è¨±çš„ã€‚ æ‰€ä»¥ï¼Œåœ¨é€™é‚Šæˆ‘å€‘å¯ä»¥åˆ©ç”¨ app.Environment.IsProduction() é€™å€‹å±¬æ€§ä¾†åˆ¤æ–·ç›®å‰ç³»çµ±çš„é‹ä½œç’°å¢ƒä¸¦ä¸” api è¦å›å‚³çš„è³‡è¨Šï¼Œé¿å…æ­éœ²ä¸æ‡‰è©²æš´éœ²çš„è³‡è¨Šã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Excep","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:1","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#å–å¾—ä¾‹å¤–è³‡è¨Š"},{"categories":[],"content":" 2.1 ä½¿ç”¨ UseExceptionHandler è™•ç†ä¾‹å¤–ä¸¦åŒ…è£å›æ‡‰è³‡æ–™UseExceptionHandler é€™å€‹ middleware æ˜¯åœ¨ dotnet 8 æ‰é–‹å§‹æ”¯æ´çš„ middlewareï¼Œé€™å€‹ middleware å¯ä»¥æ•æ‰ç³»çµ±å…§çš„æ‰€æœ‰ä¾‹å¤–ï¼Œä¸¦ä¸”è‡ªè¨‚ä¾‹å¤–è™•ç†çš„è¡Œç‚ºï¼Œæ‰€ä»¥ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨é€™å€‹ middleware ä¾†åŒ…è£å›æ‡‰è³‡æ–™ã€‚ é—œæ–¼å…¶ä»–è‡ªè¨‚ UseExceptionHandler é€™å€‹ middleware çš„ç´°ç¯€å¯ä»¥åœ¨å¾®è»Ÿçš„ MS Learn - ASP.NET Core éŒ¯èª¤è™•ç† ä¸­å¯ä»¥æŸ¥é–±ã€‚ æˆ‘é€™é‚Šè¦ç”¨çš„æ–¹å¼æ˜¯æ¯”è¼ƒç°¡å–®çš„åœ¨ UserExceptionHandler ä¸­ç›´æ¥ç”¨ lambda è¨­å®šè™•ç†æ–¹æ³•ï¼Œå…¶ä»–è©³ç´°èªªæ˜å¯ä»¥åƒé–± å¾®è»Ÿå®˜æ–¹èªªæ˜é€£çµã€‚ 2.1.1 å–å¾—ä¾‹å¤–è³‡è¨Šåœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ context.Features.Get(); å–å¾—è©²æ¬¡ä¾‹å¤–çš„è³‡è¨Šï¼Œé€™å€‹è³‡è¨ŠåŒ…å«è©²æ¬¡ä¾‹å¤–ç™¼ç”Ÿçš„è·¯å¾‘ã€ä¾‹å¤–è³‡è¨Šã€ä¾‹å¤–ç‰©ä»¶ç­‰è³‡è¨Šã€‚ é€™é‚Šæœƒè¦æ³¨æ„çš„æ˜¯ï¼Œcontext.Features.Get(); é€™å€‹æ–¹æ³•å–å‡ºçš„ IExceptionHandlerPathFeature å¯èƒ½ç‚º nullï¼Œæ‰€ä»¥é€™é‚Šå»ºè­°å¦å¤–æª¢æŸ¥ä¸€æ¬¡ï¼Œä¸éï¼Œå› ç‚ºæ˜¯ç™¼ç”Ÿä¾‹å¤–ç‹€æ³æ‰é€²å…¥é€™å€‹ middlewareï¼Œç†è«–ä¸Šä¸æœƒæœ‰å–ä¸åˆ°çš„ç‹€æ³ï¼Œæ‰€ä»¥ï¼Œæ˜¯å¦è¦æª¢æŸ¥ null ç«¯çœ‹å€‹äººã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; Console.Error.WriteLine(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exceptionMessage, exception?.ToString()); }); }); 2.1.2 å–å¾—æ³¨å…¥ç‰©ä»¶åœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨ context.RequestServices.GetRequiredService(); æ–¹æ³•ä¾†å–å¾—å·²æ³¨å…¥çš„ç‰©ä»¶ï¼Œå¦‚ AutoMapper çš„ IMapperï¼Œæˆ–æ˜¯ ILogger ç­‰ï¼Œä¹Ÿå¯ä»¥æ‹¿ä¾†å–å¾— IOption ä¸­çš„è‡ªè¨‚è¨­å®šã€‚ æ‰€ä»¥é€™é‚Šæˆ‘åˆ©ç”¨ context.RequestServices.GetRequiredService(); ä¾†å–å¾— ILogger ç‰©ä»¶ï¼Œä¸¦ä¸”åˆ©ç”¨å®ƒä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šï¼Œæ›¿æ›æ‰å‰é¢æˆ‘å€‘åœ¨ console ä¸­è¨˜éŒ„ä¾‹å¤–è³‡è¨Šçš„åšæ³•ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); }); }); 2.1.3 å»ºç«‹å›æ‡‰è³‡æ–™åˆ©ç”¨ ILogger ç´€éŒ„å¥½äº†éŒ¯èª¤å¾Œï¼Œæˆ‘å€‘æ¥è‘—ä¾†èª¿æ•´å›æ‡‰è³‡æ–™ã€‚ é¦–å…ˆï¼Œæˆ‘å€‘è¦ä½¿ç”¨åœ¨å‰ä¸€ç« ç¯€ä¸­å»ºç«‹çš„ ApiResponse ç‰©ä»¶ä¾†å»ºç«‹æ¨™æº–åŒ–çš„å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”ä½¿ç”¨ ApiErrorInformation é€™å€‹ç‰©ä»¶ä¾†ä½œç‚ºæˆ‘å€‘çš„éŒ¯èª¤å›æ‡‰å…§å®¹ï¼Œä»¥ä¸‹æ˜¯ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š ApiErrorInformation ä¸­çš„ ErrorCode é€™å€‹å±¬æ€§ï¼Œæ‰€ä»¥é€™é‚Šæˆ‘å€‘å…ˆå®šç¾©ä¸€å€‹éŒ¯èª¤ä»£ç¢¼ err-unknown ä¾†ä½œç‚ºéŒ¯èª¤çš„ä»£ç¢¼ã€‚ å¦å¤–ï¼ŒApiResponse ä¸­çš„ Id é€™å€‹å±¬æ€§ï¼Œä¹Ÿèˆ‡ ç¬¬ä¸€éƒ¨åˆ† ä¸€æ¨£ï¼Œæ˜¯åˆ©ç”¨ Activity.Current?.TraceId.ToString() ä¾†å–å¾—è©²æ¬¡éŒ¯èª¤çš„è¿½è¹¤ç·¨è™Ÿï¼Œä¸¦ä¸”è¨­å®šåˆ° Id é€™å€‹å±¬æ€§ä¸­ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); // å»ºç«‹åŒ…å«éŒ¯èª¤è³‡è¨Šçš„ api response ç‰©ä»¶ var failResultViewModel = new ApiResponse { Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.Request.Path}.{context.Request.Method}\", Data = new ApiErrorInformation { ErrorCode = \"err-unknown\", Message = exception?.Message, Description = exception?.ToString() } }; await context.Response.WriteAsJsonAsync(failResultViewModel); }); }); 2.1.4 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨å‰é¢ç« ç¯€æˆ‘å€‘åœ¨è¨­å®š ApiErrorInformation çš„ Description å±¬æ€§æ™‚ï¼Œæˆ‘å€‘æ˜¯ç›´æ¥ä½¿ç”¨ exception?.ToString() ä¾†å–å¾—ä¾‹å¤–è³‡è¨Šï¼Œé€™æ¨£åšé›–ç„¶å¯ä»¥å–å¾—è¼ƒå®Œæ•´çš„ä¾‹å¤–è³‡è¨Šï¼Œä½†æ˜¯ï¼Œé€™æ¨£çš„ä½œæ³•æœƒå°‡ç³»çµ±çš„å¯¦ä½œç´°ç¯€æš´éœ²çµ¦èª¿ç”¨ç«¯ï¼Œé€™æ¨£çš„ä½œæ³•åœ¨æ­£å¼ç’°å¢ƒä¸­æ˜¯çµ•å°ä¸è¢«å…è¨±çš„ã€‚ æ‰€ä»¥ï¼Œåœ¨é€™é‚Šæˆ‘å€‘å¯ä»¥åˆ©ç”¨ app.Environment.IsProduction() é€™å€‹å±¬æ€§ä¾†åˆ¤æ–·ç›®å‰ç³»çµ±çš„é‹ä½œç’°å¢ƒä¸¦ä¸” api è¦å›å‚³çš„è³‡è¨Šï¼Œé¿å…æ­éœ²ä¸æ‡‰è©²æš´éœ²çš„è³‡è¨Šã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Excep","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:1","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#å–å¾—æ³¨å…¥ç‰©ä»¶"},{"categories":[],"content":" 2.1 ä½¿ç”¨ UseExceptionHandler è™•ç†ä¾‹å¤–ä¸¦åŒ…è£å›æ‡‰è³‡æ–™UseExceptionHandler é€™å€‹ middleware æ˜¯åœ¨ dotnet 8 æ‰é–‹å§‹æ”¯æ´çš„ middlewareï¼Œé€™å€‹ middleware å¯ä»¥æ•æ‰ç³»çµ±å…§çš„æ‰€æœ‰ä¾‹å¤–ï¼Œä¸¦ä¸”è‡ªè¨‚ä¾‹å¤–è™•ç†çš„è¡Œç‚ºï¼Œæ‰€ä»¥ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨é€™å€‹ middleware ä¾†åŒ…è£å›æ‡‰è³‡æ–™ã€‚ é—œæ–¼å…¶ä»–è‡ªè¨‚ UseExceptionHandler é€™å€‹ middleware çš„ç´°ç¯€å¯ä»¥åœ¨å¾®è»Ÿçš„ MS Learn - ASP.NET Core éŒ¯èª¤è™•ç† ä¸­å¯ä»¥æŸ¥é–±ã€‚ æˆ‘é€™é‚Šè¦ç”¨çš„æ–¹å¼æ˜¯æ¯”è¼ƒç°¡å–®çš„åœ¨ UserExceptionHandler ä¸­ç›´æ¥ç”¨ lambda è¨­å®šè™•ç†æ–¹æ³•ï¼Œå…¶ä»–è©³ç´°èªªæ˜å¯ä»¥åƒé–± å¾®è»Ÿå®˜æ–¹èªªæ˜é€£çµã€‚ 2.1.1 å–å¾—ä¾‹å¤–è³‡è¨Šåœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ context.Features.Get(); å–å¾—è©²æ¬¡ä¾‹å¤–çš„è³‡è¨Šï¼Œé€™å€‹è³‡è¨ŠåŒ…å«è©²æ¬¡ä¾‹å¤–ç™¼ç”Ÿçš„è·¯å¾‘ã€ä¾‹å¤–è³‡è¨Šã€ä¾‹å¤–ç‰©ä»¶ç­‰è³‡è¨Šã€‚ é€™é‚Šæœƒè¦æ³¨æ„çš„æ˜¯ï¼Œcontext.Features.Get(); é€™å€‹æ–¹æ³•å–å‡ºçš„ IExceptionHandlerPathFeature å¯èƒ½ç‚º nullï¼Œæ‰€ä»¥é€™é‚Šå»ºè­°å¦å¤–æª¢æŸ¥ä¸€æ¬¡ï¼Œä¸éï¼Œå› ç‚ºæ˜¯ç™¼ç”Ÿä¾‹å¤–ç‹€æ³æ‰é€²å…¥é€™å€‹ middlewareï¼Œç†è«–ä¸Šä¸æœƒæœ‰å–ä¸åˆ°çš„ç‹€æ³ï¼Œæ‰€ä»¥ï¼Œæ˜¯å¦è¦æª¢æŸ¥ null ç«¯çœ‹å€‹äººã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; Console.Error.WriteLine(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exceptionMessage, exception?.ToString()); }); }); 2.1.2 å–å¾—æ³¨å…¥ç‰©ä»¶åœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨ context.RequestServices.GetRequiredService(); æ–¹æ³•ä¾†å–å¾—å·²æ³¨å…¥çš„ç‰©ä»¶ï¼Œå¦‚ AutoMapper çš„ IMapperï¼Œæˆ–æ˜¯ ILogger ç­‰ï¼Œä¹Ÿå¯ä»¥æ‹¿ä¾†å–å¾— IOption ä¸­çš„è‡ªè¨‚è¨­å®šã€‚ æ‰€ä»¥é€™é‚Šæˆ‘åˆ©ç”¨ context.RequestServices.GetRequiredService(); ä¾†å–å¾— ILogger ç‰©ä»¶ï¼Œä¸¦ä¸”åˆ©ç”¨å®ƒä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šï¼Œæ›¿æ›æ‰å‰é¢æˆ‘å€‘åœ¨ console ä¸­è¨˜éŒ„ä¾‹å¤–è³‡è¨Šçš„åšæ³•ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); }); }); 2.1.3 å»ºç«‹å›æ‡‰è³‡æ–™åˆ©ç”¨ ILogger ç´€éŒ„å¥½äº†éŒ¯èª¤å¾Œï¼Œæˆ‘å€‘æ¥è‘—ä¾†èª¿æ•´å›æ‡‰è³‡æ–™ã€‚ é¦–å…ˆï¼Œæˆ‘å€‘è¦ä½¿ç”¨åœ¨å‰ä¸€ç« ç¯€ä¸­å»ºç«‹çš„ ApiResponse ç‰©ä»¶ä¾†å»ºç«‹æ¨™æº–åŒ–çš„å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”ä½¿ç”¨ ApiErrorInformation é€™å€‹ç‰©ä»¶ä¾†ä½œç‚ºæˆ‘å€‘çš„éŒ¯èª¤å›æ‡‰å…§å®¹ï¼Œä»¥ä¸‹æ˜¯ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š ApiErrorInformation ä¸­çš„ ErrorCode é€™å€‹å±¬æ€§ï¼Œæ‰€ä»¥é€™é‚Šæˆ‘å€‘å…ˆå®šç¾©ä¸€å€‹éŒ¯èª¤ä»£ç¢¼ err-unknown ä¾†ä½œç‚ºéŒ¯èª¤çš„ä»£ç¢¼ã€‚ å¦å¤–ï¼ŒApiResponse ä¸­çš„ Id é€™å€‹å±¬æ€§ï¼Œä¹Ÿèˆ‡ ç¬¬ä¸€éƒ¨åˆ† ä¸€æ¨£ï¼Œæ˜¯åˆ©ç”¨ Activity.Current?.TraceId.ToString() ä¾†å–å¾—è©²æ¬¡éŒ¯èª¤çš„è¿½è¹¤ç·¨è™Ÿï¼Œä¸¦ä¸”è¨­å®šåˆ° Id é€™å€‹å±¬æ€§ä¸­ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); // å»ºç«‹åŒ…å«éŒ¯èª¤è³‡è¨Šçš„ api response ç‰©ä»¶ var failResultViewModel = new ApiResponse { Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.Request.Path}.{context.Request.Method}\", Data = new ApiErrorInformation { ErrorCode = \"err-unknown\", Message = exception?.Message, Description = exception?.ToString() } }; await context.Response.WriteAsJsonAsync(failResultViewModel); }); }); 2.1.4 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨å‰é¢ç« ç¯€æˆ‘å€‘åœ¨è¨­å®š ApiErrorInformation çš„ Description å±¬æ€§æ™‚ï¼Œæˆ‘å€‘æ˜¯ç›´æ¥ä½¿ç”¨ exception?.ToString() ä¾†å–å¾—ä¾‹å¤–è³‡è¨Šï¼Œé€™æ¨£åšé›–ç„¶å¯ä»¥å–å¾—è¼ƒå®Œæ•´çš„ä¾‹å¤–è³‡è¨Šï¼Œä½†æ˜¯ï¼Œé€™æ¨£çš„ä½œæ³•æœƒå°‡ç³»çµ±çš„å¯¦ä½œç´°ç¯€æš´éœ²çµ¦èª¿ç”¨ç«¯ï¼Œé€™æ¨£çš„ä½œæ³•åœ¨æ­£å¼ç’°å¢ƒä¸­æ˜¯çµ•å°ä¸è¢«å…è¨±çš„ã€‚ æ‰€ä»¥ï¼Œåœ¨é€™é‚Šæˆ‘å€‘å¯ä»¥åˆ©ç”¨ app.Environment.IsProduction() é€™å€‹å±¬æ€§ä¾†åˆ¤æ–·ç›®å‰ç³»çµ±çš„é‹ä½œç’°å¢ƒä¸¦ä¸” api è¦å›å‚³çš„è³‡è¨Šï¼Œé¿å…æ­éœ²ä¸æ‡‰è©²æš´éœ²çš„è³‡è¨Šã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Excep","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:1","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#å»ºç«‹å›æ‡‰è³‡æ–™"},{"categories":[],"content":" 2.1 ä½¿ç”¨ UseExceptionHandler è™•ç†ä¾‹å¤–ä¸¦åŒ…è£å›æ‡‰è³‡æ–™UseExceptionHandler é€™å€‹ middleware æ˜¯åœ¨ dotnet 8 æ‰é–‹å§‹æ”¯æ´çš„ middlewareï¼Œé€™å€‹ middleware å¯ä»¥æ•æ‰ç³»çµ±å…§çš„æ‰€æœ‰ä¾‹å¤–ï¼Œä¸¦ä¸”è‡ªè¨‚ä¾‹å¤–è™•ç†çš„è¡Œç‚ºï¼Œæ‰€ä»¥ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨é€™å€‹ middleware ä¾†åŒ…è£å›æ‡‰è³‡æ–™ã€‚ é—œæ–¼å…¶ä»–è‡ªè¨‚ UseExceptionHandler é€™å€‹ middleware çš„ç´°ç¯€å¯ä»¥åœ¨å¾®è»Ÿçš„ MS Learn - ASP.NET Core éŒ¯èª¤è™•ç† ä¸­å¯ä»¥æŸ¥é–±ã€‚ æˆ‘é€™é‚Šè¦ç”¨çš„æ–¹å¼æ˜¯æ¯”è¼ƒç°¡å–®çš„åœ¨ UserExceptionHandler ä¸­ç›´æ¥ç”¨ lambda è¨­å®šè™•ç†æ–¹æ³•ï¼Œå…¶ä»–è©³ç´°èªªæ˜å¯ä»¥åƒé–± å¾®è»Ÿå®˜æ–¹èªªæ˜é€£çµã€‚ 2.1.1 å–å¾—ä¾‹å¤–è³‡è¨Šåœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ context.Features.Get(); å–å¾—è©²æ¬¡ä¾‹å¤–çš„è³‡è¨Šï¼Œé€™å€‹è³‡è¨ŠåŒ…å«è©²æ¬¡ä¾‹å¤–ç™¼ç”Ÿçš„è·¯å¾‘ã€ä¾‹å¤–è³‡è¨Šã€ä¾‹å¤–ç‰©ä»¶ç­‰è³‡è¨Šã€‚ é€™é‚Šæœƒè¦æ³¨æ„çš„æ˜¯ï¼Œcontext.Features.Get(); é€™å€‹æ–¹æ³•å–å‡ºçš„ IExceptionHandlerPathFeature å¯èƒ½ç‚º nullï¼Œæ‰€ä»¥é€™é‚Šå»ºè­°å¦å¤–æª¢æŸ¥ä¸€æ¬¡ï¼Œä¸éï¼Œå› ç‚ºæ˜¯ç™¼ç”Ÿä¾‹å¤–ç‹€æ³æ‰é€²å…¥é€™å€‹ middlewareï¼Œç†è«–ä¸Šä¸æœƒæœ‰å–ä¸åˆ°çš„ç‹€æ³ï¼Œæ‰€ä»¥ï¼Œæ˜¯å¦è¦æª¢æŸ¥ null ç«¯çœ‹å€‹äººã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; Console.Error.WriteLine(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exceptionMessage, exception?.ToString()); }); }); 2.1.2 å–å¾—æ³¨å…¥ç‰©ä»¶åœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨ context.RequestServices.GetRequiredService(); æ–¹æ³•ä¾†å–å¾—å·²æ³¨å…¥çš„ç‰©ä»¶ï¼Œå¦‚ AutoMapper çš„ IMapperï¼Œæˆ–æ˜¯ ILogger ç­‰ï¼Œä¹Ÿå¯ä»¥æ‹¿ä¾†å–å¾— IOption ä¸­çš„è‡ªè¨‚è¨­å®šã€‚ æ‰€ä»¥é€™é‚Šæˆ‘åˆ©ç”¨ context.RequestServices.GetRequiredService(); ä¾†å–å¾— ILogger ç‰©ä»¶ï¼Œä¸¦ä¸”åˆ©ç”¨å®ƒä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šï¼Œæ›¿æ›æ‰å‰é¢æˆ‘å€‘åœ¨ console ä¸­è¨˜éŒ„ä¾‹å¤–è³‡è¨Šçš„åšæ³•ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); }); }); 2.1.3 å»ºç«‹å›æ‡‰è³‡æ–™åˆ©ç”¨ ILogger ç´€éŒ„å¥½äº†éŒ¯èª¤å¾Œï¼Œæˆ‘å€‘æ¥è‘—ä¾†èª¿æ•´å›æ‡‰è³‡æ–™ã€‚ é¦–å…ˆï¼Œæˆ‘å€‘è¦ä½¿ç”¨åœ¨å‰ä¸€ç« ç¯€ä¸­å»ºç«‹çš„ ApiResponse ç‰©ä»¶ä¾†å»ºç«‹æ¨™æº–åŒ–çš„å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”ä½¿ç”¨ ApiErrorInformation é€™å€‹ç‰©ä»¶ä¾†ä½œç‚ºæˆ‘å€‘çš„éŒ¯èª¤å›æ‡‰å…§å®¹ï¼Œä»¥ä¸‹æ˜¯ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š ApiErrorInformation ä¸­çš„ ErrorCode é€™å€‹å±¬æ€§ï¼Œæ‰€ä»¥é€™é‚Šæˆ‘å€‘å…ˆå®šç¾©ä¸€å€‹éŒ¯èª¤ä»£ç¢¼ err-unknown ä¾†ä½œç‚ºéŒ¯èª¤çš„ä»£ç¢¼ã€‚ å¦å¤–ï¼ŒApiResponse ä¸­çš„ Id é€™å€‹å±¬æ€§ï¼Œä¹Ÿèˆ‡ ç¬¬ä¸€éƒ¨åˆ† ä¸€æ¨£ï¼Œæ˜¯åˆ©ç”¨ Activity.Current?.TraceId.ToString() ä¾†å–å¾—è©²æ¬¡éŒ¯èª¤çš„è¿½è¹¤ç·¨è™Ÿï¼Œä¸¦ä¸”è¨­å®šåˆ° Id é€™å€‹å±¬æ€§ä¸­ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); // å»ºç«‹åŒ…å«éŒ¯èª¤è³‡è¨Šçš„ api response ç‰©ä»¶ var failResultViewModel = new ApiResponse { Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.Request.Path}.{context.Request.Method}\", Data = new ApiErrorInformation { ErrorCode = \"err-unknown\", Message = exception?.Message, Description = exception?.ToString() } }; await context.Response.WriteAsJsonAsync(failResultViewModel); }); }); 2.1.4 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨å‰é¢ç« ç¯€æˆ‘å€‘åœ¨è¨­å®š ApiErrorInformation çš„ Description å±¬æ€§æ™‚ï¼Œæˆ‘å€‘æ˜¯ç›´æ¥ä½¿ç”¨ exception?.ToString() ä¾†å–å¾—ä¾‹å¤–è³‡è¨Šï¼Œé€™æ¨£åšé›–ç„¶å¯ä»¥å–å¾—è¼ƒå®Œæ•´çš„ä¾‹å¤–è³‡è¨Šï¼Œä½†æ˜¯ï¼Œé€™æ¨£çš„ä½œæ³•æœƒå°‡ç³»çµ±çš„å¯¦ä½œç´°ç¯€æš´éœ²çµ¦èª¿ç”¨ç«¯ï¼Œé€™æ¨£çš„ä½œæ³•åœ¨æ­£å¼ç’°å¢ƒä¸­æ˜¯çµ•å°ä¸è¢«å…è¨±çš„ã€‚ æ‰€ä»¥ï¼Œåœ¨é€™é‚Šæˆ‘å€‘å¯ä»¥åˆ©ç”¨ app.Environment.IsProduction() é€™å€‹å±¬æ€§ä¾†åˆ¤æ–·ç›®å‰ç³»çµ±çš„é‹ä½œç’°å¢ƒä¸¦ä¸” api è¦å›å‚³çš„è³‡è¨Šï¼Œé¿å…æ­éœ²ä¸æ‡‰è©²æš´éœ²çš„è³‡è¨Šã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Excep","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:1","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡"},{"categories":[],"content":" 2.1 ä½¿ç”¨ UseExceptionHandler è™•ç†ä¾‹å¤–ä¸¦åŒ…è£å›æ‡‰è³‡æ–™UseExceptionHandler é€™å€‹ middleware æ˜¯åœ¨ dotnet 8 æ‰é–‹å§‹æ”¯æ´çš„ middlewareï¼Œé€™å€‹ middleware å¯ä»¥æ•æ‰ç³»çµ±å…§çš„æ‰€æœ‰ä¾‹å¤–ï¼Œä¸¦ä¸”è‡ªè¨‚ä¾‹å¤–è™•ç†çš„è¡Œç‚ºï¼Œæ‰€ä»¥ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨é€™å€‹ middleware ä¾†åŒ…è£å›æ‡‰è³‡æ–™ã€‚ é—œæ–¼å…¶ä»–è‡ªè¨‚ UseExceptionHandler é€™å€‹ middleware çš„ç´°ç¯€å¯ä»¥åœ¨å¾®è»Ÿçš„ MS Learn - ASP.NET Core éŒ¯èª¤è™•ç† ä¸­å¯ä»¥æŸ¥é–±ã€‚ æˆ‘é€™é‚Šè¦ç”¨çš„æ–¹å¼æ˜¯æ¯”è¼ƒç°¡å–®çš„åœ¨ UserExceptionHandler ä¸­ç›´æ¥ç”¨ lambda è¨­å®šè™•ç†æ–¹æ³•ï¼Œå…¶ä»–è©³ç´°èªªæ˜å¯ä»¥åƒé–± å¾®è»Ÿå®˜æ–¹èªªæ˜é€£çµã€‚ 2.1.1 å–å¾—ä¾‹å¤–è³‡è¨Šåœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ context.Features.Get(); å–å¾—è©²æ¬¡ä¾‹å¤–çš„è³‡è¨Šï¼Œé€™å€‹è³‡è¨ŠåŒ…å«è©²æ¬¡ä¾‹å¤–ç™¼ç”Ÿçš„è·¯å¾‘ã€ä¾‹å¤–è³‡è¨Šã€ä¾‹å¤–ç‰©ä»¶ç­‰è³‡è¨Šã€‚ é€™é‚Šæœƒè¦æ³¨æ„çš„æ˜¯ï¼Œcontext.Features.Get(); é€™å€‹æ–¹æ³•å–å‡ºçš„ IExceptionHandlerPathFeature å¯èƒ½ç‚º nullï¼Œæ‰€ä»¥é€™é‚Šå»ºè­°å¦å¤–æª¢æŸ¥ä¸€æ¬¡ï¼Œä¸éï¼Œå› ç‚ºæ˜¯ç™¼ç”Ÿä¾‹å¤–ç‹€æ³æ‰é€²å…¥é€™å€‹ middlewareï¼Œç†è«–ä¸Šä¸æœƒæœ‰å–ä¸åˆ°çš„ç‹€æ³ï¼Œæ‰€ä»¥ï¼Œæ˜¯å¦è¦æª¢æŸ¥ null ç«¯çœ‹å€‹äººã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; Console.Error.WriteLine(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exceptionMessage, exception?.ToString()); }); }); 2.1.2 å–å¾—æ³¨å…¥ç‰©ä»¶åœ¨ UseExceptionHandler ä¸­ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥åˆ©ç”¨ context.RequestServices.GetRequiredService(); æ–¹æ³•ä¾†å–å¾—å·²æ³¨å…¥çš„ç‰©ä»¶ï¼Œå¦‚ AutoMapper çš„ IMapperï¼Œæˆ–æ˜¯ ILogger ç­‰ï¼Œä¹Ÿå¯ä»¥æ‹¿ä¾†å–å¾— IOption ä¸­çš„è‡ªè¨‚è¨­å®šã€‚ æ‰€ä»¥é€™é‚Šæˆ‘åˆ©ç”¨ context.RequestServices.GetRequiredService(); ä¾†å–å¾— ILogger ç‰©ä»¶ï¼Œä¸¦ä¸”åˆ©ç”¨å®ƒä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šï¼Œæ›¿æ›æ‰å‰é¢æˆ‘å€‘åœ¨ console ä¸­è¨˜éŒ„ä¾‹å¤–è³‡è¨Šçš„åšæ³•ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); }); }); 2.1.3 å»ºç«‹å›æ‡‰è³‡æ–™åˆ©ç”¨ ILogger ç´€éŒ„å¥½äº†éŒ¯èª¤å¾Œï¼Œæˆ‘å€‘æ¥è‘—ä¾†èª¿æ•´å›æ‡‰è³‡æ–™ã€‚ é¦–å…ˆï¼Œæˆ‘å€‘è¦ä½¿ç”¨åœ¨å‰ä¸€ç« ç¯€ä¸­å»ºç«‹çš„ ApiResponse ç‰©ä»¶ä¾†å»ºç«‹æ¨™æº–åŒ–çš„å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”ä½¿ç”¨ ApiErrorInformation é€™å€‹ç‰©ä»¶ä¾†ä½œç‚ºæˆ‘å€‘çš„éŒ¯èª¤å›æ‡‰å…§å®¹ï¼Œä»¥ä¸‹æ˜¯ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š ApiErrorInformation ä¸­çš„ ErrorCode é€™å€‹å±¬æ€§ï¼Œæ‰€ä»¥é€™é‚Šæˆ‘å€‘å…ˆå®šç¾©ä¸€å€‹éŒ¯èª¤ä»£ç¢¼ err-unknown ä¾†ä½œç‚ºéŒ¯èª¤çš„ä»£ç¢¼ã€‚ å¦å¤–ï¼ŒApiResponse ä¸­çš„ Id é€™å€‹å±¬æ€§ï¼Œä¹Ÿèˆ‡ ç¬¬ä¸€éƒ¨åˆ† ä¸€æ¨£ï¼Œæ˜¯åˆ©ç”¨ Activity.Current?.TraceId.ToString() ä¾†å–å¾—è©²æ¬¡éŒ¯èª¤çš„è¿½è¹¤ç·¨è™Ÿï¼Œä¸¦ä¸”è¨­å®šåˆ° Id é€™å€‹å±¬æ€§ä¸­ã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", exception?.Message, exception?.ToString()); // å»ºç«‹åŒ…å«éŒ¯èª¤è³‡è¨Šçš„ api response ç‰©ä»¶ var failResultViewModel = new ApiResponse { Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.Request.Path}.{context.Request.Method}\", Data = new ApiErrorInformation { ErrorCode = \"err-unknown\", Message = exception?.Message, Description = exception?.ToString() } }; await context.Response.WriteAsJsonAsync(failResultViewModel); }); }); 2.1.4 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨å‰é¢ç« ç¯€æˆ‘å€‘åœ¨è¨­å®š ApiErrorInformation çš„ Description å±¬æ€§æ™‚ï¼Œæˆ‘å€‘æ˜¯ç›´æ¥ä½¿ç”¨ exception?.ToString() ä¾†å–å¾—ä¾‹å¤–è³‡è¨Šï¼Œé€™æ¨£åšé›–ç„¶å¯ä»¥å–å¾—è¼ƒå®Œæ•´çš„ä¾‹å¤–è³‡è¨Šï¼Œä½†æ˜¯ï¼Œé€™æ¨£çš„ä½œæ³•æœƒå°‡ç³»çµ±çš„å¯¦ä½œç´°ç¯€æš´éœ²çµ¦èª¿ç”¨ç«¯ï¼Œé€™æ¨£çš„ä½œæ³•åœ¨æ­£å¼ç’°å¢ƒä¸­æ˜¯çµ•å°ä¸è¢«å…è¨±çš„ã€‚ æ‰€ä»¥ï¼Œåœ¨é€™é‚Šæˆ‘å€‘å¯ä»¥åˆ©ç”¨ app.Environment.IsProduction() é€™å€‹å±¬æ€§ä¾†åˆ¤æ–·ç›®å‰ç³»çµ±çš„é‹ä½œç’°å¢ƒä¸¦ä¸” api è¦å›å‚³çš„è³‡è¨Šï¼Œé¿å…æ­éœ²ä¸æ‡‰è©²æš´éœ²çš„è³‡è¨Šã€‚ csharp app.UseExceptionHandler(applicationBuilder =\u003e { applicationBuilder.Run(async context =\u003e { // å–å¾— ILogger ä»¥ä¾¿å¦å¤–æ’°å¯«æ—¥èªŒ var logger = context.RequestServices.GetRequiredService(); // å–å¾— IExceptionHandlerPathFeature çš„è³‡æ–™ï¼Œä»¥ä¾¿å¾ŒçºŒé‡å°ä¾‹å¤–å…§å®¹é€²è¡Œè™•ç† var exceptionHandlerPathFeature = context.Features.Get(); var exception = exceptionHandlerPathFeature?.Error; logger.LogError(\"Exception occured: {ExceptionMessage} , Excep","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:1","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#å®Œæ•´ç¨‹å¼ç¢¼"},{"categories":[],"content":" 2.2 ä½¿ç”¨ IExceptionFilter è™•ç†ä¾‹å¤–å›æ‡‰æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ IExceptionFilter ä¾†æ•æ‰ api çš„ä¾‹å¤–ä¸¦ä¸”è¨­å®šå›æ‡‰è³‡æ–™ã€‚ 2.2.1 ExceptionHandledç•¶ç³»çµ±ç™¼ç”Ÿä¾‹å¤–å¾Œï¼Œå¦‚æœåœ¨ç¨‹å¼ä¸­éƒ½æ²’æœ‰ä½¿ç”¨ try-catch æ•æ‰ä¾‹å¤–ï¼Œé‚£éº¼å°±æœƒé€²å…¥ IExceptionFilter ä»¥ä¾¿æˆ‘å€‘çµ±ä¸€è™•ç†ã€‚ æ‰€ä»¥ï¼Œæˆ‘å€‘éœ€è¦å°‡ ExceptionHandled é€™å€‹å±¬æ€§è¨­å®šç‚º trueï¼Œä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œé¿å…é€™å€‹ä¾‹å¤–é€²å…¥æˆ‘å€‘å‰é¢æéçš„ UseExceptionHandler é€™å€‹ middleware ä¹‹ä¸­ã€‚ ä»¥ä¸‹ç¯„ä¾‹æ˜¯æˆ‘åˆ©ç”¨ ExceptionHandled é€™å€‹å±¬æ€§ä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œä¸¦ä¸”åˆ©ç”¨ ILogger ä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger\u003cExceptionWrappingFilter\u003e _logger; /// \u003csummary\u003e /// ctor /// \u003c/summary\u003e /// \u003cparam name=\"logger\"\u003e\u003c/param\u003e public ExceptionWrappingFilter(ILogger\u003cExceptionWrappingFilter\u003e logger) { this._logger = logger; } /// \u003csummary\u003e /// Called after an action has thrown an \u003csee cref=\"T:System.Exception\" /\u003e. /// \u003c/summary\u003e /// \u003cparam name=\"context\"\u003eThe \u003csee cref=\"T:Microsoft.AspNetCore.Mvc.Filters.ExceptionContext\" /\u003e.\u003c/param\u003e public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); } } é€™æ¨£ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨ api ç™¼ç”Ÿä¾‹å¤–æ™‚ï¼Œè®“ api å›æ‡‰ 200 ä¸¦åœ¨ console çœ‹åˆ°ä¾‹å¤–è³‡è¨Šï¼Œåƒæ˜¯ä¸‹åœ–çš„çµæœã€‚ 2.2.2 å»ºç«‹å›æ‡‰è³‡æ–™è¨­å®šå¥½ ExceptionHandled å¾Œï¼Œæˆ‘å€‘ä¾†é–‹å§‹èª¿æ•´å›æ‡‰è³‡æ–™ï¼Œè®“ api çš„å›æ‡‰å…§å®¹å¯ä»¥ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ åŒæ¨£çš„ï¼Œæˆ‘å€‘å¯ä»¥åƒè€ƒ ç¬¬ä¸€éƒ¨åˆ† ä¸­çš„åšæ³•ä¾†å»ºç«‹å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”å°‡å»ºç«‹å¥½çš„è³‡æ–™è¨­å®šåˆ° context.Result ä¹‹ä¸­ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥è®“ api çš„å›æ‡‰å…§å®¹ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger\u003cExceptionWrappingFilter\u003e _logger; /// \u003csummary\u003e /// ctor /// \u003c/summary\u003e /// \u003cparam name=\"logger\"\u003e\u003c/param\u003e public ExceptionWrappingFilter(ILogger\u003cExceptionWrappingFilter\u003e logger) { this._logger = logger; } /// \u003csummary\u003e /// Called after an action has thrown an \u003csee cref=\"T:System.Exception\" /\u003e. /// \u003c/summary\u003e /// \u003cparam name=\"context\"\u003eThe \u003csee cref=\"T:Microsoft.AspNetCore.Mvc.Filters.ExceptionContext\" /\u003e.\u003c/param\u003e public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); var failResultViewModel = new ApiResponse\u003cApiErrorInformation\u003e { // å–å¾—è©²æ¬¡éŒ¯èª¤æ™‚çš„è¿½è¹¤ç·¨è™Ÿä»¥ä¾¿è¨­å®šåœ¨ error information ä¸­ Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", // å°‡ä¾‹å¤–è³‡æ–™è½‰ç‚ºå°ˆç”¨çš„éŒ¯èª¤å›æ‡‰è³‡è¨Š Data = new ApiErrorInformation() { ErrorCode = \"err-unknown\", Message = context.Exception.Message, Description = context.Exception.ToString() }; } context.Result = new JsonResult(failResultViewModel) { StatusCode = StatusCodes.Status500InternalServerError }; } } æ•ˆæœå¯ä»¥åƒè€ƒä¸‹åœ– é€™é‚Šæœ‰å€‹èˆ‡ä½¿ç”¨ UseExceptionHandler å®šç¾©å›æ‡‰è³‡æ–™æ™‚ä¸€æ¨£çš„å•é¡Œï¼Œé‚£å°±æ˜¯ ç³»çµ±çš„ä¾‹å¤–éŒ¯èª¤ä¸æ‡‰è©²ç›´æ¥æš´éœ²çµ¦èª¿ç”¨ç«¯ã€‚ æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ exception filter ä¸­æ§åˆ¶ä¾‹å¤–è³‡è¨Šçš„æ­éœ²ç¨‹åº¦ã€‚ 2.2.3 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨ AspNetCore ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ IHostEnvironment.IsDevelopment() æˆ– IHostEnvironment.IsProduction() ç­‰æ–¹æ³•ä¾†å¾—çŸ¥ç›®å‰ç³»çµ±çš„é‹è¡Œç’°å¢ƒï¼Œä¹Ÿå°±æ˜¯åœ¨ UseExceptionHandler ä¸­ä¹Ÿæœ‰ç”¨åˆ°çš„ app.Environment.IsProduction()ã€‚ å¦å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Environment.GetEnvironmentVariable(\"ASPNETCORE_ENVIRONMENT\"); é€™å€‹éœæ…‹æ–¹æ³•ä¾†å–å¾—ç³»çµ±é‹ä½œæ™‚ä½¿ç”¨çš„ç’°å¢ƒè³‡è¨Šã€‚ é€™é‚Šæˆ‘å€‘å…ˆä¾†çœ‹è³‡è¨Šè¢«éš±è—ã€æ²’æœ‰è¢«éš±è—çš„å…©å¼µçµæœæˆªåœ– è³‡è¨Šæ²’æœ‰è¢«éš±è— (é€™å¼µåœ–å…¶å¯¦å°±æ˜¯å‰é¢å»ºç«‹å›æ‡‰ç« ç¯€çš„çµæœ) è³‡è¨Šè¢«éš±è— æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•å¯¦ä½œé€™å…©ç¨®åšæ³•ã€‚ 2.2.3.1 ä½¿ç”¨ IHostEnvironment å–å¾—ç’°å¢ƒè³‡è¨Šä½¿ç”¨ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒè³‡è¨Šçš„æ–¹æ³•è·Ÿåœ¨ UseExceptionHandler é‚£é‚Šä¸åŒï¼Œå› ç‚ºåœ¨ ExceptionFilter ä¸­æˆ‘å€‘æ²’è¾¦æ³•åƒå¯« UseExceptionHander çš„æ™‚å€™ä¸€æ¨£ç›´æ¥èª¿ç”¨ app.Environment.IsProduction()ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šè¦é æ³¨å…¥ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger\u003cExceptionWrappingFilter\u003e _logger; // æ³¨å…¥ IHostEnvironment ä»¥ä¾¿å–å¾—ç³»çµ±é‹ä½œç’°å¢ƒ private readonly IHostEnvironment _hostEnvironment; /// \u003csummary\u003e /// ctor /// \u003c/summary\u003e /// \u003cparam name=\"logger\"\u003e\u003c/param\u003e /// \u003cparam name=\"hostEnvironment\"\u003e\u003c/param\u003e public ExceptionWrappingFilter(ILogger\u003cExceptionWrappingFilter\u003e logger, IHostEnvironment hostEnvironment) { this._logger = logger; this._hostEnvironment = hostEnvironment; } /// \u003csummary\u003e /// Called after an action has thrown an \u003csee cref=\"T:System.Except","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#ä½¿ç”¨-iexceptionfilter-è™•ç†ä¾‹å¤–å›æ‡‰"},{"categories":[],"content":" 2.2 ä½¿ç”¨ IExceptionFilter è™•ç†ä¾‹å¤–å›æ‡‰æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ IExceptionFilter ä¾†æ•æ‰ api çš„ä¾‹å¤–ä¸¦ä¸”è¨­å®šå›æ‡‰è³‡æ–™ã€‚ 2.2.1 ExceptionHandledç•¶ç³»çµ±ç™¼ç”Ÿä¾‹å¤–å¾Œï¼Œå¦‚æœåœ¨ç¨‹å¼ä¸­éƒ½æ²’æœ‰ä½¿ç”¨ try-catch æ•æ‰ä¾‹å¤–ï¼Œé‚£éº¼å°±æœƒé€²å…¥ IExceptionFilter ä»¥ä¾¿æˆ‘å€‘çµ±ä¸€è™•ç†ã€‚ æ‰€ä»¥ï¼Œæˆ‘å€‘éœ€è¦å°‡ ExceptionHandled é€™å€‹å±¬æ€§è¨­å®šç‚º trueï¼Œä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œé¿å…é€™å€‹ä¾‹å¤–é€²å…¥æˆ‘å€‘å‰é¢æéçš„ UseExceptionHandler é€™å€‹ middleware ä¹‹ä¸­ã€‚ ä»¥ä¸‹ç¯„ä¾‹æ˜¯æˆ‘åˆ©ç”¨ ExceptionHandled é€™å€‹å±¬æ€§ä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œä¸¦ä¸”åˆ©ç”¨ ILogger ä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); } } é€™æ¨£ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨ api ç™¼ç”Ÿä¾‹å¤–æ™‚ï¼Œè®“ api å›æ‡‰ 200 ä¸¦åœ¨ console çœ‹åˆ°ä¾‹å¤–è³‡è¨Šï¼Œåƒæ˜¯ä¸‹åœ–çš„çµæœã€‚ 2.2.2 å»ºç«‹å›æ‡‰è³‡æ–™è¨­å®šå¥½ ExceptionHandled å¾Œï¼Œæˆ‘å€‘ä¾†é–‹å§‹èª¿æ•´å›æ‡‰è³‡æ–™ï¼Œè®“ api çš„å›æ‡‰å…§å®¹å¯ä»¥ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ åŒæ¨£çš„ï¼Œæˆ‘å€‘å¯ä»¥åƒè€ƒ ç¬¬ä¸€éƒ¨åˆ† ä¸­çš„åšæ³•ä¾†å»ºç«‹å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”å°‡å»ºç«‹å¥½çš„è³‡æ–™è¨­å®šåˆ° context.Result ä¹‹ä¸­ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥è®“ api çš„å›æ‡‰å…§å®¹ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); var failResultViewModel = new ApiResponse { // å–å¾—è©²æ¬¡éŒ¯èª¤æ™‚çš„è¿½è¹¤ç·¨è™Ÿä»¥ä¾¿è¨­å®šåœ¨ error information ä¸­ Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", // å°‡ä¾‹å¤–è³‡æ–™è½‰ç‚ºå°ˆç”¨çš„éŒ¯èª¤å›æ‡‰è³‡è¨Š Data = new ApiErrorInformation() { ErrorCode = \"err-unknown\", Message = context.Exception.Message, Description = context.Exception.ToString() }; } context.Result = new JsonResult(failResultViewModel) { StatusCode = StatusCodes.Status500InternalServerError }; } } æ•ˆæœå¯ä»¥åƒè€ƒä¸‹åœ– é€™é‚Šæœ‰å€‹èˆ‡ä½¿ç”¨ UseExceptionHandler å®šç¾©å›æ‡‰è³‡æ–™æ™‚ä¸€æ¨£çš„å•é¡Œï¼Œé‚£å°±æ˜¯ ç³»çµ±çš„ä¾‹å¤–éŒ¯èª¤ä¸æ‡‰è©²ç›´æ¥æš´éœ²çµ¦èª¿ç”¨ç«¯ã€‚ æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ exception filter ä¸­æ§åˆ¶ä¾‹å¤–è³‡è¨Šçš„æ­éœ²ç¨‹åº¦ã€‚ 2.2.3 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨ AspNetCore ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ IHostEnvironment.IsDevelopment() æˆ– IHostEnvironment.IsProduction() ç­‰æ–¹æ³•ä¾†å¾—çŸ¥ç›®å‰ç³»çµ±çš„é‹è¡Œç’°å¢ƒï¼Œä¹Ÿå°±æ˜¯åœ¨ UseExceptionHandler ä¸­ä¹Ÿæœ‰ç”¨åˆ°çš„ app.Environment.IsProduction()ã€‚ å¦å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Environment.GetEnvironmentVariable(\"ASPNETCORE_ENVIRONMENT\"); é€™å€‹éœæ…‹æ–¹æ³•ä¾†å–å¾—ç³»çµ±é‹ä½œæ™‚ä½¿ç”¨çš„ç’°å¢ƒè³‡è¨Šã€‚ é€™é‚Šæˆ‘å€‘å…ˆä¾†çœ‹è³‡è¨Šè¢«éš±è—ã€æ²’æœ‰è¢«éš±è—çš„å…©å¼µçµæœæˆªåœ– è³‡è¨Šæ²’æœ‰è¢«éš±è— (é€™å¼µåœ–å…¶å¯¦å°±æ˜¯å‰é¢å»ºç«‹å›æ‡‰ç« ç¯€çš„çµæœ) è³‡è¨Šè¢«éš±è— æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•å¯¦ä½œé€™å…©ç¨®åšæ³•ã€‚ 2.2.3.1 ä½¿ç”¨ IHostEnvironment å–å¾—ç’°å¢ƒè³‡è¨Šä½¿ç”¨ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒè³‡è¨Šçš„æ–¹æ³•è·Ÿåœ¨ UseExceptionHandler é‚£é‚Šä¸åŒï¼Œå› ç‚ºåœ¨ ExceptionFilter ä¸­æˆ‘å€‘æ²’è¾¦æ³•åƒå¯« UseExceptionHander çš„æ™‚å€™ä¸€æ¨£ç›´æ¥èª¿ç”¨ app.Environment.IsProduction()ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šè¦é æ³¨å…¥ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; // æ³¨å…¥ IHostEnvironment ä»¥ä¾¿å–å¾—ç³»çµ±é‹ä½œç’°å¢ƒ private readonly IHostEnvironment _hostEnvironment; /// /// ctor /// /// /// public ExceptionWrappingFilter(ILogger logger, IHostEnvironment hostEnvironment) { this._logger = logger; this._hostEnvironment = hostEnvironment; } /// /// Called after an action has thrown an ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#exceptionhandled"},{"categories":[],"content":" 2.2 ä½¿ç”¨ IExceptionFilter è™•ç†ä¾‹å¤–å›æ‡‰æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ IExceptionFilter ä¾†æ•æ‰ api çš„ä¾‹å¤–ä¸¦ä¸”è¨­å®šå›æ‡‰è³‡æ–™ã€‚ 2.2.1 ExceptionHandledç•¶ç³»çµ±ç™¼ç”Ÿä¾‹å¤–å¾Œï¼Œå¦‚æœåœ¨ç¨‹å¼ä¸­éƒ½æ²’æœ‰ä½¿ç”¨ try-catch æ•æ‰ä¾‹å¤–ï¼Œé‚£éº¼å°±æœƒé€²å…¥ IExceptionFilter ä»¥ä¾¿æˆ‘å€‘çµ±ä¸€è™•ç†ã€‚ æ‰€ä»¥ï¼Œæˆ‘å€‘éœ€è¦å°‡ ExceptionHandled é€™å€‹å±¬æ€§è¨­å®šç‚º trueï¼Œä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œé¿å…é€™å€‹ä¾‹å¤–é€²å…¥æˆ‘å€‘å‰é¢æéçš„ UseExceptionHandler é€™å€‹ middleware ä¹‹ä¸­ã€‚ ä»¥ä¸‹ç¯„ä¾‹æ˜¯æˆ‘åˆ©ç”¨ ExceptionHandled é€™å€‹å±¬æ€§ä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œä¸¦ä¸”åˆ©ç”¨ ILogger ä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); } } é€™æ¨£ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨ api ç™¼ç”Ÿä¾‹å¤–æ™‚ï¼Œè®“ api å›æ‡‰ 200 ä¸¦åœ¨ console çœ‹åˆ°ä¾‹å¤–è³‡è¨Šï¼Œåƒæ˜¯ä¸‹åœ–çš„çµæœã€‚ 2.2.2 å»ºç«‹å›æ‡‰è³‡æ–™è¨­å®šå¥½ ExceptionHandled å¾Œï¼Œæˆ‘å€‘ä¾†é–‹å§‹èª¿æ•´å›æ‡‰è³‡æ–™ï¼Œè®“ api çš„å›æ‡‰å…§å®¹å¯ä»¥ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ åŒæ¨£çš„ï¼Œæˆ‘å€‘å¯ä»¥åƒè€ƒ ç¬¬ä¸€éƒ¨åˆ† ä¸­çš„åšæ³•ä¾†å»ºç«‹å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”å°‡å»ºç«‹å¥½çš„è³‡æ–™è¨­å®šåˆ° context.Result ä¹‹ä¸­ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥è®“ api çš„å›æ‡‰å…§å®¹ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); var failResultViewModel = new ApiResponse { // å–å¾—è©²æ¬¡éŒ¯èª¤æ™‚çš„è¿½è¹¤ç·¨è™Ÿä»¥ä¾¿è¨­å®šåœ¨ error information ä¸­ Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", // å°‡ä¾‹å¤–è³‡æ–™è½‰ç‚ºå°ˆç”¨çš„éŒ¯èª¤å›æ‡‰è³‡è¨Š Data = new ApiErrorInformation() { ErrorCode = \"err-unknown\", Message = context.Exception.Message, Description = context.Exception.ToString() }; } context.Result = new JsonResult(failResultViewModel) { StatusCode = StatusCodes.Status500InternalServerError }; } } æ•ˆæœå¯ä»¥åƒè€ƒä¸‹åœ– é€™é‚Šæœ‰å€‹èˆ‡ä½¿ç”¨ UseExceptionHandler å®šç¾©å›æ‡‰è³‡æ–™æ™‚ä¸€æ¨£çš„å•é¡Œï¼Œé‚£å°±æ˜¯ ç³»çµ±çš„ä¾‹å¤–éŒ¯èª¤ä¸æ‡‰è©²ç›´æ¥æš´éœ²çµ¦èª¿ç”¨ç«¯ã€‚ æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ exception filter ä¸­æ§åˆ¶ä¾‹å¤–è³‡è¨Šçš„æ­éœ²ç¨‹åº¦ã€‚ 2.2.3 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨ AspNetCore ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ IHostEnvironment.IsDevelopment() æˆ– IHostEnvironment.IsProduction() ç­‰æ–¹æ³•ä¾†å¾—çŸ¥ç›®å‰ç³»çµ±çš„é‹è¡Œç’°å¢ƒï¼Œä¹Ÿå°±æ˜¯åœ¨ UseExceptionHandler ä¸­ä¹Ÿæœ‰ç”¨åˆ°çš„ app.Environment.IsProduction()ã€‚ å¦å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Environment.GetEnvironmentVariable(\"ASPNETCORE_ENVIRONMENT\"); é€™å€‹éœæ…‹æ–¹æ³•ä¾†å–å¾—ç³»çµ±é‹ä½œæ™‚ä½¿ç”¨çš„ç’°å¢ƒè³‡è¨Šã€‚ é€™é‚Šæˆ‘å€‘å…ˆä¾†çœ‹è³‡è¨Šè¢«éš±è—ã€æ²’æœ‰è¢«éš±è—çš„å…©å¼µçµæœæˆªåœ– è³‡è¨Šæ²’æœ‰è¢«éš±è— (é€™å¼µåœ–å…¶å¯¦å°±æ˜¯å‰é¢å»ºç«‹å›æ‡‰ç« ç¯€çš„çµæœ) è³‡è¨Šè¢«éš±è— æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•å¯¦ä½œé€™å…©ç¨®åšæ³•ã€‚ 2.2.3.1 ä½¿ç”¨ IHostEnvironment å–å¾—ç’°å¢ƒè³‡è¨Šä½¿ç”¨ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒè³‡è¨Šçš„æ–¹æ³•è·Ÿåœ¨ UseExceptionHandler é‚£é‚Šä¸åŒï¼Œå› ç‚ºåœ¨ ExceptionFilter ä¸­æˆ‘å€‘æ²’è¾¦æ³•åƒå¯« UseExceptionHander çš„æ™‚å€™ä¸€æ¨£ç›´æ¥èª¿ç”¨ app.Environment.IsProduction()ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šè¦é æ³¨å…¥ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; // æ³¨å…¥ IHostEnvironment ä»¥ä¾¿å–å¾—ç³»çµ±é‹ä½œç’°å¢ƒ private readonly IHostEnvironment _hostEnvironment; /// /// ctor /// /// /// public ExceptionWrappingFilter(ILogger logger, IHostEnvironment hostEnvironment) { this._logger = logger; this._hostEnvironment = hostEnvironment; } /// /// Called after an action has thrown an ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#å»ºç«‹å›æ‡‰è³‡æ–™-1"},{"categories":[],"content":" 2.2 ä½¿ç”¨ IExceptionFilter è™•ç†ä¾‹å¤–å›æ‡‰æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ IExceptionFilter ä¾†æ•æ‰ api çš„ä¾‹å¤–ä¸¦ä¸”è¨­å®šå›æ‡‰è³‡æ–™ã€‚ 2.2.1 ExceptionHandledç•¶ç³»çµ±ç™¼ç”Ÿä¾‹å¤–å¾Œï¼Œå¦‚æœåœ¨ç¨‹å¼ä¸­éƒ½æ²’æœ‰ä½¿ç”¨ try-catch æ•æ‰ä¾‹å¤–ï¼Œé‚£éº¼å°±æœƒé€²å…¥ IExceptionFilter ä»¥ä¾¿æˆ‘å€‘çµ±ä¸€è™•ç†ã€‚ æ‰€ä»¥ï¼Œæˆ‘å€‘éœ€è¦å°‡ ExceptionHandled é€™å€‹å±¬æ€§è¨­å®šç‚º trueï¼Œä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œé¿å…é€™å€‹ä¾‹å¤–é€²å…¥æˆ‘å€‘å‰é¢æéçš„ UseExceptionHandler é€™å€‹ middleware ä¹‹ä¸­ã€‚ ä»¥ä¸‹ç¯„ä¾‹æ˜¯æˆ‘åˆ©ç”¨ ExceptionHandled é€™å€‹å±¬æ€§ä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œä¸¦ä¸”åˆ©ç”¨ ILogger ä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); } } é€™æ¨£ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨ api ç™¼ç”Ÿä¾‹å¤–æ™‚ï¼Œè®“ api å›æ‡‰ 200 ä¸¦åœ¨ console çœ‹åˆ°ä¾‹å¤–è³‡è¨Šï¼Œåƒæ˜¯ä¸‹åœ–çš„çµæœã€‚ 2.2.2 å»ºç«‹å›æ‡‰è³‡æ–™è¨­å®šå¥½ ExceptionHandled å¾Œï¼Œæˆ‘å€‘ä¾†é–‹å§‹èª¿æ•´å›æ‡‰è³‡æ–™ï¼Œè®“ api çš„å›æ‡‰å…§å®¹å¯ä»¥ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ åŒæ¨£çš„ï¼Œæˆ‘å€‘å¯ä»¥åƒè€ƒ ç¬¬ä¸€éƒ¨åˆ† ä¸­çš„åšæ³•ä¾†å»ºç«‹å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”å°‡å»ºç«‹å¥½çš„è³‡æ–™è¨­å®šåˆ° context.Result ä¹‹ä¸­ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥è®“ api çš„å›æ‡‰å…§å®¹ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); var failResultViewModel = new ApiResponse { // å–å¾—è©²æ¬¡éŒ¯èª¤æ™‚çš„è¿½è¹¤ç·¨è™Ÿä»¥ä¾¿è¨­å®šåœ¨ error information ä¸­ Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", // å°‡ä¾‹å¤–è³‡æ–™è½‰ç‚ºå°ˆç”¨çš„éŒ¯èª¤å›æ‡‰è³‡è¨Š Data = new ApiErrorInformation() { ErrorCode = \"err-unknown\", Message = context.Exception.Message, Description = context.Exception.ToString() }; } context.Result = new JsonResult(failResultViewModel) { StatusCode = StatusCodes.Status500InternalServerError }; } } æ•ˆæœå¯ä»¥åƒè€ƒä¸‹åœ– é€™é‚Šæœ‰å€‹èˆ‡ä½¿ç”¨ UseExceptionHandler å®šç¾©å›æ‡‰è³‡æ–™æ™‚ä¸€æ¨£çš„å•é¡Œï¼Œé‚£å°±æ˜¯ ç³»çµ±çš„ä¾‹å¤–éŒ¯èª¤ä¸æ‡‰è©²ç›´æ¥æš´éœ²çµ¦èª¿ç”¨ç«¯ã€‚ æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ exception filter ä¸­æ§åˆ¶ä¾‹å¤–è³‡è¨Šçš„æ­éœ²ç¨‹åº¦ã€‚ 2.2.3 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨ AspNetCore ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ IHostEnvironment.IsDevelopment() æˆ– IHostEnvironment.IsProduction() ç­‰æ–¹æ³•ä¾†å¾—çŸ¥ç›®å‰ç³»çµ±çš„é‹è¡Œç’°å¢ƒï¼Œä¹Ÿå°±æ˜¯åœ¨ UseExceptionHandler ä¸­ä¹Ÿæœ‰ç”¨åˆ°çš„ app.Environment.IsProduction()ã€‚ å¦å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Environment.GetEnvironmentVariable(\"ASPNETCORE_ENVIRONMENT\"); é€™å€‹éœæ…‹æ–¹æ³•ä¾†å–å¾—ç³»çµ±é‹ä½œæ™‚ä½¿ç”¨çš„ç’°å¢ƒè³‡è¨Šã€‚ é€™é‚Šæˆ‘å€‘å…ˆä¾†çœ‹è³‡è¨Šè¢«éš±è—ã€æ²’æœ‰è¢«éš±è—çš„å…©å¼µçµæœæˆªåœ– è³‡è¨Šæ²’æœ‰è¢«éš±è— (é€™å¼µåœ–å…¶å¯¦å°±æ˜¯å‰é¢å»ºç«‹å›æ‡‰ç« ç¯€çš„çµæœ) è³‡è¨Šè¢«éš±è— æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•å¯¦ä½œé€™å…©ç¨®åšæ³•ã€‚ 2.2.3.1 ä½¿ç”¨ IHostEnvironment å–å¾—ç’°å¢ƒè³‡è¨Šä½¿ç”¨ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒè³‡è¨Šçš„æ–¹æ³•è·Ÿåœ¨ UseExceptionHandler é‚£é‚Šä¸åŒï¼Œå› ç‚ºåœ¨ ExceptionFilter ä¸­æˆ‘å€‘æ²’è¾¦æ³•åƒå¯« UseExceptionHander çš„æ™‚å€™ä¸€æ¨£ç›´æ¥èª¿ç”¨ app.Environment.IsProduction()ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šè¦é æ³¨å…¥ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; // æ³¨å…¥ IHostEnvironment ä»¥ä¾¿å–å¾—ç³»çµ±é‹ä½œç’°å¢ƒ private readonly IHostEnvironment _hostEnvironment; /// /// ctor /// /// /// public ExceptionWrappingFilter(ILogger logger, IHostEnvironment hostEnvironment) { this._logger = logger; this._hostEnvironment = hostEnvironment; } /// /// Called after an action has thrown an ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡-1"},{"categories":[],"content":" 2.2 ä½¿ç”¨ IExceptionFilter è™•ç†ä¾‹å¤–å›æ‡‰æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ IExceptionFilter ä¾†æ•æ‰ api çš„ä¾‹å¤–ä¸¦ä¸”è¨­å®šå›æ‡‰è³‡æ–™ã€‚ 2.2.1 ExceptionHandledç•¶ç³»çµ±ç™¼ç”Ÿä¾‹å¤–å¾Œï¼Œå¦‚æœåœ¨ç¨‹å¼ä¸­éƒ½æ²’æœ‰ä½¿ç”¨ try-catch æ•æ‰ä¾‹å¤–ï¼Œé‚£éº¼å°±æœƒé€²å…¥ IExceptionFilter ä»¥ä¾¿æˆ‘å€‘çµ±ä¸€è™•ç†ã€‚ æ‰€ä»¥ï¼Œæˆ‘å€‘éœ€è¦å°‡ ExceptionHandled é€™å€‹å±¬æ€§è¨­å®šç‚º trueï¼Œä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œé¿å…é€™å€‹ä¾‹å¤–é€²å…¥æˆ‘å€‘å‰é¢æéçš„ UseExceptionHandler é€™å€‹ middleware ä¹‹ä¸­ã€‚ ä»¥ä¸‹ç¯„ä¾‹æ˜¯æˆ‘åˆ©ç”¨ ExceptionHandled é€™å€‹å±¬æ€§ä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œä¸¦ä¸”åˆ©ç”¨ ILogger ä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); } } é€™æ¨£ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨ api ç™¼ç”Ÿä¾‹å¤–æ™‚ï¼Œè®“ api å›æ‡‰ 200 ä¸¦åœ¨ console çœ‹åˆ°ä¾‹å¤–è³‡è¨Šï¼Œåƒæ˜¯ä¸‹åœ–çš„çµæœã€‚ 2.2.2 å»ºç«‹å›æ‡‰è³‡æ–™è¨­å®šå¥½ ExceptionHandled å¾Œï¼Œæˆ‘å€‘ä¾†é–‹å§‹èª¿æ•´å›æ‡‰è³‡æ–™ï¼Œè®“ api çš„å›æ‡‰å…§å®¹å¯ä»¥ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ åŒæ¨£çš„ï¼Œæˆ‘å€‘å¯ä»¥åƒè€ƒ ç¬¬ä¸€éƒ¨åˆ† ä¸­çš„åšæ³•ä¾†å»ºç«‹å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”å°‡å»ºç«‹å¥½çš„è³‡æ–™è¨­å®šåˆ° context.Result ä¹‹ä¸­ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥è®“ api çš„å›æ‡‰å…§å®¹ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); var failResultViewModel = new ApiResponse { // å–å¾—è©²æ¬¡éŒ¯èª¤æ™‚çš„è¿½è¹¤ç·¨è™Ÿä»¥ä¾¿è¨­å®šåœ¨ error information ä¸­ Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", // å°‡ä¾‹å¤–è³‡æ–™è½‰ç‚ºå°ˆç”¨çš„éŒ¯èª¤å›æ‡‰è³‡è¨Š Data = new ApiErrorInformation() { ErrorCode = \"err-unknown\", Message = context.Exception.Message, Description = context.Exception.ToString() }; } context.Result = new JsonResult(failResultViewModel) { StatusCode = StatusCodes.Status500InternalServerError }; } } æ•ˆæœå¯ä»¥åƒè€ƒä¸‹åœ– é€™é‚Šæœ‰å€‹èˆ‡ä½¿ç”¨ UseExceptionHandler å®šç¾©å›æ‡‰è³‡æ–™æ™‚ä¸€æ¨£çš„å•é¡Œï¼Œé‚£å°±æ˜¯ ç³»çµ±çš„ä¾‹å¤–éŒ¯èª¤ä¸æ‡‰è©²ç›´æ¥æš´éœ²çµ¦èª¿ç”¨ç«¯ã€‚ æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ exception filter ä¸­æ§åˆ¶ä¾‹å¤–è³‡è¨Šçš„æ­éœ²ç¨‹åº¦ã€‚ 2.2.3 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨ AspNetCore ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ IHostEnvironment.IsDevelopment() æˆ– IHostEnvironment.IsProduction() ç­‰æ–¹æ³•ä¾†å¾—çŸ¥ç›®å‰ç³»çµ±çš„é‹è¡Œç’°å¢ƒï¼Œä¹Ÿå°±æ˜¯åœ¨ UseExceptionHandler ä¸­ä¹Ÿæœ‰ç”¨åˆ°çš„ app.Environment.IsProduction()ã€‚ å¦å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Environment.GetEnvironmentVariable(\"ASPNETCORE_ENVIRONMENT\"); é€™å€‹éœæ…‹æ–¹æ³•ä¾†å–å¾—ç³»çµ±é‹ä½œæ™‚ä½¿ç”¨çš„ç’°å¢ƒè³‡è¨Šã€‚ é€™é‚Šæˆ‘å€‘å…ˆä¾†çœ‹è³‡è¨Šè¢«éš±è—ã€æ²’æœ‰è¢«éš±è—çš„å…©å¼µçµæœæˆªåœ– è³‡è¨Šæ²’æœ‰è¢«éš±è— (é€™å¼µåœ–å…¶å¯¦å°±æ˜¯å‰é¢å»ºç«‹å›æ‡‰ç« ç¯€çš„çµæœ) è³‡è¨Šè¢«éš±è— æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•å¯¦ä½œé€™å…©ç¨®åšæ³•ã€‚ 2.2.3.1 ä½¿ç”¨ IHostEnvironment å–å¾—ç’°å¢ƒè³‡è¨Šä½¿ç”¨ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒè³‡è¨Šçš„æ–¹æ³•è·Ÿåœ¨ UseExceptionHandler é‚£é‚Šä¸åŒï¼Œå› ç‚ºåœ¨ ExceptionFilter ä¸­æˆ‘å€‘æ²’è¾¦æ³•åƒå¯« UseExceptionHander çš„æ™‚å€™ä¸€æ¨£ç›´æ¥èª¿ç”¨ app.Environment.IsProduction()ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šè¦é æ³¨å…¥ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; // æ³¨å…¥ IHostEnvironment ä»¥ä¾¿å–å¾—ç³»çµ±é‹ä½œç’°å¢ƒ private readonly IHostEnvironment _hostEnvironment; /// /// ctor /// /// /// public ExceptionWrappingFilter(ILogger logger, IHostEnvironment hostEnvironment) { this._logger = logger; this._hostEnvironment = hostEnvironment; } /// /// Called after an action has thrown an ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#ä½¿ç”¨-ihostenvironment-å–å¾—ç’°å¢ƒè³‡è¨Š"},{"categories":[],"content":" 2.2 ä½¿ç”¨ IExceptionFilter è™•ç†ä¾‹å¤–å›æ‡‰æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ IExceptionFilter ä¾†æ•æ‰ api çš„ä¾‹å¤–ä¸¦ä¸”è¨­å®šå›æ‡‰è³‡æ–™ã€‚ 2.2.1 ExceptionHandledç•¶ç³»çµ±ç™¼ç”Ÿä¾‹å¤–å¾Œï¼Œå¦‚æœåœ¨ç¨‹å¼ä¸­éƒ½æ²’æœ‰ä½¿ç”¨ try-catch æ•æ‰ä¾‹å¤–ï¼Œé‚£éº¼å°±æœƒé€²å…¥ IExceptionFilter ä»¥ä¾¿æˆ‘å€‘çµ±ä¸€è™•ç†ã€‚ æ‰€ä»¥ï¼Œæˆ‘å€‘éœ€è¦å°‡ ExceptionHandled é€™å€‹å±¬æ€§è¨­å®šç‚º trueï¼Œä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œé¿å…é€™å€‹ä¾‹å¤–é€²å…¥æˆ‘å€‘å‰é¢æéçš„ UseExceptionHandler é€™å€‹ middleware ä¹‹ä¸­ã€‚ ä»¥ä¸‹ç¯„ä¾‹æ˜¯æˆ‘åˆ©ç”¨ ExceptionHandled é€™å€‹å±¬æ€§ä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œä¸¦ä¸”åˆ©ç”¨ ILogger ä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); } } é€™æ¨£ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨ api ç™¼ç”Ÿä¾‹å¤–æ™‚ï¼Œè®“ api å›æ‡‰ 200 ä¸¦åœ¨ console çœ‹åˆ°ä¾‹å¤–è³‡è¨Šï¼Œåƒæ˜¯ä¸‹åœ–çš„çµæœã€‚ 2.2.2 å»ºç«‹å›æ‡‰è³‡æ–™è¨­å®šå¥½ ExceptionHandled å¾Œï¼Œæˆ‘å€‘ä¾†é–‹å§‹èª¿æ•´å›æ‡‰è³‡æ–™ï¼Œè®“ api çš„å›æ‡‰å…§å®¹å¯ä»¥ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ åŒæ¨£çš„ï¼Œæˆ‘å€‘å¯ä»¥åƒè€ƒ ç¬¬ä¸€éƒ¨åˆ† ä¸­çš„åšæ³•ä¾†å»ºç«‹å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”å°‡å»ºç«‹å¥½çš„è³‡æ–™è¨­å®šåˆ° context.Result ä¹‹ä¸­ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥è®“ api çš„å›æ‡‰å…§å®¹ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); var failResultViewModel = new ApiResponse { // å–å¾—è©²æ¬¡éŒ¯èª¤æ™‚çš„è¿½è¹¤ç·¨è™Ÿä»¥ä¾¿è¨­å®šåœ¨ error information ä¸­ Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", // å°‡ä¾‹å¤–è³‡æ–™è½‰ç‚ºå°ˆç”¨çš„éŒ¯èª¤å›æ‡‰è³‡è¨Š Data = new ApiErrorInformation() { ErrorCode = \"err-unknown\", Message = context.Exception.Message, Description = context.Exception.ToString() }; } context.Result = new JsonResult(failResultViewModel) { StatusCode = StatusCodes.Status500InternalServerError }; } } æ•ˆæœå¯ä»¥åƒè€ƒä¸‹åœ– é€™é‚Šæœ‰å€‹èˆ‡ä½¿ç”¨ UseExceptionHandler å®šç¾©å›æ‡‰è³‡æ–™æ™‚ä¸€æ¨£çš„å•é¡Œï¼Œé‚£å°±æ˜¯ ç³»çµ±çš„ä¾‹å¤–éŒ¯èª¤ä¸æ‡‰è©²ç›´æ¥æš´éœ²çµ¦èª¿ç”¨ç«¯ã€‚ æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ exception filter ä¸­æ§åˆ¶ä¾‹å¤–è³‡è¨Šçš„æ­éœ²ç¨‹åº¦ã€‚ 2.2.3 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨ AspNetCore ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ IHostEnvironment.IsDevelopment() æˆ– IHostEnvironment.IsProduction() ç­‰æ–¹æ³•ä¾†å¾—çŸ¥ç›®å‰ç³»çµ±çš„é‹è¡Œç’°å¢ƒï¼Œä¹Ÿå°±æ˜¯åœ¨ UseExceptionHandler ä¸­ä¹Ÿæœ‰ç”¨åˆ°çš„ app.Environment.IsProduction()ã€‚ å¦å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Environment.GetEnvironmentVariable(\"ASPNETCORE_ENVIRONMENT\"); é€™å€‹éœæ…‹æ–¹æ³•ä¾†å–å¾—ç³»çµ±é‹ä½œæ™‚ä½¿ç”¨çš„ç’°å¢ƒè³‡è¨Šã€‚ é€™é‚Šæˆ‘å€‘å…ˆä¾†çœ‹è³‡è¨Šè¢«éš±è—ã€æ²’æœ‰è¢«éš±è—çš„å…©å¼µçµæœæˆªåœ– è³‡è¨Šæ²’æœ‰è¢«éš±è— (é€™å¼µåœ–å…¶å¯¦å°±æ˜¯å‰é¢å»ºç«‹å›æ‡‰ç« ç¯€çš„çµæœ) è³‡è¨Šè¢«éš±è— æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•å¯¦ä½œé€™å…©ç¨®åšæ³•ã€‚ 2.2.3.1 ä½¿ç”¨ IHostEnvironment å–å¾—ç’°å¢ƒè³‡è¨Šä½¿ç”¨ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒè³‡è¨Šçš„æ–¹æ³•è·Ÿåœ¨ UseExceptionHandler é‚£é‚Šä¸åŒï¼Œå› ç‚ºåœ¨ ExceptionFilter ä¸­æˆ‘å€‘æ²’è¾¦æ³•åƒå¯« UseExceptionHander çš„æ™‚å€™ä¸€æ¨£ç›´æ¥èª¿ç”¨ app.Environment.IsProduction()ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šè¦é æ³¨å…¥ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; // æ³¨å…¥ IHostEnvironment ä»¥ä¾¿å–å¾—ç³»çµ±é‹ä½œç’°å¢ƒ private readonly IHostEnvironment _hostEnvironment; /// /// ctor /// /// /// public ExceptionWrappingFilter(ILogger logger, IHostEnvironment hostEnvironment) { this._logger = logger; this._hostEnvironment = hostEnvironment; } /// /// Called after an action has thrown an ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#ä½¿ç”¨-environment-å–å¾—ç’°å¢ƒè³‡è¨Š"},{"categories":[],"content":" 2.2 ä½¿ç”¨ IExceptionFilter è™•ç†ä¾‹å¤–å›æ‡‰æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ IExceptionFilter ä¾†æ•æ‰ api çš„ä¾‹å¤–ä¸¦ä¸”è¨­å®šå›æ‡‰è³‡æ–™ã€‚ 2.2.1 ExceptionHandledç•¶ç³»çµ±ç™¼ç”Ÿä¾‹å¤–å¾Œï¼Œå¦‚æœåœ¨ç¨‹å¼ä¸­éƒ½æ²’æœ‰ä½¿ç”¨ try-catch æ•æ‰ä¾‹å¤–ï¼Œé‚£éº¼å°±æœƒé€²å…¥ IExceptionFilter ä»¥ä¾¿æˆ‘å€‘çµ±ä¸€è™•ç†ã€‚ æ‰€ä»¥ï¼Œæˆ‘å€‘éœ€è¦å°‡ ExceptionHandled é€™å€‹å±¬æ€§è¨­å®šç‚º trueï¼Œä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œé¿å…é€™å€‹ä¾‹å¤–é€²å…¥æˆ‘å€‘å‰é¢æéçš„ UseExceptionHandler é€™å€‹ middleware ä¹‹ä¸­ã€‚ ä»¥ä¸‹ç¯„ä¾‹æ˜¯æˆ‘åˆ©ç”¨ ExceptionHandled é€™å€‹å±¬æ€§ä¾†æ¨™è¨˜ä¾‹å¤–å·²ç¶“è¢«è™•ç†ï¼Œä¸¦ä¸”åˆ©ç”¨ ILogger ä¾†è¨˜éŒ„ä¾‹å¤–è³‡è¨Šã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); } } é€™æ¨£ï¼Œæˆ‘å€‘å°±å¯ä»¥åœ¨ api ç™¼ç”Ÿä¾‹å¤–æ™‚ï¼Œè®“ api å›æ‡‰ 200 ä¸¦åœ¨ console çœ‹åˆ°ä¾‹å¤–è³‡è¨Šï¼Œåƒæ˜¯ä¸‹åœ–çš„çµæœã€‚ 2.2.2 å»ºç«‹å›æ‡‰è³‡æ–™è¨­å®šå¥½ ExceptionHandled å¾Œï¼Œæˆ‘å€‘ä¾†é–‹å§‹èª¿æ•´å›æ‡‰è³‡æ–™ï¼Œè®“ api çš„å›æ‡‰å…§å®¹å¯ä»¥ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ åŒæ¨£çš„ï¼Œæˆ‘å€‘å¯ä»¥åƒè€ƒ ç¬¬ä¸€éƒ¨åˆ† ä¸­çš„åšæ³•ä¾†å»ºç«‹å›æ‡‰è³‡æ–™ï¼Œä¸¦ä¸”å°‡å»ºç«‹å¥½çš„è³‡æ–™è¨­å®šåˆ° context.Result ä¹‹ä¸­ï¼Œé€™æ¨£æˆ‘å€‘å°±å¯ä»¥è®“ api çš„å›æ‡‰å…§å®¹ç¬¦åˆæˆ‘å€‘å®šç¾©çš„æ¨™æº–æ ¼å¼ã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; /// /// ctor /// /// public ExceptionWrappingFilter(ILogger logger) { this._logger = logger; } /// /// Called after an action has thrown an . /// /// The . public void OnException(ExceptionContext context) { context.ExceptionHandled = true; this._logger.LogError(\"Exception occured: {ExceptionMessage} , Exception Description: {ExceptionDescription} \", context.Exception.Message, context.Exception.ToString()); var failResultViewModel = new ApiResponse { // å–å¾—è©²æ¬¡éŒ¯èª¤æ™‚çš„è¿½è¹¤ç·¨è™Ÿä»¥ä¾¿è¨­å®šåœ¨ error information ä¸­ Id = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(), ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", // å°‡ä¾‹å¤–è³‡æ–™è½‰ç‚ºå°ˆç”¨çš„éŒ¯èª¤å›æ‡‰è³‡è¨Š Data = new ApiErrorInformation() { ErrorCode = \"err-unknown\", Message = context.Exception.Message, Description = context.Exception.ToString() }; } context.Result = new JsonResult(failResultViewModel) { StatusCode = StatusCodes.Status500InternalServerError }; } } æ•ˆæœå¯ä»¥åƒè€ƒä¸‹åœ– é€™é‚Šæœ‰å€‹èˆ‡ä½¿ç”¨ UseExceptionHandler å®šç¾©å›æ‡‰è³‡æ–™æ™‚ä¸€æ¨£çš„å•é¡Œï¼Œé‚£å°±æ˜¯ ç³»çµ±çš„ä¾‹å¤–éŒ¯èª¤ä¸æ‡‰è©²ç›´æ¥æš´éœ²çµ¦èª¿ç”¨ç«¯ã€‚ æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ exception filter ä¸­æ§åˆ¶ä¾‹å¤–è³‡è¨Šçš„æ­éœ²ç¨‹åº¦ã€‚ 2.2.3 ä¾‹å¤–è³‡è¨Šçš„å®‰å…¨æ€§è€ƒé‡åœ¨ AspNetCore ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ IHostEnvironment.IsDevelopment() æˆ– IHostEnvironment.IsProduction() ç­‰æ–¹æ³•ä¾†å¾—çŸ¥ç›®å‰ç³»çµ±çš„é‹è¡Œç’°å¢ƒï¼Œä¹Ÿå°±æ˜¯åœ¨ UseExceptionHandler ä¸­ä¹Ÿæœ‰ç”¨åˆ°çš„ app.Environment.IsProduction()ã€‚ å¦å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Environment.GetEnvironmentVariable(\"ASPNETCORE_ENVIRONMENT\"); é€™å€‹éœæ…‹æ–¹æ³•ä¾†å–å¾—ç³»çµ±é‹ä½œæ™‚ä½¿ç”¨çš„ç’°å¢ƒè³‡è¨Šã€‚ é€™é‚Šæˆ‘å€‘å…ˆä¾†çœ‹è³‡è¨Šè¢«éš±è—ã€æ²’æœ‰è¢«éš±è—çš„å…©å¼µçµæœæˆªåœ– è³‡è¨Šæ²’æœ‰è¢«éš±è— (é€™å¼µåœ–å…¶å¯¦å°±æ˜¯å‰é¢å»ºç«‹å›æ‡‰ç« ç¯€çš„çµæœ) è³‡è¨Šè¢«éš±è— æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•å¯¦ä½œé€™å…©ç¨®åšæ³•ã€‚ 2.2.3.1 ä½¿ç”¨ IHostEnvironment å–å¾—ç’°å¢ƒè³‡è¨Šä½¿ç”¨ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒè³‡è¨Šçš„æ–¹æ³•è·Ÿåœ¨ UseExceptionHandler é‚£é‚Šä¸åŒï¼Œå› ç‚ºåœ¨ ExceptionFilter ä¸­æˆ‘å€‘æ²’è¾¦æ³•åƒå¯« UseExceptionHander çš„æ™‚å€™ä¸€æ¨£ç›´æ¥èª¿ç”¨ app.Environment.IsProduction()ï¼Œæ‰€ä»¥æˆ‘å€‘é€™é‚Šè¦é æ³¨å…¥ IHostEnvironment ä¾†å–å¾—ç’°å¢ƒã€‚ csharp public class ExceptionWrappingFilter : IExceptionFilter { private readonly ILogger _logger; // æ³¨å…¥ IHostEnvironment ä»¥ä¾¿å–å¾—ç³»çµ±é‹ä½œç’°å¢ƒ private readonly IHostEnvironment _hostEnvironment; /// /// ctor /// /// /// public ExceptionWrappingFilter(ILogger logger, IHostEnvironment hostEnvironment) { this._logger = logger; this._hostEnvironment = hostEnvironment; } /// /// Called after an action has thrown an ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#å¥—ç”¨-exception-filter"},{"categories":[],"content":" 2.3 ExceptionFilter ä¸­çš„è¨­å®šå¦‚ä½•å½±éŸ¿ä¾‹å¤–å‚³é 2.3.1 ExceptionHandled å±¬æ€§åœ¨ä¸€é–‹å§‹å»ºç«‹ ExceptionFilter æ™‚ï¼Œç¬¬ä¸€å€‹æ­¥é©Ÿå°±æ˜¯èª¿æ•´ ExceptionHandled é€™å€‹å±¬æ€§ï¼Œé€™é‚Šæˆ‘ä¾†æ•´ç†ä¸€ä¸‹ ExceptionHandled é€™å€‹å±¬æ€§çš„æ•ˆæœã€‚ å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ç”¨ä¾†æ¨™è¨˜æœ¬æ¬¡ç™¼ç”Ÿçš„ä¾‹å¤–å·²ç¶“è¢«è™•ç†äº†ï¼Œå¯ä»¥ç†è§£ç‚ºç•¶ ExceptionHandled = true æ™‚ï¼Œä»£è¡¨è‘—é€™å€‹ä¾‹å¤–å·²ç¶“æœ‰è¢« try-catch è™•ç†éï¼Œæ‰€ä»¥ç³»çµ±æœƒç›´æ¥éš±è—ä¾‹å¤–è³‡è¨Šï¼Œä¸¦ä¸”å›å‚³ 200 OK çµ¦èª¿ç”¨ç«¯ã€‚ ä¸‹åœ–æ˜¯ ExceptionHandled = true æ™‚çš„ç¯„ä¾‹æˆªåœ–ï¼Œå¯ä»¥çœ‹åˆ° api ç›´æ¥å›æ‡‰äº† 200 OKï¼Œä¸¦ä¸”åœ¨ console ä¸­å¯ä»¥çœ‹åˆ°ä¾‹å¤–è³‡è¨Šã€‚ åä¹‹ï¼Œå¦‚æœè¨­å®šç‚º ExceptionHandled = false çš„è©±ï¼Œå°±æœƒè¢«è¦–ç‚ºæœªè¢«è™•ç†ï¼Œç›´æ¥å¾€å¤–éƒ¨å‚³éï¼Œå¦‚ä¸‹åœ–ï¼š å¦‚æœæ˜¯ä½¿ç”¨ç€è¦½å™¨é–‹å•Ÿ HTTP Get çš„ api çš„è©±ï¼Œé€™æœƒé€²å…¥ AspNetCore çš„ UseDeveloperExceptionPage é€™å€‹éŒ¯èª¤è³‡è¨Šé é¢ã€‚ 2.3.2 è¨­å®š Responseå¦‚æœæˆ‘å€‘åœ¨ ExceptionFilter ä¸­è¨­å®š context.Result çš„è©±ï¼Œç­‰åŒæ–¼ ExceptionHandled è¨­å®šç‚º true çš„æ•ˆæœï¼Œå°±ä¸æœƒé€²å…¥ UseExceptionHandlerã€‚ ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:3","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#exceptionfilter-ä¸­çš„è¨­å®šå¦‚ä½•å½±éŸ¿ä¾‹å¤–å‚³é"},{"categories":[],"content":" 2.3 ExceptionFilter ä¸­çš„è¨­å®šå¦‚ä½•å½±éŸ¿ä¾‹å¤–å‚³é 2.3.1 ExceptionHandled å±¬æ€§åœ¨ä¸€é–‹å§‹å»ºç«‹ ExceptionFilter æ™‚ï¼Œç¬¬ä¸€å€‹æ­¥é©Ÿå°±æ˜¯èª¿æ•´ ExceptionHandled é€™å€‹å±¬æ€§ï¼Œé€™é‚Šæˆ‘ä¾†æ•´ç†ä¸€ä¸‹ ExceptionHandled é€™å€‹å±¬æ€§çš„æ•ˆæœã€‚ å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ç”¨ä¾†æ¨™è¨˜æœ¬æ¬¡ç™¼ç”Ÿçš„ä¾‹å¤–å·²ç¶“è¢«è™•ç†äº†ï¼Œå¯ä»¥ç†è§£ç‚ºç•¶ ExceptionHandled = true æ™‚ï¼Œä»£è¡¨è‘—é€™å€‹ä¾‹å¤–å·²ç¶“æœ‰è¢« try-catch è™•ç†éï¼Œæ‰€ä»¥ç³»çµ±æœƒç›´æ¥éš±è—ä¾‹å¤–è³‡è¨Šï¼Œä¸¦ä¸”å›å‚³ 200 OK çµ¦èª¿ç”¨ç«¯ã€‚ ä¸‹åœ–æ˜¯ ExceptionHandled = true æ™‚çš„ç¯„ä¾‹æˆªåœ–ï¼Œå¯ä»¥çœ‹åˆ° api ç›´æ¥å›æ‡‰äº† 200 OKï¼Œä¸¦ä¸”åœ¨ console ä¸­å¯ä»¥çœ‹åˆ°ä¾‹å¤–è³‡è¨Šã€‚ åä¹‹ï¼Œå¦‚æœè¨­å®šç‚º ExceptionHandled = false çš„è©±ï¼Œå°±æœƒè¢«è¦–ç‚ºæœªè¢«è™•ç†ï¼Œç›´æ¥å¾€å¤–éƒ¨å‚³éï¼Œå¦‚ä¸‹åœ–ï¼š å¦‚æœæ˜¯ä½¿ç”¨ç€è¦½å™¨é–‹å•Ÿ HTTP Get çš„ api çš„è©±ï¼Œé€™æœƒé€²å…¥ AspNetCore çš„ UseDeveloperExceptionPage é€™å€‹éŒ¯èª¤è³‡è¨Šé é¢ã€‚ 2.3.2 è¨­å®š Responseå¦‚æœæˆ‘å€‘åœ¨ ExceptionFilter ä¸­è¨­å®š context.Result çš„è©±ï¼Œç­‰åŒæ–¼ ExceptionHandled è¨­å®šç‚º true çš„æ•ˆæœï¼Œå°±ä¸æœƒé€²å…¥ UseExceptionHandlerã€‚ ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:3","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#exceptionhandled-å±¬æ€§"},{"categories":[],"content":" 2.3 ExceptionFilter ä¸­çš„è¨­å®šå¦‚ä½•å½±éŸ¿ä¾‹å¤–å‚³é 2.3.1 ExceptionHandled å±¬æ€§åœ¨ä¸€é–‹å§‹å»ºç«‹ ExceptionFilter æ™‚ï¼Œç¬¬ä¸€å€‹æ­¥é©Ÿå°±æ˜¯èª¿æ•´ ExceptionHandled é€™å€‹å±¬æ€§ï¼Œé€™é‚Šæˆ‘ä¾†æ•´ç†ä¸€ä¸‹ ExceptionHandled é€™å€‹å±¬æ€§çš„æ•ˆæœã€‚ å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯ç”¨ä¾†æ¨™è¨˜æœ¬æ¬¡ç™¼ç”Ÿçš„ä¾‹å¤–å·²ç¶“è¢«è™•ç†äº†ï¼Œå¯ä»¥ç†è§£ç‚ºç•¶ ExceptionHandled = true æ™‚ï¼Œä»£è¡¨è‘—é€™å€‹ä¾‹å¤–å·²ç¶“æœ‰è¢« try-catch è™•ç†éï¼Œæ‰€ä»¥ç³»çµ±æœƒç›´æ¥éš±è—ä¾‹å¤–è³‡è¨Šï¼Œä¸¦ä¸”å›å‚³ 200 OK çµ¦èª¿ç”¨ç«¯ã€‚ ä¸‹åœ–æ˜¯ ExceptionHandled = true æ™‚çš„ç¯„ä¾‹æˆªåœ–ï¼Œå¯ä»¥çœ‹åˆ° api ç›´æ¥å›æ‡‰äº† 200 OKï¼Œä¸¦ä¸”åœ¨ console ä¸­å¯ä»¥çœ‹åˆ°ä¾‹å¤–è³‡è¨Šã€‚ åä¹‹ï¼Œå¦‚æœè¨­å®šç‚º ExceptionHandled = false çš„è©±ï¼Œå°±æœƒè¢«è¦–ç‚ºæœªè¢«è™•ç†ï¼Œç›´æ¥å¾€å¤–éƒ¨å‚³éï¼Œå¦‚ä¸‹åœ–ï¼š å¦‚æœæ˜¯ä½¿ç”¨ç€è¦½å™¨é–‹å•Ÿ HTTP Get çš„ api çš„è©±ï¼Œé€™æœƒé€²å…¥ AspNetCore çš„ UseDeveloperExceptionPage é€™å€‹éŒ¯èª¤è³‡è¨Šé é¢ã€‚ 2.3.2 è¨­å®š Responseå¦‚æœæˆ‘å€‘åœ¨ ExceptionFilter ä¸­è¨­å®š context.Result çš„è©±ï¼Œç­‰åŒæ–¼ ExceptionHandled è¨­å®šç‚º true çš„æ•ˆæœï¼Œå°±ä¸æœƒé€²å…¥ UseExceptionHandlerã€‚ ","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:3","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#è¨­å®š-response"},{"categories":[],"content":" 2.4 IExceptionFilter çš„è§€æ¸¬è­°é¡Œåœ¨å¯è§€æ¸¬æ€§æ¦‚å¿µé€æ­¥è¢«é‡è¦–çš„ç¾åœ¨ï¼Œåˆ©ç”¨ IExceptionFilter è™•ç†å›æ‡‰å°è§€æ¸¬è³‡æ–™çš„å½±éŸ¿å¯ä»¥æ•´ç†ç‚ºä»¥ä¸‹è¡¨æ ¼ï¼š ExceptionHandled Response è§€æ¸¬è³‡æ–™ api å›æ‡‰ æ˜¯å¦è§¸ç™¼ ExceptionHandlerMiddleware / ExceptionPageMiddleware true æœªè¨­å®š ç„¡ä¾‹å¤–äº‹ä»¶ 200 OK å¦ true è¨­å®š ç„¡ä¾‹å¤–äº‹ä»¶ ä»¥è¨­å®šç‚ºä¸» å¦ false æœªè¨­å®š æœ‰ä¾‹å¤–äº‹ä»¶ 500 Internal Server Error æ˜¯ false è¨­å®š ç„¡ä¾‹å¤–äº‹ä»¶ ä»¥è¨­å®šç‚ºä¸» å¦ å¾ä»¥ä¸Šçš„è¡¨æ ¼ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåªæœ‰ç¬¬ä¸‰ç¨®çµ„åˆå¯ä»¥åœ¨è§€æ¸¬ç³»çµ±ä¸Šçœ‹åˆ°ä¾‹å¤–çš„äº‹ä»¶è³‡è¨Šï¼Œæ‰€ä»¥ï¼Œå¦‚æœåœ˜éšŠå¾ˆé‡è¦–å¯è§€æ¸¬æ€§æˆ–æ˜¯å¾ˆä»°è³´è§€æ¸¬è³‡æ–™æŸ¥çœ‹ç³»çµ±éŒ¯èª¤çš„è©±ï¼Œåœ¨è¨­è¨ˆç³»çµ±æ™‚å°±å¿…é ˆè€ƒæ…®åˆ°é€™äº›å› ç´ ã€‚ ä¾‹å¦‚ï¼Œåœ¨ dotnet 9 ä¹‹å¾Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ Activity.Current?.AddException(context.Exception); ä¾†ä¸»å‹•å¯«å…¥ä¾‹å¤–äº‹ä»¶ï¼Œä½†å¦‚æœç³»çµ±æœ¬ä¾†å°±æœ‰ä½¿ç”¨ OpenTelemetry çš„ sql client ã€ http client ç­‰è¿½è¹¤å¥—ä»¶çš„è©±ï¼Œç”±æ–¼ä»–å€‘æœ¬ä¾†å°±æœƒåœ¨ client ç™¼ç”Ÿä¾‹å¤–æ™‚ç´€éŒ„ä¾‹å¤–äº‹ä»¶ï¼Œé€™å°±æœƒé€ æˆé‡è¤‡å¯«å…¥çš„å•é¡Œã€‚ è³‡è¨Š Activity.Current?.AddException(context.Exception); é€™å€‹æ–¹æ³•æ˜¯ System.Diagnostics.DiagnosticSource é€™å€‹å¥—ä»¶åœ¨ 9.0.0 ç‰ˆå¾Œæ–°å¢çš„ï¼Œä¸”æœ‰ .NetStandard 2.0 ç‰ˆæœ¬ï¼Œæ‰€ä»¥å°±ç®—æ²’æœ‰å‡ç´šåˆ° dotnet 9 ä¹Ÿæ˜¯å¯ä»¥ç”¨çš„å–”~","date":"2024-11-17","objectID":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/:1:4","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 2 : åŒ…è£ä¾‹å¤–","uri":"/2024/11/aspnetcore-webapi-custom-response-model-part2-wrapping-exception/#iexceptionfilter-çš„è§€æ¸¬è­°é¡Œ"},{"categories":[],"content":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/"},{"categories":[],"content":"åœ¨è¨­è¨ˆ web api æ™‚ï¼Œé€šå¸¸æœƒæƒ³è¦æœ‰ä¸€å€‹è‡ªå·±ç³»çµ±å°ˆç”¨çš„æ¨™æº–åŒ–å›æ‡‰æ ¼å¼ï¼Œæˆ‘åœ¨å‰ä¸€ä»½å·¥ä½œä¸­å› ç‚ºå·²ç¶“æœ‰åº•å±¤çš„å‰è¼©å»ºç«‹å¥½ç›¸é—œçš„è™•ç†å¥—ä»¶ï¼Œæ‰€ä»¥ä¸€ç›´ä»¥ä¾†éƒ½æ²’ç‰¹åˆ¥ç ”ç©¶æ€éº¼åŒ…è£ä»¥åŠè‡ªè¨‚å›æ‡‰æ¬„ä½ã€‚ æœ€è¿‘åœ¨è‡ªå·±çš„ç·´ç¿’å°ˆæ¡ˆä¸­å˜—è©¦å»å¯¦ä½œç›¸é—œæ©Ÿåˆ¶ï¼Œæ‰ç™¼ç¾åŸä¾†è¦è€ƒæ…®çš„æ±è¥¿æœ‰é»å¤šï¼Œé€™é‚Šæˆ‘å°±ä¾†åˆ†äº«ä¸€ä¸‹æˆ‘çš„åšæ³•ä»¥åŠå…¶ä»–å¯ä»¥ç”¨çš„æ–¹å¼èˆ‡ç”¨é€”ã€‚ è³‡è¨Š ä»¥ä¸‹å…§å®¹ä½¿ç”¨ dotnet 9 çš„ AspNetCore WebApi é€²è¡Œæ¸¬è©¦èˆ‡é–‹ç™¼ï¼Œç›¸é—œç¯„ä¾‹ç¨‹å¼ç¢¼å¯ä»¥åœ¨æˆ‘çš„ github repo æ‰¾åˆ° ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:0:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#"},{"categories":[],"content":" 1 å®šç¾©å›æ‡‰ç‰©ä»¶","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:1:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#å®šç¾©å›æ‡‰ç‰©ä»¶"},{"categories":[],"content":" 1.1 æ¨™æº–å›æ‡‰æ ¼å¼æ—¢ç„¶è¦å»ºç«‹æ¨™æº–çš„ api å›æ‡‰æ ¼å¼ï¼Œç•¶ç„¶æ˜¯è¦å…ˆæº–å‚™ç›¸é—œçš„å›æ‡‰ç‰©ä»¶ã€‚ é¦–å…ˆï¼Œæˆ‘å€‘æœƒéœ€è¦ä¸€å€‹ id ä¾†è¨˜è¼‰é€™æ¬¡å›æ‡‰çš„å”¯ä¸€ç¢¼ä»¥ä¾¿æ”¯æ´èˆ‡è¿½è¹¤ã€‚ é™¤äº† id å¤–ï¼Œæˆ‘å€‘å¯èƒ½ä¹Ÿæœƒéœ€è¦ç´€éŒ„æ­¤æ¬¡ api request çš„ api version, request path ç­‰è³‡è¨Šï¼Œä½†ç”±æ–¼ api version é€šå¸¸æœƒè¨­è¨ˆåœ¨ api request path ä¹‹ä¸Šï¼Œè€Œ request path èª¿ç”¨çš„äººä¸€å®šæœƒçŸ¥é“ï¼Œæ‰€ä»¥é€™å…©å€‹è³‡è¨Šé€šå¸¸å¯ä»¥å¿½ç•¥ï¼Œå¯ä¾æ“šéœ€æ±‚é¸æ“‡æ˜¯å¦åŠ å…¥ã€‚ å¯¦éš›å›æ‡‰çš„è³‡æ–™éƒ¨åˆ†ï¼Œç‚ºäº†è®“ç‰©ä»¶çš„æ³›ç”¨æ€§æ›´é«˜ï¼Œé¸æ“‡æ³›å‹ä¾†å®šç¾©è³‡æ–™å±¬æ€§è®“é€™å€‹å›æ‡‰æ ¼å¼å¯ä»¥ç›¸å®¹çµ•å¤§å¤šæ•¸çš„æƒ…å¢ƒã€‚ csharp /// \u003csummary\u003e /// æ¨™æº– api å›æ‡‰ /// \u003c/summary\u003e /// \u003ctypeparam name=\"T\"\u003e\u003c/typeparam\u003e public class ApiResponse\u003cT\u003e { /// \u003csummary\u003e /// api çš„è¿½è¹¤ç·¨è™Ÿ /// \u003c/summary\u003e public string Id { get; set; } /// \u003csummary\u003e /// api version /// \u003c/summary\u003e public string ApiVersion { get; set; } /// \u003csummary\u003e /// api request path /// \u003c/summary\u003e public string RequestPath { get; set; } /// \u003csummary\u003e /// å›æ‡‰è³‡æ–™ /// \u003c/summary\u003e public T Data { get; set; } } ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:1:1","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#æ¨™æº–å›æ‡‰æ ¼å¼"},{"categories":[],"content":" 1.2 éŒ¯èª¤è³‡è¨Šç‰©ä»¶å®šç¾©å¥½æˆ‘å€‘ api è¦ç”¨çš„æ¨™æº–å›æ‡‰ä¹‹å¾Œï¼Œæˆ‘å€‘é‚„å¯ä»¥å¦å¤–æº–å‚™ä¸€å€‹å°ˆé–€ç”¨æ–¼åŒ…è£éŒ¯èª¤è³‡è¨Šçš„ç‰©ä»¶ï¼Œä»¥ä¾¿æˆ‘å€‘åœ¨ç³»çµ±ç™¼ç”ŸéŒ¯èª¤æˆ–è€…éœ€è¦è‡ªè¨‚å›æ‡‰è³‡è¨Šæ™‚å¦å¤–åŒ…è£è³‡æ–™ã€‚ é€šå¸¸åœ¨å»ºç«‹ç³»çµ±æ™‚ï¼Œç‚ºäº†æ˜ç¢ºå®šç¾©éŒ¯èª¤æ˜¯ä»€éº¼ï¼Œåœ¨ç³»çµ±è¨­è¨ˆæ™‚éƒ½æœƒå®šç¾©ä¸€ç³»åˆ—çš„éŒ¯èª¤ç¢¼ä¾†å‘ŠçŸ¥å‰ç«¯é–‹ç™¼äººå“¡æˆ– api ä½¿ç”¨è€…æˆ‘å€‘ç³»çµ±å‡ºç¾äº†ä»€éº¼å•é¡Œï¼Œæ‰€ä»¥é€™é‚Šæˆ‘å€‘å®šç¾©äº† â€˜ErrorCodeâ€™ å±¬æ€§ä¾†è¨˜è¼‰éŒ¯èª¤ç·¨è™Ÿ ç„¶å¾Œï¼Œæˆ‘å€‘å¯èƒ½æœƒå¦å¤–éœ€è¦ â€˜Messageâ€™ èˆ‡ â€˜Descriptionâ€™ å…©å€‹è³‡è¨Šä¾†åˆ†åˆ¥ç´€éŒ„ã€ŒéŒ¯èª¤è¨Šæ¯ã€èˆ‡ã€ŒéŒ¯èª¤è©³ç´°è³‡æ–™ã€ã€‚ csharp /// \u003csummary\u003e /// api error information /// \u003c/summary\u003e public class ApiErrorInformation { /// \u003csummary\u003e /// éŒ¯èª¤ç·¨è™Ÿ /// \u003c/summary\u003e public string ErrorCode { get; set; } /// \u003csummary\u003e /// éŒ¯èª¤è¨Šæ¯ /// \u003c/summary\u003e public string Message { get; set; } /// \u003csummary\u003e /// éŒ¯èª¤è©³ç´°èªªæ˜ /// \u003c/summary\u003e [JsonIgnore(Condition = JsonIgnoreCondition.WhenWritingNull)] public string Description { get; set; } } ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:1:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#éŒ¯èª¤è³‡è¨Šç‰©ä»¶"},{"categories":[],"content":" 2 å»ºç«‹ IResultFilter è™•ç†ç‰©ä»¶åŒ…è£æ¥ä¸‹ä¾†ï¼Œä½¿ç”¨ IResultFilter ä¾†è¨­å®šç³»çµ±è©²å¦‚ä½•è™•ç†å›æ‡‰ç‰©ä»¶ã€‚ é€™é‚Šæ˜¯ä¸€å€‹ç©ºçš„ IResultFilterï¼Œå¾Œé¢æœƒä¾æ“šå„å°ç¯€ä¸»é¡ŒæŒçºŒè£œå……å®ƒã€‚ csharp public class SuccessApiResponseWrappingFilter : IResultFilter { /// \u003csummary\u003eCalled before the action result executes.\u003c/summary\u003e /// \u003cparam name=\"context\"\u003eThe \u003csee cref=\"T:Microsoft.AspNetCore.Mvc.Filters.ResultExecutingContext\" /\u003e.\u003c/param\u003e public void OnResultExecuting(ResultExecutingContext context) { throw new NotImplementedException(); } /// \u003csummary\u003eCalled after the action result executes.\u003c/summary\u003e /// \u003cparam name=\"context\"\u003eThe \u003csee cref=\"T:Microsoft.AspNetCore.Mvc.Filters.ResultExecutedContext\" /\u003e.\u003c/param\u003e public void OnResultExecuted(ResultExecutedContext context) { throw new NotImplementedException(); } } ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#å»ºç«‹-iresultfilter-è™•ç†ç‰©ä»¶åŒ…è£"},{"categories":[],"content":" 2.1 é¿é–‹åœ–ç‰‡èˆ‡å¤§å‹æª”æ¡ˆç­‰å›æ‡‰çš„åŒ…è£ç•¶ api å›æ‡‰çš„è³‡æ–™æ˜¯åœ–ç‰‡æˆ–å…¶ä»–äºŒé€²ä½è³‡æ–™æ™‚ï¼Œä¸¦ä¸éœ€è¦å»å¦å¤–åŒ…è£ç‚ºåœ˜éšŠæ‰€éœ€çš„å›æ‡‰æ ¼å¼ï¼Œå› æ­¤åœ¨è‡ªè¨‚çš„ IResultFilter ä¸­è¦å¢åŠ ç›¸å°æ‡‰çš„åˆ¤æ–·ä¾†é¿é–‹é€™å€‹ç‹€æ³ã€‚ åœ¨å›æ‡‰åœ–ç‰‡æˆ–å…¶ä»–äºŒé€²ä½è³‡æ–™æ™‚ï¼ŒController å¯èƒ½æœƒé€™æ¨£è¨­å®š csharp [HttpGet] public IActionResult GetImage() { var imagePath = \"path_to_image.png\"; var fileBytes = System.IO.File.ReadAllBytes(imagePath); return File(fileBytes, \"image/png\"); } åœ¨é€™å€‹ api method ä¸­ï¼Œä½¿ç”¨äº† File() ä¾†å›å‚³è³‡æ–™ï¼Œæ‰€ä»¥åœ¨ IResultFilter ä¸­çš„ context.Result ç‰©ä»¶å‹åˆ¥æœƒæ˜¯ FileResultï¼Œå› æ­¤å¯ä»¥åˆ¤æ–· Result æ˜¯å¦ç‚º FileResult ä¾†é¿é–‹ csharp if (context.Result is FileResult) { return; } å¦‚æœè¦è¬¹æ…ä¸€é»çš„è©±ï¼Œé‚„å¯ä»¥åŠ ä¸Šè³‡æ–™é¡å‹çš„åˆ¤æ–·ä¾†é¿å… context.Result ä¸æ˜¯ FileResult çš„æƒ…å¢ƒ csharp if (context.Result is FileResult || context.HttpContext.Response.ContentType?.StartsWith(\"image/\") == true || context.HttpContext.Response.ContentType == \"application/octet-stream\") { return; } ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:1","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#é¿é–‹åœ–ç‰‡èˆ‡å¤§å‹æª”æ¡ˆç­‰å›æ‡‰çš„åŒ…è£"},{"categories":[],"content":" 2.2 åŒ…è£æœ‰æ•ˆå›æ‡‰ 2.2.1 è¾¨åˆ¥æ˜¯å¦ç‚º 200 æˆåŠŸå›æ‡‰å¦‚æœ Controller ä¸­çš„ api method ç”¨ä»¥ä¸‹çš„æ–¹å¼æ’°å¯«æ™‚ï¼Œå›æ‡‰çš„ç‰©ä»¶åˆ†åˆ¥æœƒæ˜¯ â€˜OkObjectResultâ€™ ã€ â€˜ObjectResultâ€™ å…©ç¨® csharp [HttpGet(\"action-result\")] public async Task\u003cIActionResult\u003e GetActionResult() { return Ok(\"Hello World\"); } [HttpGet(\"object\")] public async Task\u003cobject\u003e GetObject() { return \"Hello World\"; } é€™æ™‚å€™ï¼Œå¯ä»¥åˆ©ç”¨ä»¥ä¸‹çš„åˆ¤æ–·ä¾†è®“ ResultFilter é‡å°æœ‰æ•ˆå›æ‡‰é€²è¡ŒåŒ…è£ç‰©ä»¶ï¼›ç”±æ–¼æˆ‘æƒ³è¦è‡ªå·±å¦å¤–è™•ç†éŒ¯èª¤ç›¸é—œçš„å›æ‡‰ï¼Œæ‰€ä»¥é€™é‚Šæ˜¯é‡å° 200 çš„å›æ‡‰ä¾†é€²è¡ŒåŒ…è£ï¼Œå¾ŒçºŒæœƒå†å¦å¤–æ’°å¯«éŒ¯èª¤è³‡æ–™çš„åŒ…è£è¡Œç‚ºã€‚ é€™é‚Šçš„åˆ¤æ–·æ–¹æ³•æœƒå°‡è½‰å‹å¥½çš„ ObjectResult å›å‚³çµ¦èª¿ç”¨ç«¯ï¼Œè®“èª¿ç”¨ç«¯å¯ä»¥ç”¨ä¾†è¨­å®šè³‡æ–™ csharp private static bool TryGetSuccessResultData(ResultExecutingContext context, out ObjectResult successObjectResult) { switch (context.Result) { case OkObjectResult okResult: successObjectResult = okResult; return true; case ObjectResult { StatusCode: \u003e= 200 and \u003c 300 } objectResult: successObjectResult = objectResult; return true; default: successObjectResult = context.Result; return false; } } 2.2.2 åŒ…è£å›æ‡‰ç‰©ä»¶æ¥ä¸‹ä¾†å°±æ˜¯å¯¦éš›çš„ç‰©ä»¶åŒ…è£äº†ï¼Œå› ç‚ºå‰é¢å·²ç¶“æ‹¿åˆ°äº†æœ‰æ•ˆçš„å›æ‡‰ç‰©ä»¶ï¼Œæ‰€ä»¥é€™é‚Šçš„è¨­å®šå°±æœƒæ¯”è¼ƒç°¡å–®ï¼Œå°±åªæ˜¯æŠŠ ApiResponse ç‰©ä»¶å»ºç«‹èµ·ä¾†ä¸¦è¨­å®šå›å»è€Œå·²ã€‚ é€™é‚Šæœƒæ¯”è¼ƒæ³¨æ„çš„æ˜¯ï¼Œè¦æ€è€ƒ ApiResponse ä¸­çš„ Id æ¬„ä½è¦å¡å…¥çš„è³‡æ–™æ˜¯ä»€éº¼ï¼Œåœ¨ç¾åœ¨å¯è§€æ¸¬æ€§æ¦‚å¿µç››è¡Œçš„ç’°å¢ƒä¸‹ï¼Œæˆ‘é¸æ“‡ç›´æ¥ä½¿ç”¨ Trace Id ä¾†ä½œç‚ºæˆ‘çš„ Response Idï¼Œè‡³æ–¼å¯¦éš›ä¸Šæ‡‰è©²è¦ç”¨ä»€éº¼è³‡æ–™ä½œç‚º Id å¯ä»¥ç”±åœ˜éšŠæˆå“¡ä¸€èµ·å®šç¾©ï¼Œä¸¦ä¸”é…åˆè³‡å®‰è€ƒé‡é€²è¡Œè™•ç†ã€‚ å¦å¤–ï¼Œé›–ç„¶é€™é‚Šçš„ successObjectResult å¯èƒ½ç‚º nullï¼Œä½†æ˜¯æˆ‘åœ¨ TryGetSuccessResultData ä¸­çš„è™•ç†æ˜¯å¦‚æœä¸æˆåŠŸå°±æœƒæ˜¯ falseï¼Œæ‰€ä»¥ä¸¦ä¸æœƒé€²å…¥é€™å€‹ if å…§é€²è¡Œè™•ç†ï¼Œæ‰€ä»¥æˆ‘é¸æ“‡å¿½ç•¥é€™å€‹å•é¡Œã€‚ csharp if (TryGetSuccessResultData(context, out var successObjectResult)) { // å¾ http header request ä¸­æª¢æŸ¥æœ‰æ²’æœ‰ trace id // var traceId = context.HttpContext.Request.Headers[\"X-Trace-Id\"].ToString() ?? \"no-trace-id\"; // åˆ©ç”¨ dotnet çš„ Activity ä¾†å–å¾— trace id var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse\u003cobject?\u003e { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = successObjectResult?.Value }; context.Result = new ObjectResult(wrappedResponse) { Formatters = successObjectResult?.Formatters, ContentTypes = successObjectResult?.ContentTypes, StatusCode = successObjectResult?.StatusCode, DeclaredType = successObjectResult?.DeclaredType, }; } 2.2.3 åŒ…è£æˆå“æ¯”å° before after ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#åŒ…è£æœ‰æ•ˆå›æ‡‰"},{"categories":[],"content":" 2.2 åŒ…è£æœ‰æ•ˆå›æ‡‰ 2.2.1 è¾¨åˆ¥æ˜¯å¦ç‚º 200 æˆåŠŸå›æ‡‰å¦‚æœ Controller ä¸­çš„ api method ç”¨ä»¥ä¸‹çš„æ–¹å¼æ’°å¯«æ™‚ï¼Œå›æ‡‰çš„ç‰©ä»¶åˆ†åˆ¥æœƒæ˜¯ â€˜OkObjectResultâ€™ ã€ â€˜ObjectResultâ€™ å…©ç¨® csharp [HttpGet(\"action-result\")] public async Task GetActionResult() { return Ok(\"Hello World\"); } [HttpGet(\"object\")] public async Task GetObject() { return \"Hello World\"; } é€™æ™‚å€™ï¼Œå¯ä»¥åˆ©ç”¨ä»¥ä¸‹çš„åˆ¤æ–·ä¾†è®“ ResultFilter é‡å°æœ‰æ•ˆå›æ‡‰é€²è¡ŒåŒ…è£ç‰©ä»¶ï¼›ç”±æ–¼æˆ‘æƒ³è¦è‡ªå·±å¦å¤–è™•ç†éŒ¯èª¤ç›¸é—œçš„å›æ‡‰ï¼Œæ‰€ä»¥é€™é‚Šæ˜¯é‡å° 200 çš„å›æ‡‰ä¾†é€²è¡ŒåŒ…è£ï¼Œå¾ŒçºŒæœƒå†å¦å¤–æ’°å¯«éŒ¯èª¤è³‡æ–™çš„åŒ…è£è¡Œç‚ºã€‚ é€™é‚Šçš„åˆ¤æ–·æ–¹æ³•æœƒå°‡è½‰å‹å¥½çš„ ObjectResult å›å‚³çµ¦èª¿ç”¨ç«¯ï¼Œè®“èª¿ç”¨ç«¯å¯ä»¥ç”¨ä¾†è¨­å®šè³‡æ–™ csharp private static bool TryGetSuccessResultData(ResultExecutingContext context, out ObjectResult successObjectResult) { switch (context.Result) { case OkObjectResult okResult: successObjectResult = okResult; return true; case ObjectResult { StatusCode: \u003e= 200 and \u003c 300 } objectResult: successObjectResult = objectResult; return true; default: successObjectResult = context.Result; return false; } } 2.2.2 åŒ…è£å›æ‡‰ç‰©ä»¶æ¥ä¸‹ä¾†å°±æ˜¯å¯¦éš›çš„ç‰©ä»¶åŒ…è£äº†ï¼Œå› ç‚ºå‰é¢å·²ç¶“æ‹¿åˆ°äº†æœ‰æ•ˆçš„å›æ‡‰ç‰©ä»¶ï¼Œæ‰€ä»¥é€™é‚Šçš„è¨­å®šå°±æœƒæ¯”è¼ƒç°¡å–®ï¼Œå°±åªæ˜¯æŠŠ ApiResponse ç‰©ä»¶å»ºç«‹èµ·ä¾†ä¸¦è¨­å®šå›å»è€Œå·²ã€‚ é€™é‚Šæœƒæ¯”è¼ƒæ³¨æ„çš„æ˜¯ï¼Œè¦æ€è€ƒ ApiResponse ä¸­çš„ Id æ¬„ä½è¦å¡å…¥çš„è³‡æ–™æ˜¯ä»€éº¼ï¼Œåœ¨ç¾åœ¨å¯è§€æ¸¬æ€§æ¦‚å¿µç››è¡Œçš„ç’°å¢ƒä¸‹ï¼Œæˆ‘é¸æ“‡ç›´æ¥ä½¿ç”¨ Trace Id ä¾†ä½œç‚ºæˆ‘çš„ Response Idï¼Œè‡³æ–¼å¯¦éš›ä¸Šæ‡‰è©²è¦ç”¨ä»€éº¼è³‡æ–™ä½œç‚º Id å¯ä»¥ç”±åœ˜éšŠæˆå“¡ä¸€èµ·å®šç¾©ï¼Œä¸¦ä¸”é…åˆè³‡å®‰è€ƒé‡é€²è¡Œè™•ç†ã€‚ å¦å¤–ï¼Œé›–ç„¶é€™é‚Šçš„ successObjectResult å¯èƒ½ç‚º nullï¼Œä½†æ˜¯æˆ‘åœ¨ TryGetSuccessResultData ä¸­çš„è™•ç†æ˜¯å¦‚æœä¸æˆåŠŸå°±æœƒæ˜¯ falseï¼Œæ‰€ä»¥ä¸¦ä¸æœƒé€²å…¥é€™å€‹ if å…§é€²è¡Œè™•ç†ï¼Œæ‰€ä»¥æˆ‘é¸æ“‡å¿½ç•¥é€™å€‹å•é¡Œã€‚ csharp if (TryGetSuccessResultData(context, out var successObjectResult)) { // å¾ http header request ä¸­æª¢æŸ¥æœ‰æ²’æœ‰ trace id // var traceId = context.HttpContext.Request.Headers[\"X-Trace-Id\"].ToString() ?? \"no-trace-id\"; // åˆ©ç”¨ dotnet çš„ Activity ä¾†å–å¾— trace id var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = successObjectResult?.Value }; context.Result = new ObjectResult(wrappedResponse) { Formatters = successObjectResult?.Formatters, ContentTypes = successObjectResult?.ContentTypes, StatusCode = successObjectResult?.StatusCode, DeclaredType = successObjectResult?.DeclaredType, }; } 2.2.3 åŒ…è£æˆå“æ¯”å° before after ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#è¾¨åˆ¥æ˜¯å¦ç‚º-200-æˆåŠŸå›æ‡‰"},{"categories":[],"content":" 2.2 åŒ…è£æœ‰æ•ˆå›æ‡‰ 2.2.1 è¾¨åˆ¥æ˜¯å¦ç‚º 200 æˆåŠŸå›æ‡‰å¦‚æœ Controller ä¸­çš„ api method ç”¨ä»¥ä¸‹çš„æ–¹å¼æ’°å¯«æ™‚ï¼Œå›æ‡‰çš„ç‰©ä»¶åˆ†åˆ¥æœƒæ˜¯ â€˜OkObjectResultâ€™ ã€ â€˜ObjectResultâ€™ å…©ç¨® csharp [HttpGet(\"action-result\")] public async Task GetActionResult() { return Ok(\"Hello World\"); } [HttpGet(\"object\")] public async Task GetObject() { return \"Hello World\"; } é€™æ™‚å€™ï¼Œå¯ä»¥åˆ©ç”¨ä»¥ä¸‹çš„åˆ¤æ–·ä¾†è®“ ResultFilter é‡å°æœ‰æ•ˆå›æ‡‰é€²è¡ŒåŒ…è£ç‰©ä»¶ï¼›ç”±æ–¼æˆ‘æƒ³è¦è‡ªå·±å¦å¤–è™•ç†éŒ¯èª¤ç›¸é—œçš„å›æ‡‰ï¼Œæ‰€ä»¥é€™é‚Šæ˜¯é‡å° 200 çš„å›æ‡‰ä¾†é€²è¡ŒåŒ…è£ï¼Œå¾ŒçºŒæœƒå†å¦å¤–æ’°å¯«éŒ¯èª¤è³‡æ–™çš„åŒ…è£è¡Œç‚ºã€‚ é€™é‚Šçš„åˆ¤æ–·æ–¹æ³•æœƒå°‡è½‰å‹å¥½çš„ ObjectResult å›å‚³çµ¦èª¿ç”¨ç«¯ï¼Œè®“èª¿ç”¨ç«¯å¯ä»¥ç”¨ä¾†è¨­å®šè³‡æ–™ csharp private static bool TryGetSuccessResultData(ResultExecutingContext context, out ObjectResult successObjectResult) { switch (context.Result) { case OkObjectResult okResult: successObjectResult = okResult; return true; case ObjectResult { StatusCode: \u003e= 200 and \u003c 300 } objectResult: successObjectResult = objectResult; return true; default: successObjectResult = context.Result; return false; } } 2.2.2 åŒ…è£å›æ‡‰ç‰©ä»¶æ¥ä¸‹ä¾†å°±æ˜¯å¯¦éš›çš„ç‰©ä»¶åŒ…è£äº†ï¼Œå› ç‚ºå‰é¢å·²ç¶“æ‹¿åˆ°äº†æœ‰æ•ˆçš„å›æ‡‰ç‰©ä»¶ï¼Œæ‰€ä»¥é€™é‚Šçš„è¨­å®šå°±æœƒæ¯”è¼ƒç°¡å–®ï¼Œå°±åªæ˜¯æŠŠ ApiResponse ç‰©ä»¶å»ºç«‹èµ·ä¾†ä¸¦è¨­å®šå›å»è€Œå·²ã€‚ é€™é‚Šæœƒæ¯”è¼ƒæ³¨æ„çš„æ˜¯ï¼Œè¦æ€è€ƒ ApiResponse ä¸­çš„ Id æ¬„ä½è¦å¡å…¥çš„è³‡æ–™æ˜¯ä»€éº¼ï¼Œåœ¨ç¾åœ¨å¯è§€æ¸¬æ€§æ¦‚å¿µç››è¡Œçš„ç’°å¢ƒä¸‹ï¼Œæˆ‘é¸æ“‡ç›´æ¥ä½¿ç”¨ Trace Id ä¾†ä½œç‚ºæˆ‘çš„ Response Idï¼Œè‡³æ–¼å¯¦éš›ä¸Šæ‡‰è©²è¦ç”¨ä»€éº¼è³‡æ–™ä½œç‚º Id å¯ä»¥ç”±åœ˜éšŠæˆå“¡ä¸€èµ·å®šç¾©ï¼Œä¸¦ä¸”é…åˆè³‡å®‰è€ƒé‡é€²è¡Œè™•ç†ã€‚ å¦å¤–ï¼Œé›–ç„¶é€™é‚Šçš„ successObjectResult å¯èƒ½ç‚º nullï¼Œä½†æ˜¯æˆ‘åœ¨ TryGetSuccessResultData ä¸­çš„è™•ç†æ˜¯å¦‚æœä¸æˆåŠŸå°±æœƒæ˜¯ falseï¼Œæ‰€ä»¥ä¸¦ä¸æœƒé€²å…¥é€™å€‹ if å…§é€²è¡Œè™•ç†ï¼Œæ‰€ä»¥æˆ‘é¸æ“‡å¿½ç•¥é€™å€‹å•é¡Œã€‚ csharp if (TryGetSuccessResultData(context, out var successObjectResult)) { // å¾ http header request ä¸­æª¢æŸ¥æœ‰æ²’æœ‰ trace id // var traceId = context.HttpContext.Request.Headers[\"X-Trace-Id\"].ToString() ?? \"no-trace-id\"; // åˆ©ç”¨ dotnet çš„ Activity ä¾†å–å¾— trace id var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = successObjectResult?.Value }; context.Result = new ObjectResult(wrappedResponse) { Formatters = successObjectResult?.Formatters, ContentTypes = successObjectResult?.ContentTypes, StatusCode = successObjectResult?.StatusCode, DeclaredType = successObjectResult?.DeclaredType, }; } 2.2.3 åŒ…è£æˆå“æ¯”å° before after ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#åŒ…è£å›æ‡‰ç‰©ä»¶"},{"categories":[],"content":" 2.2 åŒ…è£æœ‰æ•ˆå›æ‡‰ 2.2.1 è¾¨åˆ¥æ˜¯å¦ç‚º 200 æˆåŠŸå›æ‡‰å¦‚æœ Controller ä¸­çš„ api method ç”¨ä»¥ä¸‹çš„æ–¹å¼æ’°å¯«æ™‚ï¼Œå›æ‡‰çš„ç‰©ä»¶åˆ†åˆ¥æœƒæ˜¯ â€˜OkObjectResultâ€™ ã€ â€˜ObjectResultâ€™ å…©ç¨® csharp [HttpGet(\"action-result\")] public async Task GetActionResult() { return Ok(\"Hello World\"); } [HttpGet(\"object\")] public async Task GetObject() { return \"Hello World\"; } é€™æ™‚å€™ï¼Œå¯ä»¥åˆ©ç”¨ä»¥ä¸‹çš„åˆ¤æ–·ä¾†è®“ ResultFilter é‡å°æœ‰æ•ˆå›æ‡‰é€²è¡ŒåŒ…è£ç‰©ä»¶ï¼›ç”±æ–¼æˆ‘æƒ³è¦è‡ªå·±å¦å¤–è™•ç†éŒ¯èª¤ç›¸é—œçš„å›æ‡‰ï¼Œæ‰€ä»¥é€™é‚Šæ˜¯é‡å° 200 çš„å›æ‡‰ä¾†é€²è¡ŒåŒ…è£ï¼Œå¾ŒçºŒæœƒå†å¦å¤–æ’°å¯«éŒ¯èª¤è³‡æ–™çš„åŒ…è£è¡Œç‚ºã€‚ é€™é‚Šçš„åˆ¤æ–·æ–¹æ³•æœƒå°‡è½‰å‹å¥½çš„ ObjectResult å›å‚³çµ¦èª¿ç”¨ç«¯ï¼Œè®“èª¿ç”¨ç«¯å¯ä»¥ç”¨ä¾†è¨­å®šè³‡æ–™ csharp private static bool TryGetSuccessResultData(ResultExecutingContext context, out ObjectResult successObjectResult) { switch (context.Result) { case OkObjectResult okResult: successObjectResult = okResult; return true; case ObjectResult { StatusCode: \u003e= 200 and \u003c 300 } objectResult: successObjectResult = objectResult; return true; default: successObjectResult = context.Result; return false; } } 2.2.2 åŒ…è£å›æ‡‰ç‰©ä»¶æ¥ä¸‹ä¾†å°±æ˜¯å¯¦éš›çš„ç‰©ä»¶åŒ…è£äº†ï¼Œå› ç‚ºå‰é¢å·²ç¶“æ‹¿åˆ°äº†æœ‰æ•ˆçš„å›æ‡‰ç‰©ä»¶ï¼Œæ‰€ä»¥é€™é‚Šçš„è¨­å®šå°±æœƒæ¯”è¼ƒç°¡å–®ï¼Œå°±åªæ˜¯æŠŠ ApiResponse ç‰©ä»¶å»ºç«‹èµ·ä¾†ä¸¦è¨­å®šå›å»è€Œå·²ã€‚ é€™é‚Šæœƒæ¯”è¼ƒæ³¨æ„çš„æ˜¯ï¼Œè¦æ€è€ƒ ApiResponse ä¸­çš„ Id æ¬„ä½è¦å¡å…¥çš„è³‡æ–™æ˜¯ä»€éº¼ï¼Œåœ¨ç¾åœ¨å¯è§€æ¸¬æ€§æ¦‚å¿µç››è¡Œçš„ç’°å¢ƒä¸‹ï¼Œæˆ‘é¸æ“‡ç›´æ¥ä½¿ç”¨ Trace Id ä¾†ä½œç‚ºæˆ‘çš„ Response Idï¼Œè‡³æ–¼å¯¦éš›ä¸Šæ‡‰è©²è¦ç”¨ä»€éº¼è³‡æ–™ä½œç‚º Id å¯ä»¥ç”±åœ˜éšŠæˆå“¡ä¸€èµ·å®šç¾©ï¼Œä¸¦ä¸”é…åˆè³‡å®‰è€ƒé‡é€²è¡Œè™•ç†ã€‚ å¦å¤–ï¼Œé›–ç„¶é€™é‚Šçš„ successObjectResult å¯èƒ½ç‚º nullï¼Œä½†æ˜¯æˆ‘åœ¨ TryGetSuccessResultData ä¸­çš„è™•ç†æ˜¯å¦‚æœä¸æˆåŠŸå°±æœƒæ˜¯ falseï¼Œæ‰€ä»¥ä¸¦ä¸æœƒé€²å…¥é€™å€‹ if å…§é€²è¡Œè™•ç†ï¼Œæ‰€ä»¥æˆ‘é¸æ“‡å¿½ç•¥é€™å€‹å•é¡Œã€‚ csharp if (TryGetSuccessResultData(context, out var successObjectResult)) { // å¾ http header request ä¸­æª¢æŸ¥æœ‰æ²’æœ‰ trace id // var traceId = context.HttpContext.Request.Headers[\"X-Trace-Id\"].ToString() ?? \"no-trace-id\"; // åˆ©ç”¨ dotnet çš„ Activity ä¾†å–å¾— trace id var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = successObjectResult?.Value }; context.Result = new ObjectResult(wrappedResponse) { Formatters = successObjectResult?.Formatters, ContentTypes = successObjectResult?.ContentTypes, StatusCode = successObjectResult?.StatusCode, DeclaredType = successObjectResult?.DeclaredType, }; } 2.2.3 åŒ…è£æˆå“æ¯”å° before after ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:2","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#åŒ…è£æˆå“æ¯”å°"},{"categories":[],"content":" 2.3 è™•ç†éŒ¯èª¤å›æ‡‰å‰é¢è™•ç†å®Œäº†æˆåŠŸçš„å›æ‡‰å¾Œï¼Œæ¥ä¸‹ä¾†æ¥è‘—è™•ç†éŒ¯èª¤çš„å›æ‡‰ã€‚ 2.3.1 è¾¨åˆ¥æ˜¯å¦ç‚º 400 éŒ¯èª¤å›æ‡‰ç‚ºäº†é‡å°éŒ¯èª¤è¦æ±‚é€²è¡ŒåŒ…è£ï¼Œé€™é‚Šä¸€æ¨£ä½¿ç”¨ä¸€å€‹åˆ¤æ–·æ–¹æ³•ä¾†è¾¨åˆ¥æ˜¯å¦ç‚º BadRequestResult csharp private static bool TryGetBadRequestResultData(ResultExecutingContext context, out BadRequestResult? badRequestResult) { if (context.Result is BadRequestResult result) { badRequestResult = result; return true; } badRequestResult = null; return false; } 2.3.2 åŒ…è£å›æ‡‰ç‰©ä»¶æ¥è‘—ä¾†è™•ç†å›æ‡‰ç‰©ä»¶åŒ…è£çš„éƒ¨åˆ†ï¼Œé€™é‚Šæœƒéœ€è¦æ³¨æ„çš„é»æ˜¯ï¼Œé–‹ç™¼åœ˜éšŠå¯èƒ½ä½¿ç”¨ FluentValidation é€²è¡Œç‰©ä»¶é©—è­‰ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨å…§å»ºçš„ DataAnnotations é€²è¡Œé©—è­‰ï¼Œå…©é‚Šå›æ‡‰çš„ç‰©ä»¶ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥æœƒéœ€è¦æ³¨æ„ç‰©ä»¶è½‰æ›æ™‚æ‰€ä½¿ç”¨çš„ç‰©ä»¶ã€‚ å…ˆå°‡ FluentValidation è·Ÿ DataAnnotations çš„éŒ¯èª¤ç‰©ä»¶è½‰ç‚ºå‰é¢å®šç¾©çš„å…±ç”¨éŒ¯èª¤ç‰©ä»¶ â€˜ApiErrorInformationâ€™ï¼Œé€™é‚Šçš„ç¯„ä¾‹ç¨‹å¼ç¢¼çš„è¨­å®šæ–¹å¼åƒ…ç”¨æ–¼ç¤ºæ„ï¼Œå¯¦éš›çš„è¨­å®šæ–¹æ³•æ‡‰èˆ‡åœ˜éšŠå”è­°å¥½ç‰©ä»¶è©²æ€éº¼å®šç¾©è³‡æ–™ã€‚ è³‡è¨Š ç•¶ç„¶ï¼Œå¦‚æœåœ˜éšŠæœ‰å…±è­˜å¯ä»¥ç›´æ¥ä½¿ç”¨åŸæœ¬çš„éŒ¯èª¤ç‰©ä»¶è¼¸å‡ºä¹Ÿæ˜¯æ²’æœ‰å•é¡Œçš„ï¼Œå®Œå…¨å°±æ˜¯åœ˜éšŠåœ¨ç³»çµ±è¨­è¨ˆä¸Šçš„æ±ºç­–å•é¡Œ~ å¦‚æœè¦ä½¿ç”¨åŸæœ¬çš„éŒ¯èª¤ç‰©ä»¶ï¼Œåšæ³•å°±è·Ÿå‰é¢æˆåŠŸè¦æ±‚çš„åšæ³•ä¸€æ¨£ï¼Œç›´æ¥æŠŠå›æ‡‰è³‡æ–™åŒ…èµ·ä¾†å°±å¥½ï¼Œä¸ç”¨ç‰¹åˆ¥è™•ç†ã€‚ csharp var apiErrorInformation = new ApiErrorInformation(); switch (badRequestObjectResult.Value) { // FluentValidation çš„éŒ¯èª¤ç‰©ä»¶ case List\u003cValidationFailure\u003e validationFailures: apiErrorInformation.ErrorCode = validationFailures.First().ErrorCode; apiErrorInformation.Message = validationFailures.First().ErrorMessage; break; // DataAnnotations çš„éŒ¯èª¤ç‰©ä»¶ case ValidationProblemDetails validationProblemDetails: apiErrorInformation.ErrorCode = validationProblemDetails.Title; // é€™é‚Šéœ€è¦é¡å¤–é€²å…¥ values è£¡é¢æ‰èƒ½å–å¾—çœŸçš„è¦çš„éŒ¯èª¤è¨Šæ¯ apiErrorInformation.Message = validationProblemDetails.Errors.Values.FirstOrDefault().FirstOrDefault(); break; } å†ä¾†è·Ÿå‰é¢æˆåŠŸçš„å›æ‡‰ä¸€æ¨£ï¼Œè¨­å®š Result csharp var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse\u003cApiErrorInformation\u003e { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = apiErrorInformation }; context.Result = new BadRequestObjectResult(wrappedResponse) { Formatters = badRequestObjectResult.Formatters, ContentTypes = badRequestObjectResult.ContentTypes, StatusCode = badRequestObjectResult.StatusCode, DeclaredType = badRequestObjectResult.DeclaredType }; 2.3.3 åŒ…è£å¾Œæˆæœ use data annotations validation use fluent validation ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:3","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#è™•ç†éŒ¯èª¤å›æ‡‰"},{"categories":[],"content":" 2.3 è™•ç†éŒ¯èª¤å›æ‡‰å‰é¢è™•ç†å®Œäº†æˆåŠŸçš„å›æ‡‰å¾Œï¼Œæ¥ä¸‹ä¾†æ¥è‘—è™•ç†éŒ¯èª¤çš„å›æ‡‰ã€‚ 2.3.1 è¾¨åˆ¥æ˜¯å¦ç‚º 400 éŒ¯èª¤å›æ‡‰ç‚ºäº†é‡å°éŒ¯èª¤è¦æ±‚é€²è¡ŒåŒ…è£ï¼Œé€™é‚Šä¸€æ¨£ä½¿ç”¨ä¸€å€‹åˆ¤æ–·æ–¹æ³•ä¾†è¾¨åˆ¥æ˜¯å¦ç‚º BadRequestResult csharp private static bool TryGetBadRequestResultData(ResultExecutingContext context, out BadRequestResult? badRequestResult) { if (context.Result is BadRequestResult result) { badRequestResult = result; return true; } badRequestResult = null; return false; } 2.3.2 åŒ…è£å›æ‡‰ç‰©ä»¶æ¥è‘—ä¾†è™•ç†å›æ‡‰ç‰©ä»¶åŒ…è£çš„éƒ¨åˆ†ï¼Œé€™é‚Šæœƒéœ€è¦æ³¨æ„çš„é»æ˜¯ï¼Œé–‹ç™¼åœ˜éšŠå¯èƒ½ä½¿ç”¨ FluentValidation é€²è¡Œç‰©ä»¶é©—è­‰ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨å…§å»ºçš„ DataAnnotations é€²è¡Œé©—è­‰ï¼Œå…©é‚Šå›æ‡‰çš„ç‰©ä»¶ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥æœƒéœ€è¦æ³¨æ„ç‰©ä»¶è½‰æ›æ™‚æ‰€ä½¿ç”¨çš„ç‰©ä»¶ã€‚ å…ˆå°‡ FluentValidation è·Ÿ DataAnnotations çš„éŒ¯èª¤ç‰©ä»¶è½‰ç‚ºå‰é¢å®šç¾©çš„å…±ç”¨éŒ¯èª¤ç‰©ä»¶ â€˜ApiErrorInformationâ€™ï¼Œé€™é‚Šçš„ç¯„ä¾‹ç¨‹å¼ç¢¼çš„è¨­å®šæ–¹å¼åƒ…ç”¨æ–¼ç¤ºæ„ï¼Œå¯¦éš›çš„è¨­å®šæ–¹æ³•æ‡‰èˆ‡åœ˜éšŠå”è­°å¥½ç‰©ä»¶è©²æ€éº¼å®šç¾©è³‡æ–™ã€‚ è³‡è¨Š ç•¶ç„¶ï¼Œå¦‚æœåœ˜éšŠæœ‰å…±è­˜å¯ä»¥ç›´æ¥ä½¿ç”¨åŸæœ¬çš„éŒ¯èª¤ç‰©ä»¶è¼¸å‡ºä¹Ÿæ˜¯æ²’æœ‰å•é¡Œçš„ï¼Œå®Œå…¨å°±æ˜¯åœ˜éšŠåœ¨ç³»çµ±è¨­è¨ˆä¸Šçš„æ±ºç­–å•é¡Œ~ å¦‚æœè¦ä½¿ç”¨åŸæœ¬çš„éŒ¯èª¤ç‰©ä»¶ï¼Œåšæ³•å°±è·Ÿå‰é¢æˆåŠŸè¦æ±‚çš„åšæ³•ä¸€æ¨£ï¼Œç›´æ¥æŠŠå›æ‡‰è³‡æ–™åŒ…èµ·ä¾†å°±å¥½ï¼Œä¸ç”¨ç‰¹åˆ¥è™•ç†ã€‚ csharp var apiErrorInformation = new ApiErrorInformation(); switch (badRequestObjectResult.Value) { // FluentValidation çš„éŒ¯èª¤ç‰©ä»¶ case List validationFailures: apiErrorInformation.ErrorCode = validationFailures.First().ErrorCode; apiErrorInformation.Message = validationFailures.First().ErrorMessage; break; // DataAnnotations çš„éŒ¯èª¤ç‰©ä»¶ case ValidationProblemDetails validationProblemDetails: apiErrorInformation.ErrorCode = validationProblemDetails.Title; // é€™é‚Šéœ€è¦é¡å¤–é€²å…¥ values è£¡é¢æ‰èƒ½å–å¾—çœŸçš„è¦çš„éŒ¯èª¤è¨Šæ¯ apiErrorInformation.Message = validationProblemDetails.Errors.Values.FirstOrDefault().FirstOrDefault(); break; } å†ä¾†è·Ÿå‰é¢æˆåŠŸçš„å›æ‡‰ä¸€æ¨£ï¼Œè¨­å®š Result csharp var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = apiErrorInformation }; context.Result = new BadRequestObjectResult(wrappedResponse) { Formatters = badRequestObjectResult.Formatters, ContentTypes = badRequestObjectResult.ContentTypes, StatusCode = badRequestObjectResult.StatusCode, DeclaredType = badRequestObjectResult.DeclaredType }; 2.3.3 åŒ…è£å¾Œæˆæœ use data annotations validation use fluent validation ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:3","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#è¾¨åˆ¥æ˜¯å¦ç‚º-400-éŒ¯èª¤å›æ‡‰"},{"categories":[],"content":" 2.3 è™•ç†éŒ¯èª¤å›æ‡‰å‰é¢è™•ç†å®Œäº†æˆåŠŸçš„å›æ‡‰å¾Œï¼Œæ¥ä¸‹ä¾†æ¥è‘—è™•ç†éŒ¯èª¤çš„å›æ‡‰ã€‚ 2.3.1 è¾¨åˆ¥æ˜¯å¦ç‚º 400 éŒ¯èª¤å›æ‡‰ç‚ºäº†é‡å°éŒ¯èª¤è¦æ±‚é€²è¡ŒåŒ…è£ï¼Œé€™é‚Šä¸€æ¨£ä½¿ç”¨ä¸€å€‹åˆ¤æ–·æ–¹æ³•ä¾†è¾¨åˆ¥æ˜¯å¦ç‚º BadRequestResult csharp private static bool TryGetBadRequestResultData(ResultExecutingContext context, out BadRequestResult? badRequestResult) { if (context.Result is BadRequestResult result) { badRequestResult = result; return true; } badRequestResult = null; return false; } 2.3.2 åŒ…è£å›æ‡‰ç‰©ä»¶æ¥è‘—ä¾†è™•ç†å›æ‡‰ç‰©ä»¶åŒ…è£çš„éƒ¨åˆ†ï¼Œé€™é‚Šæœƒéœ€è¦æ³¨æ„çš„é»æ˜¯ï¼Œé–‹ç™¼åœ˜éšŠå¯èƒ½ä½¿ç”¨ FluentValidation é€²è¡Œç‰©ä»¶é©—è­‰ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨å…§å»ºçš„ DataAnnotations é€²è¡Œé©—è­‰ï¼Œå…©é‚Šå›æ‡‰çš„ç‰©ä»¶ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥æœƒéœ€è¦æ³¨æ„ç‰©ä»¶è½‰æ›æ™‚æ‰€ä½¿ç”¨çš„ç‰©ä»¶ã€‚ å…ˆå°‡ FluentValidation è·Ÿ DataAnnotations çš„éŒ¯èª¤ç‰©ä»¶è½‰ç‚ºå‰é¢å®šç¾©çš„å…±ç”¨éŒ¯èª¤ç‰©ä»¶ â€˜ApiErrorInformationâ€™ï¼Œé€™é‚Šçš„ç¯„ä¾‹ç¨‹å¼ç¢¼çš„è¨­å®šæ–¹å¼åƒ…ç”¨æ–¼ç¤ºæ„ï¼Œå¯¦éš›çš„è¨­å®šæ–¹æ³•æ‡‰èˆ‡åœ˜éšŠå”è­°å¥½ç‰©ä»¶è©²æ€éº¼å®šç¾©è³‡æ–™ã€‚ è³‡è¨Š ç•¶ç„¶ï¼Œå¦‚æœåœ˜éšŠæœ‰å…±è­˜å¯ä»¥ç›´æ¥ä½¿ç”¨åŸæœ¬çš„éŒ¯èª¤ç‰©ä»¶è¼¸å‡ºä¹Ÿæ˜¯æ²’æœ‰å•é¡Œçš„ï¼Œå®Œå…¨å°±æ˜¯åœ˜éšŠåœ¨ç³»çµ±è¨­è¨ˆä¸Šçš„æ±ºç­–å•é¡Œ~ å¦‚æœè¦ä½¿ç”¨åŸæœ¬çš„éŒ¯èª¤ç‰©ä»¶ï¼Œåšæ³•å°±è·Ÿå‰é¢æˆåŠŸè¦æ±‚çš„åšæ³•ä¸€æ¨£ï¼Œç›´æ¥æŠŠå›æ‡‰è³‡æ–™åŒ…èµ·ä¾†å°±å¥½ï¼Œä¸ç”¨ç‰¹åˆ¥è™•ç†ã€‚ csharp var apiErrorInformation = new ApiErrorInformation(); switch (badRequestObjectResult.Value) { // FluentValidation çš„éŒ¯èª¤ç‰©ä»¶ case List validationFailures: apiErrorInformation.ErrorCode = validationFailures.First().ErrorCode; apiErrorInformation.Message = validationFailures.First().ErrorMessage; break; // DataAnnotations çš„éŒ¯èª¤ç‰©ä»¶ case ValidationProblemDetails validationProblemDetails: apiErrorInformation.ErrorCode = validationProblemDetails.Title; // é€™é‚Šéœ€è¦é¡å¤–é€²å…¥ values è£¡é¢æ‰èƒ½å–å¾—çœŸçš„è¦çš„éŒ¯èª¤è¨Šæ¯ apiErrorInformation.Message = validationProblemDetails.Errors.Values.FirstOrDefault().FirstOrDefault(); break; } å†ä¾†è·Ÿå‰é¢æˆåŠŸçš„å›æ‡‰ä¸€æ¨£ï¼Œè¨­å®š Result csharp var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = apiErrorInformation }; context.Result = new BadRequestObjectResult(wrappedResponse) { Formatters = badRequestObjectResult.Formatters, ContentTypes = badRequestObjectResult.ContentTypes, StatusCode = badRequestObjectResult.StatusCode, DeclaredType = badRequestObjectResult.DeclaredType }; 2.3.3 åŒ…è£å¾Œæˆæœ use data annotations validation use fluent validation ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:3","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#åŒ…è£å›æ‡‰ç‰©ä»¶-1"},{"categories":[],"content":" 2.3 è™•ç†éŒ¯èª¤å›æ‡‰å‰é¢è™•ç†å®Œäº†æˆåŠŸçš„å›æ‡‰å¾Œï¼Œæ¥ä¸‹ä¾†æ¥è‘—è™•ç†éŒ¯èª¤çš„å›æ‡‰ã€‚ 2.3.1 è¾¨åˆ¥æ˜¯å¦ç‚º 400 éŒ¯èª¤å›æ‡‰ç‚ºäº†é‡å°éŒ¯èª¤è¦æ±‚é€²è¡ŒåŒ…è£ï¼Œé€™é‚Šä¸€æ¨£ä½¿ç”¨ä¸€å€‹åˆ¤æ–·æ–¹æ³•ä¾†è¾¨åˆ¥æ˜¯å¦ç‚º BadRequestResult csharp private static bool TryGetBadRequestResultData(ResultExecutingContext context, out BadRequestResult? badRequestResult) { if (context.Result is BadRequestResult result) { badRequestResult = result; return true; } badRequestResult = null; return false; } 2.3.2 åŒ…è£å›æ‡‰ç‰©ä»¶æ¥è‘—ä¾†è™•ç†å›æ‡‰ç‰©ä»¶åŒ…è£çš„éƒ¨åˆ†ï¼Œé€™é‚Šæœƒéœ€è¦æ³¨æ„çš„é»æ˜¯ï¼Œé–‹ç™¼åœ˜éšŠå¯èƒ½ä½¿ç”¨ FluentValidation é€²è¡Œç‰©ä»¶é©—è­‰ï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨å…§å»ºçš„ DataAnnotations é€²è¡Œé©—è­‰ï¼Œå…©é‚Šå›æ‡‰çš„ç‰©ä»¶ä¸ä¸€æ¨£ï¼Œæ‰€ä»¥æœƒéœ€è¦æ³¨æ„ç‰©ä»¶è½‰æ›æ™‚æ‰€ä½¿ç”¨çš„ç‰©ä»¶ã€‚ å…ˆå°‡ FluentValidation è·Ÿ DataAnnotations çš„éŒ¯èª¤ç‰©ä»¶è½‰ç‚ºå‰é¢å®šç¾©çš„å…±ç”¨éŒ¯èª¤ç‰©ä»¶ â€˜ApiErrorInformationâ€™ï¼Œé€™é‚Šçš„ç¯„ä¾‹ç¨‹å¼ç¢¼çš„è¨­å®šæ–¹å¼åƒ…ç”¨æ–¼ç¤ºæ„ï¼Œå¯¦éš›çš„è¨­å®šæ–¹æ³•æ‡‰èˆ‡åœ˜éšŠå”è­°å¥½ç‰©ä»¶è©²æ€éº¼å®šç¾©è³‡æ–™ã€‚ è³‡è¨Š ç•¶ç„¶ï¼Œå¦‚æœåœ˜éšŠæœ‰å…±è­˜å¯ä»¥ç›´æ¥ä½¿ç”¨åŸæœ¬çš„éŒ¯èª¤ç‰©ä»¶è¼¸å‡ºä¹Ÿæ˜¯æ²’æœ‰å•é¡Œçš„ï¼Œå®Œå…¨å°±æ˜¯åœ˜éšŠåœ¨ç³»çµ±è¨­è¨ˆä¸Šçš„æ±ºç­–å•é¡Œ~ å¦‚æœè¦ä½¿ç”¨åŸæœ¬çš„éŒ¯èª¤ç‰©ä»¶ï¼Œåšæ³•å°±è·Ÿå‰é¢æˆåŠŸè¦æ±‚çš„åšæ³•ä¸€æ¨£ï¼Œç›´æ¥æŠŠå›æ‡‰è³‡æ–™åŒ…èµ·ä¾†å°±å¥½ï¼Œä¸ç”¨ç‰¹åˆ¥è™•ç†ã€‚ csharp var apiErrorInformation = new ApiErrorInformation(); switch (badRequestObjectResult.Value) { // FluentValidation çš„éŒ¯èª¤ç‰©ä»¶ case List validationFailures: apiErrorInformation.ErrorCode = validationFailures.First().ErrorCode; apiErrorInformation.Message = validationFailures.First().ErrorMessage; break; // DataAnnotations çš„éŒ¯èª¤ç‰©ä»¶ case ValidationProblemDetails validationProblemDetails: apiErrorInformation.ErrorCode = validationProblemDetails.Title; // é€™é‚Šéœ€è¦é¡å¤–é€²å…¥ values è£¡é¢æ‰èƒ½å–å¾—çœŸçš„è¦çš„éŒ¯èª¤è¨Šæ¯ apiErrorInformation.Message = validationProblemDetails.Errors.Values.FirstOrDefault().FirstOrDefault(); break; } å†ä¾†è·Ÿå‰é¢æˆåŠŸçš„å›æ‡‰ä¸€æ¨£ï¼Œè¨­å®š Result csharp var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = apiErrorInformation }; context.Result = new BadRequestObjectResult(wrappedResponse) { Formatters = badRequestObjectResult.Formatters, ContentTypes = badRequestObjectResult.ContentTypes, StatusCode = badRequestObjectResult.StatusCode, DeclaredType = badRequestObjectResult.DeclaredType }; 2.3.3 åŒ…è£å¾Œæˆæœ use data annotations validation use fluent validation ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:3","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#åŒ…è£å¾Œæˆæœ"},{"categories":[],"content":" 2.4 å®Œæ•´çš„ Api Response Wrapping Filter csharp /// \u003csummary\u003e /// api å›æ‡‰åŒ…è£å™¨ /// \u003c/summary\u003e public class ApiResponseWrappingFilter : IResultFilter { public void OnResultExecuting(ResultExecutingContext context) { if (IsBinaryResult(context)) { return; } if (TryGetSuccessResultData(context, out var successObjectResult)) { // var traceId = context.HttpContext.Request.Headers[\"X-Trace-Id\"].ToString() ?? \"no-trace-id\"; var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse\u003cobject?\u003e { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = successObjectResult?.Value }; context.Result = new ObjectResult(wrappedResponse) { Formatters = successObjectResult?.Formatters, ContentTypes = successObjectResult?.ContentTypes, StatusCode = successObjectResult?.StatusCode, DeclaredType = successObjectResult?.DeclaredType }; } if (TryGetBadRequestObjectResultData(context, out var badRequestObjectResult)) { var apiErrorInformation = new ApiErrorInformation(); switch (badRequestObjectResult.Value) { // FluentValidation çš„éŒ¯èª¤ç‰©ä»¶ case List\u003cValidationFailure\u003e validationFailures: apiErrorInformation.ErrorCode = validationFailures.First().ErrorCode; apiErrorInformation.Message = validationFailures.First().ErrorMessage; break; // DataAnnotations çš„éŒ¯èª¤ç‰©ä»¶ case ValidationProblemDetails validationProblemDetails: apiErrorInformation.ErrorCode = validationProblemDetails.Title; // é€™é‚Šéœ€è¦é¡å¤–é€²å…¥ values è£¡é¢æ‰èƒ½å–å¾—çœŸçš„è¦çš„éŒ¯èª¤è¨Šæ¯ apiErrorInformation.Message = validationProblemDetails.Errors.Values.FirstOrDefault().FirstOrDefault(); break; case ApiErrorInformation apiError: apiErrorInformation = apiError; break; } var traceId = Activity.Current?.TraceId.ToString() ?? Guid.NewGuid().ToString(); var wrappedResponse = new ApiResponse\u003cApiErrorInformation\u003e { Id = traceId, ApiVersion = context.HttpContext.ApiVersioningFeature().RawRequestedApiVersion, RequestPath = $\"{context.HttpContext.Request.Path}.{context.HttpContext.Request.Method}\", Data = apiErrorInformation }; context.Result = new BadRequestObjectResult(wrappedResponse) { Formatters = badRequestObjectResult.Formatters, ContentTypes = badRequestObjectResult.ContentTypes, StatusCode = badRequestObjectResult.StatusCode, DeclaredType = badRequestObjectResult.DeclaredType }; } } public void OnResultExecuted(ResultExecutedContext context) { // é€™è£¡å¯ä»¥åŠ å…¥åœ¨çµæœåŸ·è¡Œå¾Œçš„è™•ç†é‚è¼¯ } private static bool IsBinaryResult(ResultExecutingContext context) { return context.Result is FileResult || context.HttpContext.Response.ContentType?.StartsWith(\"image/\") == true || context.HttpContext.Response.ContentType == \"application/octet-stream\"; } private static bool TryGetBadRequestObjectResultData(ResultExecutingContext context, out BadRequestObjectResult? badRequestResult) { if (context.Result is BadRequestObjectResult result) { badRequestResult = result; return true; } badRequestResult = null; return false; } private static bool TryGetSuccessResultData(ResultExecutingContext context, out ObjectResult? successObjectResult) { switch (context.Result) { case OkObjectResult okResult: successObjectResult = okResult; return true; case ObjectResult { StatusCode: \u003e= 200 and \u003c 300 } objectResult: successObjectResult = objectResult; return true; default: successObjectResult = null; return false; } } } ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:4","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#å®Œæ•´çš„-api-response-wrapping-filter"},{"categories":[],"content":" 2.5 è£œå……è³‡æ–™ ActionFilter \u0026 ResultFilteråœ¨å‰é¢å¯ä»¥çœ‹åˆ°æˆ‘ä½¿ç”¨çš„æ˜¯ IResultFilter ä¾†åŒ…è£å›æ‡‰ç‰©ä»¶ï¼Œé€™æ˜¯å› ç‚º IResultFilter æ˜¯å°ˆé–€ç”¨ä¾†è™•ç†å›æ‡‰å’Œä¿®æ”¹ IActionResult ç”¨çš„ä»‹é¢ï¼Œä»–åˆ†åˆ¥æœ‰ OnResultExecuting èˆ‡ OnResultExecuted å…©å€‹æ–¹æ³•ï¼Œå€‹åˆ¥çš„è·è²¬å¦‚ä¸‹ OnResultExecuting åœ¨å‹•ä½œæ–¹æ³•åŸ·è¡Œå®Œä¸¦ç”Ÿæˆçµæœï¼Œä½†åœ¨çµæœè¢«è™•ç†ï¼ˆä¾‹å¦‚åºåˆ—åŒ–æˆ JSON æˆ–å…¶ä»–æ ¼å¼ï¼‰ä¹‹å‰åŸ·è¡Œã€‚ ä½ å¯ä»¥åœ¨é€™è£¡ä¿®æ”¹ ActionResultï¼Œæˆ–è€…åŸ·è¡Œé¡å¤–çš„é‚è¼¯ï¼Œè­¬å¦‚æˆ‘å€‘é€™é‚Šåšçš„åŒ…è£å›æ‡‰ç‰©ä»¶ï¼Œåˆæˆ–è€…æ˜¯æ‰‹å‹•èª¿æ•´ Http Status Code ç­‰ã€‚ OnResultExecuted åœ¨çµæœå·²ç¶“è™•ç†å®Œï¼Œå›æ‡‰å³å°‡ç™¼é€çµ¦å®¢æˆ¶ç«¯ä¹‹å¾ŒåŸ·è¡Œã€‚ é€™å€‹æ–¹æ³•ä¸»è¦ç”¨æ–¼åœ¨çµæœå·²ç¶“æº–å‚™ç™¼é€çµ¦å®¢æˆ¶ç«¯å¾Œåšä¸€äº›æ¸…ç†æ“ä½œæˆ–è¨˜éŒ„æ—¥èªŒã€‚ è©³ç´°è³‡æ–™å¯ä»¥åƒè€ƒ MS Learn ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:2:5","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#è£œå……è³‡æ–™-actionfilter--resultfilter"},{"categories":[],"content":" 3 ç‚º Controller åŠ ä¸Š IResultFilteråœ¨å®Œæˆäº†å‰é¢çš„ç‰©ä»¶æº–å‚™å¾Œï¼Œç•¶ç„¶å°±æ˜¯è¦å¥—ç”¨åœ¨ç³»çµ±ä¸Šæ‹‰~ å¥—ç”¨çš„æ–¹å¼å¾ˆç°¡å–®ï¼Œåªéœ€è¦åœ¨ program.cs çš„ controller è¨­å®šè£¡åŠ ä¸Šå»å°±å¥½äº†ï¼Œç¨‹å¼ç¢¼å¦‚ä¸‹ csharp builder.Services.AddControllers(options =\u003e { options.Filters.Add\u003cApiResponseWrappingFilter\u003e(); }); murmur: ç™¼ç¾å¯«é•·æ–‡çš„æ™‚å€™ç¾åœ¨ä½¿ç”¨çš„ä½ˆæ™¯æœƒæœ‰äº›å•é¡Œï¼Œå­—é«”æ„Ÿè¦ºä¹Ÿä¸å¤ å¤§ï¼Œæˆ‘è¦å†æ‰¾ä¸€ä¸‹æœ‰æ²’æœ‰å…¶ä»–é©ç”¨çš„å¸ƒæ™¯ï¼Œæˆ–æ˜¯ä¹Ÿè¦æ•´ç†ä¸€ä¸‹å…§å®¹è²¼åˆ°å…¶ä»– blog å¹³å°äº† åœ¨å¯¦ä½œ web api æ™‚ï¼Œé€šå¸¸éƒ½æœƒå¦å¤–è™•ç†è‡ªå·±ç³»çµ±å°ˆå±¬çš„å›æ‡‰ç‰©ä»¶ï¼Œæˆ‘åœ¨å‰ä¸€ä»½å·¥ä½œä¸­å› ç‚ºå·²ç¶“æœ‰åº•å±¤çš„å‰è¼©å»ºç«‹å¥½ç›¸é—œçš„è™•ç†å¥—ä»¶ï¼Œæ‰€ä»¥ä¸€ç›´ä»¥ä¾†éƒ½æ²’ç‰¹åˆ¥ç ”ç©¶æ€éº¼åŒ…è£ä»¥åŠè‡ªè¨‚å›æ‡‰æ¬„ä½ã€‚ ","date":"2024-10-12","objectID":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/:3:0","series":["aspnetcore-webapi-custom-response-model"],"tags":["dotnet"],"title":"å¹« AspNetCore WebApi åŒ…ä¸Šè‡ªå·±çš„ response modelï¼ŒPart 1 : åŒ…è£ api å›æ‡‰","uri":"/2024/10/aspnetcore-webapi-custom-response-model-part1-wrapping-api-response/#ç‚º-controller-åŠ ä¸Š-iresultfilter"},{"categories":[],"content":"è©²ä½¿ç”¨ SDK é‚„æ˜¯ WebApi çš„å½¢å¼æä¾›æœå‹™?","date":"2024-03-03","objectID":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/","series":[],"tags":[],"title":"è©²ä½¿ç”¨ SDK é‚„æ˜¯ WebApi çš„å½¢å¼æä¾›æœå‹™?","uri":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/"},{"categories":[],"content":"å¤§å®¶åœ¨ä½¿ç”¨ dotnet æˆ–å…¶ä»–å¯ä»¥æ‰“åŒ…æˆåŠŸé–‹å¥—ä»¶åšåˆ†äº«çš„ç¨‹å¼èªè¨€æ™‚ï¼Œå¯èƒ½éƒ½æœƒæƒ³åˆ°ä¸€å€‹å•é¡Œ ç¾åœ¨ WebApi é‚£éº¼ç››è¡Œï¼Œæˆ‘è©²å¦‚ä½•æŠ‰æ“‡è¦ä½¿ç”¨ Web Api é‚„æ˜¯ å¥—ä»¶ çš„å½¢å¼ç™¼å¸ƒæˆ‘çš„æœå‹™ã€åŠŸèƒ½å‘¢ï¼Ÿ æˆ‘è¦ºå¾—æˆ‘æ–°å¯«çš„åŠŸèƒ½å¥½æ£’æ£’ï¼Œæˆ‘æƒ³ç™¼å¸ƒæˆ nuget package åˆ†äº«çµ¦åœ˜éšŠï¼Œä½†æ˜¯ä¸ç¢ºå®šåˆä¸åˆé© é€™é‚Šæˆ‘ç°¡å–®æ¢³ç†ä¸€ä¸‹ä¸€äº›éœ€è¦è€ƒé‡çš„é»~ å‚™è¨»1: é€™ç¯‡ç®—æ˜¯éå¾€å‰è¼©æ•™æˆ‘çš„ä¸€äº›å¿ƒæ³•æ•´ç†ï¼Œé…åˆæˆ‘è‡ªå·±å¾ŒçºŒçš„é–‹ç™¼ç¶“é©—æ‰€æ•´ç†çš„ä¸€äº›å°è³‡è¨Š å‚™è¨»2: ç”±æ–¼æˆ‘ä¸»è¦é‚„æ˜¯é–‹ç™¼ dotnet çš„æœå‹™ï¼Œå› æ­¤ä»¥ä¸‹éƒ½æœƒä»¥ dotnet çš„è§’åº¦å‡ºç™¼ ","date":"2024-03-03","objectID":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/:0:0","series":[],"tags":[],"title":"è©²ä½¿ç”¨ SDK é‚„æ˜¯ WebApi çš„å½¢å¼æä¾›æœå‹™?","uri":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/#"},{"categories":[],"content":" å¥—ä»¶çš„é–‹ç™¼è©•ä¼°","date":"2024-03-03","objectID":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/:0:0","series":[],"tags":[],"title":"è©²ä½¿ç”¨ SDK é‚„æ˜¯ WebApi çš„å½¢å¼æä¾›æœå‹™?","uri":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/#å¥—ä»¶çš„é–‹ç™¼è©•ä¼°"},{"categories":[],"content":" 1 èª°é©åˆä½¿ç”¨é–‹ç™¼å¥—ä»¶çš„æ–¹å¼ç™¼å¸ƒ ç°¡å–®çš„é‚è¼¯é‹ç®— ç°¡å–®çš„è³‡æ–™çµ„åˆ ç›¡å¯èƒ½åªå€šè³´å¾®è»Ÿå¥—ä»¶æˆ–å¸¸è¦‹çš„ä¸»æµå¥—ä»¶ï¼Œä¸¦ä¸”æœƒè·Ÿè‘—ç›¸ä¾å¥—ä»¶é€²è¡Œæ›´ç‰ˆ æä¾›çš„åŠŸèƒ½å–®ä¸€ï¼Œä¸”æœ‰é«˜å…§èšç‰¹æ€§ ç•¶å¥—ä»¶æ›´æ–°æ™‚ï¼Œä½¿ç”¨æ­¤å¥—ä»¶çš„æ‡‰ç”¨ç¨‹å¼ä¸éœ€è¦å³æ™‚æ›´æ–°ä¹Ÿèƒ½ç¶­æŒåŠŸèƒ½ä¸å‡ºéŒ¯ æä¾›å°ç‰¹å®šç‰ˆæœ¬çš„ WebApi æˆ– è³‡æ–™åº« é€£ç·šèˆ‡èª¿ç”¨åŠŸèƒ½çš„èƒ½åŠ› ","date":"2024-03-03","objectID":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/:1:0","series":[],"tags":[],"title":"è©²ä½¿ç”¨ SDK é‚„æ˜¯ WebApi çš„å½¢å¼æä¾›æœå‹™?","uri":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/#èª°é©åˆä½¿ç”¨é–‹ç™¼å¥—ä»¶çš„æ–¹å¼ç™¼å¸ƒ"},{"categories":[],"content":" 2 Nuget å¥—ä»¶é–‹ç™¼æ™‚çš„æ³¨æ„äº‹é … ä¸è¦ä¾è³´å¤ªå¤šå¤–éƒ¨å¥—ä»¶ (é™¤éæ˜¯è¦åšé‚£å€‹å¥—ä»¶çš„é¡å¤–æ“´å……) ç›¡é‡ä¸è¦æœ‰ç¶²è·¯ä»¥å¤–çš„ IO è™•ç† (æœƒå…è¨±ç¶²è·¯ IO æ˜¯è¦èˆ‡ API æºé€š) è‹¥ä½¿ç”¨è€…ä¸ä½¿ç”¨ä½ çš„å¥—ä»¶ï¼Œæ‡‰è©²ä¹Ÿè¦æœ‰ç›¸å°ç°¡å–®çš„æ–¹å¼é”æˆä¸€æ¨£çš„ç›®çš„ å¥—ä»¶æä¾›çš„åŠŸèƒ½æ‡‰è©²è¦æœ‰é«˜å…§èšã€ä½è€¦åˆçš„ç‰¹æ€§ å¥—ä»¶çš„ API è¨­è¨ˆè¦ç°¡å–®æ˜ç­ï¼Œä¸”è·è²¬æ˜ç¢º ç›¡å¯èƒ½æä¾›æœ‰å½ˆæ€§çš„æ³¨å…¥æ–¹æ³• æœ€å¥½æä¾›å°ˆç”¨çš„æ³¨å…¥æ–¹æ³•ï¼Œé¿å…å…§éƒ¨å¯¦ä½œç‰©ä»¶æš´éœ² ä¸€å®šè¦æœ‰å…¬é–‹ä»‹é¢ å…§éƒ¨å¯¦ä½œå¯ä»¥çš„è©±ä¸è¦ä½¿ç”¨ public ","date":"2024-03-03","objectID":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/:2:0","series":[],"tags":[],"title":"è©²ä½¿ç”¨ SDK é‚„æ˜¯ WebApi çš„å½¢å¼æä¾›æœå‹™?","uri":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/#nuget-å¥—ä»¶é–‹ç™¼æ™‚çš„æ³¨æ„äº‹é …"},{"categories":[],"content":" Web Api çš„é–‹ç™¼è©•ä¼°","date":"2024-03-03","objectID":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/:0:0","series":[],"tags":[],"title":"è©²ä½¿ç”¨ SDK é‚„æ˜¯ WebApi çš„å½¢å¼æä¾›æœå‹™?","uri":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/#web-api-çš„é–‹ç™¼è©•ä¼°"},{"categories":[],"content":" 1 èª°é©åˆè£½ä½œ WebApi éœ€è¦ç¨ç«‹é‹ä½œ éœ€è¦é »ç¹èˆ‡è³‡æ–™åº«äº’å‹• éœ€è¦è™•ç†è¤‡é›œé‚è¼¯ éœ€è¦æ›´æ–°å¾Œèƒ½å¤ ç«‹å³åæ˜ æ–°çš„é‚è¼¯åœ¨ä½¿ç”¨æ­¤ Web Api çš„ç³»çµ± éœ€è¦åŒæ™‚æä¾›å¤šç‰ˆæœ¬åŠŸèƒ½ é™¤äº† dotnet ç³»çµ±å¤–ï¼Œä¹Ÿéœ€è¦æä¾›æœå‹™çµ¦å‰ç«¯ç­‰é dotnet ç”Ÿæ…‹ç³»çš„ç³»çµ± ","date":"2024-03-03","objectID":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/:1:0","series":[],"tags":[],"title":"è©²ä½¿ç”¨ SDK é‚„æ˜¯ WebApi çš„å½¢å¼æä¾›æœå‹™?","uri":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/#èª°é©åˆè£½ä½œ-webapi"},{"categories":[],"content":" å…¶ä»–åƒè€ƒè³‡æ–™ å®‰å¾·é­¯çš„éƒ¨è½æ ¼-API \u0026 SDK Design #2, è¨­è¨ˆå°ˆå±¬çš„ SDK ","date":"2024-03-03","objectID":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/:0:0","series":[],"tags":[],"title":"è©²ä½¿ç”¨ SDK é‚„æ˜¯ WebApi çš„å½¢å¼æä¾›æœå‹™?","uri":"/2024/03/%E8%A9%B2%E4%BD%BF%E7%94%A8-sdk-%E9%82%84%E6%98%AF-webapi-%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8B%99/#å…¶ä»–åƒè€ƒè³‡æ–™"},{"categories":[],"content":"æˆ‘åˆæœŸåœ¨å…¬å¸å»ºç«‹åœ°ç«¯ Kubernetes å¢é›†ä»¥é€²è¡Œ POC æ™‚ï¼Œéƒ½æ˜¯ä½¿ç”¨ kubeadm é€™å¥—å®˜æ–¹å·¥å…·é€²è¡Œçš„ (æˆ‘æ—©æœŸæ–‡ç« å°±æ˜¯åŸºæ–¼æ­¤æ’°å¯«çš„)ã€‚ ä½†æ˜¯ç•¶éœ€è¦å°‡ Kubernetes æ‹“å±•åˆ°å…¶ä»–å–®ä½æ™‚ï¼Œé‚£ç›¸å°è¤‡é›œçš„å®‰è£èˆ‡ç®¡ç†æ–¹å¼å»æ˜¯ç¬¬ä¸€å€‹é›£ä»¥èºéçš„é–€æª»ã€‚ å› æ­¤ï¼Œå¾ŒçºŒæ”¹ç”¨ RKE2 å»ºç«‹ï¼Œä¸¦ä¸”å°å…¥ Rancher é€²è¡Œ Kubernetes å¢é›†ç®¡ç†ã€‚å¾ 2022 å¹´æœ«ä½¿ç”¨è‡³ä»Šï¼Œç”±æ–¼æˆ‘å€‘å…¬å¸çš„é‹ç”¨æƒ…å¢ƒç›¸å°ç°¡å–®ï¼Œå› æ­¤æ²’å‡ºç¾å¤ªå¤šé›£ä»¥è™•ç†çš„å•é¡Œã€‚ é€™ç¯‡ç´€éŒ„æˆ‘çš„ RKE2 + Rancher çš„å®‰è£å‘½ä»¤ï¼Œä¸»è¦å…§å®¹éƒ½æ˜¯ä¾æ“š iThome Kubernetes Summit 2022 æ™‚æˆ‘åƒèˆ‡çš„ SUSE å·¥ä½œåŠè¬›å¸«æä¾›çš„è³‡è¨Šé€²è¡Œèª¿æ•´ï¼Œä¸¦é©åº¦çš„åŠ ä¸Šä¸€äº›èªªæ˜ã€‚ ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:0:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#"},{"categories":[],"content":" RKE2 Install","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:0:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#rke2-install"},{"categories":[],"content":" 1 é‹ä½œç’°å¢ƒ è³‡è¨Š OS Ubuntu 20.04 RKE2 v1.24.11+rke2r1 æ‡‰é…åˆ Rancher é¸æ“‡ç‰ˆæœ¬ Rancher v2.7.9 æ‡‰é…åˆ RKE2 é¸æ“‡ç‰ˆæœ¬ ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:1:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#é‹ä½œç’°å¢ƒ"},{"categories":[],"content":" 2 First Node","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:2:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#first-node"},{"categories":[],"content":" 2.1 download rke2 install file bash #é è¨­ä¸çµ¦ type å°±æ˜¯ server äº†ï¼Œæ‰€ä»¥ä¸ç”¨ç‰¹åœ°çµ¦ type #curl -sfL https://get.rke2.io | INSTALL_RKE2_TYPE=\"server\" sh - curl -sfL https://get.rke2.io --output install.sh chmod +x install.sh ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:2:1","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#download-rke2-install-file"},{"categories":[],"content":" 2.2 Create RKE2 Config bash sudo mkdir -p /etc/rancher/rke2/ cat \u003c\u003cEOF | sudo tee /etc/rancher/rke2/config.yaml # ä¸»æ©Ÿåç¨± node-name: - \"rke2-node-01\" # k8s å„ä¸»æ©Ÿæºé€šç”¨çš„æ†‘è­‰ç°½ç«  tls-san: - rke2-node-01 # node host - rke2-node-01.local.vm # node host domain - rke2-cluster.local.vm # k8s cluster api server domain - 1.1.1.1 # k8s cluster api server domain çš„ vipï¼Œçœ‹åƒè€ƒè³‡æ–™å¤šåŠéƒ½æœ‰è¨­å®š #å¦‚æœè¦åšç´” k8s master çš„è©±å¯å·²åŠ å…¥ä»¥ä¸‹è¨­å®šï¼ŒRKE2 é è¨­æ˜¯æ··åˆ NODE #node-taint: # - \"CriticalAddinsonly=true:NoExecute\" #ä»¥ä¸‹åƒæ•¸æ‰€æœ‰ master node éƒ½è¦ç›¸åŒ # ç”±æ–¼æˆ‘çš„ç’°å¢ƒä¸»è¦ä½¿ç”¨ istioï¼Œå› æ­¤é—œæ‰ nginx çš„ ingress disable: rke2-ingress-nginx cni: - cilium EOF ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:2:2","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#create-rke2-config"},{"categories":[],"content":" 2.3 Run Install bash sudo INSTALL_RKE2_CHANNEL=v1.24.11+rke2r1 ./install.sh export PATH=$PATH:/opt/rke2/bin sudo systemctl enable rke2-server #é€™é‚ŠåŸ·è¡Œå¾Œæœƒè¦ç­‰ä¸€ä¸‹ sudo systemctl start rke2-server ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:2:3","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#run-install"},{"categories":[],"content":" 2.4 Set Config and Kubectl bash mkdir .kube sudo cp /etc/rancher/rke2/rke2.yaml .kube/config #å¦‚æœä¸æ˜¯ç”¨ root ç™»å…¥çš„è©±ï¼Œéœ€è¦å¦å¤–çµ¦äºˆæ¬Šé™ #sudo chown rancher .kube/config sudo cp /var/lib/rancher/rke2/bin/kubectl /usr/local/bin/ ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:2:4","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#set-config-and-kubectl"},{"categories":[],"content":" 2.5 Get rke2 token è³‡è¨Š é€™é‚Šæ˜¯ç”¨ä¾†çµ¦å…¶ä»– Master Node ç”¨çš„ï¼Œå¦‚æœåªæ‰“ç®—å»ºç«‹ä¸€å° Master Nodeï¼Œå‰‡å¯ä»¥å¿½ç•¥æ­¤æ­¥é©Ÿ bash sudo cat /var/lib/rancher/rke2/server/token ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:2:5","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#get-rke2-token"},{"categories":[],"content":" 3 Other Master Node è³‡è¨Š åŸºæœ¬æµç¨‹å¤§è‡´ä¸€æ¨£ï¼Œåªæœ‰ config æœƒæœ‰äº›è¨±å·®ç•°ï¼Œå› æ­¤æ­¤ç¯€åƒ…ä¿ç•™å·®ç•°è™• ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:3:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#other-master-node"},{"categories":[],"content":" 3.1 Create rke2 Config è³‡è¨Š config æœ€å¤§çš„å·®ç•°æ˜¯åœ¨ç¬¬äºŒå°ä»¥å¾Œçš„ master éƒ½éœ€è¦åŠ ä¸Š token / server ç­‰æ¬„ä½ bash sudo mkdir -p /etc/rancher/rke2/ cat \u003c\u003cEOF | sudo tee /etc/rancher/rke2/config.yaml token: -- #é€™é‚Š server æœ‰äººç”¨ç¬¬ä¸€å°ä¸»æ©Ÿçš„ domainï¼Œæœ‰äººç”¨å¢é›† domainï¼Œåªè¦èƒ½é€£ä¸Šä¸»è¦çš„ master ä¸»æ©Ÿä¸¦ä½¿ç”¨ 9345 port å³å¯ #port çš„éƒ¨åˆ† RKE2 é è¨­ä½¿ç”¨ 9345ï¼Œä½†æ˜¯ä»æœ‰é–‹é€š 6443 ä¾†ä¾›ä¸€èˆ¬ä½¿ç”¨ server: https://rke2-node-01.local.vm:9345 # ä¸»æ©Ÿåç¨± node-name: - \"rke2-node-02\" # k8s å„ä¸»æ©Ÿæºé€šç”¨çš„æ†‘è­‰ç°½ç«  tls-san: - rke2-node-02 # node host - rke2-node-02.local.vm # node host domain - rke2-cluster.local.vm # k8s cluster api server domain - 1.1.1.1 # k8s cluster api server domain çš„ vipï¼Œçœ‹åƒè€ƒè³‡æ–™å¤šåŠéƒ½æœ‰è¨­å®š #å¦‚æœè¦åšç´” k8s master çš„è©±å¯å·²åŠ å…¥ä»¥ä¸‹è¨­å®šï¼ŒRKE2 é è¨­æ˜¯æ··åˆ NODE #node-taint: # - \"CriticalAddinsonly=true:NoExecute\" #ä»¥ä¸‹åƒæ•¸æ‰€æœ‰ master node éƒ½è¦ç›¸åŒ # ç”±æ–¼æˆ‘çš„ç’°å¢ƒä¸»è¦ä½¿ç”¨ istioï¼Œå› æ­¤é—œæ‰ nginx çš„ ingress disable: rke2-ingress-nginx cni: - cilium EOF ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:3:1","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#create-rke2-config-1"},{"categories":[],"content":" 4 uninstall å®˜æ–¹è§£å®‰è£æ–‡ä»¶ ubuntu ç›´æ¥åŸ·è¡Œ /usr/local/bin/rke2-uninstall.sh å°±å¥½ï¼Œè¼•é¬†æ„œæ„ï¼ŒæœƒæŠŠæ‰€æœ‰è‡ªè¨‚è¨­å®šç­‰è³‡æ–™å…¨éƒ¨æ¸…ç©ºï¼Œæ‰€ä»¥è¨­å®šæª”è¨˜å¾—ç•™å‚™ä»½ centos ç›´æ¥åŸ·è¡Œ /usr/bin/rke2-uninstall.sh å°±å¥½ï¼Œè¼•é¬†æ„œæ„ï¼ŒæœƒæŠŠæ‰€æœ‰è‡ªè¨‚è¨­å®šç­‰è³‡æ–™å…¨éƒ¨æ¸…ç©ºï¼Œæ‰€ä»¥è¨­å®šæª”è¨˜å¾—ç•™å‚™ä»½ ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:4:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#uninstall"},{"categories":[],"content":" Istio / Rancher ç­‰å…¶ä»–æœå‹™å®‰è£ è³‡è¨Š ç”±æ–¼å¾ŒçºŒçš„æ“ä½œéƒ½æœƒéœ€è¦é€£ä¸Š kubernetesï¼Œå› æ­¤è«‹è¨˜å¾—é‹ç”¨ Set Config and Kubectl ç« ç¯€ä¸­çš„å‘½ä»¤å°‡å·¥å…·èˆ‡è¨­å®šæª”æŠ“å‡ºä¾† ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:0:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#istio--rancher-ç­‰å…¶ä»–æœå‹™å®‰è£"},{"categories":[],"content":" 1 Helm bash curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 chmod 700 get_helm.sh ./get_helm.sh ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:1:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#helm"},{"categories":[],"content":" 2 Helm Repo bash helm repo add istio https://istio-release.storage.googleapis.com/charts helm repo add rancher-stable https://releases.rancher.com/server-charts/stable helm repo add jetstack https://charts.jetstack.io helm repo update ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:2:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#helm-repo"},{"categories":[],"content":" 3 istio è³‡è¨Š é€™é‚Šåªå®‰è£ istio çš„åŸºç¤å·¥å…·ï¼Œingress ä»¥åŠå…¶ä»–é…åˆ rancher çš„è¨­å®šæœƒè·Ÿ rancher çš„å®‰è£ä¸€èµ·é€²è¡Œ bash kubectl create namespace istio-system helm install istio-base istio/base -n istio-system --wait helm install istiod istio/istiod -n istio-system --wait ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:3:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#istio"},{"categories":[],"content":" 4 cert-manager è³‡è¨Š rancher latest version doc rancher å®˜æ–¹æœ‰èªªæ˜ç›®å‰æœ€æ–°ç‰ˆæœ¬å°æ–¼ cert-manager çš„ç‰ˆæœ¬æ¸¬è©¦ç‹€æ³ï¼Œå¯ä¾æ“šè‡ªå·±çš„éœ€æ±‚é€²è¡Œç›¸é—œç‰ˆæœ¬èª¿æ•´ å¦‚æœç¶²è·¯ç’°å¢ƒæœ‰ç¡¬é«”å¯ä»¥è™•ç†å¤–éƒ¨æ†‘è­‰ï¼Œå¯ä»¥å¿½ç•¥æ­¤å¥—ä»¶çš„å®‰è£ï¼Œä¸¦ä¸”åœ¨å®‰è£ rancher æ™‚ä½¿ç”¨å¤–éƒ¨æ†‘è­‰ (ä¸¦æ­é…ç„¡æ†‘è­‰è¨­å®šçš„ istio ingress) bash kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.7.1/cert-manager.crds.yaml helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --version v1.7.1 --wait ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:4:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#cert-manager"},{"categories":[],"content":" 5 rancher è³‡è¨Š é€™é‚Šé…åˆå‰é¢å®‰è£çš„ RKE2 ç‰ˆæœ¬è€Œä½¿ç”¨ 2.7.9 çš„ Rancher ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:5:0","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#rancher"},{"categories":[],"content":" 5.1 basic install bash kubectl create namespace cattle-system helm install rancher rancher-stable/rancher --namespace cattle-system --set hostname=my-rancher.local.vm --version 2.7.9 # use external tls # helm install rancher rancher-stable/rancher --namespace cattle-system --set hostname=my-rancher.local.vm --version 2.7.9 --set external-tls ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:5:1","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#basic-install"},{"categories":[],"content":" 5.2 set istio bash helm install istio-ingressgateway istio/gateway -n cattle-system --wait sudo mkdir -p ~/istio-setting cat \u003c\u003cEOF | sudo tee ~/istio-setting/gateway.yaml apiVersion: networking.istio.io/v1beta1 kind: Gateway metadata: name: rancher-gateway namespace: cattle-system spec: selector: istio: ingressgateway servers: - hosts: - my-rancher.local.vm port: name: http number: 80 protocol: HTTP # å¦‚æœæ˜¯ä½¿ç”¨å¤–éƒ¨æ†‘è­‰çš„è©±ï¼Œé€™é‚Šè¨­å®šå¯ä»¥çœå»æˆ–æ˜¯è¦å¦å¤–èª¿æ•´ - port: number: 443 name: https-443 protocol: HTTPS hosts: - my-rancher.local.vm tls: # mode: PASSTHROUGH mode: SIMPLE credentialName: cattle-system/tls-rancher-ingress EOF cat \u003c\u003cEOF | sudo tee ~/istio-setting/virtualservice.yaml apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: rancher-vs namespace: cattle-system spec: gateways: - rancher-gateway hosts: - my-rancher.local.vm http: - headers: request: set: x-forwarded-proto: https route: - destination: host: rancher.cattle-system.svc.cluster.local port: number: 80 # å¦‚æœæ˜¯ä½¿ç”¨å¤–éƒ¨æ†‘è­‰çš„è©±ï¼Œé€™é‚Šè¨­å®šå¯ä»¥çœå»æˆ–æ˜¯è¦å¦å¤–èª¿æ•´ tls: - match: - port: 443 sniHosts: - my-rancher.local.vm route: - destination: host: rancher.cattle-system.svc.cluster.local port: number: 443 EOF kubectl apply -f ./ ","date":"2024-01-28","objectID":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/:5:2","series":[],"tags":[],"title":"å»ºç«‹ RKE2 å¢é›†ä¸¦ä¸”å®‰è£ Rancher / istio","uri":"/2024/01/%E5%BB%BA%E7%AB%8B-rke2-%E5%8F%A2%E9%9B%86%E4%B8%A6%E4%B8%94%E5%AE%89%E8%A3%9D-rancher-/-istio/#set-istio"},{"categories":[],"content":"ä»Šå¤©æ˜¯ 2023 å¹´çš„æœ€å¾Œä¸€å¤©ï¼Œè¶è‘—ä»Šå¹´é‚„æ²’çµæŸï¼Œä¾†å›é¡§ä¸€ä¸‹æˆ‘åœ¨ä»Šå¹´çš„æŠ€è¡“ç™¼å±•ç‹€æ³å§~ ä¸éï¼Œå› ç‚ºé€™ä¸€å¹´éƒ½æ²’æ€éº¼å¯« blog (éƒ½é  hackmd ç´€éŒ„ç­†è¨˜)ï¼Œå¸Œæœ›ä¸è¦ä¸å°å¿ƒæŠŠå»å¹´çš„äº‹æƒ…å¯«æˆä»Šå¹´ XD ","date":"2023-12-31","objectID":"/2023/12/2023-yearly-retrospective/:0:0","series":["Yearly-Retrospective"],"tags":[],"title":"2023 å¹´åº¦å›é¡§","uri":"/2023/12/2023-yearly-retrospective/#"},{"categories":[],"content":" 2023 å¹´å›é¡§","date":"2023-12-31","objectID":"/2023/12/2023-yearly-retrospective/:0:0","series":["Yearly-Retrospective"],"tags":[],"title":"2023 å¹´åº¦å›é¡§","uri":"/2023/12/2023-yearly-retrospective/#2023-å¹´å›é¡§"},{"categories":[],"content":" 1 ç¤¾ç¾¤åƒèˆ‡ä»Šå¹´ä¾ç„¶åƒèˆ‡äº†ä¸€å †ç¤¾ç¾¤æ´»å‹•ï¼Œå»å¹´é‚„ç‰¹åˆ¥å°‡åƒåŠ è€…åç‰Œæ‹èµ·ä¾†ï¼Œä»Šå¹´â€¦â€¦ éƒ½ä¸çŸ¥é“è¢«æˆ‘æ”¶å»å“ªäº† XD æœƒè­°éƒ¨åˆ†ï¼ŒiThome çš„ SRE Conf, Agile Conf, DevOps Conf, Kubernetes Conf ç®—æ˜¯é€™å¹¾å¹´é–‹å§‹æœƒè·‘çš„æ´»å‹•ï¼Œä»Šå¹´ä¹Ÿå¦å¤–åƒåŠ äº†å¹¾æ¬¡ DevOps Taiwan Meetupã€‚ å…¶ä»–åƒæ˜¯ DDD Conf, .Net Conf Taiwan ä»¥åŠ COSCUP ç•¶ç„¶ä¹Ÿæ˜¯è¦å»ï¼Œä¸é COSCUP å› ç‚ºæœ‰ä¸€å¤©æ’åˆ°å…¬å¸æ´»å‹•ï¼Œåªèƒ½å»ä¸€å¤©æœ‰é»å¯æƒœã€‚ ä»Šå¹´åœ¨é€™äº›æ´»å‹•ä¸­å¯ä»¥ç™¼ç¾ï¼Œæœå‹™çš„å¯è§€æ¸¬æ€§åœ¨ä»Šå¹´æ•´å€‹å¤§çˆ†ç™¼ï¼Œåˆ°è™•éƒ½åœ¨èªªï¼Œä¸»é¡Œä¹Ÿä¸€å †ã€‚ DevOps å»¶çºŒå»å¹´çš„ BizDevOpsï¼Œä»Šå¹´ä¹Ÿæœ‰ä¸€äº›å ´æ¬¡ï¼Œä¸éä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ç‚ºè·ŸæŠ€è¡“å·®å¤ªé ï¼Œæ„Ÿè¦ºè¨è«–æ²’æœ‰å¾ˆç†±çƒˆâ€¦â€¦ã€‚ ä¸éæ¯”èµ·å‰é¢çš„æŠ€è¡“å ´æ¬¡ï¼Œä»Šå¹´åƒåŠ æœ€ç‰¹åˆ¥çš„æ´»å‹•çµ•å°æ˜¯ ç§‘æŠ€å·¥ä½œè¬› é€™å€‹ podcast ä¸»æŒäººæ‰€èˆ‰è¾¦çš„ ç§‘æŠ€èè‹±å¹´çµ‚ç››æœƒï¼Œæ‹“å±•äº†ä¸å°‘è¦–é‡~ ","date":"2023-12-31","objectID":"/2023/12/2023-yearly-retrospective/:1:0","series":["Yearly-Retrospective"],"tags":[],"title":"2023 å¹´åº¦å›é¡§","uri":"/2023/12/2023-yearly-retrospective/#ç¤¾ç¾¤åƒèˆ‡"},{"categories":[],"content":" 2 è·å ´ç™¼å±•ä»Šå¹´åœ¨å…¬å¸çš„ç™¼å±•æ„Ÿè¦ºæ²’åƒ 2022 ä¸€æ¨£éƒ½åœç¹åœ¨ kubernetes çš„å®‰è£æ‡‰ç”¨ï¼Œåˆæœ‰é–‹å§‹å›å»æœå‹™æ”¹å–„ä»¥åŠå°ˆæ¡ˆé€²è¡Œçš„éƒ¨åˆ†ã€‚ é–‹å§‹åœ¨å­¸ç¿’ DDD ä»¥åŠå…­è§’æ¶æ§‹ï¼Œä¸¦ä¸”æ‡‰ç”¨åˆ°å…¬å¸çš„ç³»çµ±ã€è»Ÿé«”æ¶æ§‹ä¸Šï¼Œä¸éç‚ºäº†è¦è®“å…¶ä»–äººå¯ä»¥ç›¸å°å®¹æ˜“ç†è§£ä¸åŒæ¶æ§‹çš„ç›¸ä¼¼è™•ï¼Œå°è‡´æ•´å€‹å°ˆæ¡ˆæ¶æ§‹å¾ˆå››ä¸åƒâ€¦â€¦æ„Ÿè¦ºå¾ˆå·®ã€‚ åœ¨å¯è§€æ¸¬æ€§æ–¹é¢ï¼Œä¹ŸæŠŠ Open Telemetry çš„è‡ªå‹•è¿½è¹¤æèµ·ä¾†äº†ï¼Œå¹«å…¬å¸å»ºç«‹äº†å…±ç”¨çš„åŸºç¤å®¹å™¨ï¼Œå…å¾—æ¯å€‹å°ˆæ¡ˆéƒ½éœ€è¦æ‰‹å·¥å®‰è£ open telemetry çš„å¥—ä»¶ï¼Œæ‡‰è©²ç®—æ˜¯ä¸€å¤§æ”¹å–„ï¼Ÿé…åˆ Grafana çš„ Tempo / Lokiï¼Œç®—æ˜¯è§£æ±ºäº†å®¹å™¨åŒ–å¾Œå¾ˆå¤šè³‡è¨Šéƒ½ç›¸å°ä¸æ˜“æŸ¥è©¢çš„å•é¡Œã€‚ è€Œä¸”ä¹Ÿåœ¨å¹´ä¸­è·Ÿå…¶ä»–å–®ä½ä¸€èµ·åˆä½œæŠŠ ELK å»ºèµ·ä¾†äº†ï¼Œé›–ç„¶â€¦â€¦ ç¾åœ¨é‚„åªæ˜¯å€‹è³‡æ–™å¾ˆå¤šçš„èšŠå­é¤¨ XDã€‚ å¹´åº•ç•¶ç„¶ä¸æ„å¤–åœ°è·Ÿè‘— .net 8 çš„æ¨å‡ºé€²è¡Œäº†éƒ¨åˆ†æœå‹™çš„æ›´æ–°ï¼Œä¾ç„¶æ˜¯ç„¡ç—› (?) å‡ç´šï¼Œé™¤äº†å› ç‚º OpenSSL ç‰ˆæœ¬å‡ç´šå¾Œï¼Œç‚ºäº†ç›¸å®¹å…¬å¸ç¶²è·¯åˆæœ‰åšäº†ä¸€äº›èª¿æ•´ã€‚ é€™å¹¾å€‹æœˆä¹Ÿå¹«å…¬å¸æŠŠè©²åšçš„æ–‡ä»¶è·Ÿç¯„æœ¬å¼„èµ·ä¾†äº†ï¼Œé›–ç„¶æ‡‰è©²ä¹Ÿæ²’äººçœ‹â€¦â€¦ã€‚ ä¹Ÿç”¨äº† RabbitMQ å¹«æ–°å°ˆæ¡ˆè©¦è¡Œäº† MQ å½¢å¼çš„å·¥ä½œè™•ç†ï¼Œå¸Œæœ›é€™å€‹æ¶æ§‹å°å…¶ä»–åŒäº‹ä¾†èªªä¸æœƒå¤ªéå›°é›£ã€‚ æ˜å¹´åº¦ä¹Ÿè¨±æœƒæŠŠé‡å¿ƒæ”¾åœ¨æ•æ·çš„é‹ç”¨ä¸Šï¼Ÿ ","date":"2023-12-31","objectID":"/2023/12/2023-yearly-retrospective/:2:0","series":["Yearly-Retrospective"],"tags":[],"title":"2023 å¹´åº¦å›é¡§","uri":"/2023/12/2023-yearly-retrospective/#è·å ´ç™¼å±•"},{"categories":[],"content":" 3 è‡ªå­¸ä»Šå¹´åº¦åˆå¦å¤–å»å ±äº† Odd-e çš„æ•æ·ç›¸é—œèª²ç¨‹ï¼Œç®—æ˜¯é«”æœƒåˆ°äº†äº›æ•æ·çš„é‹ç”¨ï¼Œä¸éè¦æ€éº¼é‹ç”¨åˆ°è·å ´ä¸Šâ€¦â€¦é‚„æœ‰å¾ˆå¤§æ®µè·¯è¦èµ°ã€‚ ","date":"2023-12-31","objectID":"/2023/12/2023-yearly-retrospective/:3:0","series":["Yearly-Retrospective"],"tags":[],"title":"2023 å¹´åº¦å›é¡§","uri":"/2023/12/2023-yearly-retrospective/#è‡ªå­¸"},{"categories":["Development-Tools"],"content":"JetBrains Rider å¸¸ç”¨æ“´å……å¥—ä»¶","date":"2023-12-17","objectID":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/","series":[],"tags":["extensions","jetBrains-rider"],"title":"JetBrains Rider å¸¸ç”¨æ“´å……å¥—ä»¶","uri":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/"},{"categories":["Development-Tools"],"content":" JetBrian Rider Extensionsä»¥ä¸‹å¥—ä»¶é™¤éæ˜¯ç‰¹å®šèªè¨€å°ˆç”¨ï¼Œä¸ç„¶çš†é€šç”¨æ–¼ JetBrian çš„ IDEï¼Œè€Œ Rider å¯ç”¨çš„å¥—ä»¶å¤šæ•¸éƒ½æ“æœ‰ ReSharper ç‰ˆæœ¬å¯ä¾›ä½¿ç”¨ã€‚ ","date":"2023-12-17","objectID":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/:0:0","series":[],"tags":["extensions","jetBrains-rider"],"title":"JetBrains Rider å¸¸ç”¨æ“´å……å¥—ä»¶","uri":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/#jetbrian-rider-extensions"},{"categories":["Development-Tools"],"content":" 1 æ¨è–¦å®‰è£ AceJump æ¸¸æ¨™ç§»å‹•çš„è¼”åŠ©å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿåœ°å°‡æ¸¸æ¨™ç§»å‹•åˆ°ç‰¹å®šä½ç½® å»ºè­°å®‰è£ GitHub CognitiveComplexity æª¢è¦–ç¨‹å¼ç¢¼è¤‡é›œåº¦ å»ºè­°å®‰è£ GitHub Heap Allocations Viewer æª¢è¦–è®Šæ•¸æ˜¯å¦æœ‰ Boxing/Unboxing issue å»ºè­°å®‰è£ GitHub AsyncApostle AsyncConverter çš„ Forkï¼Œå›  AsyncConverter çš„æ›´æ–°ä¸€ç›´è½å¾Œæ–¼ JetBrains IDEï¼Œå› æ­¤æœ‰å…¶ä»–äºº Fork å‡ºä¾†é€²è¡Œç¶­è­· å¿«é€Ÿè½‰æ›åŒæ­¥ã€éåŒæ­¥æ–¹æ³• GitHub NSubstituteComplete åœ¨å–®å…ƒæ¸¬è©¦ä¸­ï¼Œå¿«é€Ÿå®Œæˆä½¿ç”¨ NSubstitute çš„éƒ¨åˆ† GitHub Rainbow Brackets å¹«ç¨‹å¼ç¢¼ä¸­çš„å·¦å³æ‹¬è™Ÿã€ä¸­æ‹¬è™Ÿã€å¤§æ‹¬è™Ÿç­‰å­—å…ƒä¸Šè‰²ï¼Œæ–¹ä¾¿æª¢è¦–å°æ‡‰çš„ç¬¦è™Ÿä½ç½® ä»˜è²»å·¥å…· GitHub ","date":"2023-12-17","objectID":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/:1:0","series":[],"tags":["extensions","jetBrains-rider"],"title":"JetBrains Rider å¸¸ç”¨æ“´å……å¥—ä»¶","uri":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/#æ¨è–¦å®‰è£"},{"categories":["Development-Tools"],"content":" 2 æ¨è–¦å­¸ç¿’èˆ‡å®‰è£ ideaVim è®“ Rider (æ‰€æœ‰ JetBrains IDE) æ”¯æ´ VIM GitHub ","date":"2023-12-17","objectID":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/:2:0","series":[],"tags":["extensions","jetBrains-rider"],"title":"JetBrains Rider å¸¸ç”¨æ“´å……å¥—ä»¶","uri":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/#æ¨è–¦å­¸ç¿’èˆ‡å®‰è£"},{"categories":["Development-Tools"],"content":" 3 è‹¥æœ‰éœ€è¦å¯è€ƒæ…®å®‰è£ FluentAssertions å¿«é€Ÿå®Œæˆå–®å®Œæ¸¬è©¦çš„é©—è­‰ (ä½¿ç”¨ FluentAssertions) GitHub FluentValidation Nuget FluentValidation çš„è¼”åŠ©å·¥å…· GitHub ","date":"2023-12-17","objectID":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/:3:0","series":[],"tags":["extensions","jetBrains-rider"],"title":"JetBrains Rider å¸¸ç”¨æ“´å……å¥—ä»¶","uri":"/2023/12/jetbrains-rider-%E5%B8%B8%E7%94%A8%E6%93%B4%E5%85%85%E5%A5%97%E4%BB%B6/#è‹¥æœ‰éœ€è¦å¯è€ƒæ…®å®‰è£"},{"categories":["software-development"],"content":"ç¨‹å¼ç¢¼é‡æ§‹ - åŸºæœ¬æ¦‚å¿µ","date":"2023-12-17","objectID":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/","series":["code-refactor"],"tags":["refactor"],"title":"ç¨‹å¼ç¢¼é‡æ§‹ - åŸºæœ¬æ¦‚å¿µ","uri":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"},{"categories":["software-development"],"content":"é‡æ§‹ï¼šåœ¨ä¸å½±éŸ¿ç¨‹å¼ç¢¼é‚è¼¯çš„å‰æä¸‹é€²è¡Œç¨‹å¼ç¢¼ä¿®æ”¹çš„è¡Œç‚º é‡æ§‹è¡Œç‚ºæ‡‰ä½¿ç”¨ IDE éš¨é™„çš„é‡æ§‹å‘½ä»¤è™•ç†ï¼Œä»¥é™ä½äººç‚ºæ“ä½œçš„éŒ¯èª¤ï¼Œä¸”ç›¡å¯èƒ½åœ¨é€²è¡Œé‡æ§‹å‰åŠ å…¥æ¸¬è©¦ï¼Œé¿å…é‡æ§‹å¾Œç™¼ç”ŸéŒ¯èª¤ã€‚ æœ¬æ–‡è¨˜éŒ„æˆ‘éå¾€ç¶“é©—ä¸­ï¼Œå°æ–¼é‡æ§‹çš„ä¸€äº›æƒ³æ³•èˆ‡æ¦‚å¿µï¼Œä¹Ÿæœ‰åœ¨ä¸Šèª²å¾Œè€å¸«æ‰€æä¾›çš„æƒ³æ³•ã€‚ ","date":"2023-12-17","objectID":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/:0:0","series":["code-refactor"],"tags":["refactor"],"title":"ç¨‹å¼ç¢¼é‡æ§‹ - åŸºæœ¬æ¦‚å¿µ","uri":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/#"},{"categories":["software-development"],"content":" ç¨‹å¼ç¢¼é‡æ§‹çš„åŸºæœ¬æ¦‚å¿µ","date":"2023-12-17","objectID":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/:0:0","series":["code-refactor"],"tags":["refactor"],"title":"ç¨‹å¼ç¢¼é‡æ§‹ - åŸºæœ¬æ¦‚å¿µ","uri":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/#ç¨‹å¼ç¢¼é‡æ§‹çš„åŸºæœ¬æ¦‚å¿µ"},{"categories":["software-development"],"content":" 1 åœ¨é‡æ§‹ä¹‹å‰å¦‚æœæ¶æ§‹å…è¨±ï¼Œæ‡‰æ›¿é‡æ§‹ç›®æ¨™åŠ å…¥æ¸¬è©¦ï¼Œä»¥é¿å…é‡æ§‹å¾Œçš„åŠŸèƒ½é‚è¼¯èˆ‡é‡æ§‹å‰ä¸åŒçš„å•é¡Œã€‚ è‹¥å°å¤–éƒ¨é¡åˆ¥çš„ä¾è³´éé«˜ï¼Œå°è‡´ç„¡æ³•åŠ å…¥æ¸¬è©¦ï¼Œå‰‡æ‡‰å„ªå…ˆè™•ç†ä¾è³´å•é¡Œï¼Œè§£ä¾è³´å¾Œç«‹å³åŠ å…¥æ¸¬è©¦ã€‚ ","date":"2023-12-17","objectID":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/:1:0","series":["code-refactor"],"tags":["refactor"],"title":"ç¨‹å¼ç¢¼é‡æ§‹ - åŸºæœ¬æ¦‚å¿µ","uri":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/#åœ¨é‡æ§‹ä¹‹å‰"},{"categories":["software-development"],"content":" 2 åŸºæœ¬çš„é‡æ§‹ - æ•´ç†ç¨‹å¼ç¢¼ ç§»é™¤ä¸å¿…è¦çš„ç¨‹å¼ç¢¼ æœªä½¿ç”¨çš„æˆå“¡ åŸ·è¡Œä¸åˆ°çš„ç¨‹å¼ç¢¼ éå¤šçš„ç¨‹å¼è¨»è§£ èˆŠç‰ˆå¯«æ³•çš„ä¿ç•™æ–¹å¼å…¶å¯¦å¯ä»¥é ç‰ˆæ§ï¼Œä¸éœ€è¦å…¨éƒ¨ç•™åœ¨ç¨‹å¼ç¢¼å…§å½±éŸ¿åˆ¤è®€ ç‚ºä½•ä½¿ç”¨æŸç¨®å¯«æ³•çš„èªªæ˜ç›¡å¯èƒ½ç²¾ç°¡ï¼Œæˆ–è€…è®“ä»–è®Šæˆæ–¹æ³•æˆ–é¡åˆ¥çš„èªªæ˜ï¼Œä¸å»ºè­°åœ¨ç¨‹å¼å€æ®µä¸­é–“åŠ å…¥éå¤šçš„èªªæ˜è³‡è¨Š å¯ä»¥é è‘— IDE çš„å»ºè­°åŠŸèƒ½èª¿æ•´å¯«æ³•ï¼Œé™¤äº†è—‰æ©Ÿå­¸ç¿’å„ç¨®æ–°å¯«æ³•ä¹‹å¤–ï¼Œé‚„å¯ä»¥æŒ‘ä¸€ç¨®åœ¨åœ˜éšŠé–“å®¹æ˜“æºé€šçš„å¯«æ³•ä¾†ä½¿ç”¨ è‹¥æƒ…æ³å…è¨±ï¼Œå»ºè­°å®‰è£ JetBrains å‡ºå“çš„æ“´å……å¥—ä»¶æˆ–ä½¿ç”¨è©²å» å•†çš„ IDEï¼Œæˆ–ä½¿ç”¨å…¶ä»–é¡ä¼¼åŠŸèƒ½çš„æ“´å…… ä¿®æ­£å‘½å ä¿®æ­£éŒ¯å­— ä¿®æ­£å‘½åä»¥ç¬¦åˆåœ˜éšŠè¦ç¯„æˆ–ä½¿ç”¨çš„é–‹ç™¼èªè¨€ç¿’æ…£ æ›´æ­£æ–¹æ³•åç¨±ä»¥ç”¨æ–¼é‡æ¸…ç”¨é€” è™•ç†é­”è¡“æ•¸å­— å°‡å¯«æ­»çš„æ–‡å­—æˆ–æ•¸å­—æ”¹ç‚ºè®Šæ•¸æˆ–å¸¸æ•¸ï¼Œä»¥åˆ©æ–¼å¾ŒçºŒä½œæ¥­åˆ¤æ–· è™•ç†å‰ cs //é€™é‚Šæˆ‘å€‘ä¸¦ä¸æ¸…æ¥š 1 é€™å€‹æ•¸å­—æ‰€ä»£è¡¨çš„å«æ„ï¼Œå¿…é ˆé¡å¤–æŸ¥è¡¨ if (input == 1) { //do something } è™•ç†å¾Œ cs //æŠŠ 1 æ‹‰å‡ºä¾†è®Šæˆè®Šæ•¸ï¼Œä¸¦è¨­å®šä¸€å€‹åç¨±ï¼Œå¯ä»¥å¿«é€Ÿçš„ç†è§£åˆ¤æ–·å¼çš„ç›®çš„ var userUnit = 1; if (input == userUnit) { //do something } å°‹æ‰¾é‡è¤‡ -\u003e ç§»é™¤é‡è¤‡ æŠ½å‡ºè¡Œç‚ºæ–¹æ³• -\u003e ç¢ºèªè¡Œç‚ºæ˜¯å¦ç›¸åŒ -\u003e æ•´åˆé‡è¤‡çš„æ–¹æ³• Tips: ä¸è¦‹å¾—æ‰€æœ‰çš„é‡è¤‡éƒ½å¿…é ˆè™•ç†ï¼Œæ‡‰è©²æ˜¯è¦ä¾æ“šè©²å€å¡Šçš„è¡Œç‚ºå»æ±ºå®šé€™å€‹é‡è¤‡æ˜¯å¦æ‡‰è¢«è™•ç†ã€‚æœ‰æ™‚å€™ï¼Œé©ç•¶çš„ä¿ç•™é‡è¤‡å¯ä»¥æ–¹ä¾¿å¾ŒçºŒçš„èª¿æ•´ã€‚ ç¢ºèªé‚è¼¯ä¸¦å‡¸é¡¯æ„åœ– ä¿®æ­£ Code Smell ","date":"2023-12-17","objectID":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/:2:0","series":["code-refactor"],"tags":["refactor"],"title":"ç¨‹å¼ç¢¼é‡æ§‹ - åŸºæœ¬æ¦‚å¿µ","uri":"/2023/12/%E7%A8%8B%E5%BC%8F%E7%A2%BC%E9%87%8D%E6%A7%8B-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/#åŸºæœ¬çš„é‡æ§‹---æ•´ç†ç¨‹å¼ç¢¼"},{"categories":[],"content":"vim æ“ä½œç­†è¨˜","date":"2023-11-29","objectID":"/2023/11/vim-memo/","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/"},{"categories":[],"content":"æˆ‘åœ¨å¹¾å¹´å‰ä¸Šé 91 çš„æ¥µé€Ÿé–‹ç™¼å¾Œï¼Œå·²ç¶“ç¿’æ…£åœ¨æ—¥å¸¸çš„æ–‡å­—ç·¨è¼¯å·¥å…·ä»¥åŠé–‹ç™¼å·¥å…·ä¸­å•Ÿç”¨ vim ä¾†é€²è¡Œæ–‡å­—ç·¨è¼¯ï¼Œé€™é‚Šæˆ‘å°‡å…ˆå‰æ•´ç†çš„ä¸€äº›è³‡æ–™æ•´ç†å‡ºä¾†ä»¥æ–¹ä¾¿æŸ¥é–±ã€‚ è©³ç´°å…§å®¹ä»¥åŠæˆ‘è‡ªå·±ä½¿ç”¨çš„ vimrc æª”æ¡ˆå¾ŒçºŒæœƒå†å®‰æ’å…¬é–‹ï¼Œç›®å‰å…ˆè®“æˆ‘ç¹¼çºŒé–åœ¨ç§æœ‰git è£¡é¢å§ æ­¤ç¯‡ç­†è¨˜ç‚ºåŸºç¤ vim å‘½ä»¤ï¼Œå¯æ­é…å„ IDE çš„ vim å¥—ä»¶ä¾†åœ¨ IDE ä¸­é–‹å•Ÿ vim å‘½ä»¤çš„æ”¯æ´ã€‚ ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:0:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#"},{"categories":[],"content":" 3 å¾ˆé‡è¦è‹¥æœ‰éœ€è¦å¯é—œæ³¨ 91 çš„ FB ä»¥å–å¾—æœ€æ–°è³‡è¨Š 91 æ¥µé€Ÿé–‹ç™¼ #202401-online version ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:1:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#å¾ˆé‡è¦"},{"categories":[],"content":" 4 æ“ºåœ¨å‰é¢çš„åƒè€ƒæ–‡ä»¶ Vim æŒ‡ä»¤ä¸­æ–‡èªªæ˜ æ­¤ç¶²ç«™å…§å®¹å®Œæ•´ï¼Œæœ‰è¨±å¤šåœ¨æœ¬æ–‡ä»¶æ²’æœ‰å¯«çš„é¡å¤–å‘½ä»¤ (ä¸»å› æ˜¯æˆ‘æ¯”è¼ƒå°‘ç”¨)ï¼Œè‹¥æœ‰èˆˆè¶£å¯åƒé–± æˆå¤§è³‡å·¥wiki VIM-keyboard-shortcuts Vim help ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:2:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#æ“ºåœ¨å‰é¢çš„åƒè€ƒæ–‡ä»¶"},{"categories":[],"content":" 5 å„ IDE å¥—ä»¶ Visual Studio - VsVim Visual Studio Code - Vim JetBrains IDE Extensions - ideaVim Chrome - Vimium ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:3:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#å„-ide-å¥—ä»¶"},{"categories":[],"content":" 6 Vim åŠŸèƒ½æŒ‡ä»¤ æŒ‡ä»¤ ä½œç”¨ å‚™è¨» :source [vimrc file path] é‡æ–°è®€å– vimrc è¨­å®šæª”ï¼Œæª”æ¡ˆä½ç½®å¯ç”¨ ~/ ä¾†ä»£è¡¨ä½¿ç”¨è€…è³‡æ–™å¤¾ :set rnu è¨­å®šå·¦å´è¡Œæ•¸é¡¯ç¤ºå€ä»¥ç›¸å°è¡Œæ•¸é¡¯ç¤º :wq å„²å­˜ä¸¦é—œé–‰ç›®å‰æª”æ¡ˆ åœ¨ä½¿ç”¨å‘½ä»¤åˆ—é€²å…¥ Linux ä¸¦æ“ä½œ Vim æ™‚æœƒéœ€è¦ :x å„²å­˜ä¸¦é—œé–‰ç›®å‰æª”æ¡ˆ åœ¨ä½¿ç”¨å‘½ä»¤åˆ—é€²å…¥ Linux ä¸¦æ“ä½œ Vim æ™‚æœƒéœ€è¦ :w å„²å­˜ç›®å‰æª”æ¡ˆ åœ¨ä½¿ç”¨å‘½ä»¤åˆ—é€²å…¥ Linux ä¸¦æ“ä½œ Vim æ™‚æœƒéœ€è¦ :q! é—œé–‰ç›®å‰æª”æ¡ˆ (ä¸å„²å­˜) åœ¨ä½¿ç”¨å‘½ä»¤åˆ—é€²å…¥ Linux ä¸¦æ“ä½œ Vim æ™‚æœƒéœ€è¦ :wqa å„²å­˜ä¸¦é—œé–‰æ‰€æœ‰æª”æ¡ˆ :noh ç§»é™¤ä½¿ç”¨ / æŸ¥è©¢å¾Œç•™ä¸‹çš„æ¨™è¨˜ (Linux ä¸Šçš„ VIM æœƒç™¼ç”Ÿæ­¤ç‹€æ³) :only é—œé–‰æ‰€æœ‰æµ®å‹•è¦–çª—ï¼Œåƒ…ä¿ç•™ç·¨è¼¯å™¨å€å¡Š (vscode æœ‰æ•ˆï¼Œrider ç„¡æ•ˆ) :tabonly é—œé–‰ç›®å‰é–‹å•Ÿåˆ†é ä»¥å¤–çš„å…¶ä»–åˆ†é  ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:4:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#vim-åŠŸèƒ½æŒ‡ä»¤"},{"categories":[],"content":" 7 æ¨¡å¼ä»£è™Ÿ N = normal I = Insert V = Visual G = Global (N/I/V çš†ä½œç”¨) ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:5:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#æ¨¡å¼ä»£è™Ÿ"},{"categories":[],"content":" 8 å­—è©å®šç¾© n mode = æ¨™æº–æ¨¡å¼ (Normal Mode) i mode = è¼¸å…¥æ¨¡å¼ (Insert Mode) v mode = é¸æ“‡æ¨¡å¼ (Visual Mode) ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:6:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#å­—è©å®šç¾©"},{"categories":[],"content":" 9 Vim åŸºæœ¬æŒ‰éµå‘½ä»¤å°æ‡‰è‹±æ–‡è¼¸å…¥æ³•çš„è¼¸å…¥æ–¹å¼ï¼Œä¾‹å¦‚å‘½ä»¤ i = ç›´æ¥è¼¸å…¥ iï¼Œå‘½ä»¤ I = Shift+i æ¨¡å¼ å‘½ä»¤ ä½œç”¨ å‚™è¨» å¸¸ç”¨é …æ¨™è¨˜ N/V h æ–¹å‘éµ å·¦ * N/V j æ–¹å‘éµ ä¸‹ * N/V k æ–¹å‘éµ ä¸Š * N/V l æ–¹å‘éµ å³ * N i åœ¨ç›®å‰æ¸¸æ¨™ä½ç½®çš„å‰æ–¹é€²å…¥ i mode * N I åœ¨ç›®å‰æ¸¸æ¨™ä½ç½®çš„è¡Œé¦–é€²å…¥ i mode N a åœ¨ç›®å‰æ¸¸æ¨™ä½ç½®çš„å¾Œæ–¹é€²å…¥ i mode * N A åœ¨ç›®å‰æ¸¸æ¨™ä½ç½®çš„è¡Œå°¾é€²å…¥ i mode N v é¸æ“‡æ–‡å­— (æœƒé€²å…¥ v mode) N V é¸æ“‡ä¸€è¡Œ (æœƒé€²å…¥ v mode) * V o åœ¨é¸å–å­—ç¯€çš„é ­ã€å°¾åˆ‡æ› åƒ…åœ¨é¸å–å–®ä¸€å­—ç¯€æ™‚é©ç”¨ V O åœ¨é¸å–å­—ç¯€çš„é ­ã€å°¾åˆ‡æ› åƒ…åœ¨é¸å–å–®ä¸€å­—ç¯€æ™‚é©ç”¨ N o åœ¨ä¸‹ä¸€è¡Œæ–°å¢ä¸€è¡Œä¸¦é€²å…¥ i mode * N O åœ¨ä¸Šä¸€è¡Œæ–°å¢ä¸€è¡Œä¸¦é€²å…¥ i mode * N/V ~ æ‰€é¸æ–‡å­—çš„å­—æ¯å¤§å°å¯«è½‰æ› N/V s ç§»é™¤æ¸¸æ¨™ä½ç½® (é¸å–æ–‡å­—) å¾Œé€²å…¥ i mode * N S æ¸…é™¤æ¸¸æ¨™æ‰€åœ¨è¡Œæ‰€æœ‰å…§å®¹ï¼Œä¸¦é€²å…¥ i mode * N f å¾€å¾Œæœå°‹ä¸€å€‹å­—æ¯ N F å¾€å‰æœå°‹ä¸€å€‹å­—æ¯ N / å¾€å¾Œæœå°‹ä¸€çµ„æ–‡å­— * N ? å¾€å‰æœå°‹ä¸€çµ„æ–‡å­— * N J å°‡ä¸‹ä¸€è¡Œèˆ‡ç›®å‰è¡Œåˆä½µ * N $ å°‡æ¸¸æ¨™ç§»å‹•åˆ°è¡Œå°¾ N . é‡è¤‡åŸ·è¡Œä¸Šä¸€æ¬¡ â€œé€²å…¥ Insert Modeâ€ çš„æŒ‡ä»¤ \u0026 åœ¨ Insert Mode è¼¸å…¥çš„å…§å®¹ è‹¥æ˜¯é¸å–æ–‡å­—å¾Œå†ç”¨ s é€™ä¸€é¡æŒ‡ä»¤é€²å…¥è¼¸å…¥æ¨¡å¼ï¼Œæœƒé€£é¸å–å¹¾å€‹æ–‡å­—é€™ä¸€ä»¶äº‹æƒ…éƒ½é‡è¤‡åŸ·è¡Œ * N n é‡è¤‡å‰ä¸€æ¬¡çš„ /?fF ç­‰æœå°‹å‘½ä»¤ * N N é‡è¤‡å‰ä¸€æ¬¡çš„ /?fF ç­‰æœå°‹å‘½ä»¤ (åå‘åŸ·è¡Œ) * N e æ¸¸æ¨™ç§»å‹•åˆ°å–®å­—çµå°¾ * N E æ¸¸æ¨™ç§»å‹•åˆ°å–®å­—çµå°¾å¾Œçš„ä¸€å€‹æ¨™é»ç¬¦è™Ÿ N w æ¸¸æ¨™ç§»å‹•åˆ°ä¸‹ä¸€å€‹å–®å­—çš„å­—é¦– * N W æ¸¸æ¨™ç§»å‹•åˆ°ä¸‹ä¸€å€‹å­—æ®µçš„å­—é¦– (åƒ…èªæ›è¡Œç¬¦è™Ÿæˆ–è€…ç©ºç™½) N b æ¸¸æ¨™ç§»å‹•åˆ°ä¸Šä¸€å€‹å–®å­—çš„å­—é¦– * N B æ¸¸æ¨™ç§»å‹•åˆ°ä¸Šä¸€å€‹å­—æ®µçš„å­—é¦– (åƒ…èªæ›è¡Œç¬¦è™Ÿæˆ–è€…ç©ºç™½) V d åˆªé™¤æ‰€é¸é …ç›® (åŠŸèƒ½è·Ÿ v mode ä¸‹çš„ x ä¸€æ¨£ï¼Œä½†æ˜¯æœƒç­‰å¾…ä½¿ç”¨è€…è¼¸å…¥çµ„åˆå‘½ä»¤ï¼Œä¾‹å¦‚ d3l = å¾€å³åˆªé™¤ 3 å€‹å­—å…ƒï¼Œä½†æ˜¯ä½¿ç”¨ x å‘½ä»¤æ™‚æœƒç›´æ¥åŸ·è¡Œå‘½ä»¤) * N D ç›´æ¥å¾ç›®å‰æ¸¸æ¨™ä½ç½®åˆªé™¤åˆ°è¡Œå°¾ N C ç›´æ¥å¾ç›®å‰æ¸¸æ¨™ä½ç½®åˆªé™¤åˆ°è¡Œå°¾ï¼Œä¸¦é€²å…¥è¼¸å…¥æ¨¡å¼ N x å‰ªä¸‹æ¸¸æ¨™ç›®å‰æ‰€åœ¨å­—å…ƒ N X å‰ªä¸‹æ¸¸æ¨™ç›®å‰æ‰€åœ¨çš„å‰ä¸€å€‹å­—å…ƒ V x å‰ªä¸‹å·²é¸å–å­—å…ƒ V X å‰ªä¸‹å·²é¸å–å­—å…ƒçš„æ‰€åœ¨è¡Œæ•´è¡Œ N p åœ¨æ¸¸æ¨™ç›®å‰æ‰€åœ¨å­—å…ƒå¾Œæ–¹è²¼ä¸Š(æ’å…¥)ç”¨ y æŒ‡ä»¤è¤‡è£½çš„è³‡æ–™ ä¸èˆ‡ç³»çµ±å‰ªè²¼ç°¿å…±ç”¨è¤‡è£½è³‡æ–™ N P åœ¨æ¸¸æ¨™ç›®å‰æ‰€åœ¨å­—å…ƒå‰æ–¹è²¼ä¸Š(æ’å…¥)ç”¨ y æŒ‡ä»¤è¤‡è£½çš„è³‡æ–™ ä¸èˆ‡ç³»çµ±å‰ªè²¼ç°¿å…±ç”¨è¤‡è£½è³‡æ–™ V p ç”¨è¤‡è£½çš„å…§å®¹è¦†è“‹æ‰é¸å–çš„å…§å®¹ (èˆ‡ç³»çµ±é¸å–å¾Œè²¼ä¸Šæ•ˆæœç›¸åŒ) ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:7:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#vim-åŸºæœ¬æŒ‰éµ"},{"categories":[],"content":" 10 vim çµ„åˆå‘½ä»¤","date":"2023-11-29","objectID":"/2023/11/vim-memo/:8:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#vim-çµ„åˆå‘½ä»¤"},{"categories":[],"content":" 10.1 Normal Mode çš„çµ„åˆå‘½ä»¤èµ·å§‹éµ çµ„åˆ èªªæ˜ v + å‘½ä»¤ é€²å…¥ Visual Mode ç„¶å¾ŒåŸ·è¡Œå‘½ä»¤ c + å‘½ä»¤ å‰ªä¸‹ç¬¦åˆå‘½ä»¤ç¯„åœçš„æ–‡å­—ï¼ŒåŸ·è¡Œå®Œç•¢å¾Œæœƒé€²å…¥ Insert Mode y + å‘½ä»¤ è¤‡è£½ç¬¦åˆå‘½ä»¤ç¯„åœçš„æ–‡å­— (å¦‚æœæ˜¯è·³èºæ¸¸æ¨™çš„å‘½ä»¤ï¼Œå‰‡æœƒå¾ç›®å‰ä½ç½®åˆªåˆ°æ¸¸æ¨™åˆ°é”çš„ä½ç½®) d + å‘½ä»¤ åˆªé™¤ç¬¦åˆå‘½ä»¤ç¯„åœçš„æ–‡å­— (å¦‚æœæ˜¯è·³èºæ¸¸æ¨™çš„å‘½ä»¤ï¼Œå‰‡æœƒå¾ç›®å‰ä½ç½®åˆªåˆ°æ¸¸æ¨™åˆ°é”çš„ä½ç½®) gu + å‘½ä»¤ è®Šæ›´ å‘½ä»¤ç§»å‹•è»Œè·¡ / æœƒè¢«å‘½ä»¤æ¨™è¨˜ ä¸­çš„è‹±æ–‡å­—æ¯éƒ½è®Šæ›´ç‚ºå°å¯« gU + å‘½ä»¤ è®Šæ›´ å‘½ä»¤ç§»å‹•è»Œè·¡ / æœƒè¢«å‘½ä»¤æ¨™è¨˜ ä¸­çš„è‹±æ–‡å­—æ¯éƒ½è®Šæ›´ç‚ºå¤§å¯« å‘½ä»¤å¯ä»¥æ˜¯ é¸å–å‘½ä»¤ (ä¸‹ä¸€ç¯€å…§å®¹) æ¸¸æ¨™ç§»å‹•å‘½ä»¤ (j, w, b, 3j, ]} ..etc) è¡Œç§»å‹• (j,k) çš„å‘½ä»¤æœƒä»¥ è¡Œ ç‚ºå–®ä½åŸ·è¡Œ å‰ªä¸‹ã€è¤‡è£½ã€åˆªé™¤éƒ½æœƒæŠŠæ–‡å­—ç§»å‹•åˆ° vim çš„é è¨­å‰ªè²¼ç°¿ ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:8:1","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#normal-mode-çš„çµ„åˆå‘½ä»¤èµ·å§‹éµ"},{"categories":[],"content":" 10.2 é¸å–å‘½ä»¤åŸºæœ¬å‘½ä»¤å¯åœ¨ Visual Mode ä¸­ç›´æ¥ä½œç”¨ï¼Œä¸»è¦ç‚º 2 å­—å…ƒå‘½ä»¤ï¼Œçµ„åˆç‚º [é¸å–ç¯„åœ][ç’°ç¹ç¬¦è™Ÿ] 10.2.1 é¸å–ç¯„åœ å­—å…ƒ åŠŸèƒ½ i ä¸åŒ…å«ç’°ç¹ç¬¦è™Ÿ a åŒ…å«ç’°ç¹ç¬¦è™Ÿ 10.2.2 ç’°ç¹ç¬¦è™Ÿ ç’°ç¹ç¬¦è™Ÿ å‘½ä»¤å­— å‚™è¨» å°æ‹¬è™Ÿ () b,(,) ä¸­æ‹¬è™Ÿ [] [,] å¤§æ‹¬è™Ÿ {} B,{,} xml æ¨™ç±¤ \u003cOOO\u003e\u003c/OOO\u003e t é›™å¼•è™Ÿ \"\" \" a\" é€™çµ„å‘½ä»¤åœ¨å·²é¸å–å¤šå€‹å­—å…ƒæ™‚æœƒç„¡ä½œç”¨ å–®å¼•è™Ÿ '' ' ç©ºè¡Œ p (å°å¯«) ip æœƒé¸æ“‡å…©å€‹ç©ºç™½è¡Œä¹‹é–“çš„è¡Œï¼Œa å‰‡æ˜¯åŒ…å«å‰æ–¹ç©ºç™½è¡Œ (å¾Œæ–¹ç©ºç™½è¡Œçš„éƒ¨åˆ†æ‡‰åªåŒ…å«æ®µè¡Œç¬¦è™Ÿ) ä»»æ„ç¬¦è™Ÿ w (å°å¯«) é¸å–ä»»æ„ç¬¦è™Ÿé–“çš„æ–‡å­—ï¼Œåªè¦å‰å¾Œçš„å­—å…ƒéƒ½å±¬æ–¼ç¬¦è™Ÿå³å¯ ç‰¹å®šç¬¦è™Ÿ W æ­¤å‘½ä»¤åªèª ç©ºç™½ã€æ›è¡Œã€)ã€]ã€}(ã€[ã€{ é€™ä¸‰å€‹ç¬¦è™Ÿæ¯”è¼ƒç‰¹åˆ¥ï¼Œéœ€è¦å‰æ–¹ç‚ºç©ºç™½æ™‚æ‰æœƒè¢«è¦–ç‚ºå¯ä½œç”¨çš„ç¬¦è™Ÿ 10.2.3 å¸¸ç”¨çš„çµ„åˆå‘½ä»¤è¡¨ (VIM åŸç”Ÿ) æ¨¡å¼ å‘½ä»¤ ä½œç”¨ å‚™è¨» N ciw ç§»é™¤ç›®å‰æ‰€åœ¨å–®å­—/å­—æ®µå¾Œé€²å…¥ i mode N cw å¾€å¾Œç§»é™¤æ–‡å­—å¾Œé€²å…¥ i mode (æœƒåœåœ¨ w å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« W äº¦åŒ) N cb å¾€å‰ç§»é™¤æ–‡å­—å¾Œé€²å…¥ i mode (æœƒåœåœ¨ b å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« B äº¦åŒ) N diw ç§»é™¤ç›®å‰æ‰€åœ¨å–®å­—/å­—æ®µ N dw å¾€å¾Œç§»é™¤æ–‡å­— (æœƒåœåœ¨ w å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« W äº¦åŒ) N db å¾€å¾Œç§»é™¤æ–‡å­— (æœƒåœåœ¨ b å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« B äº¦åŒ) N dd åˆªé™¤è¡Œ N cc åˆªé™¤è¡Œï¼Œä¸¦é€²å…¥è¼¸å…¥æ¨¡å¼ N viw é¸æ“‡ä¸€å€‹å–®å­— (ä½†æ˜¯æˆ‘æ›´å–œæ­¡ Ctrl + D çš„é¸å–å¿«æ·éµ) N vi( / vi) é¸æ“‡ () å…§çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N va( / va) é¸æ“‡ () å…§åŒ…å«()çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N di( / di) åˆªé™¤ () å…§çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N da( / da) åˆªé™¤ () å…§åŒ…å«()çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N zb ç§»å‹•æ¸¸æ¨™ç›®å‰ä½ç½®åˆ°è¢å¹•æœ€ä¸‹æ–¹ N zt ç§»å‹•æ¸¸æ¨™ç›®å‰ä½ç½®åˆ°è¢å¹•æœ€ä¸Šæ–¹ N ZZ å„²å­˜ä¸¦é—œé–‰ç›®å‰æª”æ¡ˆ N ZQ é—œé–‰ç›®å‰æª”æ¡ˆ (ä¸å„²å­˜) ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:8:2","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#é¸å–å‘½ä»¤"},{"categories":[],"content":" 10.2 é¸å–å‘½ä»¤åŸºæœ¬å‘½ä»¤å¯åœ¨ Visual Mode ä¸­ç›´æ¥ä½œç”¨ï¼Œä¸»è¦ç‚º 2 å­—å…ƒå‘½ä»¤ï¼Œçµ„åˆç‚º [é¸å–ç¯„åœ][ç’°ç¹ç¬¦è™Ÿ] 10.2.1 é¸å–ç¯„åœ å­—å…ƒ åŠŸèƒ½ i ä¸åŒ…å«ç’°ç¹ç¬¦è™Ÿ a åŒ…å«ç’°ç¹ç¬¦è™Ÿ 10.2.2 ç’°ç¹ç¬¦è™Ÿ ç’°ç¹ç¬¦è™Ÿ å‘½ä»¤å­— å‚™è¨» å°æ‹¬è™Ÿ () b,(,) ä¸­æ‹¬è™Ÿ [] [,] å¤§æ‹¬è™Ÿ {} B,{,} xml æ¨™ç±¤ t é›™å¼•è™Ÿ \"\" \" a\" é€™çµ„å‘½ä»¤åœ¨å·²é¸å–å¤šå€‹å­—å…ƒæ™‚æœƒç„¡ä½œç”¨ å–®å¼•è™Ÿ '' ' ç©ºè¡Œ p (å°å¯«) ip æœƒé¸æ“‡å…©å€‹ç©ºç™½è¡Œä¹‹é–“çš„è¡Œï¼Œa å‰‡æ˜¯åŒ…å«å‰æ–¹ç©ºç™½è¡Œ (å¾Œæ–¹ç©ºç™½è¡Œçš„éƒ¨åˆ†æ‡‰åªåŒ…å«æ®µè¡Œç¬¦è™Ÿ) ä»»æ„ç¬¦è™Ÿ w (å°å¯«) é¸å–ä»»æ„ç¬¦è™Ÿé–“çš„æ–‡å­—ï¼Œåªè¦å‰å¾Œçš„å­—å…ƒéƒ½å±¬æ–¼ç¬¦è™Ÿå³å¯ ç‰¹å®šç¬¦è™Ÿ W æ­¤å‘½ä»¤åªèª ç©ºç™½ã€æ›è¡Œã€)ã€]ã€}(ã€[ã€{ é€™ä¸‰å€‹ç¬¦è™Ÿæ¯”è¼ƒç‰¹åˆ¥ï¼Œéœ€è¦å‰æ–¹ç‚ºç©ºç™½æ™‚æ‰æœƒè¢«è¦–ç‚ºå¯ä½œç”¨çš„ç¬¦è™Ÿ 10.2.3 å¸¸ç”¨çš„çµ„åˆå‘½ä»¤è¡¨ (VIM åŸç”Ÿ) æ¨¡å¼ å‘½ä»¤ ä½œç”¨ å‚™è¨» N ciw ç§»é™¤ç›®å‰æ‰€åœ¨å–®å­—/å­—æ®µå¾Œé€²å…¥ i mode N cw å¾€å¾Œç§»é™¤æ–‡å­—å¾Œé€²å…¥ i mode (æœƒåœåœ¨ w å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« W äº¦åŒ) N cb å¾€å‰ç§»é™¤æ–‡å­—å¾Œé€²å…¥ i mode (æœƒåœåœ¨ b å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« B äº¦åŒ) N diw ç§»é™¤ç›®å‰æ‰€åœ¨å–®å­—/å­—æ®µ N dw å¾€å¾Œç§»é™¤æ–‡å­— (æœƒåœåœ¨ w å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« W äº¦åŒ) N db å¾€å¾Œç§»é™¤æ–‡å­— (æœƒåœåœ¨ b å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« B äº¦åŒ) N dd åˆªé™¤è¡Œ N cc åˆªé™¤è¡Œï¼Œä¸¦é€²å…¥è¼¸å…¥æ¨¡å¼ N viw é¸æ“‡ä¸€å€‹å–®å­— (ä½†æ˜¯æˆ‘æ›´å–œæ­¡ Ctrl + D çš„é¸å–å¿«æ·éµ) N vi( / vi) é¸æ“‡ () å…§çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N va( / va) é¸æ“‡ () å…§åŒ…å«()çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N di( / di) åˆªé™¤ () å…§çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N da( / da) åˆªé™¤ () å…§åŒ…å«()çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N zb ç§»å‹•æ¸¸æ¨™ç›®å‰ä½ç½®åˆ°è¢å¹•æœ€ä¸‹æ–¹ N zt ç§»å‹•æ¸¸æ¨™ç›®å‰ä½ç½®åˆ°è¢å¹•æœ€ä¸Šæ–¹ N ZZ å„²å­˜ä¸¦é—œé–‰ç›®å‰æª”æ¡ˆ N ZQ é—œé–‰ç›®å‰æª”æ¡ˆ (ä¸å„²å­˜) ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:8:2","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#é¸å–ç¯„åœ"},{"categories":[],"content":" 10.2 é¸å–å‘½ä»¤åŸºæœ¬å‘½ä»¤å¯åœ¨ Visual Mode ä¸­ç›´æ¥ä½œç”¨ï¼Œä¸»è¦ç‚º 2 å­—å…ƒå‘½ä»¤ï¼Œçµ„åˆç‚º [é¸å–ç¯„åœ][ç’°ç¹ç¬¦è™Ÿ] 10.2.1 é¸å–ç¯„åœ å­—å…ƒ åŠŸèƒ½ i ä¸åŒ…å«ç’°ç¹ç¬¦è™Ÿ a åŒ…å«ç’°ç¹ç¬¦è™Ÿ 10.2.2 ç’°ç¹ç¬¦è™Ÿ ç’°ç¹ç¬¦è™Ÿ å‘½ä»¤å­— å‚™è¨» å°æ‹¬è™Ÿ () b,(,) ä¸­æ‹¬è™Ÿ [] [,] å¤§æ‹¬è™Ÿ {} B,{,} xml æ¨™ç±¤ t é›™å¼•è™Ÿ \"\" \" a\" é€™çµ„å‘½ä»¤åœ¨å·²é¸å–å¤šå€‹å­—å…ƒæ™‚æœƒç„¡ä½œç”¨ å–®å¼•è™Ÿ '' ' ç©ºè¡Œ p (å°å¯«) ip æœƒé¸æ“‡å…©å€‹ç©ºç™½è¡Œä¹‹é–“çš„è¡Œï¼Œa å‰‡æ˜¯åŒ…å«å‰æ–¹ç©ºç™½è¡Œ (å¾Œæ–¹ç©ºç™½è¡Œçš„éƒ¨åˆ†æ‡‰åªåŒ…å«æ®µè¡Œç¬¦è™Ÿ) ä»»æ„ç¬¦è™Ÿ w (å°å¯«) é¸å–ä»»æ„ç¬¦è™Ÿé–“çš„æ–‡å­—ï¼Œåªè¦å‰å¾Œçš„å­—å…ƒéƒ½å±¬æ–¼ç¬¦è™Ÿå³å¯ ç‰¹å®šç¬¦è™Ÿ W æ­¤å‘½ä»¤åªèª ç©ºç™½ã€æ›è¡Œã€)ã€]ã€}(ã€[ã€{ é€™ä¸‰å€‹ç¬¦è™Ÿæ¯”è¼ƒç‰¹åˆ¥ï¼Œéœ€è¦å‰æ–¹ç‚ºç©ºç™½æ™‚æ‰æœƒè¢«è¦–ç‚ºå¯ä½œç”¨çš„ç¬¦è™Ÿ 10.2.3 å¸¸ç”¨çš„çµ„åˆå‘½ä»¤è¡¨ (VIM åŸç”Ÿ) æ¨¡å¼ å‘½ä»¤ ä½œç”¨ å‚™è¨» N ciw ç§»é™¤ç›®å‰æ‰€åœ¨å–®å­—/å­—æ®µå¾Œé€²å…¥ i mode N cw å¾€å¾Œç§»é™¤æ–‡å­—å¾Œé€²å…¥ i mode (æœƒåœåœ¨ w å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« W äº¦åŒ) N cb å¾€å‰ç§»é™¤æ–‡å­—å¾Œé€²å…¥ i mode (æœƒåœåœ¨ b å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« B äº¦åŒ) N diw ç§»é™¤ç›®å‰æ‰€åœ¨å–®å­—/å­—æ®µ N dw å¾€å¾Œç§»é™¤æ–‡å­— (æœƒåœåœ¨ w å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« W äº¦åŒ) N db å¾€å¾Œç§»é™¤æ–‡å­— (æœƒåœåœ¨ b å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« B äº¦åŒ) N dd åˆªé™¤è¡Œ N cc åˆªé™¤è¡Œï¼Œä¸¦é€²å…¥è¼¸å…¥æ¨¡å¼ N viw é¸æ“‡ä¸€å€‹å–®å­— (ä½†æ˜¯æˆ‘æ›´å–œæ­¡ Ctrl + D çš„é¸å–å¿«æ·éµ) N vi( / vi) é¸æ“‡ () å…§çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N va( / va) é¸æ“‡ () å…§åŒ…å«()çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N di( / di) åˆªé™¤ () å…§çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N da( / da) åˆªé™¤ () å…§åŒ…å«()çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N zb ç§»å‹•æ¸¸æ¨™ç›®å‰ä½ç½®åˆ°è¢å¹•æœ€ä¸‹æ–¹ N zt ç§»å‹•æ¸¸æ¨™ç›®å‰ä½ç½®åˆ°è¢å¹•æœ€ä¸Šæ–¹ N ZZ å„²å­˜ä¸¦é—œé–‰ç›®å‰æª”æ¡ˆ N ZQ é—œé–‰ç›®å‰æª”æ¡ˆ (ä¸å„²å­˜) ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:8:2","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#ç’°ç¹ç¬¦è™Ÿ"},{"categories":[],"content":" 10.2 é¸å–å‘½ä»¤åŸºæœ¬å‘½ä»¤å¯åœ¨ Visual Mode ä¸­ç›´æ¥ä½œç”¨ï¼Œä¸»è¦ç‚º 2 å­—å…ƒå‘½ä»¤ï¼Œçµ„åˆç‚º [é¸å–ç¯„åœ][ç’°ç¹ç¬¦è™Ÿ] 10.2.1 é¸å–ç¯„åœ å­—å…ƒ åŠŸèƒ½ i ä¸åŒ…å«ç’°ç¹ç¬¦è™Ÿ a åŒ…å«ç’°ç¹ç¬¦è™Ÿ 10.2.2 ç’°ç¹ç¬¦è™Ÿ ç’°ç¹ç¬¦è™Ÿ å‘½ä»¤å­— å‚™è¨» å°æ‹¬è™Ÿ () b,(,) ä¸­æ‹¬è™Ÿ [] [,] å¤§æ‹¬è™Ÿ {} B,{,} xml æ¨™ç±¤ t é›™å¼•è™Ÿ \"\" \" a\" é€™çµ„å‘½ä»¤åœ¨å·²é¸å–å¤šå€‹å­—å…ƒæ™‚æœƒç„¡ä½œç”¨ å–®å¼•è™Ÿ '' ' ç©ºè¡Œ p (å°å¯«) ip æœƒé¸æ“‡å…©å€‹ç©ºç™½è¡Œä¹‹é–“çš„è¡Œï¼Œa å‰‡æ˜¯åŒ…å«å‰æ–¹ç©ºç™½è¡Œ (å¾Œæ–¹ç©ºç™½è¡Œçš„éƒ¨åˆ†æ‡‰åªåŒ…å«æ®µè¡Œç¬¦è™Ÿ) ä»»æ„ç¬¦è™Ÿ w (å°å¯«) é¸å–ä»»æ„ç¬¦è™Ÿé–“çš„æ–‡å­—ï¼Œåªè¦å‰å¾Œçš„å­—å…ƒéƒ½å±¬æ–¼ç¬¦è™Ÿå³å¯ ç‰¹å®šç¬¦è™Ÿ W æ­¤å‘½ä»¤åªèª ç©ºç™½ã€æ›è¡Œã€)ã€]ã€}(ã€[ã€{ é€™ä¸‰å€‹ç¬¦è™Ÿæ¯”è¼ƒç‰¹åˆ¥ï¼Œéœ€è¦å‰æ–¹ç‚ºç©ºç™½æ™‚æ‰æœƒè¢«è¦–ç‚ºå¯ä½œç”¨çš„ç¬¦è™Ÿ 10.2.3 å¸¸ç”¨çš„çµ„åˆå‘½ä»¤è¡¨ (VIM åŸç”Ÿ) æ¨¡å¼ å‘½ä»¤ ä½œç”¨ å‚™è¨» N ciw ç§»é™¤ç›®å‰æ‰€åœ¨å–®å­—/å­—æ®µå¾Œé€²å…¥ i mode N cw å¾€å¾Œç§»é™¤æ–‡å­—å¾Œé€²å…¥ i mode (æœƒåœåœ¨ w å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« W äº¦åŒ) N cb å¾€å‰ç§»é™¤æ–‡å­—å¾Œé€²å…¥ i mode (æœƒåœåœ¨ b å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« B äº¦åŒ) N diw ç§»é™¤ç›®å‰æ‰€åœ¨å–®å­—/å­—æ®µ N dw å¾€å¾Œç§»é™¤æ–‡å­— (æœƒåœåœ¨ w å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« W äº¦åŒ) N db å¾€å¾Œç§»é™¤æ–‡å­— (æœƒåœåœ¨ b å‘½ä»¤æœƒåˆ°é”çš„ä½ç½®ï¼Œå¤§å¯« B äº¦åŒ) N dd åˆªé™¤è¡Œ N cc åˆªé™¤è¡Œï¼Œä¸¦é€²å…¥è¼¸å…¥æ¨¡å¼ N viw é¸æ“‡ä¸€å€‹å–®å­— (ä½†æ˜¯æˆ‘æ›´å–œæ­¡ Ctrl + D çš„é¸å–å¿«æ·éµ) N vi( / vi) é¸æ“‡ () å…§çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N va( / va) é¸æ“‡ () å…§åŒ…å«()çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N di( / di) åˆªé™¤ () å…§çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N da( / da) åˆªé™¤ () å…§åŒ…å«()çš„å–®å­—ï¼Œ() å¯æ›¿æ›ç‚º {} / [] / \" ç­‰ N zb ç§»å‹•æ¸¸æ¨™ç›®å‰ä½ç½®åˆ°è¢å¹•æœ€ä¸‹æ–¹ N zt ç§»å‹•æ¸¸æ¨™ç›®å‰ä½ç½®åˆ°è¢å¹•æœ€ä¸Šæ–¹ N ZZ å„²å­˜ä¸¦é—œé–‰ç›®å‰æª”æ¡ˆ N ZQ é—œé–‰ç›®å‰æª”æ¡ˆ (ä¸å„²å­˜) ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:8:2","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#å¸¸ç”¨çš„çµ„åˆå‘½ä»¤è¡¨-vim-åŸç”Ÿ"},{"categories":[],"content":" è‡ªè¨‚å‘½ä»¤","date":"2023-11-29","objectID":"/2023/11/vim-memo/:0:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#è‡ªè¨‚å‘½ä»¤"},{"categories":[],"content":" 1 æ³¨æ„äº‹é … åœ¨ Vimrc æª”æ¡ˆä¸­ï¼Œç‰¹å®šéµä½çš„ä»£ç¢¼å€‹åˆ¥å¦‚ä¸‹ Vim å‘½ä»¤ \u003cCR\u003e = éµç›¤çš„ \u003cEnter\u003e Vim å‘½ä»¤ \u003cA\u003e = éµç›¤çš„ \u003cAlt\u003e æ­¤è¨­å®šåœ¨ VSCode ä¸­ç„¡æ•ˆ Vim å‘½ä»¤ \u003cC\u003e = éµç›¤çš„ \u003cCtrl\u003e Vim å‘½ä»¤ \u003cBS\u003e = éµç›¤çš„ \u003cBackSpace\u003e ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:1:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#æ³¨æ„äº‹é …"},{"categories":[],"content":" 2 å¸¸è¦‹çš„è‡ªè¨‚å‘½ä»¤ æ¨¡å¼ å‘½ä»¤ ä½œç”¨ Vimrc ä¸­è¨­å®šçš„ Vim è¡Œç‚º I jj ç”± insert mode è½‰å› normal mode \u003cEsc\u003e N hh æ¨¡æ“¬ home éµåŠŸèƒ½ ^ N ll æ¨¡æ“¬ end éµåŠŸèƒ½ $ ","date":"2023-11-29","objectID":"/2023/11/vim-memo/:2:0","series":[],"tags":["Memo"],"title":"vim memo","uri":"/2023/11/vim-memo/#å¸¸è¦‹çš„è‡ªè¨‚å‘½ä»¤"},{"categories":["Linux"],"content":"æ­¤é‚Šç­†è¨˜ç´€éŒ„å¦‚ä½•åœ¨ dockerfile ä¸­è¨­å®š debian 11/12 èˆ‡ alpine ä¸­çš„ openSSL config æª”æ¡ˆ ","date":"2023-11-27","objectID":"/2023/11/openssl-tls-version-downgrade-in-dockerfile/:0:0","series":[],"tags":["Memo"],"title":"Openssl Tls Version Downgrade in Dockerfile","uri":"/2023/11/openssl-tls-version-downgrade-in-dockerfile/#"},{"categories":["Linux"],"content":" 1 debain 11 (openSSL 1.0.x) dockerfile RUN sed -i 's/DEFAULT@SECLEVEL=2/DEFAULT@SECLEVEL=1/g' /etc/ssl/openssl.cnf RUN sed -i 's/MinProtocol = TLSv1.2/MinProtocol = TLSv1/g' /etc/ssl/openssl.cnf RUN sed -i 's/DEFAULT@SECLEVEL=2/DEFAULT@SECLEVEL=1/g' /usr/lib/ssl/openssl.cnf RUN sed -i 's/MinProtocol = TLSv1.2/MinProtocol = TLSv1/g' /usr/lib/ssl/openssl.cnf #RUN sed -i 's/MinProtocol = TLSv1.2/MinProtocol = TLSv1/g; s/DEFAULT@SECLEVEL=2/DEFAULT@SECLEVEL=1/g' /usr/lib/ssl/openssl.cnf ","date":"2023-11-27","objectID":"/2023/11/openssl-tls-version-downgrade-in-dockerfile/:1:0","series":[],"tags":["Memo"],"title":"Openssl Tls Version Downgrade in Dockerfile","uri":"/2023/11/openssl-tls-version-downgrade-in-dockerfile/#debain-11-openssl-10x"},{"categories":["Linux"],"content":" 2 debain 12 (openSSL 3.0.x) dockerfile RUN sed -i 's/openssl_conf = openssl_init/#openssl_conf = openssl_init/' /etc/ssl/openssl.cnf RUN sed -i '1i openssl_conf = default_conf' /etc/ssl/openssl.cnf \u0026\u0026 echo \"\\n[ default_conf ]\\nssl_conf = ssl_sect\\n[ssl_sect]\\nsystem_default = system_default_sect\\n[system_default_sect]\\nMinProtocol = TLSv1\\nCipherString = DEFAULT:@SECLEVEL=1\" \u003e\u003e /etc/ssl/openssl.cnf ","date":"2023-11-27","objectID":"/2023/11/openssl-tls-version-downgrade-in-dockerfile/:2:0","series":[],"tags":["Memo"],"title":"Openssl Tls Version Downgrade in Dockerfile","uri":"/2023/11/openssl-tls-version-downgrade-in-dockerfile/#debain-12-openssl-30x"},{"categories":["Linux"],"content":" 3 alpine (OpenSSL 3.0.x) dockerfile RUN sed -i 's/openssl_conf = openssl_init/#openssl_conf = openssl_init/' /etc/ssl/openssl.cnf RUN sed -i '1i openssl_conf = default_conf' /etc/ssl/openssl.cnf \u0026\u0026 echo -e \"\\n[ default_conf ]\\nssl_conf = ssl_sect\\n[ssl_sect]\\nsystem_default = system_default_sect\\n[system_default_sect]\\nMinProtocol = TLSv1\\nCipherString = DEFAULT:@SECLEVEL=1\" \u003e\u003e /etc/ssl/openssl.cnf ","date":"2023-11-27","objectID":"/2023/11/openssl-tls-version-downgrade-in-dockerfile/:3:0","series":[],"tags":["Memo"],"title":"Openssl Tls Version Downgrade in Dockerfile","uri":"/2023/11/openssl-tls-version-downgrade-in-dockerfile/#alpine-openssl-30x"},{"categories":["Linux"],"content":"å¦‚æœç¶²è·¯ç’°å¢ƒä¸­æœƒè¢«æ›¿æ›æ†‘è­‰ï¼Œä¸”æš«æ™‚ç„¡æ³•å–å¾—æ†‘è­‰æ™‚ï¼Œå¯ä»¥åˆ©ç”¨æœ¬ç¯‡ç­†è¨˜æ‰€è¨˜éŒ„çš„æ–¹å¼è™•ç†æ†‘è­‰","date":"2023-11-27","objectID":"/2023/11/%E5%9C%A8-linux-%E5%AE%89%E8%A3%9D-ssl-%E4%B8%AD%E9%96%93%E4%BA%BA%E6%86%91%E8%AD%89/","series":[],"tags":["Memo"],"title":"åœ¨ linux å®‰è£ ssl ä¸­é–“äººæ†‘è­‰","uri":"/2023/11/%E5%9C%A8-linux-%E5%AE%89%E8%A3%9D-ssl-%E4%B8%AD%E9%96%93%E4%BA%BA%E6%86%91%E8%AD%89/"},{"categories":["Linux"],"content":"å¦‚æœç¶²è·¯ç’°å¢ƒæœƒè¢«æ›¿æ›æ†‘è­‰ï¼Œä¸”æš«æ™‚ç„¡æ³•å–å¾—æ†‘è­‰æ™‚ï¼Œå¯ä»¥åˆ©ç”¨æœ¬ç¯‡ç­†è¨˜æ‰€è¨˜éŒ„çš„æ–¹å¼è™•ç†æ†‘è­‰ åƒè€ƒè³‡æ–™ Get SSL Certificate bash openssl s_client -connect {domain}:443 -showcerts æ‰¾å‡ºè¼¸å‡ºæ–‡å­—ä¸­çš„æ‰€æœ‰æ†‘è­‰å€å¡Šï¼Œä¸¦å­˜åˆ° /usr/local/share/ca-certificates/*.crt bash cat \u003c\u003cEOF | sudo tee /usr/local/share/ca-certificates/your-cert.crt -----BEGIN CERTIFICATE----- -----END CERTIFICATE----- EOF åŸ·è¡Œæ†‘è­‰æ›´æ–° bash sudo update-ca-certificates é‡å•Ÿéœ€è¦ä½¿ç”¨æ†‘è­‰çš„æœå‹™ (ä¾‹å¦‚ docker) ","date":"2023-11-27","objectID":"/2023/11/%E5%9C%A8-linux-%E5%AE%89%E8%A3%9D-ssl-%E4%B8%AD%E9%96%93%E4%BA%BA%E6%86%91%E8%AD%89/:0:0","series":[],"tags":["Memo"],"title":"åœ¨ linux å®‰è£ ssl ä¸­é–“äººæ†‘è­‰","uri":"/2023/11/%E5%9C%A8-linux-%E5%AE%89%E8%A3%9D-ssl-%E4%B8%AD%E9%96%93%E4%BA%BA%E6%86%91%E8%AD%89/#"},{"categories":["Kubernetes"],"content":"ä½¿ç”¨ k3d å¿«é€Ÿå»ºç«‹æœ¬æ©Ÿ Kubernetes (k3s) å¢é›†ä»¥ç”¨æ–¼æ¸¬è©¦èˆ‡é–‹ç™¼","date":"2023-02-26","objectID":"/2023/02/use-k3d-to-create-k3s/","series":[],"tags":[],"title":"ä½¿ç”¨ k3d å¿«é€Ÿå»ºç«‹æœ¬æ©Ÿ Kubernetes (k3s) å¢é›†ä»¥ç”¨æ–¼æ¸¬è©¦èˆ‡é–‹ç™¼","uri":"/2023/02/use-k3d-to-create-k3s/"},{"categories":["Kubernetes"],"content":"æœ¬æ–‡ç´€éŒ„åœ¨æœ¬æ©Ÿä½¿ç”¨ k3d CLI å¿«é€Ÿä½¿ç”¨ k3s å»ºç«‹ kubernetes å¢é›†çš„æ–¹æ³• ","date":"2023-02-26","objectID":"/2023/02/use-k3d-to-create-k3s/:0:0","series":[],"tags":[],"title":"ä½¿ç”¨ k3d å¿«é€Ÿå»ºç«‹æœ¬æ©Ÿ Kubernetes (k3s) å¢é›†ä»¥ç”¨æ–¼æ¸¬è©¦èˆ‡é–‹ç™¼","uri":"/2023/02/use-k3d-to-create-k3s/#"},{"categories":["Kubernetes"],"content":" k3d è³‡è¨Š k3d æ˜¯ç¤¾ç¾¤é–‹ç™¼çš„ k3s in docker çš„å¿«é€Ÿå»ºç«‹å¢é›†çš„å·¥å…·ï¼Œæ–¹ä¾¿åœ¨ docker å…§ä½¿ç”¨ k3s å»ºç«‹ kubernetes å¢é›† ç”±æ–¼æ˜¯ç´”ç¤¾ç¾¤é–‹ç™¼çš„å·¥å…·ï¼Œä¸”å› ç‚ºæ˜¯è·‘åœ¨ docker å…§éƒ¨ï¼Œæˆ‘æœƒå»ºè­°ç”¨åœ¨ kubernetes ä¸Šçš„æœå‹™é–‹ç™¼ç”¨é€”ï¼Œè€Œéæ­£å¼æœå‹™éƒ¨ç½² ","date":"2023-02-26","objectID":"/2023/02/use-k3d-to-create-k3s/:0:0","series":[],"tags":[],"title":"ä½¿ç”¨ k3d å¿«é€Ÿå»ºç«‹æœ¬æ©Ÿ Kubernetes (k3s) å¢é›†ä»¥ç”¨æ–¼æ¸¬è©¦èˆ‡é–‹ç™¼","uri":"/2023/02/use-k3d-to-create-k3s/#k3d"},{"categories":["Kubernetes"],"content":" 1 èªæ³•ç´€éŒ„ è³‡è¨Š å‰ç½®ä½œæ¥­ï¼šå®‰è£ docker ä½¿ç”¨ k3d å»ºç«‹ k8s å¢é›†ï¼Œåªæœ‰é–‹æ”¾ k8s api server port çš„å‘½ä»¤ è­¦å‘Š é€™é‚Šçš„ cluster å»ºç«‹å‘½ä»¤è³‡è¨Šå¦‚ä¸‹ å¢é›†åç¨± = service-lab api server (master node) æ•¸é‡ = 1 agent server (worker node) æ•¸é‡ = 6 ä»¥ä¸‹å‘½ä»¤æœ‰é–‹æœ¬æ©Ÿçš„ 8080 port é…å°åˆ° k3s çš„ loadbalance (80 port)ï¼Œæœ‰éœ€è¦é–‹å…¶ä»– port å¯ä»¥å¦å¤–è¨­å®š å› ç‚ºæˆ‘é€™é‚Šä½¿ç”¨çš„æœå‹™éƒ½æœ‰æ­é… istio åšäº‹ï¼Œè·Ÿ k3d å…§å»ºçš„ç¶²è·¯å·¥å…· traefik æœ‰è¡çªï¼Œæ‰€ä»¥è¦é—œæ‰ bash k3d cluster create service-lab --servers 1 --agents 6 --port 8080:80@loadbalancer --api-port 6443 --k3s-arg '--disable=traefik@server:0' å¦‚æœæ²’æœ‰è¦é—œçš„è©±ï¼Œå‘½ä»¤å¦‚ä¸‹ bash k3d cluster create service-lab --servers 1 --agents 6 --api-port 6443 --port 8080:80@loadbalancer bash # å»ºç«‹å®Œå¢é›†æ‰æƒ³åˆ°è¦æš´éœ² k8s æœå‹™çš„é€²å…¥ port çš„æ™‚å€™å¯ä»¥é€™æ¨£åŠ  k3d cluster edit service-lab --port-add 8080:80@loadbalancer # or when create cluster k3d cluster create service-lab --servers 1 --agents 6 --port 8080:80@loadbalancer --api-port 6443 --k3s-arg '--disable=traefik@server:0' ç§»é™¤ Cluster bash= k3d cluster delete service-lab åœæ­¢ Cluster bash= k3d cluster stop service-lab å•Ÿå‹• Cluster bash= k3d cluster start service-lab ","date":"2023-02-26","objectID":"/2023/02/use-k3d-to-create-k3s/:1:0","series":[],"tags":[],"title":"ä½¿ç”¨ k3d å¿«é€Ÿå»ºç«‹æœ¬æ©Ÿ Kubernetes (k3s) å¢é›†ä»¥ç”¨æ–¼æ¸¬è©¦èˆ‡é–‹ç™¼","uri":"/2023/02/use-k3d-to-create-k3s/#èªæ³•ç´€éŒ„"},{"categories":["Kubernetes"],"content":" 2 åƒè€ƒè³‡æ–™ k3så®˜ç¶² k3d å®˜ç¶² åœ¨k3dä¸Šå¿«é€Ÿå®‰è£…Istioï¼ŒåŠ©ä½ åœ¨æœ¬åœ°çµæ´»ä½¿ç”¨K8Sï¼ K3d and Istio (Service Mesh - Governing the data plane) ","date":"2023-02-26","objectID":"/2023/02/use-k3d-to-create-k3s/:2:0","series":[],"tags":[],"title":"ä½¿ç”¨ k3d å¿«é€Ÿå»ºç«‹æœ¬æ©Ÿ Kubernetes (k3s) å¢é›†ä»¥ç”¨æ–¼æ¸¬è©¦èˆ‡é–‹ç™¼","uri":"/2023/02/use-k3d-to-create-k3s/#åƒè€ƒè³‡æ–™"},{"categories":[],"content":"ä»¥ä¸‹ç´€éŒ„ä¸€äº›å¸¸ç”¨çš„ C# èªæ³•ã€ç‰¹æ€§ ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:0:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#"},{"categories":[],"content":" 1 var æœƒè‡ªå‹•ä¾æ“šçµ¦äºˆçš„è³‡æ–™å‹æ…‹ï¼Œåœ¨ç·¨è­¯æ™‚ç›´æ¥å®šç¾©ç‚ºå¼·å‹åˆ¥ ç·¨è­¯å¾Œä¸æœƒæ˜¯ varï¼Œè€Œæ˜¯å¼·å‹åˆ¥ ä½¿ç”¨ var å®£å‘ŠåŒ¿åå‹åˆ¥æ™‚ï¼Œæ¯”è¼ƒé‹ç®—å­ä¸æœƒä¸€èµ·è¤‡å¯«ï¼Œåªæœƒè™•è£¡ Equals csharp var x = new { Name = \"Bill\", Age = 15 }; var y = new { Name = \"Bill\", Age = 15 }; Console.WriteLine($\"x == y {x == y}\"); //false Console.WriteLine($\"x.Equals(y) {x.Equals(y)}\"); //true ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:1:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#var"},{"categories":[],"content":" 2 åŒ¿åå‹åˆ¥ ç›´æ¥ä½¿ç”¨ new {} çš„å½¢å¼å»ºç«‹çš„æš«æ™‚æ€§å‹åˆ¥ ç›¸åŒçµ„ä»¶ (ç›¸åŒå°ˆæ¡ˆ) ä¸­çš„ new { Name = â€œâ€} ç”¢ç”Ÿçš„åŒ¿åå‹åˆ¥éƒ½æœƒè¢«ç·¨è­¯ç‚ºåŒä¸€å€‹å‹åˆ¥ç‰©ä»¶ï¼Œåä¹‹ï¼Œä¸åŒå°ˆæ¡ˆçš„ new {Name = â€œâ€} æœƒå› ç‚ºç·¨è­¯å¾Œå±¬æ–¼ä¸åŒçµ„ä»¶ (DLL)ï¼Œå› æ­¤é‹è¡Œæ™‚æœƒå»ºç«‹ä¸åŒçš„å‹åˆ¥ç‰©ä»¶ åŒ¿åå‹åˆ¥æˆå“¡ç‚ºå”¯è®€ ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:2:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#åŒ¿åå‹åˆ¥"},{"categories":[],"content":" 3 TupleClass é¡ä¼¼æ–¼åŒ¿åå‹åˆ¥ï¼Œå¯å‹•æ…‹å»ºç«‹ç‰©ä»¶ æ˜¯åƒè€ƒå‹åˆ¥ç‰©ä»¶ ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:3:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#tupleclass"},{"categories":[],"content":" 4 ValueTuple C# 7.0 åŠ å…¥çš„å‹åˆ¥ .NET Core 2.0 .NET Framework 4.7 ä½æ–¼ä»¥ä¸Šç‰ˆæœ¬è«‹å¾ nuget å®‰è£å¥—ä»¶ ç‚ºçµæ§‹ï¼Œæ˜¯å¯¦è³ªå‹åˆ¥ å¯ä»¥æœ‰ 1~8 å€‹æ³›å‹æˆå“¡ ç¬¬ 8 çš„æˆå“¡å¿…é ˆç‚ºçµæ§‹ ä½¿ç”¨å®Œç•¢å¾Œæœƒé‡‹æ”¾ä½¿ç”¨çš„è¨˜æ†¶é«”è³‡æº è³‡æ–™æˆå“¡æ˜¯æ¬„ä½ (Field) csharp // é¡¯å¼å®£å‘Šä½¿ç”¨ ValueTuple.Create methods ValueTuple\u003cint, string\u003e x1 = ValueTuple.Create\u003cint, string\u003e(8, \"ABC\"); // éš±å¼å®£å‘Šä½¿ç”¨ ValueTuple Constructor var x2 = (8, \"ABC\"); // å…·åå®£å‘Šæ¬„ä½åç¨± (1) var x3 = (length: 8, letters: \"ABC\"); // å…·åå®£å‘Šæ¬„ä½åç¨± (2) (int length, string letters) x4 = (8, \"ABC\"); // å…·åå®£å‘Šæ¬„ä½åç¨± (3) -- æœƒä»¥æŒ‡æ´¾é‹ç®—å­çš„å·¦é‚Šç‚ºä¸» (int length, string letters) x5 = (first: 8, second: \"ABC\"); // ç›´æ¥æŒ‡æ´¾çµ¦å€åŸŸè®Šæ•¸ (int length, string letters) = (8, \"ABC\"); var (l, s) = (8, \"ABC\"); ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:4:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#valuetuple"},{"categories":[],"content":" 5 è®Šæ•¸å­˜æ”¾ å¯¦è³ªå‹åˆ¥å­˜æ”¾æ–¼ Stack è¨˜æ†¶é«”ï¼Œå­˜å–é€šå¸¸è¼ƒå¿« åƒè€ƒå‹åˆ¥å­˜æ”¾æ–¼ Heap è¨˜æ†¶é«”ï¼Œå­˜å–é€šå¸¸è¼ƒæ…¢ ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:5:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#è®Šæ•¸å­˜æ”¾"},{"categories":[],"content":" 6 Boxing and Unboxing åƒè€ƒå‹åˆ¥è³‡æ–™è½‰å­˜è‡³å¯¦è³ªå‹åˆ¥ï¼šBoxing å¯¦è³ªå‹åˆ¥è³‡æ–™è½‰å­˜è‡³åƒè€ƒå‹åˆ¥ï¼šUnboxing æ°¸é é–ƒä¸æ‰çš„ Boxing : int.GetType() ArrayList å¿…å®šæœ‰æ­¤å•é¡Œ å•é¡Œæˆå› ï¼šå¯¦è³ªå‹åˆ¥èˆ‡åƒè€ƒå‹åˆ¥çš„è¨˜æ†¶é«”å­˜æ”¾æ©Ÿåˆ¶ä¸åŒï¼Œå› æ­¤æœƒç‚ºäº†ç¬¦åˆç›®æ¨™å‹åˆ¥è€Œæœ‰è¨˜æ†¶é«”è¤‡è£½è½‰ç§»ç­‰æ•ˆèƒ½æè€— ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:6:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#boxing-and-unboxing"},{"categories":[],"content":" 7 é˜²ç¦¦æ€§è¤‡è£½ åªæœƒç™¼ç”Ÿåœ¨å¯¦è³ªå‹åˆ¥ è³‡æ–™æœƒæ•´åŒ…è¤‡è£½å‡ºä¾† å»ºæ§‹å¼ä¸æœƒç”¢ç”Ÿé˜²ç¦¦æ€§è¤‡è£½ è¦é˜²æ­¢é˜²ç¦¦æ€§è¤‡è£½çš„è©±ï¼Œéœ€è¦ä½¿ç”¨å”¯è®€çµæ§‹ï¼Œä¸”æ‰€æœ‰æˆå“¡éƒ½æ˜¯å”¯è®€ çµæ§‹å®£å‘Šé readonlyï¼Œä½†æ˜¯ä½¿ç”¨æ™‚ä½¿ç”¨ readonly è®Šæ•¸æ‰¿æ¥ï¼Œå°±æœƒæœ‰é˜²ç¦¦æ€§è¤‡è£½ ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:7:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#é˜²ç¦¦æ€§è¤‡è£½"},{"categories":[],"content":" 8 æ¬„ä½ (Field) ç‰©ä»¶å…§çš„å…¨åŸŸè®Šæ•¸ é€šå¸¸ç‚ºç§æœ‰æˆå“¡ (è‹¥éœ€è¦ä½œç‚ºå…¬é–‹æˆå“¡ï¼Œé€šå¸¸æœƒä½¿ç”¨å±¬æ€§) ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:8:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#æ¬„ä½-field"},{"categories":[],"content":" 9 å±¬æ€§ (Property) ç‰¹å®šè®Šæ•¸(æ¬„ä½)çš„å…¬é–‹ Get / Set æ–¹æ³• é€šå¸¸ç‚ºå…¬é–‹æˆå“¡ ç·¨è­¯å¾Œæœƒè‡ªå‹•é•·å‡ºç§æœ‰æ¬„ä½èˆ‡ Get / Set æ–¹æ³• ç·¨è­¯å‰ csharp public string SampleString { Get; Set; } ç·¨è­¯å¾Œ (åƒ…ç¤ºæ„ï¼Œç·¨è­¯å®Œçš„å¯¦éš› IL Code ä¸¦éå¦‚æ­¤) csharp private string _sampleString; //å¯¦éš›è®Šæ•¸åç¨±ç”±ç·¨è­¯å™¨ç”¢å‡º public string GetSampleString() { return _sampleString; } public void SetSampleString(string value) { _sampleString = value; } ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:9:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#å±¬æ€§-property"},{"categories":[],"content":" 10 Nullable\u003cT\u003e T è¢«é™åˆ¶ç‚ºçµæ§‹ (ref : microsoft learn - system.nullable) è®“ä¸èƒ½ç‚º null çš„çµæ§‹å½è£ç‚ºåƒè€ƒå‹åˆ¥ï¼Œè®Šæˆå¯ null int? å¯¦éš›ä¸Šæ˜¯ Nullable\u003cint\u003eï¼Œèˆ‡ int ä¸åŒ åˆ¤æ–·æ˜¯å¦æœ‰å€¼æ™‚ï¼Œå»ºè­°ä½¿ç”¨æ¯”è¼ƒé‹ç®—å­ï¼Œé€™æ¨£åœ¨ LinQ to sql æ™‚ï¼Œå‡ºä¾†çš„èªæ³•æœƒæ¯”è¼ƒæ¼‚äº® Nullable\u003cT\u003e.Equals åƒ…æœ‰å¯¦ä½œ Equals(Object)ï¼Œä¸¦æ²’æœ‰å¯¦ä½œ Equals(T)ï¼Œç„¡æ³•é¿å… boxing å•é¡Œï¼Œå› æ­¤åœ¨ Nullable\u003cT\u003e è®Šæ•¸ä¸Šç›¡å¯èƒ½ä¸è¦ä½¿ç”¨ Equals Nullable.GetUnderlyingType ç”¨æ–¼ç¢ºèªè©²é¡å‹æ˜¯ä¸æ˜¯ Nullableï¼Œåœ¨åå°„æ™‚æœƒéœ€è¦ä½¿ç”¨ Nullable boxing å¾Œæ²’æœ‰ Nullableï¼Œæœƒå‘ˆç¾ Nullable\u003cT\u003e çš„ T csharp int? I; Nullable.GetUnderlyingType(i.GetType()); çµæœæœƒæ˜¯ nullï¼Œå› ç‚ºåŸ·è¡Œ GetType() çš„æ™‚å€™æœƒ boxingï¼Œè€Œç•¶ä¸‹ä¸¦æ²’æœ‰å…§å®¹å€¼ï¼Œå› æ­¤å–å¾—çš„æ˜¯ null å¦‚æœè¦ç¢ºå¯¦çš„æ‹¿åˆ°å‹åˆ¥ï¼Œçµ¦ GetUnderlyingType çš„åƒæ•¸éœ€è¦ç”¨ typeof(int?) æ‰èƒ½çœŸçš„æ‹¿åˆ° int ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:10:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#nullablet"},{"categories":[],"content":" 11 é‹ç®—å¼ä¸»é«” ç°¡åŒ–æ–¹æ³•çš„å®£å‘Š csharp public string Something() =\u003e \"\"; //ç­‰åŒä»¥ä¸‹å¯«æ³• public string Something() { return \"\"; } ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:11:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#é‹ç®—å¼ä¸»é«”"},{"categories":[],"content":" 12 åƒæ•¸é—œéµå­ï¼šref / out / in ref: call by references out: è³‡æ–™æœƒå›è¨­å®šè‡³è©²ä½ç½®çš„å¤–éƒ¨è®Šæ•¸ï¼Œæœ‰ ValueTuple Structure æ™‚å°±ä¸æ˜¯ç‰¹åˆ¥éœ€è¦ä½¿ç”¨æ­¤é—œéµå­—ä¾†å‚³å‡ºå¤šé …è³‡æ–™äº† in: æœƒé€²è¡Œé˜²ç¦¦æ€§è¤‡è£½ï¼Œåœ¨æ–¹æ³•å…§å°è©²åƒæ•¸çš„èª¿æ•´ä¸æœƒåæ˜ åˆ°å‘¼å«ç«¯ å‚™è¨»ï¼šä¸è¦éåº¦å€šè³´ out / ref ä¾†å›å‚³è³‡æ–™ï¼Œå®¹æ˜“å°è‡´æ–¹æ³•çš„è·è²¬ä¸æ˜ç¢º ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:12:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#åƒæ•¸é—œéµå­ref--out--in"},{"categories":[],"content":" 13 nameof() å–å¾—æˆå“¡åç¨± ç·¨è­¯å¾Œæœƒæˆç‚ºå­—ä¸² å¯é™ä½èª¤å­—å•é¡Œ ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:13:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#nameof"},{"categories":[],"content":" 14 æ¨æ£„è³‡æ–™ csharp _ = GetSomething(); //GetSomething æ–¹æ³•æ‰€å›å‚³çš„è³‡æ–™ä¸æœƒè¢«ä½¿ç”¨ var _ = GetSomething(); //GetSomething æ–¹æ³•æ‰€å›å‚³çš„è³‡æ–™æœƒè¢«å­˜æ”¾æ–¼ _ é€™å€‹è®Šæ•¸ä¸­ ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:14:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#æ¨æ£„è³‡æ–™"},{"categories":[],"content":" 15 æ“´å……æ–¹æ³• å¯ä»¥ç‚ºç‰¹å®šå‹åˆ¥åŠ å…¥åŠŸèƒ½ æœ‰æ’°å¯«é™åˆ¶ï¼Œå¿…é ˆç¬¦åˆä»¥ä¸‹æ¢ä»¶ ä½æ–¼éœæ…‹é¡åˆ¥ æ–¹æ³•å¿…å®šç‚ºéœæ…‹ ç¬¬ä¸€å€‹æ–¹æ³•åƒæ•¸å¿…é ˆåŠ ä¸Š this é—œéµå­— è¨­è¨ˆæ“´å……æ–¹æ³•å¯¦æ‡‰æ³¨æ„è·è²¬å–®ä¸€çš„å•é¡Œ æ“´å……æ–¹æ³•å…§æ‡‰ç›¡å¯èƒ½é™ä½å¤–éƒ¨ä¾è³´ æ“´å……æ–¹æ³•æ‡‰ç‚ºå–®ç´”çš„è™•ç†é‚è¼¯ æ“´å……æ–¹æ³•æ‡‰ç‚ºç„¡ç‹€æ…‹æ–¹æ³• (ä¸ç´€éŒ„è³‡æ–™) ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:15:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#æ“´å……æ–¹æ³•"},{"categories":[],"content":" 16 æ³›å‹çš„å‹åˆ¥æ§åˆ¶ csharp public class SampleInput\u003cT\u003e where T : ISampleClass { } ","date":"2023-02-26","objectID":"/2023/02/csharp-feature/:16:0","series":[],"tags":["dotnet"],"title":"C# Feature","uri":"/2023/02/csharp-feature/#æ³›å‹çš„å‹åˆ¥æ§åˆ¶"},{"categories":["software-design"],"content":"RESTful WebApi è¨­è¨ˆæ¦‚å¿µ","date":"2022-12-17","objectID":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/","series":[],"tags":[],"title":"RESTful WebApi è¨­è¨ˆæ¦‚å¿µ","uri":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/"},{"categories":["software-design"],"content":"æœ¬æ–‡ç‚ºä»¥ä¸‹æ›¸ç±çš„é–±è®€ç­†è¨˜ï¼Œæ•´ç†èˆ‡ç´€éŒ„ä¸€äº›æˆ‘èªç‚ºé‡è¦çš„éƒ¨åˆ† Web API å»ºæ§‹èˆ‡è¨­è¨ˆ ","date":"2022-12-17","objectID":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/:0:0","series":[],"tags":[],"title":"RESTful WebApi è¨­è¨ˆæ¦‚å¿µ","uri":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/#"},{"categories":["software-design"],"content":" Web Api è¨­è¨ˆ","date":"2022-12-17","objectID":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/:0:0","series":[],"tags":[],"title":"RESTful WebApi è¨­è¨ˆæ¦‚å¿µ","uri":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/#web-api-è¨­è¨ˆ"},{"categories":["software-design"],"content":" 1 RESTful Api æ‰€éµå¾ªçš„è¨­è¨ˆè¦å‰‡ è³‡æºæ˜¯ URL çš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ /users æ¯ä¸€å€‹è³‡æºé€šå¸¸æœ‰å…©ç¨®è·¯ç”±ï¼Œåˆ†åˆ¥ä»£è¡¨å–®æ•¸èˆ‡è¤‡æ•¸è³‡æ–™ è¤‡æ•¸ï¼šGET http://{domain}/api/users å–®æ•¸ï¼šGET http://{domain}/api/users/{userid} ä½¿ç”¨è³‡æºåè©è€Œéå‹•è© è¡Œç‚ºï¼šå–å¾—ä½¿ç”¨è€…è³‡æ–™ å»ºè­°ï¼š GET {domain}/api/users/{userid} ä¸å»ºè­°ï¼š GET {domain}/api/getUserInfo/{userid} åˆ©ç”¨ HTTP æ–¹æ³•è¡¨ç¤ºåŠŸèƒ½è¡Œç‚º HTTP æ–¹æ³• URL: /users URL: /users/{userid} Get å–å¾—æ‰€æœ‰ä½¿ç”¨è€…è³‡æ–™ å–å¾—æŒ‡å®š user id çš„è³‡æ–™ POST å»ºç«‹ä¸€ä½ä½¿ç”¨è€… (è³‡æ–™ä»¥ Request Body å‚³é) ä¸é©ç”¨ PUT æ‰¹æ¬¡æ›´æ–°ä½¿ç”¨è€… (è³‡æ–™ä»¥ Request Body å‚³éã€è³‡æ–™å¿…é ˆç‚ºå®Œæ•´çš„ User è³‡æ–™) æŒ‡å®šæ›´æ–° user id çš„è³‡æ–™ PATCH æ‰¹æ¬¡æ›´æ–°ä½¿ç”¨è€… (è³‡æ–™ä»¥ Request Body å‚³éã€è³‡æ–™ç‚ºéƒ¨åˆ†çš„ User è³‡æ–™) æŒ‡å®šæ›´æ–° user id çš„è³‡æ–™ DELETE åˆªé™¤æ‰€æœ‰ä½¿ç”¨è€… åˆªé™¤æŒ‡å®šä½¿ç”¨è€… ä¼ºæœå™¨å›å‚³æ¨™æº–çš„ HTTP ç‹€æ…‹ç¢¼ä¾†è¡¨ç¤ºè™•ç†çµæœ å›æ‡‰ç¢¼ åŸ·è¡Œçµæœ 2xx æˆåŠŸ 3xx è³‡æºä¸å­˜åœ¨ã€å·²è¢«ç§»é™¤ 4xx ç”¨æˆ¶ç«¯éŒ¯èª¤(ç¼ºå°‘åƒæ•¸æˆ–å¤ªå¤šè«‹æ±‚) 5xx ä¼ºæœå™¨éŒ¯èª¤ RESTful Api å›å‚³æ ¼å¼é€šå¸¸ç‚º JSON æˆ– XML ","date":"2022-12-17","objectID":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/:1:0","series":[],"tags":[],"title":"RESTful WebApi è¨­è¨ˆæ¦‚å¿µ","uri":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/#restful-api-æ‰€éµå¾ªçš„è¨­è¨ˆè¦å‰‡"},{"categories":["software-design"],"content":" 2 URL è³‡æºé—œä¿‚URL çš„è·¯å¾‘è¦å¯ä»¥è¡¨é”æ¯å€‹è³‡æºçš„é—œä¿‚ text GET {domain}/users/{userid}/name å–å¾— æŸå€‹ä½¿ç”¨è€…id çš„åç¨± GET {domain}/unit/{unitid}/name å–å¾— æŸå€‹å–®ä½id çš„åç¨± ","date":"2022-12-17","objectID":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/:2:0","series":[],"tags":[],"title":"RESTful WebApi è¨­è¨ˆæ¦‚å¿µ","uri":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/#url-è³‡æºé—œä¿‚"},{"categories":["software-design"],"content":" 3 é CRUD æ“ä½œä»¥ HTTP è¡Œç‚ºè¡¨ç¤ºèˆ‡è³‡æ–™çš„äº’å‹•é—œä¿‚ï¼Œä»¥å¾ŒçºŒçš„è³‡æºæ¬„ä½è¡¨ç¤ºè¦é€²è¡Œçš„è¡Œç‚º HTTP æ–¹æ³• å°æ‡‰è¡Œç‚º POST é©—è­‰ã€æ¯”è¼ƒç­‰ç„¡æ›´æ–°è³‡æ–™çš„è¡Œç‚º PUT URL å³ä»£è¡¨è¡Œç‚º PATCH ä¾æ“š query string æˆ–æ˜¯ request body å…§çš„è³‡æ–™æ±ºå®šè¡Œç‚ºçµæœ ç¯„ä¾‹ é æœŸè¡Œç‚º HTTP æ–¹æ³• URL å‚™è¨» é©—è­‰ä½¿ç”¨è€…è³‡æ–™è³‡æ–™ POST {domain}/users/verify é©—è­‰è³‡è¨Šæœƒæ”¾ç½®æ–¼ Http Request Body èª¿æ•´ä½¿ç”¨è€…ç‹€æ…‹ç‚ºæœ‰æ•ˆæˆ–ç„¡æ•ˆ (ç¯„ä¾‹1) PATCH {domain}/users/{userid}/status?invalid=true ä½¿ç”¨ query string è¨­å®šç‹€æ…‹ èª¿æ•´ä½¿ç”¨è€…ç‹€æ…‹ç‚ºæœ‰æ•ˆæˆ–ç„¡æ•ˆ (ç¯„ä¾‹2) PATCH {domain}/users/{userid}/status ä½¿ç”¨ HttpBody è¨­å®šç‹€æ…‹: Body Context = {â€œinvalidâ€=true} è¨­å®šä½¿ç”¨è€…ç‚ºç„¡æ•ˆä½¿ç”¨è€… PUT {domain}/users/{userid}/status/invalid è¨­å®šä½¿ç”¨è€…ç‚ºæœ‰æ•ˆä½¿ç”¨è€… PUT {domain}/users/{userid}/status/valid ","date":"2022-12-17","objectID":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/:3:0","series":[],"tags":[],"title":"RESTful WebApi è¨­è¨ˆæ¦‚å¿µ","uri":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/#é-crud-æ“ä½œ"},{"categories":["software-design"],"content":" 4 C# .Net Core 3.1 å¾Œçš„ Route è¨­å®šåƒè€ƒè³‡æ–™ ","date":"2022-12-17","objectID":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/:4:0","series":[],"tags":[],"title":"RESTful WebApi è¨­è¨ˆæ¦‚å¿µ","uri":"/2022/12/restful-webapi-%E8%A8%AD%E8%A8%88%E6%A6%82%E5%BF%B5/#c-net-core-31-å¾Œçš„-route-è¨­å®š"},{"categories":["Kubernetes"],"content":"æœ€æ–°ç‰ˆ Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu 20.04 LTS \u0026 containerd ç‰ˆæœ¬","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/"},{"categories":["Kubernetes"],"content":"kubernetes å®‰è£ç­†è¨˜ è³‡è¨Š K8s: v1.25.1 OS: ubuntu server 20.04 LTS cri: containerd 1.6.8 Update Time 2022/09/17 ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#"},{"categories":["Kubernetes"],"content":" Ubuntu æ ¹ç›®éŒ„ç£å€ç”±æ–¼å…ˆå‰ä¸»è¦ç¿’æ…£æ˜¯ä½¿ç”¨ CentOS7ï¼Œåœ¨ç£å€æ ¼å¼ä¸Šæ…£ç”¨çš„æ˜¯ xfs æ ¼å¼ï¼Œæ‰€ä»¥æˆ‘æœ‰ç‰¹åˆ¥èª¿æ•´æ ¹ç›®éŒ„ç£å€çš„æ ¼å¼åŒ–é¡å‹ç‚º xfsï¼Œè€Œé ubuntu é è¨­çš„ ext4 æˆ‘é€™é‚Šå¦å¤–æ”¶é›†äº†ä¸€äº›ç¶²è·¯ä¸Šé‡å° xfs / ext4 å…©è€…çš„æ¯”è¼ƒè³‡è¨Šï¼Œä¾›éœ€è¦çš„äººåƒè€ƒè©•ä¼° StackExchange ä¸Šçš„ä¸€å€‹é‡å° ubuntu é¸æ“‡ ext4 ä½œç‚ºé è¨­æ ¼å¼çš„åŸå› å›æ‡‰ ubuntu tw ä¸Šçš„ä¸€ç¯‡å„æ ¼å¼æ¯”è¼ƒè¡¨(2009 å¹´çš„æ–‡ç« äº†) XFS-vs-EXT4 çš„ä¸€ç¯‡ç°¡ä¸­è³‡æº ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#ubuntu-æ ¹ç›®éŒ„ç£å€"},{"categories":["Kubernetes"],"content":" ä¸»æ©Ÿæ ¡æ™‚","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#ä¸»æ©Ÿæ ¡æ™‚"},{"categories":["Kubernetes"],"content":" 1 å®‰è£æ‰€éœ€å¥—ä»¶ å®‰è£æª¢æŸ¥ è³‡è¨Š æ ¸å¿ƒçš„åŒæ­¥æœå‹™æ˜¯ ntpï¼Œæ‰€ä»¥è£ ntp å…¶å¯¦å°±å¤ äº† bash # dpkg -l å¯ä»¥åˆ—å‡ºå·²å®‰è£å¥—ä»¶ #dpkg -l | grep ntpdate dpkg -l | grep ntp å®‰è£èªæ³• bash #sudo apt-get install ntpdate sudo apt install ntp è³‡è¨Š åœ¨ ubuntu ä¸­ï¼Œç”¨ apt / apt-get å®‰è£å¥—ä»¶æ™‚æœƒé è¨­å•Ÿç”¨ (è‡³å°‘æˆ‘åœ¨æ’°å¯«æœ¬æ–‡æ™‚ï¼Œéƒ½ä¸ç”¨ç‰¹åˆ¥å¦å¤–åŸ·è¡Œ systemctl enable å‘½ä»¤ï¼Œå®‰è£çš„æœå‹™å°±æœƒè‡ªè¡Œå•Ÿå‹•äº†) ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#å®‰è£æ‰€éœ€å¥—ä»¶"},{"categories":["Kubernetes"],"content":" 2 å•Ÿç”¨è‡ªå‹•æ ¡æ­£ ç·¨è¼¯è¨­å®šæª” bash sudo vi /etc/ntp.conf æŠŠ server å€å¡Šçš„è¨­å®šèª¿æ•´ä¸€ä¸‹ï¼Œæ”¹æˆä¸­è¯é›»ä¿¡çš„æ ¡æ™‚æœå‹™ æ ¡æ™‚ä¼ºæœå™¨åƒè€ƒ é€™é‚Šæœ‰å¦å¤–ä¸€çµ„å¯ä»¥å˜—è©¦ å…¶ä»–åƒè€ƒ conf # org linux time server # pool 0.ubuntu.pool.ntp.org iburst # pool 1.ubuntu.pool.ntp.org iburst # pool 2.ubuntu.pool.ntp.org iburst # pool 3.ubuntu.pool.ntp.org iburst # taiwan time server pool tock.stdtime.gov.tw iburst pool watch.stdtime.gov.tw iburst pool time.stdtime.gov.tw iburst pool clock.stdtime.gov.tw iburst pool tick.stdtime.gov.tw iburst # Use Ubuntu's ntp server as a fallback. # pool ntp.ubuntu.com æ”¹å®Œéœ€è¦é‡å•Ÿ bash sudo vi /etc/ntp.conf è³‡è¨Š é€™é‚Šå¯ä»¥è‡ªå·±è©•ä¼°è¦ä¸è¦èª¿æ•´ï¼Œå› ç‚ºåœ¨æ”¹è¨­å®šæª”å‰ä½¿ç”¨ ntpq -p å‘½ä»¤å»æŸ¥ä»–ä½¿ç”¨äº†é‚£äº›æ ¡æ™‚ä¼ºæœå™¨æ™‚ï¼Œæœ‰çœ‹åˆ°ä½¿ç”¨å°ç£çš„ä½ç½®ï¼Œä¹Ÿè¨±é€™å€‹èª¿æ•´è¡Œç‚ºæ˜¯å¤šçš„ï¼Ÿ ç¢ºèªæœå‹™ç‹€æ…‹ ntp åœ¨å®‰è£å¾Œé è¨­å°±æœƒè¢«å•Ÿç”¨ï¼Œå› æ­¤å¯ä»¥ç”¨ä»¥ä¸‹ç¶²è·¯å·¥å…·ç¢ºèªæ˜¯å¦å·²é–‹å§‹ç›£è½ UDP Port 123 bash netstat -tlunp # å¦‚æœæ²’æœ‰å®‰è£ç¶²è·¯å·¥å…·ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£ sudo apt install net-tools å…¶ä»–åƒè€ƒå‘½ä»¤ bash # æŸ¥çœ‹ç›®å‰ä½¿ç”¨çš„æ ¡æ™‚ä¼ºæœå™¨ç‹€æ…‹ sudo ntpq -p # å•Ÿå‹• sudo /etc/init.d/ntp start # é‡é–‹ sudo /etc/init.d/ntp restart # åœæ­¢ sudo /etc/init.d/ntp stop ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#å•Ÿç”¨è‡ªå‹•æ ¡æ­£"},{"categories":["Kubernetes"],"content":" 3 åƒè€ƒ åƒè€ƒ 1 åƒè€ƒ 2 åƒè€ƒ 3 ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:3:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#åƒè€ƒ"},{"categories":["Kubernetes"],"content":" containerdé€™é‚Šç­†è¨˜ä¸€å€‹ä¸­åœ‹çš„ bili bili é€£çµ ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#containerd"},{"categories":["Kubernetes"],"content":" 1 æ ¸å¿ƒå¥—ä»¶å®‰è£ å®‰è£åƒè€ƒ ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#æ ¸å¿ƒå¥—ä»¶å®‰è£"},{"categories":["Kubernetes"],"content":" 1.1 ä½¿ç”¨ apt-get å¥—ä»¶ç®¡ç†å·¥å…·å®‰è£å®‰è£åƒè€ƒ in docker doc è³‡è¨Š å› ç‚º containerd çš„æœ€æ–°ç‰ˆä¹Ÿåœ¨ docker çš„å„²å­˜åº«ä¸­ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ docker çš„ä¾†æºã€‚ ä½¿ç”¨å¥—ä»¶å®‰è£æœƒè‡ªå‹•å•Ÿç”¨ä¸¦ä¸”ä¸€èµ·å®‰è£éœ€è¦çš„å¥—ä»¶ runc ã€‚ æ›´æ–° apt-get çš„å¥—ä»¶åº« å®‰è£éœ€è¦çš„é¡å¤–å¥—ä»¶ bash sudo apt-get update sudo apt-get install \\ ca-certificates \\ curl \\ gnupg \\ lsb-release è¨­å®šå®‰è£å¥—ä»¶éœ€è¦çš„æ†‘è­‰è³‡æ–™ bash sudo mkdir -p /etc/apt/keyrings curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg echo \\ \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null å®‰è£ containerd bash sudo apt-get update sudo apt-get install containerd.io éœ€è¦æŒ‡å®šç‰ˆæœ¬å¯ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®‰è£ åˆ—å‡ºå¯ç”¨çš„ç‰ˆæœ¬ bash sudo apt-cache madison containerd.io å®‰è£æŒ‡å®šç‰ˆæœ¬ bash sudo apt-get install containerd.io=\u003cVERSION_STRING\u003e ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:1:1","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#ä½¿ç”¨-apt-get-å¥—ä»¶ç®¡ç†å·¥å…·å®‰è£"},{"categories":["Kubernetes"],"content":" 1.2 ä½¿ç”¨æ‰‹å‹•å®‰è£ è³‡è¨Š é€™é‚Šæ‰‹å‹•å®‰è£åƒ…ä½œç‚ºæ•´ç†è¨˜éŒ„ï¼Œæˆ‘ä¸¦æœªä½¿ç”¨è©²æ–¹æ³•å®‰è£ã€‚ æ‰‹å‹•å®‰è£çš„å¥½è™•æ˜¯ä¸ç”¨å¤šè¨­å®šã€å®‰è£ä¸€äº›é¡å¤–çš„æ±è¥¿ï¼Œä½¿ç”¨å“ªç¨®å®‰è£æ–¹å¼å°±å› äººè€Œç•°äº†ã€‚ ä¸‹è¼‰ä¸¦è¨­å®š containerd containerd æ–¼ 2022-09-16 æ™‚çš„æœ€æ–°ç‰ˆä¸‹è¼‰é€£çµ https://github.com/containerd/containerd/releases/download/v1.6.8/containerd-1.6.8-linux-amd64.tar.gz ä¸‹è¼‰ä¸¦è§£å£“ç¸® bash wget https://github.com/containerd/containerd/releases/download/v1.6.8/containerd-1.6.8-linux-amd64.tar.gz sudo tar Czxvf /usr/local containerd-1.6.8-linux-amd64.tar.gz ä¸‹è¼‰ systemd ä½¿ç”¨çš„ service åŸ·è¡Œæª” bash wget https://raw.githubusercontent.com/containerd/containerd/main/containerd.service sudo mv containerd.service /usr/lib/systemd/system/ ä¸‹è¼‰ä¸¦è¨­å®š runc runc æ–¼ 2022-09-16 æ™‚çš„æœ€æ–°ç‰ˆä¸‹è¼‰é€£çµ https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64 ä¸‹è¼‰ä¸¦å®‰è£ bash wget https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64 sudo install -m 755 runc.amd64 /usr/local/sbin/runc ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:1:2","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#ä½¿ç”¨æ‰‹å‹•å®‰è£"},{"categories":["Kubernetes"],"content":" 2 èª¿æ•´è¨­å®šæª”path: /etc/containerd/config.toml å› ç‚ºä½¿ç”¨ å®‰è£ containerd æ™‚çš„é è¨­è¨­å®šæª”é•·é€™æ¨£ toml disabled_plugins = [\"cri\"] ä½¿ç”¨ containerd å…§éƒ¨çš„é è¨­è¨­å®šæª”è¦†è“‹å¾Œå†å»èª¿æ•´ SystemdCgroup=true bash # å¦‚æœä½¿ç”¨æ‰‹å‹•å®‰è£çš„è©±ï¼Œæœƒæ²’æœ‰é€™å€‹è¨­å®šæª”èˆ‡è³‡æ–™å¤¾ï¼Œéœ€è¦å…ˆæ‰‹å‹•å»ºç«‹è³‡æ–™å¤¾ sudo mkdir -p /etc/containerd/ # è¼¸å‡º containerd çš„é è¨­è¨­å®šæª”å‡ºä¾† containerd config default | tee /etc/containerd/config.toml # ç·¨è¼¯è©²è¨­å®šæª” vi /etc/containerd/config.toml # é è¨­è¨­å®šçš„çš„ SystemdCgroup è¨­å®šç‚º falseï¼Œæ”¹æˆ true å°±å¯ä»¥äº† # æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ sed è™•ç† sudo sed -i 's/SystemdCgroup \\= false/SystemdCgroup \\= true/g' /etc/containerd/config.toml è¨­å®š systemdCgroup = true (å®˜æ–¹æ–‡ä»¶åƒè€ƒ) toml [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc] [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options] SystemdCgroup = true ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#èª¿æ•´è¨­å®šæª”"},{"categories":["Kubernetes"],"content":" 3 å»ºç«‹ crictl è¨­å®šèª¿æ•´é€™å€‹è¨­å®šæª”ä¸€é–‹å§‹ä¸å­˜åœ¨ï¼Œéœ€è¦è‡ªå·±å»ºç«‹ä¸¦å¯«å…¥ä»¥ä¸‹å…§å®¹ bash vi /etc/crictl.yaml yaml å…§å®¹å¦‚ä¸‹ yaml runtime-endpoint: unix:///run/containerd/containerd.sock image-endpoint: unix:///run/containerd/containerd.sock timeout: 10 debug: false ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:3:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#å»ºç«‹-crictl-è¨­å®šèª¿æ•´"},{"categories":["Kubernetes"],"content":" 4 å•Ÿå‹• containerd bash sudo systemctl daemon-reload # ç”±æ–¼ä½¿ç”¨ apt-get å¥—ä»¶å®‰è£çš„è©±æœƒé è¨­å•Ÿå‹•ï¼Œæ‰€ä»¥é€™é‚Šå»ºè­°ä½¿ç”¨é‡å•Ÿçš„å‘½ä»¤ sudo systemctl restart containerd sudo systemctl enable --now containerd ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:4:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#å•Ÿå‹•-containerd"},{"categories":["Kubernetes"],"content":" Network Settingref: å®˜æ–¹æ–‡ä»¶ bash cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF sudo modprobe overlay sudo modprobe br_netfilter # sysctl params required by setup, params persist across reboots cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF # Apply sysctl params without reboot sudo sysctl --system ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#network-setting"},{"categories":["Kubernetes"],"content":" Disable Swapåƒè€ƒæ–‡ä»¶ æš«æ™‚é—œé–‰ bash sudo swapoff -a è­¦å‘Š æ­¤å‘½ä»¤åƒ…æ˜¯æš«æ™‚æ€§é—œé–‰ï¼Œserver é‡é–‹å¾Œä»æœƒå•Ÿç”¨ swapï¼Œå› æ­¤éœ€è¦æ­é…ä¸‹ä¸€ç¯€çš„è¨­å®šä¾†å®Œå…¨é—œé–‰ swap æ°¸ä¹…é—œé–‰ swap è¨»è§£æ‰ä»¥ä¸‹å‘½ä»¤é–‹å•Ÿçš„æª”æ¡ˆä¸­ï¼Œå«æœ‰ swap å­—æ¨£çš„è¡Œæ¬¡ bash sudo vim /etc/fstab ç”¨ vim é–‹å•Ÿ /etc/sysctl.conf æª”æ¡ˆï¼Œä¸¦åŠ å…¥ vm.swappiness=0 æœ‰æ™‚å€™æ²’æœ‰è¨­å®šæ­¤è¡Œä¹Ÿå¯ä»¥æ­£å¸¸é‹è¡Œï¼Œä½†å¦‚æœå¯ä»¥çš„è©±ï¼Œé—œæ‰ä¹Ÿè¨±æ¯”è¼ƒå¥½ æ–°ä¸»æ©Ÿè¨­å®šå¾Œæ­¤æª”æ¡ˆæ‡‰è©²æœƒé•·é€™æ¨£ conf # ...å…¶ä»–åŸæœ¬å°±å­˜åœ¨çš„è¨»è§£è³‡æ–™ vm.swappiness=0 ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#disable-swap"},{"categories":["Kubernetes"],"content":" Kubernetes CLI \u0026 SELinux Setref: å®˜æ–¹æ–‡ä»¶ bash sudo apt-get update # é€™é‚Šè·Ÿå‰é¢ç”¨å¥—ä»¶å®‰è£ containerd çš„éƒ¨åˆ†å·®äº† apt-transport-https é€™å€‹å¥—ä»¶ï¼Œå¦‚æœæ˜¯ç”¨å¥—ä»¶å®‰è£ containerd çš„è©±ï¼Œå¯ä»¥è€ƒæ…®èª¿æ•´é€™æ¢å®‰è£å‘½ä»¤ sudo apt-get install -y apt-transport-https ca-certificates curl sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg echo \"deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main\" | sudo tee /etc/apt/sources.list.d/kubernetes.list sudo apt-get update sudo apt-get install -y kubelet kubeadm kubectl #æŒ‡å®šç‰ˆæœ¬ #sudo apt-get install -y kubelet=1.24.6-00 kubeadm=1.24.6-00 kubect #é™ç‰ˆèˆ‡æŒ‡å®šç‰ˆæœ¬ #æ›´æ”¹ç‰ˆæœ¬è¨˜å¾— apt-mark unhold kubelet kubeadm kubectl #sudo apt-get install -y --allow-downgrades kubelet=1.24.6-00 kubeadm=1.24.6-00 kubect # é¿å… apt-get éš¨ä¾¿æ›´æ–°ç›¸é—œå¥—ä»¶ sudo apt-mark hold kubelet kubeadm kubectl å®‰è£å®Œç•¢å¾Œå¯çœ‹åˆ°å®‰è£äº†å·²ä¸‹å¥—ä»¶ bash Setting up conntrack (1:1.4.5-2) ... Setting up kubectl (1.25.1-00) ... Setting up ebtables (2.0.11-3build1) ... Setting up socat (1.7.3.3-2) ... Setting up cri-tools (1.25.0-00) ... Setting up kubernetes-cni (1.1.1-00) ... Setting up kubelet (1.25.1-00) ... Created symlink /etc/systemd/system/multi-user.target.wants/kubelet.service â†’ /lib/systemd/system/kubelet.service. Setting up kubeadm (1.25.1-00) ... Processing triggers for man-db (2.9.1-1) ... ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#kubernetes-cli--selinux-set"},{"categories":["Kubernetes"],"content":" kubernetes cluster init / join command (use kubeadm) é å…ˆæ‹‰å–éœ€è¦çš„ Image bash sudo kubeadm config images pull å»ºç«‹ kubernetes cluster bash sudo kubeadm init # æŒ‡å®š control-plane-endpoint sudo kubeadm init --control-plane-endpoint=\u003ccontrol-plane-endpoint-domain\u003e \\ --upload-certs #sudo kubeadm init --control-plane-endpoint=k8s-ubuntu-containerd.mshome.net \\ # --upload-certs # æŒ‡å®šç‰ˆæœ¬ # ç”±æ–¼æŒ‡å®šç‰ˆæœ¬æœƒéœ€è¦å°æ‡‰ç‰ˆæœ¬çš„ kubeadm / kubelet ç­‰å·¥å…·ï¼Œè¨˜å¾—å®‰è£å°æ‡‰ç‰ˆæœ¬çš„å·¥å…· sudo kubeadm init --control-plane-endpoint=\u003ccontrol-plane-endpoint-domain\u003e \\ --upload-certs --kubernetes-version=v1.24.6 reset kubernetes cluster bash kubectl drain \u003cnode name\u003e --delete-emptydir-data --force --ignore-daemonsets #kubectl drain \u003cnode name\u003e --delete-emptydir-data --force --ignore-daemonsets sudo kubeadm reset # æ¸…é™¤è³‡æ–™ sudo rm -rf /etc/cni/net.d # é‡è¨­ ip table sudo iptables -F \u0026\u0026 iptables -t nat -F \u0026\u0026 iptables -t mangle -F \u0026\u0026 iptables -X join kubernetes cluster bash sudo kubeadm join \u003ccontrol-endpoint\u003e:6443 --token \u003ctoken\u003e \\ --discovery-token-ca-cert-hash sha256:\u003chash\u003e ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#kubernetes-cluster-init--join-command-use-kubeadm"},{"categories":["Kubernetes"],"content":" Other Setting","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#other-setting"},{"categories":["Kubernetes"],"content":" 1 Master node","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#master-node"},{"categories":["Kubernetes"],"content":" 1.1 kubeconfig 1.1.1 bash profileMaster Node åœ¨ kubeadm join / init çµæŸä¹‹å¾Œï¼Œå¯ä»¥è€ƒæ…®å°‡ kubeconfig æª”æ¡ˆè¨­å®šåœ¨ bash_profile è£¡é¢ bash export KUBECONFIG=/etc/kubernetes/admin.conf vi .bash_profile .bash_profile çš„è¨­å®š config # .bash_profile # Get the aliases and functions if [ -f ~/.bashrc ]; then . ~/.bashrc fi # User specific environment and startup programs PATH=$PATH:$HOME/bin export PATH export KUBECONFIG=/etc/kubernetes/admin.conf 1.1.2 ä¸€èˆ¬ä½¿ç”¨è€… (é root å¸³è™Ÿ) bash mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:1:1","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#kubeconfig"},{"categories":["Kubernetes"],"content":" 1.1 kubeconfig 1.1.1 bash profileMaster Node åœ¨ kubeadm join / init çµæŸä¹‹å¾Œï¼Œå¯ä»¥è€ƒæ…®å°‡ kubeconfig æª”æ¡ˆè¨­å®šåœ¨ bash_profile è£¡é¢ bash export KUBECONFIG=/etc/kubernetes/admin.conf vi .bash_profile .bash_profile çš„è¨­å®š config # .bash_profile # Get the aliases and functions if [ -f ~/.bashrc ]; then . ~/.bashrc fi # User specific environment and startup programs PATH=$PATH:$HOME/bin export PATH export KUBECONFIG=/etc/kubernetes/admin.conf 1.1.2 ä¸€èˆ¬ä½¿ç”¨è€… (é root å¸³è™Ÿ) bash mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:1:1","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#bash-profile"},{"categories":["Kubernetes"],"content":" 1.1 kubeconfig 1.1.1 bash profileMaster Node åœ¨ kubeadm join / init çµæŸä¹‹å¾Œï¼Œå¯ä»¥è€ƒæ…®å°‡ kubeconfig æª”æ¡ˆè¨­å®šåœ¨ bash_profile è£¡é¢ bash export KUBECONFIG=/etc/kubernetes/admin.conf vi .bash_profile .bash_profile çš„è¨­å®š config # .bash_profile # Get the aliases and functions if [ -f ~/.bashrc ]; then . ~/.bashrc fi # User specific environment and startup programs PATH=$PATH:$HOME/bin export PATH export KUBECONFIG=/etc/kubernetes/admin.conf 1.1.2 ä¸€èˆ¬ä½¿ç”¨è€… (é root å¸³è™Ÿ) bash mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:1:1","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#ä¸€èˆ¬ä½¿ç”¨è€…-é-root-å¸³è™Ÿ"},{"categories":["Kubernetes"],"content":" 1.2 single nodeå¦‚æœéœ€è¦åœ¨ master ä¸Šéƒ¨ç½²æœå‹™çš„è©±ï¼Œéœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ bash #kubectl taint nodes --all node-role.kubernetes.io/control-plane- kubectl taint nodes --all node-role.kubernetes.io/control-plane- node-role.kubernetes.io/master- ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:1:2","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#single-node"},{"categories":["Kubernetes"],"content":" 2 Weave net CNIå¦‚æœæ˜¯æ­£åœ¨å»ºç«‹å¢é›†ï¼Œå°±æœƒéœ€è¦å¦å¤–å®‰è£ CNI ( Container Network Interface )ï¼Œé€™é‚Šæ¡ç”¨ Weave net CNI ç›´æ¥å®‰è£ weave net doc - install bash #kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" kubectl apply -f https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml # 1.24.6 #kubectl apply -f https://cloud.weave.works/k8s/net?k8s-version=Q2xpZW50IFZlcnNpb246IHZlcnNpb24uSW5mb3tNYWpvcjoiMSIsIE1pbm9yOiIyNSIsIEdpdFZlcnNpb246InYxLjI1LjIiLCBHaXRDb21taXQ6IjU4MzU1NDRjYTU2OGI3NTdhOGVjYWU1YzE1M2YzMTdlNTczNjcwMGUiLCBHaXRUcmVlU3RhdGU6ImNsZWFuIiwgQnVpbGREYXRlOiIyMDIyLTA5LTIxVDE0OjMzOjQ5WiIsIEdvVmVyc2lvbjoiZ28xLjE5LjEiLCBDb21waWxlcjoiZ2MiLCBQbGF0Zm9ybToibGludXgvYW1kNjQifQpLdXN0b21pemUgVmVyc2lvbjogdjQuNS43ClNlcnZlciBWZXJzaW9uOiB2ZXJzaW9uLkluZm97TWFqb3I6IjEiLCBNaW5vcjoiMjQiLCBHaXRWZXJzaW9uOiJ2MS4yNC42IiwgR2l0Q29tbWl0OiJiMzliZjE0OGNkNjU0NTk5YTUyZTg2NzQ4NWMwMmM0ZjlkMjhiMzEyIiwgR2l0VHJlZVN0YXRlOiJjbGVhbiIsIEJ1aWxkRGF0ZToiMjAyMi0wOS0yMVQxMzoxMjowNFoiLCBHb1ZlcnNpb246ImdvMS4xOC42IiwgQ29tcGlsZXI6ImdjIiwgUGxhdGZvcm06ImxpbnV4L2FtZDY0In0K å¦‚æœè¦ç‰¹åˆ¥èª¿æ•´ç¶²æ®µ è³‡è¨Š ç”±æ–¼ç™¼ç¾å®˜æ–¹çš„å®‰è£èªæ³•æ–¼ 2022-10-11 æ™‚ç™¼ç¾æœ‰è®Šå‹•ï¼Œä»¥ä¸‹å‘½ä»¤å¾…æ¸¬è©¦ bash kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\u0026env.IPALLOC_RANGE=172.30.0.0/16\" æ¸…é™¤å®‰è£ è³‡è¨Š ç”±æ–¼ç™¼ç¾å®˜æ–¹çš„å®‰è£èªæ³•æ–¼ 2022-10-11 æ™‚ç™¼ç¾æœ‰è®Šå‹•ï¼Œä»¥ä¸‹å‘½ä»¤å¾…æ¸¬è©¦ bash kubectl delete -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#weave-net-cni"},{"categories":["Kubernetes"],"content":" ç¶²æ®µè³‡æ–™åƒè€ƒå…¨é è¨­ weave-net cni çš„ kubernetes cluster ç¶²æ®µ Used For Subnet Genmask Start End Kubernetes Pod Subnet (Weave-cni) 10.32.0.0/12 255.240.0.0 10.32.0.1 10.47.255.254 Kubernetes Service Subnet 10.105.0.0/12 255.240.0.0 10.105.0.1 10.111.255.254 ","date":"2022-09-16","objectID":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - ubuntu \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-ubuntu-with-containerd/#ç¶²æ®µè³‡æ–™åƒè€ƒ"},{"categories":["Kubernetes"],"content":"æœ€æ–°ç‰ˆ Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd ç‰ˆæœ¬","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/"},{"categories":["Kubernetes"],"content":"å®šæœŸæ›´æ–°ç‰ˆ kubernetes å®‰è£ç­†è¨˜ è³‡è¨Š K8s: v1.25.0 OS: CentOs 7 (kernel = 3.10.1) cri: containerd 1.6.8-3.1.el7 Update Time 2022/09/14 ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#"},{"categories":["Kubernetes"],"content":" ä¸»æ©Ÿæ ¡æ™‚","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#ä¸»æ©Ÿæ ¡æ™‚"},{"categories":["Kubernetes"],"content":" 1 å®‰è£æ‰€éœ€å¥—ä»¶ bash sudo yum install ntp ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#å®‰è£æ‰€éœ€å¥—ä»¶"},{"categories":["Kubernetes"],"content":" 2 å•Ÿç”¨è‡ªå‹•æ ¡æ­£ ç·¨è¼¯è¨­å®šæª” bash sudo vi /etc/ntp.conf æŠŠ server å€å¡Šçš„è¨­å®šèª¿æ•´ä¸€ä¸‹ï¼Œæ”¹æˆä¸­è¯é›»ä¿¡çš„æ ¡æ™‚æœå‹™ (æœƒæ¯”ä½¿ç”¨ linux çš„æ ¡æ™‚ä¼ºæœå™¨å¿«ä¸€é»ï¼Œå› ç‚ºæ¯”è¼ƒè¿‘) æ ¡æ™‚ä¼ºæœå™¨åƒè€ƒ é€™é‚Šæœ‰å¦å¤–ä¸€çµ„å¯ä»¥å˜—è©¦ å…¶ä»–åƒè€ƒ conf # org linux time server # server 0.centos.pool.ntp.org iburst # server 1.centos.pool.ntp.org iburst # server 2.centos.pool.ntp.org iburst # server 3.centos.pool.ntp.org iburst # taiwan time server server tock.stdtime.gov.tw server watch.stdtime.gov.tw server time.stdtime.gov.tw server clock.stdtime.gov.tw server tick.stdtime.gov.tw å°‡æ ¡æ™‚åŠŸèƒ½åŠ å…¥ç³»çµ±æœå‹™ bash sudo systemctl start ntpd sudo systemctl enable ntpd ç¢ºèªå•Ÿç”¨ç‹€æ…‹ bash systemctl status ntpd ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#å•Ÿç”¨è‡ªå‹•æ ¡æ­£"},{"categories":["Kubernetes"],"content":" 3 åƒè€ƒ åƒè€ƒ 1 åƒè€ƒ 2 ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:3:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#åƒè€ƒ"},{"categories":["Kubernetes"],"content":" containerd","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#containerd"},{"categories":["Kubernetes"],"content":" 1 æ ¸å¿ƒå¥—ä»¶å®‰è£ æ›´æ–° yum ä¸¦å®šç¾© docker å·¥å…·ä¾†æº è³‡è¨Š å› ç‚º containerd çš„æœ€æ–°ç‰ˆä¹Ÿåœ¨ docker çš„å„²å­˜åº«ä¸­ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ docker çš„ä¾†æº bash sudo yum install -y yum-utils sudo yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo å®‰è£ containerd bash sudo yum install containerd.io éœ€è¦æŒ‡å®šç‰ˆæœ¬å¯ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®‰è£ åˆ—å‡ºå¯ç”¨çš„ç‰ˆæœ¬ bash sudo yum list containerd.io --showduplicates | sort -r å®‰è£æŒ‡å®šç‰ˆæœ¬ bash sudo yum install containerd.io-\u003cVERSION_STRING\u003e ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#æ ¸å¿ƒå¥—ä»¶å®‰è£"},{"categories":["Kubernetes"],"content":" 2 èª¿æ•´è¨­å®šæª”path: /etc/containerd/config.toml ä½¿ç”¨ yum å®‰è£ containerd æ™‚çš„é è¨­è¨­å®šæª”é•·é€™æ¨£ toml disabled_plugins = [\"cri\"] ä½¿ç”¨ containerd å…§éƒ¨çš„é è¨­è¨­å®šæª”è¦†è“‹å¾Œå†å»èª¿æ•´ SystemdCgroup=true bash # è¼¸å‡º containerd çš„é è¨­è¨­å®šæª”å‡ºä¾† sudo containerd config default | tee /etc/containerd/config.toml # ç·¨è¼¯è©²è¨­å®šæª” sudo vi /etc/containerd/config.toml # é è¨­è¨­å®šçš„çš„ SystemdCgroup è¨­å®šç‚º falseï¼Œæ”¹æˆ true å°±å¯ä»¥äº† # æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ sed è™•ç† sudo sed -i 's/SystemdCgroup \\= false/SystemdCgroup \\= true/g' /etc/containerd/config.toml è¨­å®š systemdCgroup = true (å®˜æ–¹æ–‡ä»¶åƒè€ƒ) toml [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc] [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options] SystemdCgroup = true ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#èª¿æ•´è¨­å®šæª”"},{"categories":["Kubernetes"],"content":" 3 å»ºç«‹ crictl è¨­å®šèª¿æ•´é€™å€‹è¨­å®šæª”ä¸€é–‹å§‹ä¸å­˜åœ¨ï¼Œéœ€è¦è‡ªå·±å»ºç«‹ä¸¦å¯«å…¥ä»¥ä¸‹å…§å®¹ bash sudo vi /etc/crictl.yaml yaml å…§å®¹å¦‚ä¸‹ yaml runtime-endpoint: unix:///run/containerd/containerd.sock image-endpoint: unix:///run/containerd/containerd.sock timeout: 10 debug: false ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:3:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#å»ºç«‹-crictl-è¨­å®šèª¿æ•´"},{"categories":["Kubernetes"],"content":" 4 å…¶ä»–è¼”åŠ©æ€§è³ªçš„å·¥å…·å®‰è£","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:4:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#å…¶ä»–è¼”åŠ©æ€§è³ªçš„å·¥å…·å®‰è£"},{"categories":["Kubernetes"],"content":" 4.1 containerd çš„ CNI è³‡è¨Š é€™å€‹ä¸è£ä¸æœƒå½±éŸ¿ kubernetes é‹ä½œï¼Œä½†æ˜¯æœƒé€ æˆ containerd å…§éƒ¨å‡ºç¾éŒ¯èª¤æ™‚ï¼Œç„¡æ³•åœ¨æ²’æœ‰ kubernetes çš„ç‹€æ…‹ä¸‹é€²è¡Œå®¹å™¨æ“ä½œã€‚ cni åœ¨æ–‡ç« æ’°å¯«ç•¶ä¸‹ (2022-09-19 æœ€æ–°ç‰ˆæœ¬ç‚º 1.1.1) cni github bash sudo mkdir -p /opt/cni/bin/ sudo wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz sudo tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:4:1","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#containerd-çš„-cni"},{"categories":["Kubernetes"],"content":" 4.2 nerdctlnerdctl Github æ˜¯è¼”åŠ©æ€§è³ªçš„å‘½ä»¤åˆ—å·¥å…·ï¼Œå»ºè­°å®‰è£ æ’°æ–‡ç•¶ä¸‹æœ€æ–°ç‰ˆæœ¬é€£çµå¦‚ä¸‹ https://github.com/containerd/nerdctl/releases/download/v0.23.0/nerdctl-0.23.0-linux-amd64.tar.gz bash wget https://github.com/containerd/nerdctl/releases/download/v0.23.0/nerdctl-0.23.0-linux-amd64.tar.gz sudo tar Cxzvf /usr/local/bin nerdctl-0.23.0-linux-amd64.tar.gz è³‡è¨Š nerdctl çš„ç™¼å¸ƒæ¸…å–®è£¡é¢æœ‰ä¸€å€‹æ˜¯ nerdctl-full-{version}-linux-amd64.tar.gzï¼Œé€™å€‹åŒ…å«äº† containerd / runc / CNI ç­‰å¿…è¦å€šè³´ï¼Œå¦‚æœä½¿ç”¨æ‰‹å‹•å®‰è£çš„è©±ï¼Œä¹Ÿè¨±å¯ä»¥è€ƒæ…®ç”¨é€™åŒ…ä¸€æ¬¡å…¨è£ã€‚ ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:4:2","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#nerdctl"},{"categories":["Kubernetes"],"content":" 5 å•Ÿå‹• containerd è­¦å‘Š å•Ÿå‹• containerd çš„æ®µè½æœƒæ”¾åœ¨é€™é‚Šæ˜¯å› ç‚ºï¼Œå‰é¢çš„æ‰€æœ‰å®‰è£è®Šæ›´éƒ½æœƒéœ€è¦é‡å•Ÿ containerd !! bash sudo systemctl daemon-reload # å¥—ä»¶å®‰è£æœƒé è¨­å•Ÿç”¨ sudo systemctl enable --now containerd # å¦‚æœå·²ç¶“æœ‰è¨­å®šå•Ÿç”¨ containerd çš„è©±å°±è¦ç”¨é€™å€‹ sudo systemctl restart containerd ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:5:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#å•Ÿå‹•-containerd"},{"categories":["Kubernetes"],"content":" Network Settingref: å®˜æ–¹æ–‡ä»¶ bash cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF sudo modprobe overlay sudo modprobe br_netfilter # sysctl params required by setup, params persist across reboots cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF # Apply sysctl params without reboot sudo sysctl --system ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#network-setting"},{"categories":["Kubernetes"],"content":" Disable Swapåƒè€ƒæ–‡ä»¶ æš«æ™‚é—œé–‰ ```bash sudo swapoff -a ``` è­¦å‘Š æ­¤å‘½ä»¤åƒ…æ˜¯æš«æ™‚æ€§é—œé–‰ï¼Œserver é‡é–‹å¾Œä»æœƒå•Ÿç”¨ swapï¼Œå› æ­¤éœ€è¦æ­é…ä¸‹ä¸€ç¯€çš„è¨­å®šä¾†å®Œå…¨é—œé–‰ swap æ°¸ä¹…é—œé–‰ swap è¨»è§£æ‰ä»¥ä¸‹å‘½ä»¤é–‹å•Ÿçš„æª”æ¡ˆä¸­ï¼Œå«æœ‰ swap å­—æ¨£çš„è¡Œæ¬¡ bash sudo vim /etc/fstab ç”¨ vim é–‹å•Ÿ /etc/sysctl.conf æª”æ¡ˆï¼Œä¸¦åŠ å…¥ vm.swappiness=0 æœ‰æ™‚å€™æ²’æœ‰è¨­å®šæ­¤è¡Œä¹Ÿå¯ä»¥æ­£å¸¸é‹è¡Œï¼Œä½†å¦‚æœå¯ä»¥çš„è©±ï¼Œé—œæ‰ä¹Ÿè¨±æ¯”è¼ƒå¥½ æ–°ä¸»æ©Ÿè¨­å®šå¾Œæ­¤æª”æ¡ˆæ‡‰è©²æœƒé•·é€™æ¨£ conf # sysctl settings are defined through files in # /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/. # # Vendors settings live in /usr/lib/sysctl.d/. # To override a whole file, create a new file with the same in # /etc/sysctl.d/ and put new settings there. To override # only specific settings, add a file with a lexically later # name in /etc/sysctl.d/ and put new settings there. # # For more information, see sysctl.conf(5) and sysctl.d(5). vm.swappiness=0 ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#disable-swap"},{"categories":["Kubernetes"],"content":" Kubernetes CLI \u0026 SELinux Setref: å®˜æ–¹æ–‡ä»¶ bash cat \u003c\u003cEOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF # Set SELinux in permissive mode (effectively disabling it) sudo setenforce 0 sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes sudo systemctl enable --now kubelet è³‡è¨Š å…ˆå‰èˆŠçš„å‘½ä»¤æœƒæœ‰ repo_gpgcheck çš„å•é¡Œï¼Œåœ¨æ’°æ–‡ç•¶ä¸‹ (2022/09/12) å·²è¢«ä¿®æ­£ è‹¥ä»æœ‰ç›¸é—œå•é¡Œçš„è©±ï¼Œè«‹åƒè€ƒå®˜æ–¹èªªæ˜ text If the baseurl fails because your Red Hat-based distribution cannot interpret basearch, replace \\$basearch with your computer's architecture. Type uname -m to see that value. For example, the baseurl URL for x86_64 could be: https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64. å®‰è£å®Œç•¢å¾Œå¯çœ‹åˆ°å®‰è£äº†å·²ä¸‹å¥—ä»¶ bash Installed: kubeadm.x86_64 0:1.25.0-0 kubectl.x86_64 0:1.25.0-0 kubelet.x86_64 0:1.25.0-0 Dependency Installed: conntrack-tools.x86_64 0:1.4.4-7.el7 cri-tools.x86_64 0:1.24.2-0 kubernetes-cni.x86_64 0:0.8.7-0 libnetfilter_cthelper.x86_64 0:1.0.0-11.el7 libnetfilter_cttimeout.x86_64 0:1.0.0-7.el7 libnetfilter_queue.x86_64 0:1.0.2-2.el7_2 socat.x86_64 0:1.7.3.2-2.el7 Complete! ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#kubernetes-cli--selinux-set"},{"categories":["Kubernetes"],"content":" kubernetes cluster init / join command (use kubeadm) é å…ˆæ‹‰å–éœ€è¦çš„ Image bash kubeadm config images pull å»ºç«‹ kubernetes cluster bash kubeadm init # æŒ‡å®š control-plane-endpoint kubeadm init --control-plane-endpoint=\u003ccontrol-plane-endpoint-domain\u003e \\ --upload-certs reset kubernetes cluster bash kubeadm reset # æ¸…é™¤è³‡æ–™ rm -rf /etc/cni/net.d # é‡è¨­ ip table iptables -F \u0026\u0026 iptables -t nat -F \u0026\u0026 iptables -t mangle -F \u0026\u0026 iptables -X join kubernetes cluster bash kubeadm join \u003ccontrol-endpoint\u003e:6443 --token \u003ctoken\u003e \\ --discovery-token-ca-cert-hash sha256:\u003chash\u003e ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#kubernetes-cluster-init--join-command-use-kubeadm"},{"categories":["Kubernetes"],"content":" Other Setting","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#other-setting"},{"categories":["Kubernetes"],"content":" 1 Master nodeMaster Node åœ¨ kubeadm join / init çµæŸä¹‹å¾Œï¼Œå¯ä»¥è€ƒæ…®å°‡ kubeconfig æª”æ¡ˆè¨­å®šåœ¨ bash_profile è£¡é¢ bash export KUBECONFIG=/etc/kubernetes/admin.conf vi .bash_profile .bash_profile çš„è¨­å®š config # .bash_profile # Get the aliases and functions if [ -f ~/.bashrc ]; then . ~/.bashrc fi # User specific environment and startup programs PATH=$PATH:$HOME/bin export PATH export KUBECONFIG=/etc/kubernetes/admin.conf ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#master-node"},{"categories":["Kubernetes"],"content":" 2 Weave net CNIå¦‚æœæ˜¯æ­£åœ¨å»ºç«‹å¢é›†ï¼Œå°±æœƒéœ€è¦å¦å¤–å®‰è£ CNI ( Container Network Interface )ï¼Œé€™é‚Šæ¡ç”¨ Weave net CNI ç›´æ¥å®‰è£ weave net doc - install bash kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" å¦‚æœè¦ç‰¹åˆ¥èª¿æ•´ç¶²æ®µ bash kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\u0026env.IPALLOC_RANGE=172.30.0.0/16\" æ¸…é™¤å®‰è£ bash kubectl delete -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#weave-net-cni"},{"categories":["Kubernetes"],"content":" ç¶²æ®µè³‡æ–™åƒè€ƒå…¨é è¨­ weave-net cni çš„ kubernetes cluster ç¶²æ®µ Used For Subnet Genmask Start End Kubernetes Pod Subnet (Weave-cni) 10.32.0.0/12 255.240.0.0 10.32.0.1 10.47.255.254 Kubernetes Service Subnet 10.105.0.0/12 255.240.0.0 10.105.0.1 10.111.255.254 ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 containerd","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-containerd/#ç¶²æ®µè³‡æ–™åƒè€ƒ"},{"categories":["Kubernetes"],"content":"æœ€æ–°ç‰ˆ Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker ç‰ˆæœ¬","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/"},{"categories":["Kubernetes"],"content":"å®šæœŸæ›´æ–°ç‰ˆ kubernetes å®‰è£ç­†è¨˜ è³‡è¨Š K8s: v1.25.0 OS: CentOs 7 (kernel = 3.10.1) cri: docker 20.10.18 Update Time 2022/09/12 ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#"},{"categories":["Kubernetes"],"content":" ä¸»æ©Ÿæ ¡æ™‚","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#ä¸»æ©Ÿæ ¡æ™‚"},{"categories":["Kubernetes"],"content":" 1 å®‰è£æ‰€éœ€å¥—ä»¶ bash sudo yum install ntp ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#å®‰è£æ‰€éœ€å¥—ä»¶"},{"categories":["Kubernetes"],"content":" 2 å•Ÿç”¨è‡ªå‹•æ ¡æ­£ ç·¨è¼¯è¨­å®šæª” bash sudo vi /etc/ntp.conf æŠŠ server å€å¡Šçš„è¨­å®šèª¿æ•´ä¸€ä¸‹ï¼Œæ”¹æˆä¸­è¯é›»ä¿¡çš„æ ¡æ™‚æœå‹™ (æœƒæ¯”ä½¿ç”¨ linux çš„æ ¡æ™‚ä¼ºæœå™¨å¿«ä¸€é»ï¼Œå› ç‚ºæ¯”è¼ƒè¿‘) æ ¡æ™‚ä¼ºæœå™¨åƒè€ƒ é€™é‚Šæœ‰å¦å¤–ä¸€çµ„å¯ä»¥å˜—è©¦ å…¶ä»–åƒè€ƒ conf # org linux time server # server 0.centos.pool.ntp.org iburst # server 1.centos.pool.ntp.org iburst # server 2.centos.pool.ntp.org iburst # server 3.centos.pool.ntp.org iburst # taiwan time server server tock.stdtime.gov.tw server watch.stdtime.gov.tw server time.stdtime.gov.tw server clock.stdtime.gov.tw server tick.stdtime.gov.tw å°‡æ ¡æ™‚åŠŸèƒ½åŠ å…¥ç³»çµ±æœå‹™ bash sudo systemctl start ntpd sudo systemctl enable ntpd ç¢ºèªå•Ÿç”¨ç‹€æ…‹ bash systemctl status ntpd ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#å•Ÿç”¨è‡ªå‹•æ ¡æ­£"},{"categories":["Kubernetes"],"content":" 3 åƒè€ƒ åƒè€ƒ 1 åƒè€ƒ 2 ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:3:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#åƒè€ƒ"},{"categories":["Kubernetes"],"content":" Docker","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#docker"},{"categories":["Kubernetes"],"content":" 1 å®‰è£ä¹‹å‰ è­¦å‘Š åœ¨ kubernetes 1.24 ç‰ˆä¹‹å¾Œï¼Œç”±æ–¼è¢«æ‹”é™¤äº† docker æ”¯æ´ï¼Œæ‰€ä»¥è«‹è©•ä¼°æ˜¯å¦é‚„æœ‰ä½¿ç”¨ docker çš„éœ€è¦ï¼Œä¸”å°±ç®—æ˜¯ dockerï¼ŒèƒŒå¾Œä¹Ÿæ˜¯ä½¿ç”¨ containerd ä¾†é‹è¡Œï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯è¦åšç‚ºæ˜ åƒæª”å»ºç½®ä¸»æ©Ÿçš„è©±ï¼Œå…¶å¯¦å¯ä»¥è€ƒæ…®ç›´æ¥ä½¿ç”¨ containerdã€‚ å®˜æ–¹æ–‡ä»¶ ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#å®‰è£ä¹‹å‰"},{"categories":["Kubernetes"],"content":" 2 æ ¸å¿ƒå¥—ä»¶å®‰è£ æ›´æ–° yum ä¸¦å®šç¾© docker å·¥å…·ä¾†æº bash sudo yum install -y yum-utils sudo yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo å®‰è£ docker-ce èˆ‡ä¾è³´å¥—ä»¶ bash sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin è³‡è¨Š ç”±æ–¼æ˜¯è¦åšç‚º kuberntes çš„å®¹å™¨åŸ·è¡Œæ ¸å¿ƒï¼Œå…¶å¯¦å¯ä»¥è€ƒæ…®ä¸å®‰è£ docker-compose-plugin éœ€è¦æŒ‡å®šç‰ˆæœ¬å¯ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®‰è£ åˆ—å‡ºå¯ç”¨çš„ç‰ˆæœ¬ bash sudo yum list docker-ce --showduplicates | sort -r å®‰è£æŒ‡å®šç‰ˆæœ¬ bash sudo yum install docker-ce-\u003cVERSION_STRING\u003e docker-ce-cli-\u003cVERSION_STRING\u003e containerd.io ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#æ ¸å¿ƒå¥—ä»¶å®‰è£"},{"categories":["Kubernetes"],"content":" 3 èª¿æ•´è¨­å®šæª”å»ºç«‹èˆ‡ç·¨è¼¯ /etc/docker/daemon.json å®˜æ–¹å° Cgroup drivers çš„èªªæ˜ bash sudo mkdir /etc/docker cat \u003c\u003cEOF | sudo tee /etc/docker/daemon.json { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\" } } EOF ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:3:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#èª¿æ•´è¨­å®šæª”"},{"categories":["Kubernetes"],"content":" 4 å•Ÿå‹• docker bash sudo systemctl daemon-reload sudo systemctl enable docker sudo systemctl start docker ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:4:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#å•Ÿå‹•-docker"},{"categories":["Kubernetes"],"content":" Cri-dockerd","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#cri-dockerd"},{"categories":["Kubernetes"],"content":" 1 Reference migrate-kubernetes-to-dockershim how-to-install-cri-dockerd-and-migrate-nodes-from-dockershim ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#reference"},{"categories":["Kubernetes"],"content":" 2 Install and configure è³‡è¨Š å‰è¿°çš„åƒè€ƒä¸­ï¼Œä½¿ç”¨çš„ä¸‹è¼‰å‘½ä»¤éƒ½æ˜¯ wget ï¼Œä¸éæˆ‘çš„ç’°å¢ƒæ²’æœ‰ wget å¯ä»¥ç”¨ï¼Œä¹Ÿä¸æƒ³å¤šå®‰è£æ±è¥¿ï¼Œå°±æ”¹ç”¨æœ€å°å®‰è£çš„ centos å°±æœ‰çš„ curl äº† bash # å…ˆåˆ° OS é è¨­çš„æš«å­˜è³‡æ–™å¤¾ cd /tmp # ç¢ºå®šç›®å‰ cri-dockerd çš„ç‰ˆæœ¬ä¸¦è¨­å®šåˆ°ç’°å¢ƒåƒæ•¸ä¸­ echo $(curl -s https://api.github.com/repos/Mirantis/cri-dockerd/releases/latest|grep tag_name | cut -d '\"' -f 4) # 2022-09-11 æ™‚çš„æœ€æ–°ç‰ˆæœ¬ = 0.2.5 # 2022-09-11 æ™‚çš„æœ€æ–°ç‰ˆæœ¬ç¶²å€ # https://github.com/Mirantis/cri-dockerd/releases/download/v0.2.5/cri-dockerd-0.2.5.amd64.tgz curl -L -o cri-dockerd-0.2.5.amd64.tgz https://github.com/Mirantis/cri-dockerd/releases/download/v0.2.5/cri-dockerd-0.2.5.amd64.tgz tar xvf cri-dockerd-0.2.5.amd64.tgz # Centos å¯ä»¥è€ƒæ…® rpm å®‰è£ # å®‰è£å‘½ä»¤è«‹è‡ªè¡Œæ¸¬è©¦ # centos 7 # curl -L -o cri-dockerd-0.2.5-3.el7.x86_64.rpm https://github.com/Mirantis/cri-dockerd/releases/download/v0.2.5/cri-dockerd-0.2.5-3.el7.x86_64.rpm # centos 8 # curl -L -o cri-dockerd-0.2.5-3.el8.x86_64.rpm https://github.com/Mirantis/cri-dockerd/releases/download/v0.2.5/cri-dockerd-0.2.5-3.el8.x86_64.rpm # ç§»å‹•åŸ·è¡Œæª”æ¡ˆ sudo mv cri-dockerd/cri-dockerd /usr/local/bin/cri-dockerd # æ¸…æ‰è§£å£“ç¸®æ™‚å¤šå‡ºä¾†çš„è³‡æ–™å¤¾ sudo rm -rf cri-dockerd # ç¢ºèªæœ‰æ²’æœ‰å®‰è£æˆåŠŸ cri-dockerd --version cri-dockerd 0.2.0 (HEAD) curl -L -o cri-docker.service https://raw.githubusercontent.com/Mirantis/cri-dockerd/master/packaging/systemd/cri-docker.service curl -L -o cri-docker.socket https://raw.githubusercontent.com/Mirantis/cri-dockerd/master/packaging/systemd/cri-docker.socket sudo mv cri-docker.socket cri-docker.service /etc/systemd/system/ sudo sed -i -e 's,/usr/bin/cri-dockerd,/usr/local/bin/cri-dockerd,' /etc/systemd/system/cri-docker.service ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#install-and-configure"},{"categories":["Kubernetes"],"content":" 3 enable Cri-docker.service / socket bash sudo systemctl daemon-reload sudo systemctl enable cri-docker.service sudo systemctl enable --now cri-docker.socket ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:3:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#enable-cri-dockerservice--socket"},{"categories":["Kubernetes"],"content":" Network Settingref: å®˜æ–¹æ–‡ä»¶ bash cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF sudo modprobe overlay sudo modprobe br_netfilter # sysctl params required by setup, params persist across reboots cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF # Apply sysctl params without reboot sudo sysctl --system ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#network-setting"},{"categories":["Kubernetes"],"content":" Disable Swapåƒè€ƒæ–‡ä»¶ æš«æ™‚é—œé–‰ ```bash sudo swapoff -a ``` è­¦å‘Š æ­¤å‘½ä»¤åƒ…æ˜¯æš«æ™‚æ€§é—œé–‰ï¼Œserver é‡é–‹å¾Œä»æœƒå•Ÿç”¨ swapï¼Œå› æ­¤éœ€è¦æ­é…ä¸‹ä¸€ç¯€çš„è¨­å®šä¾†å®Œå…¨é—œé–‰ swap æ°¸ä¹…é—œé–‰ swap è¨»è§£æ‰ä»¥ä¸‹å‘½ä»¤é–‹å•Ÿçš„æª”æ¡ˆä¸­ï¼Œå«æœ‰ swap å­—æ¨£çš„è¡Œæ¬¡ bash sudo vim /etc/fstab ç”¨ vim é–‹å•Ÿ /etc/sysctl.conf æª”æ¡ˆï¼Œä¸¦åŠ å…¥ vm.swappiness=0 æœ‰æ™‚å€™æ²’æœ‰è¨­å®šæ­¤è¡Œä¹Ÿå¯ä»¥æ­£å¸¸é‹è¡Œï¼Œä½†å¦‚æœå¯ä»¥çš„è©±ï¼Œé—œæ‰ä¹Ÿè¨±æ¯”è¼ƒå¥½ æ–°ä¸»æ©Ÿè¨­å®šå¾Œæ­¤æª”æ¡ˆæ‡‰è©²æœƒé•·é€™æ¨£ conf # sysctl settings are defined through files in # /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/. # # Vendors settings live in /usr/lib/sysctl.d/. # To override a whole file, create a new file with the same in # /etc/sysctl.d/ and put new settings there. To override # only specific settings, add a file with a lexically later # name in /etc/sysctl.d/ and put new settings there. # # For more information, see sysctl.conf(5) and sysctl.d(5). vm.swappiness=0 ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#disable-swap"},{"categories":["Kubernetes"],"content":" Kubernetes CLI \u0026 SELinux Setref: å®˜æ–¹æ–‡ä»¶ bash cat \u003c\u003cEOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF # Set SELinux in permissive mode (effectively disabling it) sudo setenforce 0 sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes sudo systemctl enable --now kubelet è³‡è¨Š å…ˆå‰èˆŠçš„å‘½ä»¤æœƒæœ‰ repo_gpgcheck çš„å•é¡Œï¼Œåœ¨æ’°æ–‡ç•¶ä¸‹ (2022/09/12) å·²è¢«ä¿®æ­£ è‹¥ä»æœ‰ç›¸é—œå•é¡Œçš„è©±ï¼Œè«‹åƒè€ƒå®˜æ–¹èªªæ˜ text If the baseurl fails because your Red Hat-based distribution cannot interpret basearch, replace \\$basearch with your computer's architecture. Type uname -m to see that value. For example, the baseurl URL for x86_64 could be: https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64. å®‰è£å®Œç•¢å¾Œå¯çœ‹åˆ°å®‰è£äº†å·²ä¸‹å¥—ä»¶ bash Installed: kubeadm.x86_64 0:1.25.0-0 kubectl.x86_64 0:1.25.0-0 kubelet.x86_64 0:1.25.0-0 Dependency Installed: conntrack-tools.x86_64 0:1.4.4-7.el7 cri-tools.x86_64 0:1.24.2-0 kubernetes-cni.x86_64 0:0.8.7-0 libnetfilter_cthelper.x86_64 0:1.0.0-11.el7 libnetfilter_cttimeout.x86_64 0:1.0.0-7.el7 libnetfilter_queue.x86_64 0:1.0.2-2.el7_2 socat.x86_64 0:1.7.3.2-2.el7 Complete! ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#kubernetes-cli--selinux-set"},{"categories":["Kubernetes"],"content":" kubernetes cluster init / join command (use kubeadm) è³‡è¨Š æˆ‘åœ¨å…¬å¸ç’°å¢ƒçš„ä¸»æ©Ÿä¸Šä¸¦æœªè¨­å®š cri-socket çš„åƒæ•¸ï¼Œä¸ç¢ºå®šæ˜¯ä¸æ˜¯å› ç‚ºå…¬å¸ç’°å¢ƒçš„ docker ç‰ˆæœ¬æ˜¯å¡åœ¨ 18.6.1 çš„é—œä¿‚ å› ç‚ºå®‰è£ docker çš„æ™‚å€™åŒæ™‚æœƒè£ containerdï¼Œæ‰€ä»¥ kubeadm æœƒå› ç‚ºä¸»æ©Ÿå…§æœ‰å…©å€‹å®¹å™¨åŸ·è¡Œæœå‹™è€Œç„¡æ³•å•Ÿå‹•ï¼Œé€™æ™‚å¯ä»¥ä½¿ç”¨ --cri-socket åƒæ•¸ä¾†æŒ‡å®šè¦ä½¿ç”¨å“ªä¸€å€‹å®¹å™¨æœå‹™ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¨­å®š kubeadm çš„ç’°å¢ƒæª”æ¡ˆä¾†èª¿æ•´ã€‚ è·Ÿ kubeadm ç›¸é—œçš„å‘½ä»¤éƒ½éœ€è¦åŠ å…¥æ­¤åƒæ•¸æ‰èƒ½ä½œç”¨ é å…ˆæ‹‰å–éœ€è¦çš„ Image bash kubeadm config images pull --cri-socket unix:///var/run/cri-dockerd.sock å»ºç«‹ kubernetes cluster bash kubeadm init --cri-socket unix:///var/run/cri-dockerd.sock # æŒ‡å®š control-plane-endpoint kubeadm init --control-plane-endpoint=\u003ccontrol-plane-endpoint-domain\u003e \\ --upload-certs \\ --cri-socket unix:///var/run/cri-dockerd.sock reset kubernetes cluster bash kubeadm reset --cri-socket unix:///var/run/cri-dockerd.sock # æ¸…é™¤è³‡æ–™ rm -rf /etc/cni/net.d # é‡è¨­ ip table iptables -F \u0026\u0026 iptables -t nat -F \u0026\u0026 iptables -t mangle -F \u0026\u0026 iptables -X join kubernetes cluster bash kubeadm join \u003ccontrol-endpoint\u003e:6443 --token \u003ctoken\u003e \\ --discovery-token-ca-cert-hash sha256:\u003chash\u003e \\ --cri-socket unix:///var/run/cri-dockerd.sock ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#kubernetes-cluster-init--join-command-use-kubeadm"},{"categories":["Kubernetes"],"content":" Other Setting","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#other-setting"},{"categories":["Kubernetes"],"content":" 1 Master nodeMaster Node åœ¨ kubeadm join / init çµæŸä¹‹å¾Œï¼Œå¯ä»¥è€ƒæ…®å°‡ kubeconfig æª”æ¡ˆè¨­å®šåœ¨ bash_profile è£¡é¢ bash export KUBECONFIG=/etc/kubernetes/admin.conf vi .bash_profile .bash_profile çš„è¨­å®š config # .bash_profile # Get the aliases and functions if [ -f ~/.bashrc ]; then . ~/.bashrc fi # User specific environment and startup programs PATH=$PATH:$HOME/bin export PATH export KUBECONFIG=/etc/kubernetes/admin.conf ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:1:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#master-node"},{"categories":["Kubernetes"],"content":" 2 Weave net CNIå¦‚æœæ˜¯æ­£åœ¨å»ºç«‹å¢é›†ï¼Œå°±æœƒéœ€è¦å¦å¤–å®‰è£ CNI ( Container Network Interface )ï¼Œé€™é‚Šæ¡ç”¨ Weave net CNI ç›´æ¥å®‰è£ weave net doc - install bash kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" å¦‚æœè¦ç‰¹åˆ¥èª¿æ•´ç¶²æ®µ bash kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\u0026env.IPALLOC_RANGE=172.30.0.0/16\" æ¸…é™¤å®‰è£ bash kubectl delete -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:2:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#weave-net-cni"},{"categories":["Kubernetes"],"content":" ç¶²æ®µè³‡æ–™åƒè€ƒå…¨é è¨­ docker + weave-net cni çš„ kubernetes cluster ç¶²æ®µ Used For Subnet Genmask Start End Kubernetes Pod Subnet (Weave-cni) 10.32.0.0/12 255.240.0.0 10.32.0.1 10.47.255.254 Kubernetes Service Subnet 10.105.0.0/12 255.240.0.0 10.105.0.1 10.111.255.254 Docker (default bridge) 172.17.0.0/16 255.255.0.0 172.17.0.1 172.17.255.254 Docker (custom bridge) 172.18.0.0/16 255.255.0.0 172.18.0.1 172.18.255.254 è³‡è¨Š åœ¨ docker ä¸­å¦å¤–å»ºç«‹çš„ bridge ç¶²æ®µé è¨­æ˜¯ç¬¬äºŒæ®µä¾åº +1ï¼Œæ¥µé™æ•¸å€¼ç¯„åœç‚º 172.16.0.1 - 172.31.255.254 å³ subnet pool = 172.17.0.0/12 subnet size = 16 æ•¸å€¼ä¾†æºåƒè€ƒ ","date":"2022-09-13","objectID":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/:0:0","series":["kubernetes-install-memo"],"tags":["Install"],"title":"Kubernetes ç’°å¢ƒæº–å‚™ - centos7 \u0026 docker","uri":"/2022/09/kubernetes-node-prepare-for-centos7-with-docker/#ç¶²æ®µè³‡æ–™åƒè€ƒ"},{"categories":["Kubernetes","Installation"],"content":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","date":"2022-06-11","objectID":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","uri":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/"},{"categories":["Kubernetes","Installation"],"content":"ç”±æ–¼ kubernetes åœ¨ 1.24 ç‰ˆä¹‹å¾Œå·²ä¸é è¨­æ”¯æ´ Docker ( kubernetes 1.24 release page )ï¼Œæ‰€ä»¥ç…§åŸæœ¬çš„å®‰è£æ–¹å¼çš„è©±ï¼Œåœ¨å»ºç«‹å¢é›†æ™‚æœƒå‡ºç¾éŒ¯èª¤ã€‚ ä½†æ˜¯å› ç‚ºåŸæœ¬çš„ä½œæ³•åœ¨å®‰è£ Docker æ™‚å·²ç¶“æœ‰å®‰è£å…¶ä»– kubernetes æœ‰æ”¯æ´çš„å®¹å™¨å¥—ä»¶ containerdï¼Œæ‰€ä»¥é€™ç¯‡ä¸»è¦ç´€éŒ„å¦‚ä½•å»è¨­å®š containerd ä¾†ä½œç‚º Docker çš„æ›¿ä»£å“ï¼Œä¸¦ç´€éŒ„ä¸€äº›è·ŸåŸå…ˆçš„å®‰è£åƒæ•¸ä¸ä¸€æ¨£çš„åœ°æ–¹ã€‚ ç›¸é—œå…§å®¹å·²æ›´æ–°è‡³ Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™~ è³‡è¨Š OS: CentOs 7 (kernel = 3.10.1) K8s: v1.24.1 (æ–°å®‰è£æ™‚é è¨­ä½¿ç”¨ç•¶ä¸‹çš„æœ€æ–°ç‰ˆï¼Œå› æ­¤æ­¤ç‰ˆæœ¬è³‡è¨Šåƒè€ƒç”¨) ","date":"2022-06-11","objectID":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/:0:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","uri":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/#"},{"categories":["Kubernetes","Installation"],"content":" 6 iptable æ©‹æ¥è¨­å®šè®ŠåŒ–ä¾†åˆ° 1.24 ä¹‹å¾Œï¼Œç¬¬ä¸€å€‹ä¸ä¸€æ¨£çš„ç’°å¢ƒè¨­å®šèˆŠè­˜ iptable çš„è¨­å®šåƒæ•¸ï¼ŒåŸæœ¬èˆŠç‰ˆæ˜¯ bash cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sudo sysctl --system ç¾åœ¨æ–°ç‰ˆè¦æ”¹æˆé€™æ¨£ bash cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF sudo modprobe overlay sudo modprobe br_netfilter # sysctl params required by setup, params persist across reboots cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF # Apply sysctl params without reboot sudo sysctl --system ","date":"2022-06-11","objectID":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/:1:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","uri":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/#iptable-æ©‹æ¥è¨­å®šè®ŠåŒ–"},{"categories":["Kubernetes","Installation"],"content":" 7 containerdåœ¨åŸæœ¬çš„ç’°å¢ƒæº–å‚™æ–¹å¼ä¸­ï¼Œå¯ä»¥ç™¼ç¾å®‰è£ docker çš„æ™‚å€™å…¶å¯¦æœ‰å¦å¤–è£ä¸€å€‹å«åš containerd.io çš„æ±è¥¿ï¼Œå…¶å¯¦é€™æ˜¯æ ¸å¿ƒçš„å®¹å™¨åŸ·è¡Œå…ƒä»¶ï¼Œè©³ç´°æŠ€è¡“ç´°ç¯€æˆ‘é€™é‚Šå°±ä¸èªªäº†ï¼Œå°å¼Ÿæˆ‘æ‰ç–å­¸æ·ºï¼Œç›´æ¥çœ‹æŠ€è¡“æ–‡ä»¶ä¸€å®šæ¯”æˆ‘é€™ç¯‡ç­†è¨˜ä¾†çš„è©³ç´°ã€‚ è€Œ 1.24 ç‰ˆæœ¬çš„ kubernetes é›–ç„¶æ‹”æ‰äº† docker åŸç”Ÿæ”¯æ´ï¼Œä½†æ˜¯å…¶å¯¦ kubernetes ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ containerd ä¾†æ“ä½œå®¹å™¨çš„ (åŸæœ¬çš„æ“å®‰è£æ–¹å¼æ¯”è¼ƒåƒæ˜¯è—‰ç”± docker å»æ“ä½œ containerd)ã€‚æ‰€ä»¥ï¼Œæˆ‘å€‘ç¾åœ¨åœ¨å·²ç¶“æœ‰å®‰è£ç›¸é—œå¥—ä»¶çš„ç‹€æ³ä¸‹ï¼Œåªè¦æ‰¾åˆ°æ–¹å¼è®“ kubernetes æ”¹ç”¨ containerd ä¾†é‹ä½œå°±è¡Œäº†~ æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘å°±æ˜¯è¦é–‹å§‹è¨­å®š containerd çš„ç›¸é—œåƒæ•¸ (å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶) ","date":"2022-06-11","objectID":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/:2:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","uri":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/#containerd"},{"categories":["Kubernetes","Installation"],"content":" 7.1 è®Šæ›´ configpath: /etc/containerd/config.toml å› ç‚ºä½¿ç”¨ yum å®‰è£ containerd æ™‚çš„é è¨­è¨­å®šæª”é•·é€™æ¨£ (å·²å¿½ç•¥è¨»è§£é …ç›®) toml disabled_plugins = [\"cri\"] æˆ‘å€‘éœ€è¦æŠŠ disabled_plugins è£¡é¢çš„ cri ç§»é™¤ï¼Œä¸¦åŠ å…¥ systemd çš„ç›¸é—œæ§åˆ¶ï¼Œæ‰€ä»¥è¨­å®šæª”æœƒè®Šæˆé€™æ¨£ toml disabled_plugins = [] [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc] [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options] SystemdCgroup = true è­¦å‘Š é€™å€‹è¨­å®šæª”å»ºè­°ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”¨ containerd å…§éƒ¨çš„é è¨­è¨­å®šæª”è¦†è“‹å¾Œå†å»èª¿æ•´ SystemdCgroup=true å› ç‚ºæˆ‘ä¸€é–‹å§‹ä½¿ç”¨ä¸Šé¢çš„è¨­å®šçš„æ™‚å€™æœ‰ç™¼ç”Ÿ CoreDNS èµ·ä¸ä¾†çš„å•é¡Œï¼Œä¹‹å¾Œå°±å¥½äº†ï¼Œä¹Ÿè¨±å¯ä»¥è©•ä¼°ä¸€ä¸‹è¦ä¸è¦æ›ç”¨é è¨­è¨­å®šæª”å»æ”¹ã€‚ bash # è¼¸å‡º containerd çš„é è¨­è¨­å®šæª”å‡ºä¾† containerd config default | tee /etc/containerd/config.toml # ç·¨è¼¯è©²è¨­å®šæª” vi /etc/containerd/config.toml # é è¨­è¨­å®šçš„çš„ SystemdCgroup è¨­å®šç‚º falseï¼Œæ”¹æˆ true å°±å¯ä»¥äº† ç„¶å¾Œå•Ÿå‹• (é‡å•Ÿ) containerd bash sudo systemctl daemon-reload sudo systemctl enable --now containerd # å¦‚æœå·²ç¶“æœ‰è¨­å®šå•Ÿç”¨ containerd çš„è©±å°±è¦ç”¨é€™å€‹ sudo systemctl restart containerd ","date":"2022-06-11","objectID":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/:2:1","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","uri":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/#è®Šæ›´-config"},{"categories":["Kubernetes","Installation"],"content":" 7.2 crictl è¨­å®šèª¿æ•´é€™å€‹è¨­å®šæª”ä¸€é–‹å§‹ä¸å­˜åœ¨ï¼Œéœ€è¦è‡ªå·±å»ºç«‹ä¸¦å¯«å…¥ä»¥ä¸‹å…§å®¹ bash vi /etc/crictl.yaml yaml å…§å®¹å¦‚ä¸‹ yaml runtime-endpoint: unix:///run/containerd/containerd.sock image-endpoint: unix:///run/containerd/containerd.sock timeout: 10 debug: false ","date":"2022-06-11","objectID":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/:2:2","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","uri":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/#crictl-è¨­å®šèª¿æ•´"},{"categories":["Kubernetes","Installation"],"content":" 8 Single Node SettingKubernetes 1.24 ä¹‹å¾Œçš„ single node è¨­å®šä¹Ÿæœ‰èª¿æ•´ èˆŠçš„å‘½ä»¤åªè¦é€™æ¨£ä¸‹å°±å¯ä»¥äº† bash kubectl taint nodes --all node-role.kubernetes.io/master- æ–°çš„è¦é€™æ¨£ä¸‹ bash # kubernetes 1.24 è¦æ”¹ç”¨é€™å€‹ kubectl taint nodes --all node-role.kubernetes.io/control-plane- node-role.kubernetes.io/master- ","date":"2022-06-11","objectID":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/:3:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","uri":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/#single-node-setting"},{"categories":["Kubernetes","Installation"],"content":" 9 å¾…æ¸¬è©¦ã€è§£æ±ºå•é¡Œ åŒæ™‚åŸ·è¡Œ docker \u0026 containerd (å¦‚æœé‚„æƒ³è¦ä½¿ç”¨ docker çš„è©±ï¼Œæˆ‘ä¸ç¢ºå®šæ˜¯å¦å¯ä»¥ä¸¦è¡Œï¼Œç†è«–ä¸Šæ˜¯å¯ä»¥ï¼Œå› ç‚º docker ä¹Ÿæ˜¯ä½¿ç”¨ containerd ä¾†è™•ç†å®¹å™¨çš„) ","date":"2022-06-11","objectID":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/:4:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","uri":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/#å¾…æ¸¬è©¦è§£æ±ºå•é¡Œ"},{"categories":["Kubernetes","Installation"],"content":" 10 åƒè€ƒè³‡æ–™ å®Œæ•´çš„ kubernetes 1.24 å®‰è£æ–¹å¼ - ä¸­æ–‡ æ­¤ç¶²é  æˆ‘æœ‰åƒè€ƒé€™é‚Šä¾†ç¢ºèªè‡ªå·±çš„å®‰è£æ–¹å¼æœ‰ç¼ºä»€éº¼æ±è¥¿ å¦å¤–ä¸€ç¯‡å®‰è£ kubernetes 1.24 \u0026 ä½¿ç”¨ CentOs çš„ Blog åˆ¥äººæ•´ç†çš„ kubeadm 1.24 ç‰ˆä½¿ç”¨ docker çš„å®‰è£æ–¹å¼åœ¨ æ­¤ç¶²é  æœ‰äº›è¨­å®šè·Ÿæˆ‘ä¸ä¸€æ¨£ï¼Œè€Œä¸”é€™ç¯‡ä½¿ç”¨çš„ OS æ˜¯ CentOs 8ï¼Œæˆ‘æ˜¯ç”¨ 7 å¦å¤–ï¼Œç”±æ–¼æˆ‘æ”¹ä½¿ç”¨ containerd ä¾†åšç‚º kubernetes çš„å®¹å™¨åŸ·è¡Œå·¥å…·ï¼Œæ‰€ä»¥é€™ç¯‡ä½¿ç”¨ docker çš„ä½œæ³•ä¹Ÿåƒ…ä½œç‚ºåƒè€ƒ ","date":"2022-06-11","objectID":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/:5:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes 1.24 ç‰ˆæœ¬ç’°å¢ƒè¨­å®šé‡é»","uri":"/2022/06/kubernetes-1.24-%E7%89%88%E6%9C%AC%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A%E9%87%8D%E9%BB%9E/#åƒè€ƒè³‡æ–™"},{"categories":["ArgoCD"],"content":"ArgoCD install use kustomizaion","date":"2022-05-31","objectID":"/2022/05/argocd-install/","series":null,"tags":["Install"],"title":"ArgoCD install use kustomizaion","uri":"/2022/05/argocd-install/"},{"categories":["ArgoCD"],"content":"ä½¿ç”¨ kustomization å®‰è£ ArgoCDï¼Œä¸¦ä¸”åˆ©ç”¨ patch ä¾†åŠ å…¥ istio æ‰€éœ€è¦çš„ Labelã€‚ æ­¤ç¯‡æ–‡æ‰€ä½¿ç”¨çš„å®‰è£è¨­å®šæª”é€£çµï¼šGithub ","date":"2022-05-31","objectID":"/2022/05/argocd-install/:0:0","series":null,"tags":["Install"],"title":"ArgoCD install use kustomizaion","uri":"/2022/05/argocd-install/#"},{"categories":["ArgoCD"],"content":" ArgoCD Memoè¨­å®šæª”ä¸­ä¹ŸåŒ…å«äº† --insecure åŸ·è¡Œåƒæ•¸ï¼Œä»¥ä¾¿ä½¿ç”¨ http é€£ç·š æ­¤å®šç¾©æª”ä¸»è¦å¢åŠ  Kubernetes çš„ Label è¨­å®š (app, version)ï¼Œè®“ Istio å¯æ­£å¸¸å­˜å– ç‚ºäº†æ–¹ä¾¿ä»¥å¾Œçš„æ›´æ–°ï¼Œæœ‰ç‰¹åˆ¥å°‡å„ç¨®ä¸åŒé¡å‹çš„ patch è¨­å®šæª”åˆ‡å‰²å‡ºä¾† å®‰è£æª”æ¡ˆèªªæ˜ æª”æ¡ˆ èªªæ˜ Kustomiztion.yaml kustomiztion å®šç¾©æª” install-2.3.4.yaml argocd å®˜æ–¹ 2.3.4 ç‰ˆæœ¬å®‰è£æª” VirtualService.yaml Istio æ‰€éœ€çš„ VirtualService æœå‹™å®‰è£æª” Gateway.yaml Istio æ‰€éœ€çš„ Gateway æœå‹™å®‰è£æª” (ä¸æ˜¯ IngressGateway) istio_patches_deployment.yaml argocd å®˜æ–¹ç‰ˆæœ¬å®‰è£æª”çš„è¦†è“‹åƒæ•¸ï¼Œå¢åŠ  Istio æ‰€éœ€çš„ Label å®šç¾© istio_patches_service.yaml argocd å®˜æ–¹ç‰ˆæœ¬å®‰è£æª”çš„è¦†è“‹åƒæ•¸ï¼Œå¢åŠ  Istio æ‰€éœ€çš„ Label å®šç¾© istio_patches_statefulset.yaml argocd å®˜æ–¹ç‰ˆæœ¬å®‰è£æª”çš„è¦†è“‹åƒæ•¸ï¼Œå¢åŠ  Istio æ‰€éœ€çš„ Label å®šç¾© ","date":"2022-05-31","objectID":"/2022/05/argocd-install/:0:0","series":null,"tags":["Install"],"title":"ArgoCD install use kustomizaion","uri":"/2022/05/argocd-install/#argocd-memo"},{"categories":["ArgoCD"],"content":" 0.4 å®‰è£æª”æº–å‚™ download install yaml (option) æŒ‡å®šç‰ˆæœ¬ bash= curl -sSL https://raw.githubusercontent.com/argoproj/argo-cd/v2.3.4/manifests/install.yaml -o install-2.3.4.yaml æœ€æ–°ç‰ˆæœ¬ bash= curl -sSL https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml -o install-latest.yaml å»ºç«‹ namespace ç´”å»ºç«‹ bash= kubectl create namespace argocd å«è¨­å®š istio æ›è»Š bash= kubectl create namespace argocd kubectl label namespace argocd istio-injection=enabled --overwrite # å¦‚æœå®‰è£ istio çš„æ™‚å€™æ˜¯ç‰¹åˆ¥è¨­å®šç‰ˆæœ¬çš„è©± (é€šå¸¸å‡ºç¾åœ¨æœ‰ä½¿ç”¨é‡‘çµ²é›€éƒ¨ç½²ä¾†æ›´æ–° istio çš„ç‹€æ³) # å¦‚æœå·²ç¶“æœ‰è¨­å®šæ›è»Šçš„è©±ï¼Œå¯ä»¥ç”¨é€™æ–¹å¼åˆªæ‰èˆŠçš„åŒæ™‚è¨­å®šæ–°çš„ #kubectl label namespace argocd istio-injection- istio.io/rev=1-13-3 kubectl label namespace argocd istio.io/rev=1-13-3 ","date":"2022-05-31","objectID":"/2022/05/argocd-install/:0:1","series":null,"tags":["Install"],"title":"ArgoCD install use kustomizaion","uri":"/2022/05/argocd-install/#å®‰è£æª”æº–å‚™"},{"categories":["ArgoCD"],"content":" 0.5 When Upgrade å‡ç´šå¾Œä¸æœƒæ›´æ–°è¨­å®šæª”ï¼Œå› æ­¤åŸå§‹çš„å¯†ç¢¼èˆ‡è¨­å®šéƒ½ç›¸åŒ å¯ä»¥å…ˆç”¨ä»¥ä¸‹å‘½ä»¤æª¢æŸ¥å·®ç•° (cmd ä½ç½®è¦å…ˆåˆ° argocd kustomiztion çš„ä½ç½®) bash= # æŸ¥çœ‹å·®ç•° kubectl diff -k ./ # å°‡å·®ç•°è³‡æ–™è¼¸å‡ºåˆ°ç‰¹å®šæª”æ¡ˆ kubectl diff -k ./ \u003e different-data.txt # æ¸¬è©¦åŸ·è¡Œä¸¦è¼¸å‡ºçµæœ kubectl apply -k ./ --dry-run=client \u003e dry-run.txt ","date":"2022-05-31","objectID":"/2022/05/argocd-install/:0:2","series":null,"tags":["Install"],"title":"ArgoCD install use kustomizaion","uri":"/2022/05/argocd-install/#when-upgrade"},{"categories":["ArgoCD"],"content":" 0.6 Install text kubectl apply -k ./ ","date":"2022-05-31","objectID":"/2022/05/argocd-install/:0:3","series":null,"tags":["Install"],"title":"ArgoCD install use kustomizaion","uri":"/2022/05/argocd-install/#install"},{"categories":["Istio"],"content":"Istio è¨­å®š http request header ä¾†è®“å…§éƒ¨å®¹å™¨ä½¿ç”¨ https","date":"2022-04-12","objectID":"/2022/04/istio-%E8%A8%AD%E5%AE%9A-http-request-header-%E4%BE%86%E8%AE%93%E5%85%A7%E9%83%A8%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8-https/","series":[],"tags":["Istio","service-mesh","Troubleshooting"],"title":"Istio è¨­å®š http request header ä¾†è®“å…§éƒ¨å®¹å™¨ä½¿ç”¨ https","uri":"/2022/04/istio-%E8%A8%AD%E5%AE%9A-http-request-header-%E4%BE%86%E8%AE%93%E5%85%A7%E9%83%A8%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8-https/"},{"categories":["Istio"],"content":"ç•¶ç¶²è·¯æ¶æ§‹åœ¨ä»¥ä¸‹ç‹€æ³æ™‚ text Client (get `https://my.domain.com`) -\u003e LB (A10) -\u003e Istio Ingress (TLS Terminating) -\u003e Service (http request schema is http) ç”±æ–¼ Service ç«¯æ”¶åˆ°çš„ Http Request ä¸­çš„å”å®šå¯èƒ½å› ç‚ºæ†‘è­‰ç®¡ç†çš„æ–¹å¼æˆ–å…¶ä»–åŸå› ï¼Œæ˜¯æœƒè¢« A10 æˆ–æ˜¯ Istio Ingress çµ¦éæ¿¾æ‰çš„ã€‚ åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œå¯èƒ½æœƒå°è‡´å®šç¾©åœ¨æœå‹™å…§çš„ä¸€äº›æœå‹™å‡ºç¾éŒ¯èª¤ï¼›æˆ‘å¯¦å‹™ä¸Šç¢°åˆ°çš„æ¡ˆä¾‹æ˜¯ OAuth OpenIdConnect çš„ Redirect Url åœ¨ .Net 6 è£¡é¢å…¶å¯¦æ˜¯ç„¡æ³•å¼·åˆ¶è¤‡å¯«æˆ https çš„ï¼ŒåŠ ä¸Š A10 é‚£ç«¯æœ‰è¢«è¨­å®šå¼·è½‰ï¼Œä½¿ç”¨ http çš„ç¶²å€ä¸¦ä¸æœƒé€šï¼Œé€™æ™‚å€™å°±æœƒå‡ºç¾éŒ¯èª¤ã€‚ ä»¥ä¸‹æä¾›åœ¨ Istio ä¸­çš„è§£æ±ºæ–¹å¼ï¼Œæ–‡ç« æœ«ç«¯ä¹Ÿæœ‰ä¸€äº›æˆ‘è¦ºå¾—å¯èƒ½æœ‰å¹«åŠ©çš„ä¸€äº›è³‡æ–™ä¾†æºè®“å¤§å®¶åƒè€ƒã€‚ å‰é¢æœ‰æåˆ°ï¼Œæˆ‘è‡ªå·±ç¢°åˆ°çš„ç‹€æ³å¦‚ä¸‹ ç”±æ–¼æ†‘è­‰æ˜¯è¨­å®šåœ¨ LB (A10) ä¸Šé¢çš„ï¼Œç•¶ http request ç¶“é LB ä¹‹å¾Œå°±æ˜¯ä¸€å¾‹ä½¿ç”¨ http (non SSL) å”å®šé€²è¡Œé€£ç·šï¼Œé€™å°è‡´ Istio Ingress æ°¸é åªæœƒæ”¶åˆ° http://my.domain.com é€™æ¨£çš„é https ç¶²å€ï¼Œå†å¾€ä¸‹é€²å…¥æœå‹™å¾Œï¼Œ.Net æœå‹™æ‰€æ”¶åˆ°çš„è¦æ±‚æ›´åªæœƒé€²å…¥ 80 portã€‚ è€Œç”±æ–¼æˆ‘å…¬å¸ä½¿ç”¨ OAuth 2.0 Code Flowï¼Œåœ¨ä½¿ç”¨ OpenIdConnect è¨­å®šé€£ç·šæ™‚ï¼Œå¾®è»Ÿå¥—ä»¶æ˜¯ç„¡æ³•ç›´æ¥ä¿®æ”¹æ•´æ®µ Redirect Url çš„ï¼›å„˜ç®¡ä¿®æ”¹äº†ï¼Œåœ¨é€™æ¨£çš„æ¶æ§‹ä¸‹ä¹Ÿæœƒèªè­‰å¤±æ•—ã€‚ åœ¨ç¶“éå¹¾å¤©çš„æœå°‹å¾Œæ‰¾åˆ°æ¢æœ‰ç”¨çš„ github issue istio github issue ç™¼ç¾åªè¦åœ¨ http header ä¸ŠåŠ å…¥ x-forwarded-proto: https ä¹‹å¾Œï¼ŒOpenIdConnect çš„å¥—ä»¶å°±æœƒä½¿ç”¨ https å»è¨­å®š redirect urlï¼ ç¨åšèª¿æ•´å¾Œçš„ Istio Virtual Service yaml å¦‚ä¸‹ (å…¶ä»–å¿…è¦è³‡æ–™è«‹è‡ªè¡Œèª¿æ•´) yaml apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: -- labels: app.kubernetes.io/name: -- app.kubernetes.io/part-of: -- namespace: -- spec: gateways: - istioGateway hosts: - host.example.com http: - headers: request: set: x-forwarded-proto: https match: - uri: prefix: / route: - destination: host: service-name.namespace.svc.cluster.local subset: v1 port: number: 8080 retries: attempts: 3 perTryTimeout: 10s timeout: 30s è¨­å®šå¥½ä¹‹å¾Œæœç„¶ OAuth å°±é€šäº†ï¼å¯å–œå¯è³€~ å¯å£å¯æ¨‚~~ å…¶ä»–éç¨‹ä¸­æŸ¥åˆ°çš„è¦ºå¾—å¯èƒ½æœ‰å¹«åŠ©çš„è³‡æ–™å¦‚ä¸‹ istio-doc å…¶å®ƒç›¸é—œè¨­å®šçš„ istio doc é é¢ istio doc - show source ip nginx è¨­å®šåƒè€ƒ (å°šæœªé©—è­‰) å¾®è»Ÿçš„ç›¸é—œèªªæ˜-.netcore 3.1 (åƒè€ƒç”¨) å¾®è»Ÿçš„ç›¸é—œèªªæ˜-.net 6 (åƒè€ƒç”¨) ç›´æ¥å¾ C# æœå‹™ä¸­ç”¨ç¨‹å¼ç¢¼è¨­å®šçš„åšæ³• (å°šæœªé©—è­‰) ===== æœªä¾†æ˜¯å¸Œæœ›å¯ä»¥å°‡èº«åˆ†èªè­‰ç­‰åŠŸèƒ½å…¨æ•¸ç§»å¾€ istio / kubernetes ä¸Šçš„ resource ä¸Šè¨­å®šï¼Œé™ä½è»Ÿé«”ä¸­å°é€™äº›ç¶²è·¯è¨­å®šçš„å€šè³´ï¼Œé€™æ„Ÿè¦ºæ‰æœ‰ç”¨åˆ° istio çš„åŠŸèƒ½ï¼Œä¸ç„¶æˆ‘éƒ½ä¸çŸ¥é“æˆ‘ç‚ºä»€éº¼è¦ä½¿ç”¨ istio äº†ã€‚ ","date":"2022-04-12","objectID":"/2022/04/istio-%E8%A8%AD%E5%AE%9A-http-request-header-%E4%BE%86%E8%AE%93%E5%85%A7%E9%83%A8%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8-https/:0:0","series":[],"tags":["Istio","service-mesh","Troubleshooting"],"title":"Istio è¨­å®š http request header ä¾†è®“å…§éƒ¨å®¹å™¨ä½¿ç”¨ https","uri":"/2022/04/istio-%E8%A8%AD%E5%AE%9A-http-request-header-%E4%BE%86%E8%AE%93%E5%85%A7%E9%83%A8%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8-https/#"},{"categories":["Istio"],"content":"Istio é™„å¸¶çš„ Plugin å®‰è£","date":"2022-04-10","objectID":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio é™„å¸¶çš„ Plugin å®‰è£","uri":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/"},{"categories":["Istio"],"content":"Istio å®˜æ–¹å®‰è£å¥—ä»¶é™„å¸¶çš„å¥—ä»¶å®‰è£æ–¹å¼ï¼ŒåŒ…å«å„æœå‹™çš„ Istio Ingress Gateway è¨­å®šæª”ã€‚ ","date":"2022-04-10","objectID":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio é™„å¸¶çš„ Plugin å®‰è£","uri":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/#"},{"categories":["Istio"],"content":" å®‰è£ Istio å®˜æ–¹å·¥å…·ä¸­é™„å¸¶çš„æœå‹™åŸ·è¡Œä»¥ä¸‹å‘½ä»¤æ™‚ï¼Œéœ€ç¢ºèªç›®å‰ bash æ‰€åœ¨ä½ç½®ç‚º istioctl å·¥å…·çš„è³‡æ–™å¤¾ä¸­ã€‚ å»ºè­°å®‰è£ prometheus èˆ‡ kiali å®‰è£å…¨éƒ¨ bash kubectl apply -f samples/addons å€‹åˆ¥å®‰è£ prometheus bash kubectl apply -f samples/addons/prometheus.yaml Kiali bash kubectl apply -f samples/addons/kiali.yaml Grafana bash kubectl apply -f samples/addons/grafana.yaml Jaeger bash kubectl apply -f samples/addons/jaeger.yaml Zipkin èˆ‡ jaeger ç‚ºåŒè³ªæœå‹™ï¼Œå‰‡ä¸€å®‰è£å³å¯ bash kubectl apply -f samples/addons/extras/zipkin.yaml Prometheus Operator bash kubectl apply -f samples/addons/extras/prometheus-operator.yaml ","date":"2022-04-10","objectID":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio é™„å¸¶çš„ Plugin å®‰è£","uri":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/#å®‰è£-istio-å®˜æ–¹å·¥å…·ä¸­é™„å¸¶çš„æœå‹™"},{"categories":["Istio"],"content":" å„å€‹å¥—ä»¶çš„ gateway è¨­å®š åƒè€ƒ : https://istio.io/latest/docs/tasks/observability/gateways/ prometheus (æ™®ç¾…ç±³ä¿®æ–¯) bash cat \u003c\u003cEOF | kubectl apply -f - apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: prometheus-gateway namespace: istio-system spec: selector: istio: ingressgateway servers: - port: number: 80 name: http-prom protocol: HTTP hosts: - \"prometheus.${INGRESS_DOMAIN}\" --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: prometheus-vs namespace: istio-system spec: hosts: - \"prometheus.${INGRESS_DOMAIN}\" gateways: - prometheus-gateway http: - route: - destination: host: prometheus port: number: 9090 --- apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: prometheus namespace: istio-system spec: host: prometheus trafficPolicy: tls: mode: DISABLE --- EOF Kiali bash cat \u003c\u003cEOF | kubectl apply -f - apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: kiali-gateway namespace: istio-system spec: selector: istio: ingressgateway servers: - port: number: 80 name: http-kiali protocol: HTTP hosts: - \"kiali.${INGRESS_DOMAIN}\" --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: kiali-vs namespace: istio-system spec: hosts: - \"kiali.${INGRESS_DOMAIN}\" gateways: - kiali-gateway http: - route: - destination: host: kiali port: number: 20001 --- apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: kiali namespace: istio-system spec: host: kiali trafficPolicy: tls: mode: DISABLE --- EOF Grafana bash cat \u003c\u003cEOF | kubectl apply -f - apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: grafana-gateway namespace: istio-system spec: selector: istio: ingressgateway servers: - port: number: 80 name: http-grafana protocol: HTTP hosts: - \"grafana.${INGRESS_DOMAIN}\" --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: grafana-vs namespace: istio-system spec: hosts: - \"grafana.${INGRESS_DOMAIN}\" gateways: - grafana-gateway http: - route: - destination: host: grafana port: number: 3000 --- apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: grafana namespace: istio-system spec: host: grafana trafficPolicy: tls: mode: DISABLE --- EOF è¿½è¹¤ (Jaeger/Zipkin) bash cat \u003c\u003cEOF | kubectl apply -f - apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: tracing-gateway namespace: istio-system spec: selector: istio: ingressgateway servers: - port: number: 80 name: http-tracing protocol: HTTP hosts: - \"tracing.${INGRESS_DOMAIN}\" --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: tracing-vs namespace: istio-system spec: hosts: - \"tracing.${INGRESS_DOMAIN}\" gateways: - tracing-gateway http: - route: - destination: host: tracing port: number: 80 --- apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: tracing namespace: istio-system spec: host: tracing trafficPolicy: tls: mode: DISABLE --- EOF ","date":"2022-04-10","objectID":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio é™„å¸¶çš„ Plugin å®‰è£","uri":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/#å„å€‹å¥—ä»¶çš„-gateway-è¨­å®š"},{"categories":["Istio"],"content":" è§£é™¤å®‰è£ bash kubectl -n istio-system delete gateway grafana-gateway kiali-gateway prometheus-gateway tracing-gateway kubectl -n istio-system delete virtualservice grafana-vs kiali-vs prometheus-vs tracing-vs kubectl -n istio-system delete destinationrule grafana kiali prometheus tracing ","date":"2022-04-10","objectID":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio é™„å¸¶çš„ Plugin å®‰è£","uri":"/2022/04/istio-%E9%99%84%E5%B8%B6%E7%9A%84-plugin-%E5%AE%89%E8%A3%9D/#è§£é™¤å®‰è£"},{"categories":["Kubernetes","Installation"],"content":"Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™","date":"2022-04-10","objectID":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™","uri":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/"},{"categories":["Kubernetes","Installation"],"content":"Kubernetes Master(Control-plane) / Worker çš„ Node ç’°å¢ƒæº–å‚™ è³‡è¨Š OS: CentOs 7 (kernel = 3.10.1) K8s: v1.24.1 (æ–°å®‰è£æ™‚é è¨­ä½¿ç”¨ç•¶ä¸‹çš„æœ€æ–°ç‰ˆï¼Œå› æ­¤æ­¤ç‰ˆæœ¬è³‡è¨Šåƒè€ƒç”¨) æ›´æ–°æ™‚é–“ï¼š 2022/06/11 - use containerd / ä¸ä½¿ç”¨ docker 2022/04/10 - kubelet kubeadm kubectl ç­‰å·¥å…·å®‰è£éŒ¯èª¤çš„è§£æ±ºæ–¹æ¡ˆ ","date":"2022-04-10","objectID":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/:0:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™","uri":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/#"},{"categories":["Kubernetes","Installation"],"content":" 6 Docker è­¦å‘Š åœ¨ kubernetes 1.24 ç‰ˆä¹‹å¾Œï¼Œç”±æ–¼è¢«æ‹”é™¤äº† docker æ”¯æ´ï¼Œæ‰€ä»¥é€™é‚Šè«‹è©•ä¼°æ˜¯å¦é‚„æœ‰ä½¿ç”¨ docker çš„éœ€è¦ä¾†é¸æ“‡å®‰è£ï¼Œä¸¦è«‹åƒè€ƒ containerd çš„è¨­å®šç« ç¯€ å®˜æ–¹æ–‡ä»¶ æ¸…é™¤èˆŠå®‰è£ bash sudo yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine sudo yum remove docker-ce docker-ce-cli containerd.io docker-compose-plugin æ›´æ–° yum ä»¥å®‰è£ docker bash sudo yum install -y yum-utils sudo yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo å®‰è£ docker-ce èˆ‡ä¾è³´å¥—ä»¶ bash sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin æŒ‡å®šç‰ˆæœ¬å®‰è£ åˆ—å‡ºå¯ç”¨çš„ç‰ˆæœ¬ bash sudo yum list docker-ce --showduplicates | sort -r å®‰è£æŒ‡å®šç‰ˆæœ¬ bash sudo yum install docker-ce-\u003cVERSION_STRING\u003e docker-ce-cli-\u003cVERSION_STRING\u003e containerd.io å•Ÿå‹• docker ä¸¦è¨­å®šé è¨­å•Ÿå‹• è­¦å‘Š åœ¨ kubernetes 1.24 ç‰ˆä¹‹å¾Œï¼Œç”±æ–¼è¢«æ‹”é™¤äº† docker æ”¯æ´ï¼Œæ‰€ä»¥é€™é‚Šå¯ä»¥ä¸ç”¨å•Ÿç”¨äº†ï¼Œä¸¦è«‹åƒè€ƒ containerd çš„è¨­å®šç« ç¯€ bash sudo systemctl start docker sudo systemctl enable docker Docker ç£ç¢Ÿç®¡ç†æ¨¡å¼ç¢ºèª ç¢ºèªç›®å‰ docker ç”¨çš„ç£ç¢Ÿç®¡ç†æ¨¡å¼ [2018 iThome éµäººè³½] Day 28 bash docker info è³‡è¨Š æ­£å¸¸ä¾†èªªé è¨­å®‰è£å¾Œå°±æœƒä½¿ç”¨ overlay2 çš„ç£ç¢Ÿç®¡ç†æ¨¡å¼ï¼Œè‹¥éæ­¤æ¨¡å¼ï¼Œå¯é…åˆä¸‹ä¸€ç¯€çš„ daemon.json è¨­å®šæª”ä¾†è®Šæ›´è¨­å®š Set daemon æ–°å®‰è£å°šæœªæœ‰ daemon.json æª”æ¡ˆæ™‚å¯ä½¿ç”¨ä»¥ä¸‹èªæ³•é€²è¡Œå»ºç«‹ bash sudo mkdir /etc/docker cat \u003c\u003cEOF | sudo tee /etc/docker/daemon.json { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\" }, \"storage-driver\": \"overlay2\" } EOF è³‡è¨Š æ­¤æ®µèªæ³•ä¾†æº å¦‚æœæœ‰æ›´æ›ä½¿ç”¨ç¶²æ®µçš„éœ€æ±‚å¯åƒè€ƒ æ­¤ç¯‡ ç·¨è¼¯ç¾æœ‰ daemon.json bash vim /etc/docker/daemon.json åŠ å…¥ cgroupdriver è¨­å®š å¯åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼š configuring a cgroup driver kubernetes - docker è³‡è¨Š ç”±æ–¼æ–°ç‰ˆçš„ kubernetes æ–‡ä»¶å°æ–¼ docker runtime çš„èªªæ˜ä¸­å·²æ‹”é™¤ daemon.json è¨­å®šæª”ç¯„ä¾‹ã€‚ æ–¼ 2022 å¹´ 02 æœˆ 21 æ—¥ çš„æ¸¬è©¦ï¼Œä»éœ€è¦åœ¨ daemon.json æª”æ¡ˆä¸­åŠ å…¥ cgroupdriver=systemd çš„è¨­å®šæ‰å¯æ­£å¸¸çš„åˆå§‹åŒ– kubernetes å¢é›†ã€‚ è‹¥è¦åƒè€ƒç¯„ä¾‹å¯é¸æ“‡è¼ƒèˆŠçš„ç‰ˆæœ¬ï¼Œå¦‚ 1.22 ç‰ˆæ–‡ä»¶ (é€£çµ)ã€‚ json \"exec-opts\": [\"native.cgroupdriver=systemd\"], åŠ å…¥ç£ç¢Ÿç®¡ç†æ¨¡å¼çš„è¨­å®š json \"storage-driver\": \"overlay2\" è³‡è¨Š ç”±æ–¼ç¾åœ¨ Linux OS æ–°å®‰è£çš„ docker éƒ½æœƒé è¨­éƒ½æœƒä½¿ç”¨ overlay2 çš„ç£ç¢Ÿé©…å‹•ï¼Œé€šå¸¸ä¸ç”¨ç‰¹åˆ¥è¨­å®š æœ‰æ™‚å¯èƒ½ä¹Ÿæœƒç™¼ç”Ÿèª¿æ•´ç‚º overlay2 ä¹‹å¾Œå°±ç„¡æ³•å•Ÿå‹• docker çš„ç‹€æ³ï¼Œæ‰€ä»¥è‹¥æœ‰ docker ç„¡æ³•å•Ÿå‹•çš„æƒ…æ³æ™‚ï¼Œå¯ä»¥çœç•¥ overlay2 çš„è¨­å®š restart docker bash sudo systemctl enable docker sudo systemctl daemon-reload sudo systemctl restart docker ","date":"2022-04-10","objectID":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/:1:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™","uri":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/#docker"},{"categories":["Kubernetes","Installation"],"content":" 7 containerd å®‰è£ è³‡è¨Š Kubernetes 1.24 ä»¥å¾Œçš„ç‰ˆæœ¬å»ºè­°ä½¿ç”¨æ­¤å¥—ä»¶ (æˆ–å…¶ä»–é è¨­æ”¯æ´çš„ ORI å¥—ä»¶) å¦‚æœæœ‰èµ°å‰ä¸€ç« ç¯€çš„ docker å®‰è£çš„è©±ï¼Œå¯ä»¥ç›´æ¥è·³åˆ° è¨­å®š config æ›´æ–° yum ä»¥å®‰è£ docker bash sudo yum install -y yum-utils sudo yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo å®‰è£ containerd.io bash sudo yum install containerd.io è¨­å®š config path: /etc/containerd/config.toml å› ç‚ºä½¿ç”¨ yum å®‰è£ containerd æ™‚çš„é è¨­è¨­å®šæª”é•·é€™æ¨£ (å·²å¿½ç•¥è¨»è§£é …ç›®) toml disabled_plugins = [\"cri\"] æˆ‘å€‘éœ€è¦æŠŠ disabled_plugins è£¡é¢çš„ cri ç§»é™¤ï¼Œä¸¦åŠ å…¥ systemd çš„ç›¸é—œæ§åˆ¶ï¼Œæ‰€ä»¥è¨­å®šæª”æœƒè®Šæˆé€™æ¨£ toml disabled_plugins = [] [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc] [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options] SystemdCgroup = true å•Ÿå‹• (é‡å•Ÿ) containerd bash sudo systemctl daemon-reload sudo systemctl enable --now containerd # å¦‚æœå·²ç¶“æœ‰è¨­å®šå•Ÿç”¨ containerd çš„è©±å°±è¦ç”¨é€™å€‹ sudo systemctl restart containerd ","date":"2022-04-10","objectID":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/:2:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™","uri":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/#containerd-å®‰è£"},{"categories":["Kubernetes","Installation"],"content":" 8 Iptables è¨­å®š è³‡è¨Š kubernetes 1.24 ç‰ˆæœ¬å¾Œè®Šæ›´ bash cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF sudo modprobe overlay sudo modprobe br_netfilter # sysctl params required by setup, params persist across reboots cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF # Apply sysctl params without reboot sudo sysctl --system ","date":"2022-04-10","objectID":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/:3:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™","uri":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/#iptables-è¨­å®š"},{"categories":["Kubernetes","Installation"],"content":" 9 é—œé–‰ Swapåƒè€ƒæ–‡ä»¶ ä½¿ç”¨æŒ‡ä»¤é—œé–‰ bash sudo swapoff -a è­¦å‘Š æ­¤å‘½ä»¤åƒ…æ˜¯æš«æ™‚æ€§é—œé–‰ï¼Œserver é‡é–‹å¾Œä»æœƒå•Ÿç”¨ swapï¼Œå› æ­¤éœ€è¦æ­é…ä¸‹ä¸€ç¯€çš„è¨­å®šä¾†å®Œå…¨é—œé–‰ swap æ°¸ä¹…é—œé–‰ swap è¨»è§£æ‰ä»¥ä¸‹å‘½ä»¤é–‹å•Ÿçš„æª”æ¡ˆä¸­ï¼Œå«æœ‰ swap å­—æ¨£çš„è¡Œæ¬¡ bash vim /etc/fstab ç”¨ vim é–‹å•Ÿ /etc/sysctl.conf æª”æ¡ˆï¼Œä¸¦åŠ å…¥ vm.swappiness=0 æ­¤é …æˆ‘åœ¨ç›®å‰æœ‰é‹ä½œçš„ä¸»æ©Ÿä¸Šä¸¦æœªé€²è¡Œæ­¤è¨­å®šï¼Œä½†ä»å¯æ­£å¸¸é‹ä½œï¼Œä½†æ˜¯å‰è¿° /etc/fstab çš„æª”æ¡ˆæ˜¯ç¢ºå®šè¦ä¿®æ”¹çš„ ","date":"2022-04-10","objectID":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/:4:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™","uri":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/#é—œé–‰-swap"},{"categories":["Kubernetes","Installation"],"content":" 10 å®‰è£ kubernetes æ‰€éœ€ cli å·¥å…·ç›´æ¥åƒè€ƒå®˜æ–¹è³‡æ–™ è³‡è¨Š ä»¥ä¸‹å‘½ä»¤æœƒå®‰è£ kubelet / kubeadm / kubectl ç­‰ cli å·¥å…·ï¼Œä¸¦ä¸”æœƒèª¿æ•´ selinux è¨­å®š æ­¤è™•ç´€éŒ„çš„å‘½ä»¤å·²ä¿®æ­£ repo_gpgcheck å•é¡Œ (è«‹è¦‹ä¸‹é¢ Troubleshooting ç« ç¯€) bash cat \u003c\u003cEOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 repo_gpgcheck=0 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF # Set SELinux in permissive mode (effectively disabling it) sudo setenforce 0 sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes sudo systemctl enable --now kubelet è³‡è¨Š é è¨­æœƒå®‰è£ä»¥ä¸‹ä¾è³´å·¥å…· conntrack-tools cri-tools kubernetes-cni libnetfilter_cthelper libnetfilter_cttimeout libnetfilter_queue socat ","date":"2022-04-10","objectID":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/:5:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™","uri":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/#å®‰è£-kubernetes-æ‰€éœ€-cli-å·¥å…·"},{"categories":["Kubernetes","Installation"],"content":" 10.1 Troubleshootingå¦‚æœåœ¨å®‰è£ kubelet ç­‰å¥—ä»¶æ™‚å‡ºç¾ä»¥ä¸‹è¨Šæ¯ text https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64/repodata/repomd.xml: [Errno -1] repomd.xml signature could not be verified for kubernetes Trying other mirror. ç©æ¥µçš„è§£æ±ºæ–¹æ¡ˆ = unknow æ¶ˆæ¥µçš„è§£æ±ºæ–¹æ¡ˆ ä¿®æ”¹ /etc/yum.repos.d/kubernetes.repo è£¡é¢çš„ repo_gpgcheck ç‚º 0 text [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 repo_gpgcheck=0 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl ref1: https://github.com/kubernetes/kubernetes/issues/60134 ref2: https://stackoverflow.com/questions/66853387/signature-could-not-be-verified-for-kubernetes-repo ","date":"2022-04-10","objectID":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/:5:1","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Node-Envelopment-Standby"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.1 : ç’°å¢ƒæº–å‚™","uri":"/2022/04/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.1-%E7%92%B0%E5%A2%83%E6%BA%96%E5%82%99/#troubleshooting"},{"categories":["ArgoCD"],"content":"ArgoCD å®‰è£ç­†è¨˜","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/"},{"categories":["ArgoCD"],"content":"Argo CD å®‰è£çš„ç´€éŒ„ è­¦å‘Š æ–°ç‰ˆå®‰è£è³‡æ–™å¾…æ•´ç†ï¼Œæœ¬æ–‡ç‰ˆæœ¬ç‚º ver 2.2.1 ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:0:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#"},{"categories":["ArgoCD"],"content":" ArgoCD Install Memo","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:0:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#argocd-install-memo"},{"categories":["ArgoCD"],"content":" 1 Manual Install è³‡è¨Š Kubernetes with Istio çš„ç’°å¢ƒä¸‹å»ºè­°åƒç…§ kustomization install çš„æ–¹å¼é€²è¡Œå®‰è£ download install yaml (option) æŒ‡å®šç‰ˆæœ¬ bash curl -sSL https://raw.githubusercontent.com/argoproj/argo-cd/v2.2.1/manifests/install.yaml -o install-2.2.1.yaml æœ€æ–°ç‰ˆæœ¬ bash curl -sSL https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml -o install-latest.yaml å»ºç«‹ namespace ç´”å»ºç«‹ bash kubectl create namespace argocd å«è¨­å®š istio æ›è»Š bash kubectl create namespace argocd kubectl label namespace argocd istio-injection=enabled --overwrite Install to K8s ä½¿ç”¨ä¸‹è¼‰ç‰ˆ (æŒ‡å®šç‰ˆæœ¬) bash kubectl apply -n argocd -f install-2.2.1.yaml ä½¿ç”¨ä¸‹è¼‰ç‰ˆ (æœ€æ–°ç‰ˆæœ¬) bash kubectl apply -n argocd -f install-latest.yaml ä½¿ç”¨ç·šä¸ŠæŒ‡å®šç‰ˆ bash kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/v2.2.1/manifests/install.yaml ä½¿ç”¨ç·šä¸Šæœ€æ–°ç‰ˆ bash kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml Install Argo Cli (option) bash curl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64 chmod +x /usr/local/bin/argocd Fix Https Problam Reference ç·¨è¼¯ç™¼å¸ƒè¨­å®š bash kubectl edit deploy argocd-server -n argocd æ‰¾åˆ° spec.containers.command å€æ®µä¸¦åŠ å…¥ä»¥ä¸‹å…§å®¹ yaml spec: containers: - name: argocd-server command: - argocd-server # åŠ å…¥ä»¥ä¸‹äº”è¡Œï¼Œä½¿ç”¨ http é€£ç·š - --staticassets - /shared/app - --repo-server - argocd-repo-server:8081 - --insecure é‡æ–°ä½ˆç½² bash kubectl rollout restart deploy -n argocd ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:1:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#manual-install"},{"categories":["ArgoCD"],"content":" 2 Helm InstallOfficial Argo CD Helm Readme é‡è¦ï¼šå®‰è£æ™‚è¨­å®š server.extraArgs={â€“insecure} ä¾†é¿é–‹ TLS æ†‘è­‰ï¼Œå¦‚æœè¦ä½¿ç”¨ TLS æ†‘è­‰çš„è©±è¦å¤šä¸€äº›æ†‘è­‰è¨­å®šï¼Œé€™é‚Šå…ˆç•¥é bash helm repo add argo https://argoproj.github.io/argo-helm helm install argocd argo/argo-cd -n argocd kubectl create namespace argocd kubectl label namespace argocd istio-injection=enabled --overwrite helm install argocd argo/argo-cd -n argocd --set server.extraArgs={--insecure} ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:2:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#helm-install"},{"categories":["ArgoCD"],"content":" 3 Ingress Install","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:3:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#ingress-install"},{"categories":["ArgoCD"],"content":" 3.1 Use Specific ArgoCD Domain nginx Ingress yaml apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: argocd-server-ingress namespace: argocd annotations: # kubernetes.io/ingress.class: nginx # nginx.ingress.kubernetes.io/force-ssl-redirect: \"true\" # nginx.ingress.kubernetes.io/ssl-passthrough: \"true\" spec: ingressClassName: nginx rules: - host: argocd.\u003cdomain\u003e http: paths: - pathType: Prefix path: / backend: service: name: argocd-server port: number: 80 Istio Ingress Reference Gateway yaml yaml apiVersion: networking.istio.io/v1beta1 kind: Gateway metadata: name: argocd-gateway namespace: argocd spec: selector: istio: ingressgateway servers: - hosts: - argocd.\u003cdomain\u003e port: name: http # port è¦ç”¨ ingressgateway ä¸­ï¼Œport = 80 çš„é‚£çµ„è¨­å®šçš„ TargetPort number: 8080 protocol: HTTP # å¦‚æœè¦å¼·è½‰ HTTPS # tls: # httpsRedirect: true - hosts: # é€™é‚Šé€™æ¨£è¨­å®šåªæ˜¯æƒ³è®“ istio ä¸æœƒè·³ç›¸åŒ host çš„è­¦å‘Š - argocd/argocd.\u003cdomain\u003e port: name: https # port è¦ç”¨ ingressgateway ä¸­ï¼Œport = 443 çš„é‚£çµ„è¨­å®šçš„ TargetPort number: 8443 protocol: HTTPS tls: mode: PASSTHROUGH # å¦å¤–çš„è¨­å®šæ–¹æ³•ï¼Œå¾…æ¸¬è©¦ # tls: # credentialName: argocd-server-tls # argocd server æœƒè‡ªå‹•è®€å–é€™å€‹åç¨±çš„ k8s secrets # mode: SIMPLE VirtualService yaml è³‡è¨Š å«æœ‰ https å°æµçš„è¨­å®šæ–¹å¼è¦ç ”ç©¶ä¸€ä¸‹ yaml apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: argocd-vs namespace: argocd spec: hosts: - argocd.\u003cdomain\u003e gateways: - argocd-gateway http: - route: - destination: host: argocd-server.argocd.svc.cluster.local port: number: 80 ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:3:1","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#use-specific-argocd-domain"},{"categories":["ArgoCD"],"content":" 3.2 Use Relative ArgoCD Path è­¦å‘Š æš«æ™‚æ¸¬ä¸åˆ° \u003cdomain\u003e/argocd/ é€™ç¨®ç›¸å°è·¯å¾‘çš„ URL è¨­å®š nginx Ingress å¾…è£œ Istio Ingress Gateway yaml yaml apiVersion: networking.istio.io/v1beta1 kind: Gateway metadata: name: argocd-gateway namespace: argocd spec: selector: istio: ingressgateway servers: - hosts: - \u003cdomain\u003e port: name: http # port è¦ç”¨ ingressgateway ä¸­ï¼Œport = 80 çš„é‚£çµ„è¨­å®šçš„ TargetPort number: 8080 protocol: HTTP # å¦‚æœè¦å¼·è½‰ HTTPS # tls: # httpsRedirect: true - hosts: # é€™é‚Šé€™æ¨£è¨­å®šåªæ˜¯æƒ³è®“ istio ä¸æœƒè·³ç›¸åŒ host çš„è­¦å‘Š - argocd/\u003cdomain\u003e port: name: https # port è¦ç”¨ ingressgateway ä¸­ï¼Œport = 443 çš„é‚£çµ„è¨­å®šçš„ TargetPort number: 443 protocol: HTTPS tls: mode: PASSTHROUGH # å¦å¤–çš„è¨­å®šæ–¹æ³•ï¼Œå¾…æ¸¬è©¦ # tls: # credentialName: argocd-server-tls # argocd server æœƒè‡ªå‹•è®€å–é€™å€‹åç¨±çš„ k8s secrets # mode: SIMPLE VirtualService yaml è³‡è¨Š å«æœ‰ https å°æµçš„è¨­å®šæ–¹å¼è¦ç ”ç©¶ä¸€ä¸‹ yaml apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: argocd-vs namespace: argocd spec: hosts: - \u003cdomain\u003e gateways: - argocd-gateway http: - route: - destination: host: argocd-server.argocd.svc.cluster.local port: number: 80 ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:3:2","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#use-relative-argocd-path"},{"categories":["ArgoCD"],"content":" 4 kustomization Install With Istio (Recommend when use istio)æ­¤æ–¹æ³•ä¸»è¦åƒè€ƒä»¥ä¸‹ä¸‰å€‹é€£çµ èªªæ˜æ–‡ä»¶ å®˜æ–¹ issues ç¬¬ä¸‰æ–¹çš„ä¸»è¦ GitRepo è³‡è¨Š é€™é‚Šçš„ kustomization yaml åŒæ™‚è¨­å®šäº† argoproj-lab çš„æ“´å…… é å…ˆæº–å‚™ ä¾æ“š Manual Command Install ç« ç¯€æº–å‚™å¥½å®˜æ–¹ ArgoCD å®‰è£ Yaml èˆ‡ Kubernetes Namespace ä¾æ“š Ingress Install ç« ç¯€æº–å‚™å¥½ Istio ä½¿ç”¨çš„ VisualService èˆ‡ Gateway æº–å‚™ kustomization yaml yaml apiVersion: kustomize.config.k8s.io/v1beta1 kind: Kustomization namespace: argocd resources: - install-2.2.1.yaml - VirtualService.yaml - Gateway.yaml patchesStrategicMerge: - istio_patches.yaml components: # extensions controller component - https://github.com/argoproj-labs/argocd-extensions/manifests æº–å‚™ istio patch yaml è³‡è¨Š é€™é‚Šæº–å‚™çš„ yaml é™¤äº†é å…ˆè¨­å®šæ’é™¤ https ä¹‹å¤–ï¼Œå°±æ˜¯è¦è¨­å®šæ¯å€‹éƒ¨å±¬å‡ºå»çš„çµ„ä»¶çš„ç‰ˆæœ¬è™Ÿèˆ‡æ‡‰ç”¨ç¨‹å¼åç¨±ï¼Œä»¥ä¾¿ Istio å¯ä»¥æ­£ç¢ºè¿½è¹¤ï¼›åœ¨ä½¿ç”¨ [Manual Command Install](#Manual-Command-Install) + [Ingress Install](#Ingress-Install) çš„æ–¹å¼å®‰è£æ™‚ï¼ŒIstio æœƒç™¼å‡ºå› ç‚ºæ²’æœ‰ç‰ˆæœ¬è™Ÿèˆ‡æ‡‰ç”¨ç¨‹å¼çš„ Label è€Œç„¡æ³•è¿½è¹¤çš„éŒ¯èª¤ã€‚ è­¦å‘Š æ­¤è™•æä¾›çš„ yaml å…§å®¹é ˆä¾æ“šå¯¦éš›å®‰è£çš„ç‰ˆæœ¬å»ä¿®æ”¹ç‰ˆæœ¬è™Ÿï¼Œä¾‹å¦‚åœ¨æœ¬æ–‡ä»¶ä¸­ä½¿ç”¨çš„ Argo CD ç‰ˆæœ¬ç‚º v2.2.1 ç‰ˆï¼Œå°±è¦å°‡ç›¸é—œç‰ˆæœ¬è¨­å®šç‚º v2.2.1ã€‚è€Œ Redis èˆ‡å…¶ä»–å¥—ä»¶çš„éƒ¨åˆ†ï¼Œå»ºè­°åƒè€ƒå®˜æ–¹å®‰è£æ–‡ä»¶ä¸­ä½¿ç”¨çš„ç‰ˆè™Ÿé€²è¡Œè¨­å®šï¼Œç›¡å¯èƒ½ä½¿ label ä¸­çš„ç‰ˆè™Ÿèˆ‡å¯¦éš›ä½¿ç”¨çš„å¥—ä»¶ç‰ˆæœ¬ç›¸ç¬¦ã€‚ yaml apiVersion: apps/v1 kind: Deployment metadata: labels: app.kubernetes.io/component: server app.kubernetes.io/name: argocd-server app.kubernetes.io/part-of: argocd app: argocd-server version: v2.2.1 name: argocd-server spec: template: spec: containers: - name: argocd-server command: - argocd-server - --staticassets - /shared/app - --insecure --- apiVersion: apps/v1 kind: Deployment metadata: labels: app.kubernetes.io/component: repo-server app.kubernetes.io/name: argocd-repo-server app.kubernetes.io/part-of: argocd app: argocd-repo-server version: v2.2.1 name: argocd-repo-server spec: template: metadata: labels: app: argocd-repo-server version: v2.2.1 --- apiVersion: apps/v1 kind: Deployment metadata: labels: app.kubernetes.io/component: redis app.kubernetes.io/name: argocd-redis app.kubernetes.io/part-of: argocd app: argocd-redis version: v6.2.4 name: argocd-redis spec: template: metadata: labels: app: argocd-redis version: v6.2.4 --- apiVersion: apps/v1 kind: Deployment metadata: labels: app.kubernetes.io/component: dex-server app.kubernetes.io/name: argocd-dex-server app.kubernetes.io/part-of: argocd app: argocd-dex-server version: v2.30.0 name: argocd-dex-server spec: template: metadata: labels: app: argocd-dex-server version: v2.30.0 --- apiVersion: apps/v1 kind: StatefulSet metadata: labels: app.kubernetes.io/component: application-controller app.kubernetes.io/name: argocd-application-controller app.kubernetes.io/part-of: argocd app: argocd-application-controller version: v2.2.1 name: argocd-application-controller spec: template: metadata: labels: app: argocd-application-controller version: v2.2.1 --- apiVersion: v1 kind: Service metadata: name: argocd-dex-server spec: # expose container ports to istio network ports: - name: http port: 5556 protocol: TCP targetPort: 5556 - name: http-grpc port: 5557 protocol: TCP targetPort: 5557 - name: http-metrics port: 5558 protocol: TCP targetPort: 5558 --- apiVersion: v1 kind: Service metadata: name: argocd-metrics spec: # expose container ports to istio network ports: - name: http-metrics port: 8082 protocol: TCP targetPort: 8082 --- apiVersion: v1 kind: Service metadata: name: argocd-repo-server spec: # expose container ports to istio network ports: - name: https-server port: 8081 protocol: TCP targetPort: 8081 - name: http-metrics port: 8084 protocol: TCP targetPort: 8084 --- apiVersion: v1 kind: Service metadata: name: argocd-server-metrics spec: # expose container ports to istio network ports: - name: http-metrics port: 8083 protocol: TCP targetPort: 8083 --- apiVersion: v1 kind: Service metadata: name: argocd-server spec: ports: - name: http-argocd-server port: 80 protocol: TCP targetPort: 8080 # delete https port - port: 443 $patch: delete å®‰è£ è­¦å‘Š å»ºè­°å‰è¿°æº–å‚™çš„ yaml æª”æ¡ˆçµ±ä¸€æ”¾åœ¨å°ˆé–€çš„è³‡æ–™å¤¾ bash kubectl apply -k ./ ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:4:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#kustomization-install-with-istio-recommend-when-use-istio"},{"categories":["ArgoCD"],"content":" CLI Toolå®˜æ–¹æ–‡ä»¶ è­¦å‘Š CLI ä¸éœ€è¦å®‰è£åœ¨ ArgoCD æ‰€åœ¨çš„å¢é›†ä¸»æ©Ÿ (æˆ– kubernetes master server)ï¼Œä½†æ˜¯æœ‰äº› CLI å‘½ä»¤å€šè³´ kube config ä¾†å–å¾—å¢é›†è³‡æ–™ï¼Œå¦‚æœ CLI è£åœ¨æ²’æœ‰ kube config çš„ç’°å¢ƒæ™‚ï¼Œæœ‰äº›å‘½ä»¤æœƒå‡ºéŒ¯ ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:0:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#cli-tool"},{"categories":["ArgoCD"],"content":" 1 Install - Linux Download Latest with curl (Linux) bash curl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64 chmod +x /usr/local/bin/argocd Download Concrete Version with curl (Linux) bash curl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/v2.2.1/argocd-linux-amd64 chmod +x /usr/local/bin/argocd ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:1:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#install---linux"},{"categories":["ArgoCD"],"content":" Manage","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:0:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#manage"},{"categories":["ArgoCD"],"content":" 1 Remote Cluster åƒè€ƒ Kubernetes Multi-Cluster ä¸­çš„èªªæ˜ï¼Œèª¿æ•´ ArgoCD æ‰€åœ¨çš„ç¶²è·¯å¢é›†çš„ Kubernetes configï¼ŒåŠ å…¥å¤–éƒ¨å¢é›†è³‡è¨Š ç¢ºèªå¤–éƒ¨å¢é›†çš„åç¨±ä»¥ä¾›å¾ŒçºŒ ArgoCD åŠ å…¥å¤–éƒ¨å¢é›†æ™‚ä½¿ç”¨ bash kubectl config get-contexts -o name ä½¿ç”¨ ArgoCD CLI ç™»å…¥ ArgoCD bash argocd login \u003cARGOCD_SERVER\u003e åŠ å…¥å¤–éƒ¨å¢é›† bash argocd cluster add \u003cremote-cluster name\u003e ç¾åœ¨å¯ä»¥åœ¨ UI ä¸­çœ‹åˆ°å¤–éƒ¨å¢é›†äº† CLI åƒè€ƒ bash # List all known clusters in JSON format: argocd cluster list -o json # Add a target cluster configuration to ArgoCD. The context must exist in your kubectl config: argocd cluster add \u003ccluster name\u003e # Get specific details about a cluster in plain text (wide) format: argocd cluster get \u003ccluster name\u003e -o wide # Remove a target cluster context from ArgoCD argocd cluster rm \u003ccluster name\u003e ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:1:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#remote-cluster"},{"categories":["ArgoCD"],"content":" 2 User Get Default Admin Password bash kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\"{.data.password}\" | base64 -d; echo è­¦å‘Š ä¸å®Œæ•´ ä½¿ç”¨å®˜æ–¹æä¾›çš„å‘½ä»¤å–å¾—ç®¡ç†å“¡å¯†ç¢¼ï¼Œç™»å…¥ç³»çµ±å¾Œæ‡‰ä¿®æ”¹å¯†ç¢¼ bash kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\"{.data.password}\" | base64 -d ç·¨è¼¯ ConfigMap bash kubectl edit cm argocd-cm -n argocd æ‰¾åˆ° data å€æ®µï¼ŒåŠ å…¥ä½¿ç”¨è€… yaml data: accounts.\u003cuser\u003e: apiKey,login # åŠ å…¥é€™å€‹ application.instanceLabelKey: argocd.argoproj.io/instance url: \u003cargocd server url\u003e # é€™å€‹å¯ä»¥é †ä¾¿æ”¹ä¸€ä¸‹ åˆ° \u003cargocd server url\u003e/settings/accounts å»ºç«‹ç™»å…¥çš„ Token (å¯†ç¢¼çš„æ›´æ–°æ–¹å¼å¾…æ¸¬è©¦) ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:2:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#user"},{"categories":["ArgoCD"],"content":" Extension Install","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:0:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#extension-install"},{"categories":["ArgoCD"],"content":" 1 Core Installå®˜æ–¹æ“´å……å¥—ä»¶ å»ºè­°ä½¿ç”¨ Kustomization æ–¹å¼å®‰è£ï¼ŒåŒæ™‚ï¼Œå®‰è£æ™‚æœƒéœ€è¦ä½¿ç”¨åˆ° Gitï¼Œè«‹ç¢ºèªç³»çµ±å…§å·²å®‰è£ Gitã€‚ kustomization yaml (Base on kustomization Install With Istio) yaml apiVersion: kustomize.config.k8s.io/v1beta1 kind: Kustomization namespace: argocd resources: - install-2.2.1.yaml - VirtualService.yaml - Gateway.yaml patchesStrategicMerge: - istio_patches.yaml components: # extensions controller component - https://github.com/argoproj-labs/argocd-extensions/manifests ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:1:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#core-install"},{"categories":["ArgoCD"],"content":" 2 Rollout-extension installArgo Rollout dashboard into the Argo CD Web UI. download yaml bash curl https://raw.githubusercontent.com/argoproj-labs/rollout-extension/v0.1.0/manifests/install.yaml -o argocd-rollout-extension.yaml apply bash kubectl apply -n argocd -f argocd-rollout-extension.yaml ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:2:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#rollout-extension-install"},{"categories":["ArgoCD"],"content":" ReferenceArgo Cd Official Startup Argo Cd Official TLS Configuration Argo Cd Official Startup-Github Argo Cd Github Release Page ","date":"2022-04-04","objectID":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/:0:0","series":null,"tags":["Install"],"title":"ArgoCD å®‰è£ç­†è¨˜","uri":"/2022/04/argocd-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98/#reference"},{"categories":["ArgoCD","Kubernetes","kubernetes-cluster-infrastructure"],"content":"ä½¿ç”¨ ArgoCD å»ºç«‹ Kubernetes åŸºç¤å»ºè¨­","date":"2022-04-04","objectID":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/","series":null,"tags":["Kubernetes","kubernetes-cluster-infrastructure","metrics-server","Prometheus","Prometheus-adapter","Kubernetes-dashboard"],"title":"ä½¿ç”¨ ArgoCD å»ºç«‹ Kubernetes åŸºç¤å»ºè¨­","uri":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/"},{"categories":["ArgoCD","Kubernetes","kubernetes-cluster-infrastructure"],"content":"ç•¶ä¸€å€‹å¢é›†å»ºç«‹å¥½ä¹‹å¾Œç¸½æœƒéœ€è¦å®‰è£ Metrics ç›¸é—œæœå‹™ï¼Œé€™é‚Šä½¿ç”¨ ArgoCD å»ºç«‹ç›¸é—œæ‡‰ç”¨ç¨‹å¼ï¼Œè®“ Cluster åŠ å…¥ä¹‹å¾Œå°±å¯ä»¥ç›´æ¥ç”¨ ArgoCD éƒ¨å±¬ Metrics-Server / Prometheus-adapter ç­‰æœå‹™ã€‚ CLI Command - è¨­å®š Cluster/åŠ å…¥ Repository Metrics-Server çš„ Application è¨­å®š yaml Prometheus-adapter çš„ Application è¨­å®š yaml ","date":"2022-04-04","objectID":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/:0:0","series":null,"tags":["Kubernetes","kubernetes-cluster-infrastructure","metrics-server","Prometheus","Prometheus-adapter","Kubernetes-dashboard"],"title":"ä½¿ç”¨ ArgoCD å»ºç«‹ Kubernetes åŸºç¤å»ºè¨­","uri":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/#"},{"categories":["ArgoCD","Kubernetes","kubernetes-cluster-infrastructure"],"content":" ArgoCli è¨­å®š Cluster bash argocd cluster add srvk8s-admin@srvk8s --name Master-Cluster åŠ å…¥ Repo bash argocd repo add https://prometheus-community.github.io/helm-charts --type helm --name Prometheus argocd repo add https://kubernetes.github.io/dashboard --type helm --name kubernetes-dashboard argocd repo add https://kubernetes-sigs.github.io/metrics-server --type helm --name metrics-server ","date":"2022-04-04","objectID":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/:0:0","series":null,"tags":["Kubernetes","kubernetes-cluster-infrastructure","metrics-server","Prometheus","Prometheus-adapter","Kubernetes-dashboard"],"title":"ä½¿ç”¨ ArgoCD å»ºç«‹ Kubernetes åŸºç¤å»ºè¨­","uri":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/#argocli"},{"categories":["ArgoCD","Kubernetes","kubernetes-cluster-infrastructure"],"content":" Metrics-Serverhelm repository ArgoCD Application yaml yaml apiVersion: argoproj.io/v1alpha1 kind: Application metadata: name: metrics-server-master-cluster spec: destination: name: Master-Cluster namespace: kube-system server: '' source: path: '' repoURL: 'https://kubernetes-sigs.github.io/metrics-server/' targetRevision: 3.8.2 chart: metrics-server helm: valueFiles: - values.yaml parameters: - name: metrics.enabled value: 'true' values: |- args: - --kubelet-insecure-tls project: cluster-infra syncPolicy: syncOptions: - CreateNamespace=true - PruneLast=true ","date":"2022-04-04","objectID":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/:0:0","series":null,"tags":["Kubernetes","kubernetes-cluster-infrastructure","metrics-server","Prometheus","Prometheus-adapter","Kubernetes-dashboard"],"title":"ä½¿ç”¨ ArgoCD å»ºç«‹ Kubernetes åŸºç¤å»ºè¨­","uri":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/#metrics-server"},{"categories":["ArgoCD","Kubernetes","kubernetes-cluster-infrastructure"],"content":" Prometheus-adapter è­¦å‘Š æ­¤æ–¹æ³•æ­é… Istio \u0026 Istio å…¶ä¸­ä½©é™„çš„ Prometheusï¼Œæ˜¯ Metrics-Server çš„æ›¿ä»£ä½œæ³•ã€‚ ç”±æ–¼ metrics-server å®‰è£å¾Œç„¡æ³•åœ¨ lens (kubernetes IDE) ä¸Šçœ‹åˆ°å„å€‹ pod çš„è³‡æºç‹€æ…‹ï¼Œå¦‚æœ cluster çš„è³‡æºå¤ å¤šï¼Œæˆ‘æœƒå»ºè­°ä½¿ç”¨é€™å€‹åšæ³•ã€‚ yaml apiVersion: argoproj.io/v1alpha1 kind: Application metadata: name: prometheus-adapter-Master-Cluster spec: destination: name: Master-Cluster namespace: istio-system server: '' source: path: '' repoURL: 'https://prometheus-community.github.io/helm-charts' targetRevision: 3.0.1 chart: prometheus-adapter helm: valueFiles: - values.yaml values: |- rules: default: true resource: cpu: containerQuery: sum(rate(container_cpu_usage_seconds_total{\u003c\u003c.LabelMatchers\u003e\u003e, container!=\"\"}[5m])) by (\u003c\u003c.GroupBy\u003e\u003e) nodeQuery: sum(rate(container_cpu_usage_seconds_total{\u003c\u003c.LabelMatchers\u003e\u003e, id='/'}[5m])) by (\u003c\u003c.GroupBy\u003e\u003e) resources: overrides: node: resource: node namespace: resource: namespace pod: resource: pod containerLabel: container memory: containerQuery: sum(container_memory_working_set_bytes{\u003c\u003c.LabelMatchers\u003e\u003e, container!=\"\"}) by (\u003c\u003c.GroupBy\u003e\u003e) nodeQuery: sum(container_memory_working_set_bytes{\u003c\u003c.LabelMatchers\u003e\u003e,id='/'}) by (\u003c\u003c.GroupBy\u003e\u003e) resources: overrides: node: resource: node namespace: resource: namespace pod: resource: pod containerLabel: container window: 5m custom: - seriesQuery: '{__name__=~\"istio_requests_total\"}' seriesFilters: [] resources: overrides: kubernetes_namespace: resource: namespace kubernetes_pod_name: resource: pod destination_service_name: resource: service name: matches: \"^(.*)_total\" as: \"${1}_per_min\" metricsQuery: sum(increase(\u003c\u003c.Series\u003e\u003e{\u003c\u003c.LabelMatchers\u003e\u003e}[1m])) by (\u003c\u003c.GroupBy\u003e\u003e) parameters: - name: prometheus.url value: 'http://prometheus.istio-system.svc.cluster.local' project: cluster-infra syncPolicy: syncOptions: [] ","date":"2022-04-04","objectID":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/:0:0","series":null,"tags":["Kubernetes","kubernetes-cluster-infrastructure","metrics-server","Prometheus","Prometheus-adapter","Kubernetes-dashboard"],"title":"ä½¿ç”¨ ArgoCD å»ºç«‹ Kubernetes åŸºç¤å»ºè¨­","uri":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/#prometheus-adapter"},{"categories":["ArgoCD","Kubernetes","kubernetes-cluster-infrastructure"],"content":" Kubernetes Dashboard å±éšª é€™å€‹è¨­å®šæˆ‘å°šæœªå®Œæˆæ¸¬è©¦ä½¿ç”¨ï¼Œåƒ…æˆåŠŸå®‰è£ \u0026 åˆ©ç”¨ Lens çš„ Forward åŠŸèƒ½é€£é€²å»ï¼Œä½†æ˜¯ç™»å…¥çš„éƒ¨åˆ†ç¢°åˆ°å›°é›£ã€‚ å¦å¤–æˆ‘çš„ç’°å¢ƒéƒ½æœ‰ istioï¼Œä¹‹å¾Œç­‰æ¸¬è©¦ OK çš„æ™‚å€™æœƒå†è£œä¸Š istio çš„ ingress ç›¸é—œè¨­å®š yaml apiVersion: argoproj.io/v1alpha1 kind: Application metadata: name: kube-dashboard-master-cluster spec: destination: name: Master-Cluster namespace: kube-dashboard server: '' source: path: '' repoURL: 'https://kubernetes.github.io/dashboard/' targetRevision: 5.3.1 chart: kubernetes-dashboard helm: valueFiles: - values.yaml project: cluster-infra syncPolicy: syncOptions: - PruneLast=true - CreateNamespace=true ","date":"2022-04-04","objectID":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/:0:0","series":null,"tags":["Kubernetes","kubernetes-cluster-infrastructure","metrics-server","Prometheus","Prometheus-adapter","Kubernetes-dashboard"],"title":"ä½¿ç”¨ ArgoCD å»ºç«‹ Kubernetes åŸºç¤å»ºè¨­","uri":"/2022/04/%E4%BD%BF%E7%94%A8-argocd-%E5%BB%BA%E7%AB%8B-kubernetes-%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD/#kubernetes-dashboard"},{"categories":["Istio"],"content":"Istio Sidecar Proxy æœªå•Ÿå‹•æ™‚æœå‹™ç„¡æ³•é€£ç¶²å•é¡Œè™•ç†","date":"2022-03-30","objectID":"/2022/03/istio-sidecar-proxy-%E6%9C%AA%E5%95%9F%E5%8B%95%E6%99%82%E6%9C%8D%E5%8B%99%E7%84%A1%E6%B3%95%E9%80%A3%E7%B6%B2%E5%95%8F%E9%A1%8C%E8%99%95%E7%90%86/","series":[],"tags":["Istio","service-mesh","Troubleshooting"],"title":"Istio Sidecar Proxy æœªå•Ÿå‹•æ™‚æœå‹™ç„¡æ³•é€£ç¶²å•é¡Œè™•ç†","uri":"/2022/03/istio-sidecar-proxy-%E6%9C%AA%E5%95%9F%E5%8B%95%E6%99%82%E6%9C%8D%E5%8B%99%E7%84%A1%E6%B3%95%E9%80%A3%E7%B6%B2%E5%95%8F%E9%A1%8C%E8%99%95%E7%90%86/"},{"categories":["Istio"],"content":"å‰æ®µæ™‚é–“åœ¨å·¥ä½œä¸Šç¢°åˆ°æœå‹™éƒ¨ç½²å¾Œæ²’è¾¦æ³•é€£ä¸Šç¶²è·¯ï¼Œä½†æ˜¯å®¹å™¨é‡å•Ÿå¾Œå°±ä¸€åˆ‡æ­£å¸¸ã€‚ åœ¨æŸ¥éè³‡æ–™å¾Œç™¼ç¾åŸä¾†æ˜¯å› ç‚º Istio Sidecar Proxy å°šæœªå®Œæˆå•Ÿå‹•æ™‚ï¼Œå¾Œé¢çš„æœå‹™æœƒç„¡æ³•é€£ä¸Šç¶²è·¯çš„å•é¡Œï¼Œé€™ç¯‡è¨˜éŒ„è§£æ±ºè¾¦æ³•ã€‚ ","date":"2022-03-30","objectID":"/2022/03/istio-sidecar-proxy-%E6%9C%AA%E5%95%9F%E5%8B%95%E6%99%82%E6%9C%8D%E5%8B%99%E7%84%A1%E6%B3%95%E9%80%A3%E7%B6%B2%E5%95%8F%E9%A1%8C%E8%99%95%E7%90%86/:0:0","series":[],"tags":["Istio","service-mesh","Troubleshooting"],"title":"Istio Sidecar Proxy æœªå•Ÿå‹•æ™‚æœå‹™ç„¡æ³•é€£ç¶²å•é¡Œè™•ç†","uri":"/2022/03/istio-sidecar-proxy-%E6%9C%AA%E5%95%9F%E5%8B%95%E6%99%82%E6%9C%8D%E5%8B%99%E7%84%A1%E6%B3%95%E9%80%A3%E7%B6%B2%E5%95%8F%E9%A1%8C%E8%99%95%E7%90%86/#"},{"categories":["Istio"],"content":" æ›´æ–° Istio çš„ ConfigMapåœ¨ Istio Config ä¸­çš„ mesh è¨­å®šä¸­åŠ å…¥ä»¥ä¸‹è¨­å®š yaml holdApplicationUntilProxyStarts: true æœ€å¾ŒåŠ å®Œé è¨­çš„å…§å®¹æ‡‰è©²æœƒé•·é€™æ¨£ yaml defaultConfig: holdApplicationUntilProxyStarts: true discoveryAddress: istiod.istio-system.svc:15012 proxyMetadata: {} tracing: zipkin: address: zipkin.istio-system:9411 enablePrometheusMerge: true rootNamespace: istio-system trustDomain: cluster.local ","date":"2022-03-30","objectID":"/2022/03/istio-sidecar-proxy-%E6%9C%AA%E5%95%9F%E5%8B%95%E6%99%82%E6%9C%8D%E5%8B%99%E7%84%A1%E6%B3%95%E9%80%A3%E7%B6%B2%E5%95%8F%E9%A1%8C%E8%99%95%E7%90%86/:0:0","series":[],"tags":["Istio","service-mesh","Troubleshooting"],"title":"Istio Sidecar Proxy æœªå•Ÿå‹•æ™‚æœå‹™ç„¡æ³•é€£ç¶²å•é¡Œè™•ç†","uri":"/2022/03/istio-sidecar-proxy-%E6%9C%AA%E5%95%9F%E5%8B%95%E6%99%82%E6%9C%8D%E5%8B%99%E7%84%A1%E6%B3%95%E9%80%A3%E7%B6%B2%E5%95%8F%E9%A1%8C%E8%99%95%E7%90%86/#æ›´æ–°-istio-çš„-configmap"},{"categories":["Istio"],"content":" Reference stackoverflow:connection-refused-error-in-outbound-request-in-k8s-app-container-istio Istio Github Issues#33911 Istio Github Issues#11130 çŸ¥ä¹-å…³äºIstio Proxyç”Ÿå‘½å‘¨æœŸçš„ä¸¤ç‚¹æ³¨æ„äº‹é¡¹ ","date":"2022-03-30","objectID":"/2022/03/istio-sidecar-proxy-%E6%9C%AA%E5%95%9F%E5%8B%95%E6%99%82%E6%9C%8D%E5%8B%99%E7%84%A1%E6%B3%95%E9%80%A3%E7%B6%B2%E5%95%8F%E9%A1%8C%E8%99%95%E7%90%86/:0:0","series":[],"tags":["Istio","service-mesh","Troubleshooting"],"title":"Istio Sidecar Proxy æœªå•Ÿå‹•æ™‚æœå‹™ç„¡æ³•é€£ç¶²å•é¡Œè™•ç†","uri":"/2022/03/istio-sidecar-proxy-%E6%9C%AA%E5%95%9F%E5%8B%95%E6%99%82%E6%9C%8D%E5%8B%99%E7%84%A1%E6%B3%95%E9%80%A3%E7%B6%B2%E5%95%8F%E9%A1%8C%E8%99%95%E7%90%86/#reference"},{"categories":["Kubernetes"],"content":"Kubernetes èˆ‡ Docker çš„ç¶²æ®µè¨­å®šèª¿æ•´","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/"},{"categories":["Kubernetes"],"content":"æ­¤ç¯‡è¨˜éŒ„ Kubernetes ( use Weave-cni ) çš„é è¨­ç¶²æ®µä»¥åŠ Docker é è¨­ç¶²æ®µï¼Œä¸¦ä¸”èªªæ˜å¦‚ä½•é€²è¡Œç¶²æ®µèª¿æ•´ã€‚ ","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/:0:0","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/#"},{"categories":["Kubernetes"],"content":" å…¨é è¨­ç¶²æ®µDocker (custom bridge) ç‚ºä½¿ç”¨ â€˜docker create networkâ€™ å‘½ä»¤å¾Œç”¢ç”Ÿçš„æ–°çš„ docker å…§éƒ¨ç¶²è·¯ã€‚ ç”±æ–¼é è¨­ç¶²è·¯ (default bridge) ä¸­çš„ docker container ç„¡æ³•ä½¿ç”¨ç¶²è·¯åˆ¥åé€²è¡Œæºé€šï¼Œå¿…é ˆè‡ªè¡Œå»ºç«‹ä¸€å€‹è‡ªè¨‚ç¶²è·¯ä¾†ä½¿ç”¨ç¶²è·¯åˆ¥åã€‚ ä¾ç…§ Docker ç”¢ç”Ÿæ–°ç¶²è·¯çš„é‚è¼¯ï¼Œåœ¨é è¨­ä¸ç‰¹åˆ¥çµ¦å®š subnet çš„æƒ…æ³ä¸‹ï¼Œæœƒåœ¨ç¬¬äºŒç¢¼é€æ­¥éå¢ï¼›æœªæ¸¬è©¦é è¨­ä½¿ç”¨çš„ç¶²æ®µæœ€å¤§å€¼ï¼Œæ­£å¸¸ä¾†èªªä¹Ÿä¸å¤§éœ€è¦é–‹åˆ°é€™éº¼å¤šç¶²æ®µã€‚ Used For Subnet GenMask Start End Kubernetes (Weave-cni) 10.32.0.0/12 255.240.0.0 10.32.0.1 10.47.255.254 Docker (default bridge) 172.17.0.0/16 255.255.0.0 172.17.0.1 172.17.255.254 Docker (custom bridge1) 172.18.0.0/16 255.255.0.0 172.18.0.1 172.18.255.254 Docker (custom bridge2) 172.19.0.0/16 255.255.0.0 172.18.0.1 172.18.255.254 ","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/:0:0","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/#å…¨é è¨­ç¶²æ®µ"},{"categories":["Kubernetes"],"content":" Weave.net cni é è¨­ç¶²æ®µèª¿æ•´æ–¹å¼å®‰è£ Weave.net cni æ™‚è¨­å®š å®‰è£èªæ³•å¦‚ä¸‹ bash kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\u0026env.IPALLOC_RANGE=172.30.0.0/16\" kubectl delete -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\u0026env.IPALLOC_RANGE=172.30.0.0/16\" ","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/:0:0","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/#weavenet-cni-é è¨­ç¶²æ®µèª¿æ•´æ–¹å¼"},{"categories":["Kubernetes"],"content":" Docker é è¨­ç¶²æ®µèª¿æ•´æ–¹å¼ä½¿ç”¨ vi ç·¨è¼¯ /etc/docker/daemon.json json { \"default-address-pools\": [ {\"base\":\"10.48.0.0/14\",\"size\":16} ], \"bip\": \"10.48.0.1/16\" } ","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/:0:0","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/#docker-é è¨­ç¶²æ®µèª¿æ•´æ–¹å¼"},{"categories":["Kubernetes"],"content":" 1 default-address-pools èªªæ˜base = å¯ä½¿ç”¨ç¶²æ®µç¯„åœ size = æ¯ä¸€å€‹ bridge ç¶²æ®µå¤§å° ","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/:1:0","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/#default-address-pools-èªªæ˜"},{"categories":["Kubernetes"],"content":" 2 base è¨­å®š 10.48.0.0/14 æ™‚ Docker å¯ä½¿ç”¨çš„ç¶²æ®µå¦‚ä¸‹ Used For Subnet GenMask Start End Docker (default bridge) 10.48.0.0/16 255.240.0.0 10.48.0.1 10.48.255.254 Docker (custom bridge) 10.49.0.0/16 255.255.0.0 10.49.0.1 10.49.255.254 Docker (custom bridge) 10.50.0.0/16 255.255.0.0 10.50.0.1 10.50.255.254 Docker (custom bridge) 10.51.0.0/16 255.255.0.0 10.51.0.1 10.51.255.254 ","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/:2:0","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/#base-è¨­å®š-10480014-æ™‚-docker-å¯ä½¿ç”¨çš„ç¶²æ®µå¦‚ä¸‹"},{"categories":["Kubernetes"],"content":" 3 base è¨­å®š 10.48.0.0/15 æ™‚ Docker å¯ä½¿ç”¨çš„ç¶²æ®µå¦‚ä¸‹ Used For Subnet GenMask Start End Docker (default bridge) 10.48.0.0/16 255.255.0.0 10.48.0.1 10.48.255.254 Docker (custom bridge) 10.49.0.0/16 255.255.0.0 10.49.0.1 10.49.255.254 ","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/:3:0","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/#base-è¨­å®š-10480015-æ™‚-docker-å¯ä½¿ç”¨çš„ç¶²æ®µå¦‚ä¸‹"},{"categories":["Kubernetes"],"content":" 4 èª¿æ•´å®Œç•¢å¾Œçš„ç¶²æ®µè¡¨ - ä»¥ base è¨­å®š 10.48.0.0/15 ç‚ºä¾‹ Used For Subnet GenMask Start End Kubernetes (Weave-cni) 10.32.0.0/12 255.240.0.0 10.32.0.1 10.47.255.254 Docker (default bridge) 10.48.0.0/16 255.255.0.0 10.48.0.1 10.48.255.254 Docker (custom bridge) 10.49.0.0/16 255.255.0.0 10.49.0.1 10.49.255.254 ","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/:4:0","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/#èª¿æ•´å®Œç•¢å¾Œçš„ç¶²æ®µè¡¨---ä»¥-base-è¨­å®š-10480015-ç‚ºä¾‹"},{"categories":["Kubernetes"],"content":" Reference IP ç¶²æ®µè¨ˆç®—å™¨ docker defautl subnet Weave.net CNI default subnet ","date":"2022-03-30","objectID":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/:0:0","series":[],"tags":["Network","Docker"],"title":"Kubernetes \u0026 Docker çš„é è¨­ç¶²æ®µç­†è¨˜","uri":"/2022/03/kubernetes-docker-%E7%9A%84%E9%A0%90%E8%A8%AD%E7%B6%B2%E6%AE%B5%E7%AD%86%E8%A8%98/#reference"},{"categories":["Kubernetes","Installation"],"content":"Kubernetes å®‰è£ç­†è¨˜ part.2 : å¢é›†åˆå§‹åŒ–","date":"2022-02-21","objectID":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Cluster-Initializing"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.2 : å¢é›†åˆå§‹åŒ–","uri":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/"},{"categories":["Kubernetes","Installation"],"content":"ä½¿ç”¨ Kubeadm åˆå§‹åŒ– Kubernetes Cluster. è³‡è¨Š OS: CentOs 7 (kernel = 3.10.1) K8s: v1.23.4 (æ–°å®‰è£æ™‚é è¨­ä½¿ç”¨ç•¶ä¸‹çš„æœ€æ–°ç‰ˆï¼Œå› æ­¤æ­¤ç‰ˆæœ¬è³‡è¨Šåƒè€ƒç”¨) ","date":"2022-02-21","objectID":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/:0:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Cluster-Initializing"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.2 : å¢é›†åˆå§‹åŒ–","uri":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/#"},{"categories":["Kubernetes","Installation"],"content":" Init Kubernetes Cluster æ­¤ç¯‡å®‰è£ kubernetes çš„æ–¹æ³•æ˜¯ä½¿ç”¨ kubeadm ","date":"2022-02-21","objectID":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/:0:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Cluster-Initializing"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.2 : å¢é›†åˆå§‹åŒ–","uri":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/#init-kubernetes-cluster"},{"categories":["Kubernetes","Installation"],"content":" 1 kubeadm initå®‰è£æ™‚å»ºè­° å¢åŠ  --upload-certs åƒæ•¸ï¼Œé€™æ¨£æœªä¾†è¦åŠ å…¥å…¶ä»– Master (Control plane) Node ä»¥å»ºç«‹ HA ç’°å¢ƒæ™‚æ–¹ä¾¿å…±ç”¨æ†‘è­‰ã€‚ è¨­å®š â€“control-plane-endpoint ï¼Œä¸¦ä½¿ç”¨å·²è¨»å†Šæ–¼ DNS çš„ endpointï¼Œå¯ä»¥è®“å¢é›†å…§çš„ Node ä¸ç”¨å€šè³´ Node IP ä¾†èˆ‡ Master æºé€š bash kubeadm init --control-plane-endpoint=\u003cserver in dns\u003e --upload-certs å…¶å®ƒ Node è¦ç”¨ Master å½¢å¼åŠ å…¥çš„è©±å°±å¯ä»¥ç”¨ä¸‹é¢é€™å€‹å‘½ä»¤ bash kubeadm join internal.k8s.master:6443 --token \u003ctoken\u003e \\ --discovery-token-ca-cert-hash sha256:\u003chash\u003e \\ --control-plane --certificate-key \u003ccert\u003e å…¶å®ƒ Node è¦ç”¨ worker çš„å½¢å¼åŠ å…¥ cluster çš„è©±è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ bash kubeadm join internal.k8s.master:6443 --token \u003ctoken\u003e \\ --discovery-token-ca-cert-hash sha256:\u003chash\u003e é‡æ–°ç”¢ç”Ÿ Token bash kubeadm token create å–å¾— cert bash openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2\u003e/dev/null | \\ openssl dgst -sha256 -hex | sed 's/^.* //' ","date":"2022-02-21","objectID":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/:1:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Cluster-Initializing"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.2 : å¢é›†åˆå§‹åŒ–","uri":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/#kubeadm-init"},{"categories":["Kubernetes","Installation"],"content":" 2 Single Node Settingéœ€è¦åœ¨ master node ä¸­éƒ¨å±¬æœå‹™æ™‚éœ€è¦ä¸‹é€™å€‹æŒ‡ä»¤ bash kubectl taint nodes --all node-role.kubernetes.io/master- ","date":"2022-02-21","objectID":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/:2:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Cluster-Initializing"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.2 : å¢é›†åˆå§‹åŒ–","uri":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/#single-node-setting"},{"categories":["Kubernetes","Installation"],"content":" 3 éƒ¨å±¬ weave ç¶²è·¯ (CNI) éƒ¨å±¬ weave ç¶²è·¯ (CNI) æŸ¥çœ‹ weave net pods çš„éƒ¨å±¬è¨­å®š bash kubectl describe -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" éƒ¨å±¬ weave net pods bash kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" ç§»é™¤ weave net pods çš„éƒ¨å±¬ bash kubectl delete -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\" éƒ¨å±¬ weave net çš„æ™‚å€™å¦‚æœç„¡æ³•éƒ¨å±¬æˆåŠŸï¼Œå¯èƒ½æ˜¯å› ç‚ºæ©Ÿå™¨ä¸Šå·²æœ‰è·¯ç”±è¡¨ REF 1. https://www.weave.works/docs/net/latest/kubernetes/kube-addon/#troubleshooting REF 2. https://tonybai.com/2016/12/30/install-kubernetes-on-ubuntu-with-kubeadm-2/ weavenet é è¨­ä½¿ç”¨çš„è·¯ç”±ç‚º 10.32.0.0/12 (å¯ç”¨ ip ç¶²æ®µç¯„åœç‚º 10.32.0.0 ~ 10.47.0.0)ï¼Œé ˆæ³¨æ„è¦åŠ å…¥ k8s å¢é›†çš„ä¸»æ©Ÿä¸Šæ˜¯å¦æœ‰è·¯ç”±è¡çªï¼Œè‹¥æœ‰ï¼Œæœƒå°è‡´æ–°åŠ å…¥çš„æ©Ÿå™¨ä¸Šé¢çš„ weavenet æœå‹™éƒ¨å±¬å¤±æ•— å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¢ºèªè·¯ç”± bash netstat -rn ä¿®æ”¹å¾Œçš„ apply å‘½ä»¤ bash kubectl apply -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\u0026env.IPALLOC_RANGE=172.30.0.0/16\" kubectl delete -f \"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')\u0026env.IPALLOC_RANGE=172.30.0.0/16\" å®‰è£æ™‚å› ç‚º weave net image çš„ä¾†æºä¸æ˜¯ docker hubï¼Œè€Œæ˜¯ â€œghcr.ioâ€ï¼Œå¦‚æœæœ‰ç¶²è·¯ç’°å¢ƒå•é¡Œçš„è©±ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ docker daemon ä¸­èª¿æ•´è¨­å®š json \"insecure-registries\":[\"ghcr.io\"], ","date":"2022-02-21","objectID":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/:3:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Cluster-Initializing"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.2 : å¢é›†åˆå§‹åŒ–","uri":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/#éƒ¨å±¬-weave-ç¶²è·¯-cni"},{"categories":["Kubernetes","Installation"],"content":" 4 å®‰è£ HELM (å»ºè­°) kubernetes é€šå¸¸ä½¿ç”¨ HELM ä¾†å®‰è£å¥—ä»¶ï¼Œå»ºè­°åœ¨ master ä¸Šå®‰è£ helm å·¥å…· bash curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 chmod 700 get_helm.sh ./get_helm.sh ","date":"2022-02-21","objectID":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/:4:0","series":["kubernetes-install-memo"],"tags":["Kubernetes","Cluster-Install","Installation","Cluster-Initializing"],"title":"Kubernetes å®‰è£ç­†è¨˜ part.2 : å¢é›†åˆå§‹åŒ–","uri":"/2022/02/kubernetes-%E5%AE%89%E8%A3%9D%E7%AD%86%E8%A8%98-part.2-%E5%8F%A2%E9%9B%86%E5%88%9D%E5%A7%8B%E5%8C%96/#å®‰è£-helm-å»ºè­°"},{"categories":["C#","EF-Core"],"content":"EF Core ä¸­å»ºç«‹è‡ªè¨‚é—œè¯ï¼Œå¸¸ç”¨æ–¼å¯¦éš›è³‡æ–™åº«ä¸­çš„ Table æœªå»ºç«‹é—œè¯çš„æƒ…å¢ƒ","date":"2022-02-06","objectID":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/","series":[],"tags":["EFCore"],"title":"EF Core è‡ªè¨‚é—œè¯","uri":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/"},{"categories":["C#","EF-Core"],"content":"ç•¶ Db å…§çš„ Table éƒ½æ²’æœ‰è¨­å®šé—œè¯ï¼Œåˆå¸Œæœ›åœ¨ä¸èª¿æ•´ Db çš„æƒ…æ³ä¸‹ç”¨æ“ä½œæœ‰é—œé€£ Table çš„æ–¹æ³•ä½¿ç”¨ EF Core æ™‚ï¼Œå¯ä»¥åœ¨ EF Core æ‰€ä½¿ç”¨çš„ Entity èˆ‡ Entity Configuration ä¸­è‡ªè¨‚é—œè¯æ€§ï¼ŒEF Core æœƒè‡ªè¡Œèª¿æ•´ Sql èªæ³• (ä½¿ç”¨ Left join æˆ–å…¶å®ƒ join èªæ³•) ä¾†åŠ å…¥è³‡æ–™ã€‚ EF Power Tool ç”¢ç”Ÿçš„ Entity / Entity Configuration é è¨­çš†æœ‰å¼•å…¥ partial é—œéµå­—ï¼Œå› æ­¤ï¼Œç‚ºäº†å€åˆ¥å·¥å…·ç”¢ç”Ÿçš„ code èˆ‡è‡ªè¨‚çš„ codeï¼Œæˆ‘å€‘å¯ä»¥å¦å¤–å»ºç«‹æ–°çš„æª”æ¡ˆè™•ç†è‡ªå®šç¾©çš„éƒ¨åˆ†ã€‚ æœ¬ç¯‡ç¯„ä¾‹ç‚º ä¸€å°ä¸€ã€ä¸€å°å¤š çš„è¨­å®šæ–¹å¼ã€‚ è­¦å‘Š TODO: ç¤ºç¯„ç”¨ç¨‹å¼ç¢¼å¾…è£œ (2022-02-06) ","date":"2022-02-06","objectID":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/:0:0","series":[],"tags":["EFCore"],"title":"EF Core è‡ªè¨‚é—œè¯","uri":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/#"},{"categories":["C#","EF-Core"],"content":" ä½¿ç”¨çš„å°ˆæ¡ˆçµæ§‹ Db.Repository å°ˆæ¡ˆçµæ§‹æ¨¹ çµæ§‹æ¨¹ text . â”œâ”€â”€ Configurations â”œâ”€â”€ Entities â”œâ”€â”€ [db name]Context.cs â””â”€â”€ efpt.config.json å°ˆæ¡ˆå…§éƒ¨è³‡æ–™å¤¾èªªæ˜ è³‡æ–™å¤¾ èªªæ˜ Configurations EF Power Tool ç”¢ç”Ÿçš„ Entity è¨­å®šæª” Entities EF Power Tool ç”¢ç”Ÿçš„ Entity æª” [db name]Context.cs EF Core DbContext By Db efpt.config.json EF Core Power Tool è¨­å®šæª”ï¼Œé™¤äº†é€²è¡Œ Entity å¢æ¸›å¤–ï¼Œä¸æ‡‰æœ‰å…¶å®ƒè®Šæ›´ ä»¥ä¸‹æ“ä½œå‡ä½¿ç”¨ EF Core 5.0 ","date":"2022-02-06","objectID":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/:0:0","series":[],"tags":["EFCore"],"title":"EF Core è‡ªè¨‚é—œè¯","uri":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/#ä½¿ç”¨çš„å°ˆæ¡ˆçµæ§‹"},{"categories":["C#","EF-Core"],"content":" Entity èª¿æ•´åœ¨ Db.Repository å°ˆæ¡ˆä¸­ï¼Œæ‰¾åˆ°æƒ³è¦åŠ å…¥è‡ªè¨‚é—œè¯çš„ Entityï¼Œä¸¦å»ºç«‹ä¸€å€‹æ–°çš„æª”æ¡ˆï¼Œåç‚º {EntityName}.CustomProperty.csã€‚ è¨»ï¼šæ–°å¢çš„æª”æ¡ˆå¾ŒçºŒçš„å­—ç¯€ (CustomProperty) å¯ä»¥ä¾æ“šè©²æª”æ¡ˆå…§æ”¾ç½®çš„é …ç›®é€²è¡Œèª¿æ•´ï¼Œæœ¬æ¬¡ä»¥ CustomProperty å‘½åæ˜¯å› å…§å®¹å­˜æ”¾è‡ªå®šç¾©å±¬æ€§ã€‚ EF Power Tool ç”¢ç”Ÿçš„ Entity File cs //File: Db.Repository/Entities/MainTable.cs public partial class MainTable { public int MainId{ get; set; } } //File: Db.Repository/Entities/OneToManySubTable.cs public partial class OneToManySubTable { public int MainId{ get; set; } public int SubId{ get; set; } } //File: Db.Repository/Entities/OneToOneSubTable.cs public partial class OneToOneSubTable { public int MainId{ get; set; } public int SubId{ get; set; } } æ‰‹å‹•æ–°å¢çš„ Partial File cs //File: Db.Repository/Entities/MainTable.CustomProperty.cs public partial class MainTable { public MainTable() { this.OneToManySubItems = new HashSet\u003cOneToManySubTable\u003e(); } public virtual ICollection\u003cOneToManySubTable\u003e OneToManySubItems { get; set; } public virtual OnoToOneSubTable OneToOneSubItem { get; set; } } //File: Db.Repository/Entities/OneToManySubTable.CustomProperty.cs public partial class OneToManySubTable { public virtual MainTable Header { get; set; } } //File: Db.Repository/Entities/OneToOneSubTable.CustomProperty.cs public partial class OneToOneSubTable { public virtual MainTable Header { get; set; } } ","date":"2022-02-06","objectID":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/:0:0","series":[],"tags":["EFCore"],"title":"EF Core è‡ªè¨‚é—œè¯","uri":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/#entity-èª¿æ•´"},{"categories":["C#","EF-Core"],"content":" Entity Configuration èª¿æ•´åœ¨ Db.Repository å°ˆæ¡ˆä¸­ï¼Œæ‰¾åˆ°æƒ³è¦åŠ å…¥è‡ªè¨‚é—œè¯çš„ Entity Configurationï¼Œä¸¦å»ºç«‹ä¸€å€‹æ–°çš„æª”æ¡ˆï¼Œåç‚º {EntityName}Configuration.Partial.csã€‚ è¨»ï¼šæ–°å¢çš„æª”æ¡ˆå¾ŒçºŒçš„å­—ç¯€ (Partial) å¯ä»¥ä¾æ“šè©²æª”æ¡ˆå…§æ”¾ç½®çš„é …ç›®é€²è¡Œèª¿æ•´ï¼Œæœ¬æ¬¡ä»¥ Partial å‘½åæ˜¯å›  â€œé—œè¯â€ çš„è‹±æ–‡éé•·ï¼Œè€Œæ¡ç”¨è¼ƒçŸ­ä¸”ç¬¦åˆæª”æ¡ˆç›®çš„çš„ Partial EF Power Tool ç”¢ç”Ÿçš„ Entity Configuration cs //File: Db.Repository/Configurations/OneToOneSubTableConfiguration.cs public partial class OneToOneSubTableConfiguration : IEntityTypeConfiguration\u003cOneToOneSubTable\u003e { public void Configure(EntityTypeBuilder\u003cOneToOneSubTable\u003e entity) { entity.HasKey(e =\u003e e.SubId); entity.ToTable(\"OneToOneSubTable\", \"dbo\"); entity.HasComment(\"ä¸€å°ä¸€å­è¡¨\"); entity.Property(e =\u003e e.SubId).HasColumnName(\"SubId\"); this.OnConfigurePartial(entity); } partial void OnConfigurePartial(EntityTypeBuilder\u003cOneToOneSubTable\u003e entity); } //File: Db.Repository/Configurations/OneToManySubTableConfiguration.cs public partial class OneToManySubTableConfiguration : IEntityTypeConfiguration\u003cOneToManySubTable\u003e { public void Configure(EntityTypeBuilder\u003cOneToManySubTable\u003e entity) { entity.HasKey(e =\u003e e.SubId); entity.ToTable(\"OneToManySubTable\", \"dbo\"); entity.HasComment(\"ä¸€å°å¤šå­è¡¨\"); entity.Property(e =\u003e e.SubId).HasColumnName(\"SubId\"); this.OnConfigurePartial(entity); } partial void OnConfigurePartial(EntityTypeBuilder\u003cOneToManySubTable\u003e entity); } æ‰‹å‹•æ–°å¢çš„ Partial File è£œå……ï¼šOnDelete çš„åƒæ•¸å¯åƒç…§ å¾®è»Ÿå®˜æ–¹ çš„èªªæ˜èª¿æ•´è¨­å®š cs //File: Db.Repository/Configurations/OneToOneSubTableConfiguration.Partial.cs public partial class OneToOneSubTableConfiguration : IEntityTypeConfiguration\u003cOneToOneSubTable\u003e { partial void OnConfigurePartial(EntityTypeBuilder\u003cOneToOneSubTable\u003e entity) { entity.HasOne(d =\u003e d.Header) //è¨­å®š OneToOneSubTable é€™å€‹ Entity Header é€™å€‹å±¬æ€§æ˜¯å±¬æ–¼å¤–éƒ¨è³‡æ–™ .WithOne(p =\u003e p.OneToOneSubItem) //è¨­å®šå‰ä¸€è¡Œ HasOne ä¸­é¸æ“‡çš„å±¬æ€§ (Header) çš„å‹åˆ¥ (MainTable) ä¸­çš„ OneToOneSubItem å±¬æ€§å°æ‡‰è‡ªå·± (OneToOneSubTable) .HasForeignKey(d =\u003e d.MainId) //è¨­å®šè‡ªå·± (OneToOneSubTable) çš„å“ªä¸€å€‹å±¬æ€§æ˜¯ç´€éŒ„ Header çš„ PK .OnDelete(DeleteBehavior.ClientSetNull); //è¨­å®šè³‡æ–™åˆªé™¤å¾Œçš„è™•ç†æ–¹å¼ (Header è¢«åˆªæ‰å¾Œæ˜¯å¦è¦è·Ÿè‘—è¢«åˆªæ‰) } } //File: Db.Repository/Configurations/OneToManySubTableConfiguration.Partial.cs public partial class OneToManySubTableConfiguration : IEntityTypeConfiguration\u003cOneToManySubTable\u003e { partial void OnConfigurePartial(EntityTypeBuilder\u003cOneToManySubTable\u003e entity) { //å„æ–¹æ³•èªªæ˜çš†èˆ‡ OneToOne ç›¸åŒï¼Œåªæ˜¯å› ç‚º OneToMany æ˜¯ä¸€å°å¤šï¼Œæ‰€ä»¥ç¬¬äºŒè¡Œè¨­å®šå¾ WithOne æ”¹ç‚º WithMany entity.HasOne(d =\u003e d.Header) .WithMany(p =\u003e p.OneToManySubItems) .HasForeignKey(d =\u003e d.SubId) .OnDelete(DeleteBehavior.ClientSetNull); } } ","date":"2022-02-06","objectID":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/:0:0","series":[],"tags":["EFCore"],"title":"EF Core è‡ªè¨‚é—œè¯","uri":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/#entity-configuration-èª¿æ•´"},{"categories":["C#","EF-Core"],"content":" ä½¿ç”¨æ–¹å¼æœ¬ç« ç¯€æä¾›ä¸‰ç¨® EF Core æ“ä½œ Db çš„æ–¹æ³•ï¼Œå¯ä¾éœ€è¦è‡ªè¡Œé¸æ“‡åšæ³•ã€‚ EF Core ä¸­ï¼Œè§¸ç™¼æœ‰é—œè¯çš„ SubTable éœ€è¦èª¿ç”¨ Include / ThenInclude æ–¹æ³•ã€‚ ç›´æ¥è½‰æˆè¼¸å‡ºç”¨çš„ Dto ç‰©ä»¶å¯«æ³• æ­¤å¯«æ³•å¯è‡ªè¨‚è¼¸å‡ºæ¬„ä½ï¼Œæ¸›å°‘ SqlServer \u003c-\u003e WebService é–“çš„è³‡æ–™å‚³è¼¸é‡ cs private async Task\u003cIEnumerable\u003cMainTableDto\u003e\u003e GetAllMainTableDtos() { return await this._testContext.MainTables .AsNoTracking() .Get() .Include(o=\u003eo.OneToManySubItems) .Include(o=\u003eo.OneToOneSubItem) .Select(o =\u003e new MainTableDto { MainId = o.MainId, // é€™é‚Šå…è¨±ä½¿ç”¨ AutoMapper ç›´æ¥æ˜ ç…§æ¬„ä½ï¼Œå¦‚è¨»è§£ï¼Œä½†è‹¥ Sub Table ä¸­åªéœ€è¦ç‰¹å®šæ¬„ä½çš„è©±ï¼Œå‰‡å»ºè­°ä½¿ç”¨æ­¤è™•ç¯„ä¾‹ä½¿ç”¨çš„å¯«æ³• // OneToManySubItems = this._mapper.Map\u003cIEnumerable\u003cOneToManySubTableDto\u003e\u003e(o.OneToManySubItems) OneToManySubItems = o.OneToManySubItems.Select(m=\u003enew OneToManySubTableDto { SubId = m.SubId, MainId = m.MainId }), // OneToOneSubItem = this._mapper.Map\u003cOneToOneSubTableDto\u003e(o.OneToOneSubItem) OneToOneSubItem = new OneToOneSubTableDto { SubId = o.OneToOneSubItem.SubId, MainId = o.OneToOneSubItem.MainId }) }).ToListAsync(); } å®Œæ•´ä¾æ“š Table Entity å…§å®¹è½‰å‡º Db è³‡æ–™ï¼Œå†è‡ªè¡Œçµ„åˆ Service è¼¸å‡ºç”¨çš„ Dto ç‰©ä»¶å¯«æ³• æ­¤å¯«æ³•é©åˆåœ¨éœ€è¦ä¸€äº›é¡å¤–çš„æ¬„ä½åˆ¤æ–·äº‹æƒ…ï¼Œä½†æ˜¯é‚£äº›æ¬„ä½åˆä¸éœ€è¦è¼¸å‡ºçš„æƒ…å¢ƒ cs private async Task\u003cIEnumerable\u003cMainTableDto\u003e\u003e GetAllMainTableDtos() { var mainTableList = await this._testContext.MainTables .AsNoTracking() .Get() .Include(o=\u003eo.OneToManySubItems) .Include(o=\u003eo.OneToOneSubItem) .ToListAsync(); // è‹¥ç„¡å…¶å®ƒéœ€æ±‚ï¼Œå¯ç›´æ¥ä½¿ç”¨ AutoMapper é€²è¡Œè³‡æ–™æ˜ ç…§ä¸¦è½‰å‡º return this._mapper.Map\u003cIEnumerable\u003cMainTableDto\u003e\u003e(mainTableList); //============================== // ä¸ä½¿ç”¨ AutoMapper é€²è¡Œè³‡æ–™è¨­å®šçš„æ–¹å¼ï¼Œå½ˆæ€§è¼ƒé«˜ï¼Œä½†æ˜¯æ’°å¯«è¼ƒéº»ç…© return mainTableList.Select(o =\u003e new MainTableDto { MainId = o.MainId, // é€™é‚Šå…è¨±ä½¿ç”¨ AutoMapper ç›´æ¥æ˜ ç…§æ¬„ä½ï¼Œå¦‚è¨»è§£ï¼Œä½†è‹¥ Sub Table ä¸­åªéœ€è¦ç‰¹å®šæ¬„ä½çš„è©±ï¼Œå‰‡å»ºè­°ä½¿ç”¨æ­¤è™•ç¯„ä¾‹ä½¿ç”¨çš„å¯«æ³• // OneToManySubItems = this._mapper.Map\u003cIEnumerable\u003cOneToManySubTableDto\u003e\u003e(o.OneToManySubItems) OneToManySubItems = o.OneToManySubItems.Select(m=\u003enew OneToManySubTableDto { SubId = m.SubId, MainId = m.MainId }), // OneToOneSubItem = this._mapper.Map\u003cOneToOneSubTableDto\u003e(o.OneToOneSubItem) OneToOneSubItem = new OneToOneSubTableDto { SubId = o.OneToOneSubItem.SubId, MainId = o.OneToOneSubItem.MainId }) }).ToListAsync(); } å‰è¿°å…©ç¨®æ–¹å¼çš„æ··å’Œå¯«æ³•ï¼Œå‹•æ…‹èª¿æ•´ Db å‡ºä¾†çš„æ¬„ä½ï¼Œåœ¨ä¾æ“šéœ€è¦çµ„åˆæˆè¼¸å‡ºç”¨çš„ Dto æ­¤å¯«æ³•å½ˆæ€§é«˜ï¼ŒæƒŸç¨‹å¼ç¢¼è¼ƒè¤‡é›œ cs private async Task\u003cIEnumerable\u003cMainTableDto\u003e\u003e GetAllMainTableDtos() { var mainTableList = await this._testContext.MainTables .AsNoTracking() .Get() .Include(o=\u003eo.OneToManySubItems) .Include(o=\u003eo.OneToOneSubItem) .Select(o=\u003e new MainTable() { MainId = o.MainId, OneToOneSubItem = o.OneToOneSubItem //é€™é‚Šä¸å†å¦å¤–è¨­å®š OneToMainSubItem æ¬„ä½ï¼Œé€™æ¨£è§¸ç™¼çš„ Sql å°±æœƒæ é OneToOneSubItem é€™å€‹æ¬„ä½ }) .ToListAsync(); // è‹¥ç„¡å…¶å®ƒéœ€æ±‚ï¼Œå¯ç›´æ¥ä½¿ç”¨ AutoMapper é€²è¡Œè³‡æ–™æ˜ ç…§ä¸¦è½‰å‡º return this._mapper.Map\u003cIEnumerable\u003cMainTableDto\u003e\u003e(mainTableList); //============================== // ä¸ä½¿ç”¨ AutoMapper é€²è¡Œè³‡æ–™è¨­å®šçš„æ–¹å¼ï¼Œå½ˆæ€§è¼ƒé«˜ï¼Œä½†æ˜¯æ’°å¯«è¼ƒéº»ç…© return mainTableList.Select(o =\u003e new MainTableDto { MainId = o.MainId, // å› ç‚ºå‰é¢æ²’æœ‰æŠŠ OneToManySubItem å«å‡ºä¾†ï¼Œé€™é‚Šå°±ä¸è¨­å®š OneToManySubItem // è‹¥ä»ä¿ç•™ OneToManySubItem æ¬„ä½çš„è¨­å®šï¼Œå‰‡å¿…é ˆæ³¨æ„ null å€¼å•é¡Œ // OneToOneSubItem = this._mapper.Map\u003cOneToOneSubTableDto\u003e(o.OneToOneSubItem) OneToOneSubItem = new OneToOneSubTableDto { SubId = o.OneToOneSubItem.SubId, MainId = o.OneToOneSubItem.MainId }) }).ToListAsync(); } ","date":"2022-02-06","objectID":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/:0:0","series":[],"tags":["EFCore"],"title":"EF Core è‡ªè¨‚é—œè¯","uri":"/2022/02/ef-core-%E8%87%AA%E8%A8%82%E9%97%9C%E8%81%AF/#ä½¿ç”¨æ–¹å¼"},{"categories":["C#","EF-Core"],"content":"EF Core ä¸­ä½¿ç”¨ Join","date":"2022-02-06","objectID":"/2022/02/use-ef-core-to-join/","series":[],"tags":["EFCore"],"title":"Use EF-Core to Join","uri":"/2022/02/use-ef-core-to-join/"},{"categories":["C#","EF-Core"],"content":"EF Core ä¸­ä½¿ç”¨ Join ä»¥ä¸‹æ“ä½œå‡ä½¿ç”¨ EF Core 5.0 ä»¥ä¸‹ç¨‹å¼ç¢¼ç¯„ä¾‹çš†ç‚º EFCore.ToList() åŸ·è¡Œå‰çš„ IQueryable æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä»åœ¨çµ„åˆ SQL èªæ³•çš„éšæ®µ ä¸ç®¡ä½¿ç”¨å“ªç¨®å¯«æ³•ï¼Œçš†æ‡‰ç›¡å¯èƒ½æ¸›å°‘å·¢ç‹€æ“ä½œ ","date":"2022-02-06","objectID":"/2022/02/use-ef-core-to-join/:0:0","series":[],"tags":["EFCore"],"title":"Use EF-Core to Join","uri":"/2022/02/use-ef-core-to-join/#"},{"categories":["C#","EF-Core"],"content":" Use LinQ Join","date":"2022-02-06","objectID":"/2022/02/use-ef-core-to-join/:0:0","series":[],"tags":["EFCore"],"title":"Use EF-Core to Join","uri":"/2022/02/use-ef-core-to-join/#use-linq-join"},{"categories":["C#","EF-Core"],"content":" 1 Linq Join çš„åƒè€ƒè³‡æ–™ LINQ-to-SQL-Query-Tips-INNER-JOIN-and-LEFT-JOIN) [LINQ+EF]å¦‚ä½•åšå–®ä¸€æ¢ä»¶JOINä»¥åŠè¤‡åˆæ¢ä»¶JOINä»¥åŠå¤šå€‹tableçš„JOIN ","date":"2022-02-06","objectID":"/2022/02/use-ef-core-to-join/:1:0","series":[],"tags":["EFCore"],"title":"Use EF-Core to Join","uri":"/2022/02/use-ef-core-to-join/#linq-join-çš„åƒè€ƒè³‡æ–™"},{"categories":["C#","EF-Core"],"content":" 2 å¤šæ¬„ä½åŒ¹é… å¯«æ³•æ˜¯ Call Method å½¢å¼çš„ Linqï¼Œè€Œéåƒè€ƒè³‡æ–™ä¸­ä½¿ç”¨çš„é—œéµå­—å½¢å¼çš„å¯«æ³• Key ç‚ºå¤šæ¬„ä½çš„ Keyï¼Œå°æ‡‰é—œä¿‚å¦‚ä¸‹ tableA.SectName = tableB.SessionName tableA.DistName = tableB.AreaName cs private IQueryable\u003cOutPutEntity\u003e JointToOutPutEntity( IQueryable\u003cTableA\u003e tableADataList, IQueryable\u003cTableB\u003e tableBDataList) { return tableADataList.Join(tableBDataList, // Join çš„ç¬¬äºŒå€‹åƒæ•¸ç‚º TableA ä¸­è¦ç”¨ä¾†è™•ç†åŒ¹é…åˆ¤æ–·çš„æ¬„ä½ tableA =\u003e new ValueTuple\u003cstring, string\u003e( tableA.SectName, tableA.DistName), // Join çš„ç¬¬ä¸‰å€‹åƒæ•¸ç‚º TableB ä¸­è¦ç”¨ä¾†è™•ç†åŒ¹é…åˆ¤æ–·çš„æ¬„ä½ tableB =\u003e new ValueTuple\u003cstring, string\u003e( tableB.SessionName, tableB.AreaName), (tableA , tableB) =\u003e new OutPutEntity { LandCode = tableA.LandCode, CurrentValue = tableA.CurrentValue, CurrentPrice = tableA.CurrentPrice, SectName = tableB.SessionId, DistName = tableB.ZipCode, }); } å¦ä¸€ç¨®å¯«æ³•ï¼Œå¦‚æœè¦å°‡ Join å¥½çš„ Table æ¬„ä½å…¨æ•¸è¼¸å‡ºçš„è©±å¯ä»¥ä½¿ç”¨æ­¤å¯«æ³• cs private IQueryable\u003cOutPutEntity\u003e JointToOutPutEntity( IQueryable\u003cTableA\u003e tableADataList, IQueryable\u003cTableB\u003e tableBDataList) { return tableADataList.Join(tableBDataList, // Join çš„ç¬¬äºŒå€‹åƒæ•¸ç‚º TableA ä¸­è¦ç”¨ä¾†è™•ç†åŒ¹é…åˆ¤æ–·çš„æ¬„ä½ tableA =\u003e new { tableA.SectName, tableA.DistName}, // Join çš„ç¬¬ä¸‰å€‹åƒæ•¸ç‚º TableB ä¸­è¦ç”¨ä¾†è™•ç†åŒ¹é…åˆ¤æ–·çš„æ¬„ä½ tableB =\u003e new { tableB.SessionName, tableB.AreaName}, (tableA , tableB) =\u003e new { tableA, tableB }); //=====é Method å¯«æ³•å¦‚ä¸‹======= return from tableAData in tableADataList join tableBData in tableBDataList on new { fieldA = tableAData.SectName, fieldB = tableAData.DistName } equals new { fieldA = tableBData.SessionName, fieldB = tableBData.AreaName } select new { tableAData, tableBData }; } ","date":"2022-02-06","objectID":"/2022/02/use-ef-core-to-join/:2:0","series":[],"tags":["EFCore"],"title":"Use EF-Core to Join","uri":"/2022/02/use-ef-core-to-join/#å¤šæ¬„ä½åŒ¹é…"},{"categories":["C#","EF-Core"],"content":" 3 å–®æ¬„ä½åŒ¹é… å¯«æ³•æ˜¯ Call Method å½¢å¼çš„ Linqï¼Œè€Œéåƒè€ƒè³‡æ–™ä¸­ä½¿ç”¨çš„é—œéµå­—å½¢å¼çš„å¯«æ³• Key ç‚ºå–®ä¸€æ¬„ä½çš„ Keyï¼Œå°æ‡‰é—œä¿‚å¦‚ä¸‹ tableA.SectName = tableB.SessionName cs private IQueryable\u003cOutPutEntity\u003e JointToOutPutEntity( IQueryable\u003cTableA\u003e tableADataList, IQueryable\u003cTableB\u003e tableBDataList) { return tableADataList.Join(tableBDataList, tableA =\u003e tableA.SectName, tableB =\u003e tableB.SessionName, (tableA , tableB) =\u003e new OutPutEntity { LandCode = tableA.LandCode, CurrentValue = tableA.CurrentValue, CurrentPrice = tableA.CurrentPrice, SectName = tableB.SessionId, DistName = tableB.ZipCode, }); } ","date":"2022-02-06","objectID":"/2022/02/use-ef-core-to-join/:3:0","series":[],"tags":["EFCore"],"title":"Use EF-Core to Join","uri":"/2022/02/use-ef-core-to-join/#å–®æ¬„ä½åŒ¹é…"},{"categories":["C#","EF-Core"],"content":" Select To Object cs private IQueryable\u003cOutPutEntity\u003e JointToOutPutEntity( IQueryable\u003cTableA\u003e tableADataList, IQueryable\u003cTableB\u003e tableBDataList) { return tableADataList.Select(tableAData =\u003e new OutPutEntity() { A = tableAData.SomeField, B = tableBDataList.FirstOrDefault()?.SomeField TableBOneRow = tableBDataList.FirstOrDefault() //TableBOneRow çš„å‹åˆ¥ç‚º TableB //ä¸‹é¢é€™ç¨®å¯«æ³•æœƒç„¡æ³•ä½¿ç”¨ //TableBOneRows = tableBDataList //TableBOneRow çš„å‹åˆ¥ç‚º IEnumerable\u003cTableB\u003e }); } ","date":"2022-02-06","objectID":"/2022/02/use-ef-core-to-join/:0:0","series":[],"tags":["EFCore"],"title":"Use EF-Core to Join","uri":"/2022/02/use-ef-core-to-join/#select-to-object"},{"categories":["C#","EF-Core"],"content":" Use LinQ SelectManyç•¶éœ€è¦çµ„åˆå¤šå€‹ Table æ™‚ï¼Œå¯ä½¿ç”¨ SelectMany ä¾†è™•ç†ã€‚ ç•¶ä½¿ç”¨ SelectMany å¾Œï¼Œå¯ä»¥å»ºç«‹æ¥µç‚ºè¤‡é›œçš„å¯æ¸¬è©¦æŸ¥è©¢ (å› ç‚ºä¾è³´äº† IQueryable èˆ‡ IEnumerableï¼Œè€Œé SQL)ï¼Œä½†æ˜¯æœƒæœ‰ä¸€å®šçš„é–‹ç™¼ã€ç¶­è­·é›£åº¦ï¼Œéœ€è¦æ³¨æ„ã€‚ cs private IQueryable\u003cOutPutEntity\u003e JointToOutPutEntity( IQueryable\u003cTableA\u003e tableADataList, IQueryable\u003cTableB\u003e tableBDataList) { return tableADataList.SelectMany(tableAData =\u003e tableBDataList.Where(tableBData =\u003e tableBData.BId == tableAData.AId) .DefaultIfEmpty(), // é€™å€‹è¨­å®šå¾ˆé‡è¦ï¼Œæœƒå½±éŸ¿ Sql çµ„æˆèˆ‡åº•ä¸‹çš„è¼¸å‡ºè¨­å®š (tableAData, tablaBData) =\u003e new { tableAData, tableBData }); } ","date":"2022-02-06","objectID":"/2022/02/use-ef-core-to-join/:0:0","series":[],"tags":["EFCore"],"title":"Use EF-Core to Join","uri":"/2022/02/use-ef-core-to-join/#use-linq-selectmany"},{"categories":["Linux"],"content":"Linux Command Memo","date":"2022-02-06","objectID":"/2022/02/linux-command-memo/","series":[],"tags":["Memo"],"title":"Linux Command Memo","uri":"/2022/02/linux-command-memo/"},{"categories":["Linux"],"content":"ssh é ç«¯åˆ° linux server æ™‚å¸¸ç”¨çš„æŒ‡ä»¤ç­†è¨˜ ","date":"2022-02-06","objectID":"/2022/02/linux-command-memo/:0:0","series":[],"tags":["Memo"],"title":"Linux Command Memo","uri":"/2022/02/linux-command-memo/#"},{"categories":["Linux"],"content":" 3 å‘½ä»¤ç´€éŒ„ æ¸…ç©º CLI text ctrl + L æŸ¥çœ‹è·¯ç”±è¡¨ bash netstat -rn æŸ¥çœ‹ç¶²è·¯ä½¿ç”¨ç‹€æ…‹ (Port ä½¿ç”¨ç‹€æ…‹) bash netstat -lptu netstat -tulpn netstat -tln åˆªé™¤è·¯ç”±è¡¨ bash route del -net 10.32.0.0/12 æ¸…é™¤ IpTables è³‡æ–™ è³‡æ–™ä¾†æºï¼šhttp://s2.naes.tn.edu.tw/~kv/iptables.htm bash ###-----------------------------------------------------### # æ¸…é™¤å…ˆå‰çš„è¨­å®š ###-----------------------------------------------------### # æ¸…é™¤é è¨­è¡¨ filter ä¸­ï¼Œæ‰€æœ‰è¦å‰‡éˆä¸­çš„è¦å‰‡ iptables -F # æ¸…é™¤é è¨­è¡¨ filter ä¸­ï¼Œä½¿ç”¨è€…è‡ªè¨‚éˆä¸­çš„è¦å‰‡ iptables -X # æ¸…é™¤mangleè¡¨ä¸­ï¼Œæ‰€æœ‰è¦å‰‡éˆä¸­çš„è¦å‰‡ iptables -F -t mangle # æ¸…é™¤mangleè¡¨ä¸­ï¼Œä½¿ç”¨è€…è‡ªè¨‚éˆä¸­çš„è¦å‰‡ iptables -t mangle -X # æ¸…é™¤natè¡¨ä¸­ï¼Œæ‰€æœ‰è¦å‰‡éˆä¸­çš„è¦å‰‡ iptables -F -t nat # æ¸…é™¤natè¡¨ä¸­ï¼Œä½¿ç”¨è€…è‡ªè¨‚éˆä¸­çš„è¦å‰‡ iptables -t nat -X è³‡æ–™ä¾†æºï¼šhttps://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/ bash iptables -F \u0026\u0026 iptables -t nat -F \u0026\u0026 iptables -t mangle -F \u0026\u0026 iptables -X é‡å•Ÿæ‡‰ç”¨ç¨‹å¼: bash systemctl restart \u003capplication Name\u003e ç¢ºèªæ‡‰ç”¨ç¨‹å¼åŸ·è¡Œç‹€æ…‹ bash systemctl status \u003capplication Name\u003e æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼ç´€éŒ„ (log) bash journalctl -xeu \u003capplication Name\u003e è¨­å®šç’°å¢ƒåƒæ•¸ è³‡è¨Š å¯ä»¥è¨­å®šåˆ° ~/.bash_profile æª”æ¡ˆå…§ï¼Œä¾†è®“æ¯æ¬¡ç™»å…¥éƒ½è‡ªå‹•å¥—ç”¨ç›¸é—œç’°å¢ƒåƒæ•¸ bash # å»ºç«‹ç’°å¢ƒè®Šæ•¸ export \u003ckey\u003e=\u003cvalue\u003e # ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ = ${\u003ckey\u003e} ä½¿ç”¨ç¯„ä¾‹ bash export test=123 echo ${test} # bash ä¸­æœƒé¡¯ç¤º 123 ","date":"2022-02-06","objectID":"/2022/02/linux-command-memo/:1:0","series":[],"tags":["Memo"],"title":"Linux Command Memo","uri":"/2022/02/linux-command-memo/#å‘½ä»¤ç´€éŒ„"},{"categories":["Linux"],"content":" 4 å€šè³´å¥—ä»¶å®‰è£ ç¶²è·¯å·¥å…· (netstat éœ€è¦çš„å¥—ä»¶) bash # yum install net-tools [On CentOS/RHEL] # apt install net-tools [On Debian/Ubuntu] # zypper install net-tools [On OpenSuse] # pacman -S net-tools [On Arch Linux] ","date":"2022-02-06","objectID":"/2022/02/linux-command-memo/:2:0","series":[],"tags":["Memo"],"title":"Linux Command Memo","uri":"/2022/02/linux-command-memo/#å€šè³´å¥—ä»¶å®‰è£"},{"categories":["Kubernetes"],"content":"kube-config è¨­å®šåƒè€ƒ è­¦å‘Š é€™å€‹åšæ³•æœƒæœ‰å®‰å…¨æ€§å•é¡Œï¼Œç†æƒ³ä¸Šé‚„æ˜¯å¦å¤–ä½¿ç”¨ç®¡ç†å·¥å…· (å¦‚ rancher) ä¾†è™•ç†ä½¿ç”¨è€…è³‡è¨Šä»¥åŠä¸€èˆ¬ä½¿ç”¨è€…ä½¿ç”¨çš„ kubeconfig ","date":"2022-02-06","objectID":"/2022/02/%E7%AE%A1%E7%90%86-kubeconfig-%E8%A8%AD%E5%AE%9A/:0:0","series":[],"tags":[],"title":"ç®¡ç† KubeConfig è¨­å®š","uri":"/2022/02/%E7%AE%A1%E7%90%86-kubeconfig-%E8%A8%AD%E5%AE%9A/#"},{"categories":["Kubernetes"],"content":" 1 å–å¾— kubeadm æ‰€å»ºç«‹çš„å¢é›†çš„ç®¡ç†è¨­å®šæª” bash cat /etc/kubernetes/admin.conf ","date":"2022-02-06","objectID":"/2022/02/%E7%AE%A1%E7%90%86-kubeconfig-%E8%A8%AD%E5%AE%9A/:1:0","series":[],"tags":[],"title":"ç®¡ç† KubeConfig è¨­å®š","uri":"/2022/02/%E7%AE%A1%E7%90%86-kubeconfig-%E8%A8%AD%E5%AE%9A/#å–å¾—-kubeadm-æ‰€å»ºç«‹çš„å¢é›†çš„ç®¡ç†è¨­å®šæª”"},{"categories":["Kubernetes"],"content":" 2 å–å¾— suse rke2 æ‰€ç”¢ç”Ÿçš„ç®¡ç†è¨­å®šæª” bash cat /etc/rancher/rke2/rke2.yaml ","date":"2022-02-06","objectID":"/2022/02/%E7%AE%A1%E7%90%86-kubeconfig-%E8%A8%AD%E5%AE%9A/:2:0","series":[],"tags":[],"title":"ç®¡ç† KubeConfig è¨­å®š","uri":"/2022/02/%E7%AE%A1%E7%90%86-kubeconfig-%E8%A8%AD%E5%AE%9A/#å–å¾—-suse-rke2-æ‰€ç”¢ç”Ÿçš„ç®¡ç†è¨­å®šæª”"},{"categories":["Kubernetes"],"content":" 3 è¨­å®šæª”æ¡ˆçµæ§‹ yaml apiVersion: v1 clusters: - cluster: certificate-authority-data: \u003cfirst-cluster-cert-data\u003e server: https://\u003cfirst-cluster domain\u003e:6443 name: first-cluster - cluster: certificate-authority-data: \u003csecond-cluster-cert-data\u003e server: https://\u003csecond-cluster domain\u003e:6443 name: second-cluster contexts: - context: cluster: first-cluster user: first-cluster-admin name: first-cluster-admin@first-cluster - context: cluster: second-cluster user: second-cluster-admin name: second-cluster-admin@second-cluster current-context: first-cluster-admin@first-cluster kind: Config preferences: {} users: - name: first-cluster-admin user: client-certificate-data: \u003cfirst-cluster-admin-cert-data\u003e client-key-data: \u003cfirst-cluster-admin-cert-key\u003e - name: second-cluster-admin user: client-certificate-data: \u003csecond-cluster-admin-cert-data\u003e client-key-data: \u003csecond-cluster-admin-cert-key\u003e ","date":"2022-02-06","objectID":"/2022/02/%E7%AE%A1%E7%90%86-kubeconfig-%E8%A8%AD%E5%AE%9A/:3:0","series":[],"tags":[],"title":"ç®¡ç† KubeConfig è¨­å®š","uri":"/2022/02/%E7%AE%A1%E7%90%86-kubeconfig-%E8%A8%AD%E5%AE%9A/#è¨­å®šæª”æ¡ˆçµæ§‹"},{"categories":["Kubernetes"],"content":"Kubernetes","date":"2022-02-06","objectID":"/2022/02/kubernetes-metrics-install/","series":[],"tags":["Metrics","Prometheus-Adapter","Metrics-Server","Install"],"title":"Kubernetes Metrics Install","uri":"/2022/02/kubernetes-metrics-install/"},{"categories":["Kubernetes"],"content":"è¦è®“ Kubernetes ä¸­çš„ HPA(horizontal-pod-autoscaler) èµ·ä½œç”¨ï¼Œå°±å¿…é ˆå®‰è£è² è¼‰ç›£æ¸¬æœå‹™ï¼Œé€™é‚Šæ•´ç†äº† Metrics-Server èˆ‡ Prometheus-Adapter çš„å®‰è£æ–¹å¼ã€‚ ","date":"2022-02-06","objectID":"/2022/02/kubernetes-metrics-install/:0:0","series":[],"tags":["Metrics","Prometheus-Adapter","Metrics-Server","Install"],"title":"Kubernetes Metrics Install","uri":"/2022/02/kubernetes-metrics-install/#"},{"categories":["Kubernetes"],"content":" Prometheus-Adapter Prometheus Install Use Istioctl addon åœ¨æ­é… istio é€²è¡Œå»ºç½®çš„ Kubernetes çš„ç’°å¢ƒä¸‹ï¼Œç”±æ–¼ istio å®˜æ–¹çš„å®‰è£å·¥å…·ä¸­æœ‰æä¾›é…åˆ istio çš„ Prometheus å®‰è£è¨­å®šï¼Œæ–¹ä¾¿èµ·è¦‹ï¼Œå¯ç›´æ¥ä½¿ç”¨ istio æä¾›çš„å®‰è£è¨­å®šé€²è¡Œå®‰è£ã€‚ è‹¥æ²’æœ‰ä½¿ç”¨ istioï¼Œå‰‡å»ºè­°çµ±ä¸€ä½¿ç”¨ Helm çš„æ–¹å¼å®‰è£ Prometheus / Prometheus-Adapterã€‚ ä»¥ä¸‹å‘½ä»¤çš„ç´€éŒ„å·²é è¨­æ‚¨ç›®å‰çš„ bash ä½ç½®ä½æ–¼ istio å®˜æ–¹å¥—ä»¶çš„è³‡æ–™å¤¾ä¸­ï¼›å³ istioctl çš„ä¸‹è¼‰è³‡æ–™å¤¾ bash kubectl apply -f samples/addons/prometheus.yaml Use Helm æ–°å¢ prometheus çš„ helm charts repo bash helm repo add prometheus-community https://prometheus-community.github.io/helm-charts helm repo add stable https://kubernetes-charts.storage.googleapis.com/ helm repo update Install ä»¥ä¸‹å‘½ä»¤æœƒåœ¨ monitoring é€™å€‹ namespace ä¸­å®‰è£ prometheus bash helm -n monitoring install prometheus prometheus-community/prometheus Prometheus æœå‹™ç¶²é çš„ istio gateway (é¸æ“‡æ€§) istio å®˜æ–¹åƒè€ƒè³‡æ–™ è³‡è¨Š é€™é‚Šæ˜¯å»ºç«‹é€²å…¥ Prometheus ç¶²é çš„ istio ç›¸é—œæœå‹™ï¼Œéå¿…è¦ bash cat \u003c\u003cEOF | kubectl apply -f - apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: prometheus-gateway namespace: istio-system spec: selector: istio: ingressgateway servers: - port: number: 80 name: http-prom protocol: HTTP hosts: - \"\u003cyour domain\u003e\" --- apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: prometheus-vs namespace: istio-system spec: hosts: - \"prometheus.${INGRESS_DOMAIN}\" gateways: - prometheus-gateway http: - route: - destination: host: prometheus port: number: 9090 --- apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: prometheus namespace: istio-system spec: host: prometheus trafficPolicy: tls: mode: DISABLE --- EOF Prometheus-Adapter Install æº–å‚™å®‰è£è¦ç”¨çš„ Helm Values yaml (named prometheus-adapter-values.yaml) Yaml åŸå§‹åƒè€ƒè³‡æ–™ rules å€å¡Šè¨­å®šå…§å®¹åƒè€ƒè³‡æ–™ yaml prometheus: # é€™é‚Šè¨­å®š kubernetes ä¸­ prometheus æœå‹™çš„ä½ç½® # ç”±æ–¼æˆ‘ä½¿ç”¨çš„æ˜¯ istio å…§é™„çš„å®‰è£æª”ï¼Œæ‰€ä»¥é€£çµç‚º istio çš„é€£çµ # url æ ¼å¼ç‚º http://{kube-service-name}.{namespace}.svc.cluster.{cluster-name} url: http://prometheus.istio-system.svc.cluster.local port: 9090 rules: default: true resource: cpu: containerQuery: sum(rate(container_cpu_usage_seconds_total{\u003c\u003c.LabelMatchers\u003e\u003e, container!=\"\"}[5m])) by (\u003c\u003c.GroupBy\u003e\u003e) nodeQuery: sum(rate(container_cpu_usage_seconds_total{\u003c\u003c.LabelMatchers\u003e\u003e, id='/'}[5m])) by (\u003c\u003c.GroupBy\u003e\u003e) resources: overrides: node: resource: node namespace: resource: namespace pod: resource: pod containerLabel: container memory: containerQuery: sum(container_memory_working_set_bytes{\u003c\u003c.LabelMatchers\u003e\u003e, container!=\"\"}) by (\u003c\u003c.GroupBy\u003e\u003e) nodeQuery: sum(container_memory_working_set_bytes{\u003c\u003c.LabelMatchers\u003e\u003e,id='/'}) by (\u003c\u003c.GroupBy\u003e\u003e) resources: overrides: node: resource: node namespace: resource: namespace pod: resource: pod containerLabel: container window: 5m custom: - seriesQuery: '{__name__=~\"istio_requests_total\"}' seriesFilters: [] resources: overrides: kubernetes_namespace: resource: namespace kubernetes_pod_name: resource: pod destination_service_name: resource: service name: matches: \"^(.*)_total\" as: \"${1}_per_min\" metricsQuery: sum(increase(\u003c\u003c.Series\u003e\u003e{\u003c\u003c.LabelMatchers\u003e\u003e}[1m])) by (\u003c\u003c.GroupBy\u003e\u003e) ä½¿ç”¨ helm cli å®‰è£ è­¦å‘Š æˆ‘çš„æ¸¬è©¦ç’°å¢ƒæ˜¯æ­é… ArgoCD è¨­å®š Prometheus çš„ Helm Repoï¼Œä¸¦åœ¨è¨­å®š Application æ™‚é€²è¡Œä»¥ä¸‹è®Šæ›´ 1. æŒ‡å®šä½¿ç”¨é è¨­ values 2. prometheus url æ˜¯ä½¿ç”¨ ArgoCD WebUI å»ç¨ç«‹èª¿æ•´ï¼Œä¸¦æ²’æœ‰è¨­å®šåœ¨è‡ªè¨‚ Values yaml ä¸­ 3. è‡ªè¨‚ Values yaml çš„éƒ¨åˆ†åƒ…æœ‰ rules: ä»¥ä¸‹å…§å®¹ ç”±æ–¼ä¸æ˜¯ä½¿ç”¨ CLI ä½œæ¥­ï¼Œæˆ‘ä¸ä¿è­‰æˆ‘é€™é‚Šæä¾›çš„å‘½ä»¤æ˜¯å¯ç”¨çš„ bash helm -n istio-system install prometheus-adapter prometheus-community/prometheus-adapter -f prometheus-adapter-values.yaml ç­‰å¾…éƒ¨å±¬å®Œç•¢ä¹‹å¾Œ HPA ä¸­çš„ unknow æ‡‰è©²å°±éƒ½æœƒè®Šæˆå¯¦éš›çš„è³‡æºä½¿ç”¨é‡äº† helm å®‰è£æ™‚ä½¿ç”¨çš„è‡ªè¨‚ Yaml æª”æ¡ˆä¸­çš„ rule èªªæ˜ ç‰ˆæœ¬ 1 åƒè€ƒç¶²å€ yaml rules: custom: - seriesQuery: 'istio_requests_total{kubernetes_namespace!=\"\",kubernetes_pod_name!=\"\"}' resources: overrides: kubernetes_namespace: {resource: \"namespace\"} kubernetes_pod_name: {resource: \"pod\"} name: matches: \"^(.*)_total\" as: \"${1}_per_second\" metricsQuery: 'sum(rate(\u003c\u003c.Series\u003e\u003e{\u003c\u003c.LabelMatchers\u003e\u003e}[2m])) by (\u003c\u003c.GroupBy\u003e\u003e)' ç‰ˆæœ¬ 2 åƒè€ƒç¶²å€ yaml rules: custom: - seriesQuery: '{__name__=~\"istio_requests_total\"}' seriesFilters: [] resources: overrides: kubernetes_namespace: resource: namespace kubernetes_pod_name: resource: pod destination_service_name: resource: service name: matches: \"^(.*)_total\" as: \"${1","date":"2022-02-06","objectID":"/2022/02/kubernetes-metrics-install/:0:0","series":[],"tags":["Metrics","Prometheus-Adapter","Metrics-Server","Install"],"title":"Kubernetes Metrics Install","uri":"/2022/02/kubernetes-metrics-install/#prometheus-adapter"},{"categories":["Kubernetes"],"content":" 1 Use Metrics-ServerMetrics-server å®˜æ–¹ GitHub å‰ç½®ä½œæ¥­ - TLS Issue metrics-server use https k8s å•Ÿç”¨è­‰æ›¸ç®¡ç† metrics-server github faq Edit Kubelet Config ä½¿ç”¨å‘½ä»¤ç¢ºèª kubelet-config çš„åç¨± text kubectl get cm -n kube-system åŸ·è¡Œå¾Œæ‡‰è©²å¯ä»¥çœ‹åˆ° kubelet-config-\u003cversion\u003e çš„è¨­å®šåç¨± ç·¨è¼¯ kubelet-config text kubectl edit cm kubelet-config-\u003cversion\u003e -n kube-system åœ¨ data å€æ®µæœ€ä¸‹æ–¹åŠ å…¥é€™è¡Œ (æˆ–ç¢ºèªé€™è¡Œæœ‰æ²’æœ‰å­˜åœ¨) text serverTLSBootstrap: true åŸ·è¡Œ :wq å­˜æª” èª¿æ•´æ¯å€‹ Node ä¸­çš„ kubelet è¨­å®šæª” ç·¨è¼¯è¨­å®šæª” text vim /var/lib/kubelet/config.yaml åœ¨ data å€æ®µæœ€ä¸‹æ–¹åŠ å…¥é€™è¡Œ (æˆ–ç¢ºèªé€™è¡Œæœ‰æ²’æœ‰å­˜åœ¨) text serverTLSBootstrap: true åŸ·è¡Œ :wq å­˜æª” Restart kubelet (æ¯å€‹ NODE (Master/sub) éƒ½è¦åŸ·è¡Œ) text systemctl restart kubelet ä½¿ç”¨å‘½ä»¤ç¢ºèªæ†‘è­‰ç‹€æ…‹ text kubectl get csr æ‰¹å‡†å‰ä¸€æ­¥å–å¾—çš„æ†‘è­‰æ¸…å–®ä¸­ï¼Œå°šæœªèªè­‰çš„é …ç›® text kubectl certificate approve \u003cCSR-åç¨±\u003e è£œå……-åˆ—å‡ºç¾æœ‰æ†‘è­‰ text kubeadm certs check-expiration è£œå……-æ›´æ–°æ†‘è­‰ text kubeadm certs renew è£œå……-è‡ªå‹•æ›´æ–° kubelet æ†‘è­‰çš„å·¥å…· kubelet rubber stamp è³‡è¨Š kubeadm å®‰è£æ™‚é è¨­æœ‰è¨­å®šè‡ªå‹•æ›´æ–°æ†‘è­‰ï¼Œä½†ä¸ç¢ºå®šæ˜¯å¦å¯è‡ªå‹•æ›´æ–° kubelet çš„æ†‘è­‰ï¼Œå¾…ç¢ºèª Use Helm Install Add Metrics-Server Helm Repo bash helm repo add metrics-server https://kubernetes-sigs.github.io/metrics-server/ Install è‹¥æœªçµ¦ namespace åƒæ•¸ï¼Œæœƒè¢«å®‰è£åœ¨ default ä¹‹ä¸­ï¼Œå»ºè­°å®‰è£åˆ° Kube-system bash helm upgrade --install metrics-server metrics-server/metrics-server -n kube-system Edit metrics-server deploy setting command text kubectl edit deploy -n kube-system metrics-server èª¿æ•´å…§å®¹ metrics-server depoly è¨­å®šåƒè€ƒ yaml spec: containers: - args: - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname #ä¸‹é¢é€™è¡Œå¦‚æœæ²’æœ‰è™•ç†å‰ç½®æ­¥é©Ÿé‚£é‚Šçš„è­‰æ›¸è¨­å®šçš„è©±æœƒéœ€è¦ #- --kubelet-insecure-tls - --metric-resolution=30s image: k8s.gcr.io/metrics-server-amd64:v0.3.3 imagePullPolicy: Always name: metrics-server resources: {} terminationMessagePath: /dev/termination-log terminationMessagePolicy: File volumeMounts: - mountPath: /tmp name: tmp-dir dnsPolicy: ClusterFirst #ä¸‹é¢é€™è¡Œå¾ˆé‡è¦ hostNetwork: true Proxy å•é¡Œ å¦‚æœæ›´æ–°å®Œå‰è¿°å…§å®¹é²é²ç„¡æ³•çœ‹åˆ° HPA é¡¯ç¤ºè³‡æºä½¿ç”¨ç‹€æ³çš„è©±ï¼Œéœ€æª¢è¦– Proxy è¨­å®š å»ºè­° NO_PROXY è¦è¨­å®šé€™äº› Linux è¨­å®š NO_PROXY bash export NO_PROXY=istio-sidecar-injector.istio-system.svc,.svc,172.30.0.0/16,localhost,10.0.0.0/8 kube.apiserver è¨­å®š NO_PROXY bash vim /etc/kubernetes/manifests/kube-apiserver.yaml ç·¨è¼¯ env: å€æ®µ yaml env: - name: HTTPS_PROXY value: \u003cProxy Server\u003e - name: NO_PROXY value: istio-sidecar-injector.istio-system.svc,.svc,localhost,10.0.0.0/8 ","date":"2022-02-06","objectID":"/2022/02/kubernetes-metrics-install/:1:0","series":[],"tags":["Metrics","Prometheus-Adapter","Metrics-Server","Install"],"title":"Kubernetes Metrics Install","uri":"/2022/02/kubernetes-metrics-install/#use-metrics-server"},{"categories":["Kubernetes"],"content":" 2 REF github devopsbox-io/example-istio-hpa k8så®‰è£…metrics-server deckhouse.io/prometheus-metrics-adapter ","date":"2022-02-06","objectID":"/2022/02/kubernetes-metrics-install/:2:0","series":[],"tags":["Metrics","Prometheus-Adapter","Metrics-Server","Install"],"title":"Kubernetes Metrics Install","uri":"/2022/02/kubernetes-metrics-install/#ref"},{"categories":["Istio"],"content":"ä½¿ç”¨ Helm å®‰è£ Istio ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-helm/:0:0","series":[],"tags":["Istio","service-mesh"],"title":"Istio Install - Use Helm","uri":"/2022/02/istio-install-use-helm/#"},{"categories":["Istio"],"content":" å®˜æ–¹åƒè€ƒè³‡æ–™ ç”¨å®˜æ–¹å·¥å…·å®‰è£ : https://istio.io/latest/docs/setup/install/istioctl/ ç”¨ HELM å®‰è£ : https://istio.io/latest/docs/setup/install/helm/ ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-helm/:0:0","series":[],"tags":["Istio","service-mesh"],"title":"Istio Install - Use Helm","uri":"/2022/02/istio-install-use-helm/#å®˜æ–¹åƒè€ƒè³‡æ–™"},{"categories":["Istio"],"content":" Use HELM è­¦å‘Š 2022-01-10 OS: CentOS 7 - Kernel: 3.10 Helm ä¸­çš„ istio gateway ç‰ˆæœ¬å®‰è£å† kernel = 3.10 çš„ linux ä¸Šé¢æœƒç™¼ç”Ÿä»¥ä¸‹å•é¡Œï¼Œå»ºè­°ä½¿ç”¨ istioctl å·¥å…·å®‰è£ container init caused â€œopen /proc/sys/net/ipv4/ip_unprivileged_port_start: no such file or directoryâ€ æ›´æ–° HELM è³‡æ–™ bash helm repo add istio https://istio-release.storage.googleapis.com/charts helm repo update å»ºç«‹ istio namespace bash kubectl create namespace istio-system å®‰è£æ ¸å¿ƒ bash helm install istio-base istio/base -n istio-system å®‰è£ istio discovery chart bash helm install istiod istio/istiod -n istio-system --wait å®‰è£ Istio Ingress Gateway (åšç‚ºä¸»è¦çš„ç³»çµ±é€²å…¥é»ï¼Œæ›¿ä»£ k8s ingress gateway) bash kubectl create namespace istio-ingress kubectl label namespace istio-ingress istio-injection=enabled helm install istio-ingress istio/gateway -n istio-ingress --wait è³‡è¨Š å¦‚æœåœ¨å®‰è£ Istio Ingress Gateway å‡ºç¾ä¸‹åˆ—è¨Šæ¯ Error: INSTALLATION FAILED: timed out waiting for the condition è«‹ç§»é™¤ namespace istio-ingress ä¸Šé¢çš„ istio-injection=enabled label å¾Œå†é‡æ–°åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ bash kubectl create namespace istio-ingress helm install istio-ingress istio/gateway -n istio-ingress --wait ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-helm/:0:0","series":[],"tags":["Istio","service-mesh"],"title":"Istio Install - Use Helm","uri":"/2022/02/istio-install-use-helm/#use-helm"},{"categories":["Istio"],"content":" Set SiteCar bash kubectl label namespace default istio-injection=enabled --overwrite kubectl get namespace -L istio-injection è­¦å‘Š å¦‚æœè»Šæ›ä¸ä¸Šå»ï¼Œæˆ–æ˜¯æ›ä¸Šå»ä¹‹å¾Œç™¼ç¾ç„¡æ³•éƒ¨å±¬ï¼Œè«‹æª¢æŸ¥ kube-apiserver é€™å€‹ pod çš„ç’°å¢ƒè®Šæ•¸ ç•¶ api server æœ‰æ› proxy çš„è©±ï¼Œæœƒç„¡æ³•æ›è»Š REF (SCH): https://istio.io/latest/zh/docs/ops/common-problems/injection/#automatic-sidecar-injection-fails-if-the-Kubernetes-API-server-has-proxy-settings REF (ENG): https://istio.io/latest/docs/ops/common-problems/injection/#automatic-sidecar-injection-fails-if-the-kubernetes-api-server-has-proxy-settings æœ‰å…©ç¨®è§£æ³• (å»ºè­°æ–¹æ³• 2) ï¼š é‡å•Ÿæ–¹å¼çš„åƒè€ƒ : https://stackoverflow.com/a/51763158 èª¿æ•´ç’°å¢ƒè®Šæ•¸ä¸¦é‡å•Ÿ (åˆªé™¤) pods/kube-apiserverï¼Œè®“ apiserver å¥—ç”¨è¨­å®š è¨­å®šç’°å¢ƒè®Šæ•¸ bash export NO_PROXY=NO_PROXY=istio-sidecar-injector.istio-system.svc,.svc åˆªé™¤ kube-apiserver (å› ç‚º api server æ˜¯ç”± k8s ç³»çµ±ç®¡ç†ï¼Œåˆªé™¤å¾Œæœƒè‡ªå‹•é‡å»º) bash kubectl delete po kube-apiserver-\u003cnode name\u003e -n kube-system å¦‚æœæœ‰å®šç¾©é–‹æ©Ÿ (ç™»å…¥) å¾Œè‡ªå‹•å»ºç«‹ PROXY çš„ç’°å¢ƒè®Šæ•¸ï¼Œå°‡ NO_PROXY è¨­å®šåŠ å…¥ bash vim ~/.bash_profile # æŠŠ NO_PROXY è¨­å®šæª”åŠ åˆ°ç’°å¢ƒè®Šæ•¸ export NO_PROXY=NO_PROXY=istio-sidecar-injector.istio-system.svc,.svc source ~/.bash_profile ç·¨è¼¯ api server çš„è¨­å®šæª”å¾Œé‡å•Ÿ é–‹å•Ÿè¨­å®šæª” text vim /etc/kubernetes/manifests/kube-apiserver.yaml æ‰¾åˆ° env ç¯€é»ä¸¦åŠ å…¥ NO_PROXY è¨­å®š yaml env: - name: HTTPS_PROXY value: \u003cyour proxy\u003e - name: NO_PROXY value: istio-sidecar-injector.istio-system.svc,.svc åˆªé™¤ kube-apiserver (å› ç‚º api server æ˜¯ç”± k8s ç³»çµ±ç®¡ç†ï¼Œåˆªé™¤å¾Œæœƒè‡ªå‹•é‡å»º) text kubectl delete po kube-apiserver-\u003cnode name\u003e -n kube-system ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-helm/:0:0","series":[],"tags":["Istio","service-mesh"],"title":"Istio Install - Use Helm","uri":"/2022/02/istio-install-use-helm/#set-sitecar"},{"categories":["Istio"],"content":" è§£é™¤å®‰è£ Istio bash helm install istio-base istio/base -n istio-system helm install istiod istio/istiod -n istio-system --wait kubectl delete namespace istio-system ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-helm/:0:0","series":[],"tags":["Istio","service-mesh"],"title":"Istio Install - Use Helm","uri":"/2022/02/istio-install-use-helm/#è§£é™¤å®‰è£-istio"},{"categories":["Istio"],"content":"Istio å®‰è£ç­†è¨˜","date":"2022-02-01","objectID":"/2022/02/istio-install-use-istioctl/","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio Install - Use istioctl","uri":"/2022/02/istio-install-use-istioctl/"},{"categories":["Istio"],"content":"ä½¿ç”¨ Istio å®˜æ–¹ CLI (istioctl) å®‰è£ Istio ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-istioctl/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio Install - Use istioctl","uri":"/2022/02/istio-install-use-istioctl/#"},{"categories":["Istio"],"content":" å®˜æ–¹åƒè€ƒè³‡æ–™ ç”¨å®˜æ–¹å·¥å…·å®‰è£ : https://istio.io/latest/docs/setup/install/istioctl/ ç”¨ HELM å®‰è£ : https://istio.io/latest/docs/setup/install/helm/ ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-istioctl/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio Install - Use istioctl","uri":"/2022/02/istio-install-use-istioctl/#å®˜æ–¹åƒè€ƒè³‡æ–™"},{"categories":["Istio"],"content":" Use istioctldownload bash # Latest curl -L https://istio.io/downloadIstio | sh - # specific version curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.12.0 TARGET_ARCH=x86_64 sh - è¨˜å¾—åˆ°åƒæ•¸æª”æ¡ˆå…§è¨­å®š istioctl çš„åŸ·è¡Œæª”ä½ç½® bash vim ~/.bash_profile # æŠŠ istio å·¥å…·åŠ å…¥åŸ·è¡Œè·¯å¾‘ PATH=$PATH:$HOME/bin:/root/istio-1.12.0/bin #PATH=$PATH:$HOME/bin:/root/istio-1.12.1/bin å¦‚æœæ˜¯åœ¨ Single Node Cluster çš„ç’°å¢ƒä¸‹ï¼Œè¨˜å¾—ä¸‹é€™å€‹æŒ‡ä»¤æ‰èƒ½åœ¨ Master (Control plane) å®‰è£æœå‹™ è³‡è¨Š istio é™¤äº† core ä¹‹å¤–éƒ½æ˜¯å±¬æ–¼ä¸€èˆ¬æœå‹™ï¼Œå¦‚æœæ²’æœ‰ä¸‹ taint çš„æŒ‡ä»¤æœƒç„¡æ³•å®‰è£æˆåŠŸ bash kubectl taint nodes --all node-role.kubernetes.io/master- # kubernetes 1.24 è¦æ”¹ç”¨é€™å€‹ kubectl taint nodes --all node-role.kubernetes.io/control-plane- node-role.kubernetes.io/master- åœ¨æ­£å¼ç’°å¢ƒä¸Šï¼Œå»ºè­°æœ€å°å®‰è£ï¼Œå¾ŒçºŒå…¶ä»–æ±è¥¿æ…¢æ…¢å€‹åˆ¥è£ bash istioctl install --set profile=minimal è­¦å‘Š istio cni åªæ˜¯ k8s cni çš„æ“´å……å¥—ä»¶ï¼Œä»éœ€è¦å®‰è£ weave net cni ç­‰ cni æœå‹™ å®˜æ–¹å®‰è£è³‡æ–™ ä½¿ç”¨æœ€å° + istio cni bash istioctl install --set profile=minimal --set components.cni.enabled=true è³‡è¨Š å»ºè­°ä½¿ç”¨æœ€å° + CNI Ingress / Egress Gateway éƒ½å¯ä»¥ä¹‹å¾Œå†ä¾æ“šå¯¦éš›çš„ç¶²è·¯éœ€æ±‚å®‰è£ (ä¾‹å¦‚è¦æ§åˆ¶å°å¤–é–‹æ”¾çš„ port ä¹‹é¡çš„) åªæ˜¯è¦æ³¨æ„ï¼ŒIngress / Egress Gateway çš„è‡ªè¨‚å®‰è£éœ€è¦åœ¨åŒä¸€å€‹æª”æ¡ˆï¼Œä¸èƒ½å€‹åˆ¥è£½ä½œæª”æ¡ˆå†ç”¨ istioctl å·¥å…·å®‰è£ï¼Œå› ç‚ºä¸å­˜åœ¨æ–¼ç•¶æ¬¡å®‰è£ä½¿ç”¨çš„ yaml æª”ä¸­çš„ gateway è¨­å®šæœƒè¢« istioctl å·¥å…·æ¸…æ‰ ä½¿ç”¨ default + istio cni bash istioctl install --set components.cni.enabled=true â€“å–å¾— istio ingress gateway çš„ç‹€æ…‹ (ä½¿ç”¨å®˜æ–¹æä¾›çš„é è¨­å®‰è£æª”æ™‚å¯ç”¨) bash kubectl get svc istio-ingressgateway -n istio-system â€“æŸ¥ k8s ingress è¨­å®šç‹€æ³ bash kubectl get ingress --all-namespaces â€“æŸ¥ k8s gateway è¨­å®šç‹€æ³ bash kubectl get gateway --all-namespaces ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-istioctl/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio Install - Use istioctl","uri":"/2022/02/istio-install-use-istioctl/#use-istioctl"},{"categories":["Istio"],"content":" Set SiteCar bash kubectl label namespace default istio-injection=enabled --overwrite kubectl get namespace -L istio-injection è­¦å‘Š å¦‚æœè»Šæ›ä¸ä¸Šå»ï¼Œæˆ–æ˜¯æ›ä¸Šå»ä¹‹å¾Œç™¼ç¾ç„¡æ³•éƒ¨å±¬ï¼Œè«‹æª¢æŸ¥ kube-apiserver é€™å€‹ pod çš„ç’°å¢ƒè®Šæ•¸ ç•¶ api server æœ‰æ› proxy çš„è©±ï¼Œæœƒç„¡æ³•æ›è»Š REF (SCH): https://istio.io/latest/zh/docs/ops/common-problems/injection/#automatic-sidecar-injection-fails-if-the-Kubernetes-API-server-has-proxy-settings REF (ENG): https://istio.io/latest/docs/ops/common-problems/injection/#automatic-sidecar-injection-fails-if-the-kubernetes-api-server-has-proxy-settings æœ‰å…©ç¨®è§£æ³• (å»ºè­°æ–¹æ³• 2) ï¼š é‡å•Ÿæ–¹å¼çš„åƒè€ƒ : https://stackoverflow.com/a/51763158 èª¿æ•´ç’°å¢ƒè®Šæ•¸ä¸¦é‡å•Ÿ (åˆªé™¤) pods/kube-apiserverï¼Œè®“ apiserver å¥—ç”¨è¨­å®š è¨­å®šç’°å¢ƒè®Šæ•¸ bash export NO_PROXY=NO_PROXY=istio-sidecar-injector.istio-system.svc,.svc åˆªé™¤ kube-apiserver (å› ç‚º api server æ˜¯ç”± k8s ç³»çµ±ç®¡ç†ï¼Œåˆªé™¤å¾Œæœƒè‡ªå‹•é‡å»º) bash kubectl delete po kube-apiserver-\u003cnode name\u003e -n kube-system å¦‚æœæœ‰å®šç¾©é–‹æ©Ÿ (ç™»å…¥) å¾Œè‡ªå‹•å»ºç«‹ PROXY çš„ç’°å¢ƒè®Šæ•¸ï¼Œå°‡ NO_PROXY è¨­å®šåŠ å…¥ bash vim ~/.bash_profile # æŠŠ NO_PROXY è¨­å®šæª”åŠ åˆ°ç’°å¢ƒè®Šæ•¸ export NO_PROXY=NO_PROXY=istio-sidecar-injector.istio-system.svc,.svc source ~/.bash_profile ç·¨è¼¯ api server çš„è¨­å®šæª”å¾Œé‡å•Ÿ é–‹å•Ÿè¨­å®šæª” text vim /etc/kubernetes/manifests/kube-apiserver.yaml æ‰¾åˆ° env ç¯€é»ä¸¦åŠ å…¥ NO_PROXY è¨­å®š yaml env: - name: HTTPS_PROXY value: \u003cyour proxy\u003e - name: NO_PROXY value: istio-sidecar-injector.istio-system.svc,.svc åˆªé™¤ kube-apiserver (å› ç‚º api server æ˜¯ç”± k8s ç³»çµ±ç®¡ç†ï¼Œåˆªé™¤å¾Œæœƒè‡ªå‹•é‡å»º) text kubectl delete po kube-apiserver-\u003cnode name\u003e -n kube-system ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-istioctl/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio Install - Use istioctl","uri":"/2022/02/istio-install-use-istioctl/#set-sitecar"},{"categories":["Istio"],"content":" è§£é™¤å®‰è£ Istio bash istioctl x uninstall --purge istioctl x uninstall --set profile=minimal --purge kubectl delete namespace istio-system ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-istioctl/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio Install - Use istioctl","uri":"/2022/02/istio-install-use-istioctl/#è§£é™¤å®‰è£-istio"},{"categories":["Istio"],"content":" é©—è­‰ Instio å®‰è£ bash istioctl manifest generate \u003e $HOME/generated-manifest.yaml istioctl manifest generate --set profile=minimal \u003e $HOME/generated-manifest.yaml istioctl verify-install -f $HOME/generated-manifest.yaml ","date":"2022-02-01","objectID":"/2022/02/istio-install-use-istioctl/:0:0","series":[],"tags":["Istio","service-mesh","Install"],"title":"Istio Install - Use istioctl","uri":"/2022/02/istio-install-use-istioctl/#é©—è­‰-instio-å®‰è£"},{"categories":["Kubernetes"],"content":"Kubectl command note","date":"2022-02-01","objectID":"/2022/02/kubectl-command-note/","series":["Kubernetes"],"tags":["Kubernetes"],"title":"Kubectl command note","uri":"/2022/02/kubectl-command-note/"},{"categories":["Kubernetes"],"content":"Kubernetes CLI - Kubectl çš„å‘½ä»¤è¡¨ kubectl æ˜¯ k8s æ ¸å¿ƒçš„å·¥å…·ï¼Œæ¯å€‹ node éƒ½æœƒéœ€è¦è£ä¸€å€‹ é€™é‚Šæ•´ç†å‡ºå¸¸ç”¨å‘½ä»¤ï¼Œè©³ç´°å‘½ä»¤è«‹åƒè€ƒå®˜æ–¹ç¶²ç«™ è³‡è¨Š é€™é‚Šåˆ—å‡ºä¸€äº›å¸¸ç”¨çš„å®Œæ•´å‘½ä»¤æˆ–æ˜¯ä¸€äº›ç¯„ä¾‹ï¼Œè‹¥æœ‰å…¶ä»–éœ€æ±‚å¯ä»¥é…åˆå¸¸ç”¨åƒæ•¸è¡¨é€²è¡Œçµ„åˆ æœ‰äº›å‘½ä»¤ä¸Šæœ‰æ‡‰ç”¨æƒ…å¢ƒï¼Œåœ¨é€™é‚Šå°±ä¸æœƒé™„ä¸Šç¯„ä¾‹ (ä¾‹å¦‚ kubectl apply / kubectl delete) å–å¾—ç¾åœ¨ä½¿ç”¨çš„è¨­å®šæª” text kubectl config current-context å¸¸ç”¨åƒæ•¸è¡¨ åƒæ•¸ èªªæ˜ -n \u003cnamespace\u003e å®šç¾©ç¾åœ¨çš„å‘½ä»¤æ˜¯å°æ‡‰ç‰¹å®š namespaceï¼Œå– nodes è³‡æ–™æ™‚ç„¡æ•ˆæœ â€“all-namespaces å®šç¾©ç¾åœ¨çš„å‘½ä»¤æ˜¯å°æ‡‰æ‰€æœ‰ namespaceï¼Œå– nodes è³‡æ–™æ™‚ç„¡æ•ˆæœï¼Œåœ¨æœ‰æŒ‡å®šç‰¹å®šè³‡æºæ™‚æœƒå ±éŒ¯ -A å®šç¾©ç¾åœ¨çš„å‘½ä»¤æ˜¯å°æ‡‰æ‰€æœ‰ namespaceï¼Œå– nodes è³‡æ–™æ™‚ç„¡æ•ˆæœï¼Œåœ¨æœ‰æŒ‡å®šç‰¹å®šè³‡æºæ™‚æœƒå ±éŒ¯ -o wide å‘ˆç¾æ›´å¤šè³‡æ–™ï¼Œkubectl describe * å‘½ä»¤ç„¡æ³•ä½¿ç”¨ po \u003cpods name\u003e ä»£è¡¨ podsï¼Œæ²’æœ‰è¨­å®šæŒ‡å®š pods name çš„è©±ä»£è¡¨æ‰€æœ‰ pods pos \u003cpods name\u003e åŒ po \u003cpods name\u003e pods \u003cpods name\u003e åŒ po \u003cpods name\u003e no \u003cNodes name\u003e ä»£è¡¨ nodesï¼Œæ²’æœ‰è¨­å®šæŒ‡å®š nodes name çš„è©±ä»£è¡¨æ‰€æœ‰ nodes æˆ–æ˜¯åŸ·è¡Œå‘½ä»¤çš„æœ¬æ©Ÿ (çœ‹åŸ·è¡Œ get é‚„æ˜¯ describe å‘½ä»¤) node \u003cNodes name\u003e åŒ no \u003cNodes name\u003e nodes \u003cNodes name\u003e åŒ no \u003cNodes name\u003e svc \u003cservice name\u003e ä»£è¡¨ serviceï¼Œæ²’æœ‰è¨­å®šæŒ‡å®š service name çš„è©±ä»£è¡¨æ‰€æœ‰ service service \u003cservice name\u003e åŒ svc \u003cservice name\u003e services \u003cservice name\u003e åŒ svc \u003cservice name\u003e all å–å¾—å¯ä»¥å–å¾—çš„æ‰€æœ‰è³‡æº ( pods / nodes / service / â€¦) ns namespace é…åˆ get / describe å‘½ä»¤ï¼Œå¯ä»¥æŒ‡å®šè¦å–å¾—å“ªå€‹ namespace çš„è³‡æ–™ï¼Œæ²’æœ‰å®šç¾©åå­—çš„è©±ä»£è¡¨å…¨éƒ¨ï¼Œèˆ‡ -n æ•ˆæœä¸åŒ kubectl describe * å–å¾—æŒ‡å®šé …ç›®çš„è©³ç´°å…§å®¹ å¯ä»¥ç”¨ä¾†çœ‹æª”æ¡ˆ (æˆ–ç¶²è·¯è³‡æº) å…§å®¹ è­¦å‘Š -o wide åƒæ•¸ç„¡æ•ˆ ä¸å»ºè­°ä½¿ç”¨ all \u0026 -A åƒæ•¸ æŒ‡å®š pods è©³ç´°å…§å®¹ bash kubectl describe pods \u003cpods name\u003e -n \u003cnamespace\u003e Node è©³ç´°å…§å®¹ å› ç‚º node æ²’æœ‰ namespace å•é¡Œï¼Œæ‰€ä»¥ namespace ç›¸é—œåƒæ•¸åœ¨çœ‹ node æ™‚ç„¡æ•ˆ (ä½†ä¸æœƒå ±éŒ¯) æ²’æœ‰å®šç¾© node åç¨±æ™‚ï¼Œé è¨­åŸ·è¡Œå‘½ä»¤çš„é‚£å°æ©Ÿå™¨ bash kubectl describe no \u003cpods name\u003e æ‰€æœ‰å¯å–å¾—çš„è³‡æ–™çš„è©³ç´°å…§å®¹ (é è¨­å‘½åç©ºé–“) bash kubectl describe all æ‰€æœ‰å¯å–å¾—çš„è³‡æ–™çš„è©³ç´°å…§å®¹ (æ‰€æœ‰å‘½åç©ºé–“) bash kubectl describe all -A kubectl get * å–å¾—æŒ‡å®šé …ç›®çš„è³‡è¨Šæ¸…å–®ï¼Œé€™å€‹å‘½ä»¤çš„è³‡æ–™ä¸»è¦è¡¨ç¾å½¢å¼ç‚ºè¡¨æ ¼ å–å¾—ç‰¹å®š namespace çš„æ‰€æœ‰è³‡è¨Š bash kubectl get all -n \u003cname space\u003e å–å¾—æ‰€æœ‰ K8s è³‡æ–™çš„è¡¨æ ¼ bash kubectl get all -A å–å¾— kube-system é€™å€‹ namespace ä¸­çš„æ‰€æœ‰ pods ä¸¦åˆ—å‡ºæ›´è©³ç´°çš„å…§å®¹ bash kubectl get po -n kube-system -o wide kubectl get pods -n kube-system -o wide åˆ—å‡ºæ‰€æœ‰ pods (ä¸é™å‘½åç©ºé–“) bash kubectl get pods --all-namespaces kubectl get pods -A å–å¾—æ‰€æœ‰æœå‹™ bash kubectl get svc -A kubectl get services -A å–å¾—éƒ¨å±¬æ¸…å–® bash kubectl get deployment -A kubectl apply -f \u003cfile or url\u003e å¥—ç”¨éƒ¨å±¬è¨­å®šä¸¦é€²è¡Œéƒ¨å±¬ kubectl delete -f \u003cfile or url\u003e åˆªé™¤éƒ¨å±¬è¨­å®šèˆ‡å·²éƒ¨å±¬è³‡æº kubectl port-forward \u003cpods name\u003e \u003chost port\u003e:\u003cpods port\u003e -n \u003cnamespace\u003e å®šç¾© pode å°å¤–çš„ port è­¦å‘Š ä¸å»ºè­°ä½¿ç”¨ kubectl rollout restart deploy -n \u003cNAMESPACE\u003e é‡å•Ÿå·²éƒ¨å±¬è³‡æº è³‡è¨Š æ‰€æœ‰å‘½åç©ºé–“çš„åƒæ•¸ -A åœ¨é€™å€‹å‘½ä»¤ç„¡æ•ˆ REF1: https://qvault.io/open-source/how-to-restart-all-pods-in-a-kubernetes-namespace/ REF2: https://discuss.kubernetes.io/t/restart-all-deployment-in-a-namespace/8165/7 é‡å•ŸæŒ‡å®šå‘½åç©ºé–“å…§çš„è³‡æº bash kubectl rollout restart deploy -n \u003cNAMESPACE\u003e æŒ‡å®šéƒ¨å±¬è³‡æ–™é€²è¡Œé‡å•Ÿ è³‡è¨Š éƒ¨å±¬è¨­å®šçš„åç¨±å¯é…åˆ kubectl get deploymant å‘½ä»¤å–å¾— bash kubectl rollout restart deployments/\u003cname\u003e ","date":"2022-02-01","objectID":"/2022/02/kubectl-command-note/:0:0","series":["Kubernetes"],"tags":["Kubernetes"],"title":"Kubectl command note","uri":"/2022/02/kubectl-command-note/#"},{"categories":["Kubernetes"],"content":"Kubernetes Overloading","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/"},{"categories":["Kubernetes"],"content":"Kubernetes Node çš„è² è¼‰ç›¸é—œç­†è¨˜ ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:0:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#"},{"categories":["Kubernetes"],"content":" è³‡æºè¨­å®šå–®ä½[Kubernetes] åˆ†é… \u0026 ç®¡ç† container æ‰€ä½¿ç”¨åˆ°çš„è¨ˆç®—è³‡æº ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:0:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#è³‡æºè¨­å®šå–®ä½"},{"categories":["Kubernetes"],"content":" 1 CPUKubernetes officiel Document CPU è³‡æºè¨­å®šåœ¨æ²’æœ‰é™„å¸¶å–®ä½çš„ç‹€æ³ä¸‹ï¼Œè©²æ•¸å­—è¦–ç‚º CPU Core æ•¸é‡ï¼›ä¾‹å¦‚ 1 = 1 coreã€‚ å–®ä½ 1000m = 1 (core) æœ€å°ç‚º 100m (= 0.1 core) å¦‚æœè³‡æºè¨­å®šè¦å°æ–¼ 1 core çš„è©±ï¼Œå»ºè­°ä½¿ç”¨ 100~1000m çš„æ•¸å€¼ä¾†è¨­å®šï¼Œé›–ç„¶æ”¯æ´å°æ•¸é»è¨­å®š (0.5 = 500m)ï¼Œä½†æ˜¯å»ºè­°è®“è¨­å®šæ ¼å¼ä¸€è‡´ï¼Œæ¸›å°‘å°æ•¸é»çš„å‡ºç¾æ¬¡æ•¸ã€‚ ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:1:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#cpu"},{"categories":["Kubernetes"],"content":" 2 Memory è³‡è¨Š ç›®å‰å¸¸è¦‹çš„è³‡æºè¨­å®šå–®ä½éƒ½æœƒå¸¶æœ‰ i å¾Œç¶´çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ Mi (Mebibyte)ï¼Œå› ç‚ºç›¸æ¯” MB ä¾†èªªï¼ŒMiB çš„å®šç¾©æ›´ç‚ºæ˜ç¢ºï¼›MB çš„å®šç¾©æ··äº‚ï¼Œæœ‰æ™‚è¢«çœ‹ä½œ 1024 KBï¼Œæœ‰æ™‚åˆæ˜¯ 1000 KBã€‚ Kubernetes officiel Document Mi = Mebibyte wiki 1 MiB = 2^20 bytes = 1024 kibibytes = 1048576bytes M = Megabyte wiki ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:2:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#memory"},{"categories":["Kubernetes"],"content":" åŸºç¤èƒ½åŠ›è² è¼‰HPA è¨­å®šåƒç…§ ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:0:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#åŸºç¤èƒ½åŠ›è² è¼‰"},{"categories":["Kubernetes"],"content":" 1 åœ¨è¦ç”¨æ–¼æ¸¬è©¦çš„ node ä¸ŠåŠ å…¥æ¨™ç±¤ç‚ºäº†é¿å…åœ¨æ¸¬è©¦æ™‚å½±éŸ¿åˆ°é‹è¡Œä¸­çš„æœå‹™ï¼Œå¯ä»¥åœ¨ node ä¸Šé¢åŠ ä¸Šæ¨™ç±¤ï¼Œä¾†é™åˆ¶å£“æ¸¬æ™‚è¦ä½¿ç”¨çš„ node è­¦å‘Š 2022-01-04 æ­¤ç¯€åƒ…åšç­†è¨˜ï¼Œå°šæœªé€²è¡Œå¯¦æ©Ÿæ¸¬è©¦ è¨­å®š Label çš„å‘½ä»¤ bash kubectl label node \u003cnode-name\u003e \u003clabel\u003e=\u003cvalue\u003e --overwrite åˆ—å‡ºæœ‰ node-role.kubernetes.io/worker=ci é€™å€‹ label çš„å‘½ä»¤ bash kubectl top node -l node-role.kubernetes.io/worker=ci ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:1:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#åœ¨è¦ç”¨æ–¼æ¸¬è©¦çš„-node-ä¸ŠåŠ å…¥æ¨™ç±¤"},{"categories":["Kubernetes"],"content":" 2 Kubernetes å®˜ç¶²ç´€éŒ„çš„è³‡æºé™åˆ¶ä¾æ“š å®˜ç¶²æ–‡ä»¶ ç´€éŒ„ï¼ŒKubernetes v1.23 ä¸­çš„è³‡æºè² è¼‰æ•¸é‡å¦‚ä¸‹ï¼š 1 Node æœ€å¤š 110 Pods å‚™è¨»ï¼šä»£è¡¨ä¸€å€‹ Node ä¸­ï¼Œkubelet å·¥å…·å¯ä»¥æ“ä½œçš„ pod æ•¸é‡ 1 Cluster æœ€å¤š 5000 Nodes 1 Cluster ä¸­ç¸½è¨ˆæœ€å¤š 150,000 å€‹ Pods 1 Cluster ä¸­ç¸½è¨ˆæœ€å¤š 300,000 å€‹ Docker Containers ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:2:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#kubernetes-å®˜ç¶²ç´€éŒ„çš„è³‡æºé™åˆ¶"},{"categories":["Kubernetes"],"content":" Istio ç¶²æ ¼èƒ½åŠ›è² è¼‰","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:0:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#istio-ç¶²æ ¼èƒ½åŠ›è² è¼‰"},{"categories":["Kubernetes"],"content":" 1 Istio Sidecar è³‡æºé™åˆ¶ä½¿ç”¨ kubectl describe pod å‘½ä»¤æŸ¥é–± podï¼Œå¯ä»¥åœ¨ istio-proxy: å€æ®µç™¼ç¾ï¼ŒIstio æ‰€åˆå§‹åŒ–çš„ Sidecar Container æ‰€çµ¦äºˆçš„è³‡æºç‚º text Limits: cpu: 2 memory: 1Gi Requests: cpu: 100m memory: 128Mi ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:1:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#istio-sidecar-è³‡æºé™åˆ¶"},{"categories":["Kubernetes"],"content":" 2 æ­é… Istio çš„å…¶ä»–å½±éŸ¿ è³‡è¨Š ä»¥ä¸‹å½±éŸ¿ä»¥é è¨­å®‰è£ä¸èª¿æ•´åƒæ•¸çš„ Istio ç‚ºä¸» å› ç‚º Sidecar çš„å¢åŠ ï¼Œæ¯ä¸€å±¤ Sidecar å®¹å™¨æœƒå¾®å¹…å¢åŠ ç´„ 0.5ms çš„å»¶é² ä½¿ç”¨é»˜è®¤istio-proxyçš„èµ„æºé…ç½®ä¸‹, æœ€å¤šå¯ä»¥æŠ—ä½ 1w å·¦å³çš„HTTPè¯·æ±‚å¹¶å‘. æ­¤é …ç›´æ¥å¼•è¿°åƒè€ƒæ–‡ä»¶ä¸­ isito envoy sidecarçš„å…¨é¢æ€§èƒ½å‹åŠ›æµ‹è¯• çš„çµè«–å…§å®¹æœªåšä¿®æ­£çš„åŸå› æ˜¯ï¼Œæ–‡å…§çš„ 1w ä»£è¡¨æ•¸é‡æœªçŸ¥ ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:2:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#æ­é…-istio-çš„å…¶ä»–å½±éŸ¿"},{"categories":["Kubernetes"],"content":" Horizontal Pod Autoscaler (HPA)HPA å¯ä»¥ç›£æ¸¬è² è¼‰ç‹€æ³ï¼Œå¯¦ç¾è‡ªå‹•æ‹“å±• pod ä¾†å¢åŠ ç³»çµ±è² è¼‰èƒ½åŠ› å€šè³´ metrics server ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:0:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#horizontal-pod-autoscaler-hpa"},{"categories":["Kubernetes"],"content":" å£“åŠ›æ¸¬è©¦å·¥å…· è­¦å‘Š 2022-01-04 æ­¤ç¯€åƒ…åšç­†è¨˜ï¼Œå°šæœªé€²è¡Œå¯¦æ©Ÿæ¸¬è©¦ https://www.dotblogs.com.tw/armycoding/2021/12/02/k6-introuction ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:0:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#å£“åŠ›æ¸¬è©¦å·¥å…·"},{"categories":["Kubernetes"],"content":" 1 Docker-BusyBoxBusyBox å•Ÿå‹•æ¸¬è©¦å®¹å™¨ bash kubectl run --generator=run-pod/v1 -i --tty load-generator --image=busybox /bin/sh ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:1:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#docker-busybox"},{"categories":["Kubernetes"],"content":" 2 å®˜æ–¹çš„æ¸¬è©¦å·¥å…·ï¼Ÿkubernetes perf-tests ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:2:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#å®˜æ–¹çš„æ¸¬è©¦å·¥å…·"},{"categories":["Kubernetes"],"content":" 3 å¯èƒ½å¯ä»¥ç”¨çš„å·¥å…· https://github.com/wg/wrk https://github.com/giltene/wrk2 https://github.com/rakyll/hey https://github.com/tsenart/vegeta ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:3:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#å¯èƒ½å¯ä»¥ç”¨çš„å·¥å…·"},{"categories":["Kubernetes"],"content":" åƒè€ƒè³‡æ–™ èªè­˜è² è¼‰æ¸¬è©¦èˆ‡ k6 Kubernetes å‹•æ…‹å»ºç«‹ Jenkins Agent å£“åŠ›æ¸¬è©¦ (ç¹ä¸­ç¿»è­¯ç‰ˆ) Kubernetes å‹•æ…‹å»ºç«‹ Jenkins Agent å£“åŠ›æ¸¬è©¦ (åŸå§‹ä¾†æº) isito envoy sidecarçš„å…¨é¢æ€§èƒ½å‹åŠ›æµ‹è¯• Kubernetesç³»åˆ—ä¹‹Kubernetesçš„å¼¹æ€§ä¼¸ç¼©ï¼ˆHPAï¼‰ ","date":"2022-02-01","objectID":"/2022/02/kubernetes-overloading/:0:0","series":["Kubernetes"],"tags":["Kubernetes","Istio","Overloading"],"title":"Kubernetes Overloading","uri":"/2022/02/kubernetes-overloading/#åƒè€ƒè³‡æ–™"},{"categories":["Development"],"content":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/"},{"categories":["Development"],"content":"æ¸¬è©¦é©…å‹•é–‹ç™¼çš„æµç¨‹ç­†è¨˜ ","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:0:0","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#"},{"categories":["Development"],"content":" æ¸¬è©¦é©…å‹•é–‹ç™¼ (Test Driven Development)","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:0:0","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#æ¸¬è©¦é©…å‹•é–‹ç™¼-test-driven-development"},{"categories":["Development"],"content":" 1 é¦–å…ˆ TDD is not Test First! Test First åªæ˜¯ TDD çš„ä¸€ç’° TDD æ•´å€‹æµç¨‹åŒ…å«éœ€æ±‚åˆ†æèˆ‡æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆ ä¸æ˜¯æœ‰å¯«å–®å…ƒ/æ•´åˆæ¸¬è©¦å°±å«åš TDD æ¸¬è©¦åªæ˜¯ TDD ä¸­çš„å…¶ä¸­ä¸€éƒ¨ä»½ æ–‡æœ«çš„åƒè€ƒè³‡æ–™æœ‰æä¾›å„å¼å»ºè­°æ›¸ç±èˆ‡ç›¸é—œèª²ç¨‹ ","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:1:0","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#é¦–å…ˆ"},{"categories":["Development"],"content":" 2 Test First çš„é¡å‹æ­¤ç« ç¯€ç‚ºæˆ‘æµç†è§£æ³•ï¼Œä¸¦éæ­£å¼çš„æ–¹æ³•ä»‹ç´¹ï¼Œè‹¥æœ‰ä»»ä½•éŒ¯èª¤çš„åœ°æ–¹é‚„è«‹ä¸åæŒ‡æ•™ï¼ ","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:2:0","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#test-first-çš„é¡å‹"},{"categories":["Development"],"content":" 2.1 Outside In å„ç¨®åˆ¥ç¨± Top Down London School Mockist Approach Outside Inï¼Œç”±å¤–è€Œå…§çš„è™•ç†ï¼Œåœ¨é–‹å§‹å‹•å·¥å‰åªæœƒæ±ºå®šæƒ³è¦ç”¨ä»€éº¼æ–¹å¼å»å®Œæˆå¯¦ä½œï¼Œé¡åˆ¥çš„åç¨±æ¶æ§‹ã€æ–¹æ³•ç­‰å…§å®¹ï¼Œéƒ½æ˜¯åœ¨æ¸¬è©¦å¯¦ä½œæ™‚ä¸€æ­¥ä¸€æ­¥å»ºç«‹çš„ã€‚ é€™ç¨®åšæ³•æˆ‘èªç‚ºæ˜¯éœ€æ±‚å„ªå…ˆçš„åšæ³•ã€‚ ","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:2:1","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#outside-in"},{"categories":["Development"],"content":" 2.2 Inside Out å„ç¨®åˆ¥ç¨± Classic school bottom-up Inside Outï¼Œç”±å…§è€Œå¤–çš„è™•ç†ï¼Œåœ¨é–‹å§‹å‹•å·¥å‰æœƒå…ˆè¦åŠƒå¥½æ‰€æœ‰é¡åˆ¥çš„é•·ç›¸ï¼Œä¸¦ç”±æœ€å…§å´é–‹å§‹å¾€å¤–å»ºç«‹æ¸¬è©¦èˆ‡èª¿æ•´å¯¦ä½œã€‚ é€™ç¨®åšæ³•æˆ‘èªç‚ºæ˜¯æ¶æ§‹å„ªå…ˆçš„åšæ³•ã€‚ ","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:2:2","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#inside-out"},{"categories":["Development"],"content":" 3 TDD æµç¨‹TDD åœ¨é–‹ç™¼æ™‚æœƒä½¿ç”¨åº•ä¸‹çš„æµç¨‹é€²è¡Œé–‹ç™¼ ç¢ºèªéœ€æ±‚èˆ‡è¨è«–é æœŸä½¿ç”¨çš„è™•ç†æ–¹æ³• ç¢ºèªéœ€æ±‚å…§å®¹ï¼Œä¸¦è¦åŠƒç¨‹å¼ä¸­é è¨ˆä½¿ç”¨çš„è™•ç†æ–¹æ¡ˆï¼›æœ‰æ²’æœ‰éœ€è¦å¥—ç”¨ç‰¹å®šè¨­è¨ˆæ¨¡å¼æ¶æ§‹ã€è‹¥æœ‰æ•¸å­¸é‹ç®—æˆ–è³‡æ–™æ¯”å°ï¼Œç›¸é—œä½œæ³•ç‚ºå’Œï¼Ÿ è¨­è¨ˆæ¸¬è©¦æ¡ˆä¾‹ ä¾æ“šéœ€æ±‚è¦åŠƒæ¸¬è©¦æ¡ˆä¾‹ï¼Œå®šç¾©æ¯å€‹æ¡ˆä¾‹æœƒéœ€è¦çš„è¼¸å…¥åƒæ•¸èˆ‡è¼¸å‡ºçµæœã€‚ æ’åºæ¸¬è©¦æ¡ˆä¾‹ è©•ä¼°å‰é¢å»ºç«‹çš„æ¸¬è©¦æ¡ˆä¾‹ä¸­ï¼Œé‚£äº›æ¸¬è©¦è¦å»ºç«‹çš„é …ç›®æœ€æŠ½è±¡ï¼›å®šç¾©åŠŸèƒ½ä»‹é¢èˆ‡æ–¹æ³•ç°½ç« çš„æ¸¬è©¦å„ªå…ˆï¼Œå†ä¾†å°±æ˜¯ç¢ºèªä¸‹ä¸€å€‹è¦å®Œæˆçš„æ¸¬è©¦è¦æ”¹å‹•çš„é …ç›®æœ€å°ã€‚ ä¾‹å¦‚ï¼š æ²’æœ‰é ç®—è³‡æ–™_è¼¸å…¥ 2021/07/01~2021/07/31_7æœˆé ç®—ç‚º 0 å®šç¾©äº†è¼¸å…¥ (æ˜¯ä¸€å€‹æ—¥æœŸç¯„åœ) å®šç¾©äº†è¼¸å‡º (æˆ‘è¦æ‹¿åˆ°çš„æ˜¯ä¸€å€‹æ•¸å­—) å®šç¾©äº†è³‡æ–™ä¾†æº (é ç®—çš„ Repository) æœ‰ 7æœˆé ç®—ç‚º 31_è¼¸å…¥ 2021/07/01~2021/07/31_å–å¾—31 å®Œæˆå¾é ç®— Repo å–å¾—è³‡æ–™å¾Œè¼¸å‡ºçš„åŠŸèƒ½ æœ‰ 7æœˆé ç®—ç‚º 31_è¼¸å…¥ 2021/06/01~2021/06/30_å–å¾—0 ç¢ºèªæœå°‹ç¯„åœå°æ–¼è³‡æ–™ç¯„åœæ™‚çš„çµæœ æœ‰ 7æœˆé ç®—ç‚º 31_è¼¸å…¥ 2021/08/01~2021/08/31_å–å¾—0 ç¢ºèªæœå°‹ç¯„åœå¤§æ–¼è³‡æ–™ç¯„åœæ™‚çš„çµæœ â€¦è«‹å ±å91çš„TDDèª²ç¨‹ä»¥è§£é–ä»¥ä¸‹å…§å®¹â€¦ ä¾æ“šå‰é¢å®šç¾©çš„æ¸¬è©¦æ¡ˆä¾‹é †åºé€²è¡Œé–‹ç™¼ æ¯æ¬¡æ¡ˆä¾‹éƒ½æ‡‰ç¶“éä»¥ä¸‹éšæ®µï¼Œé™¤éè©²æ¸¬è©¦æ¡ˆä¾‹æ˜¯ç‚ºäº†é©—è­‰å…¶ä»–äº‹æƒ…è€Œé¡å¤–å¢åŠ çš„æ¡ˆä¾‹ï¼›å› ç‚ºé€™ç¨®æ¡ˆä¾‹é€šå¸¸æ˜¯é è¨­ç¾è¡Œå¯¦ä½œæ‡‰è©²è¦å·²ç¶“æœ‰å“ªäº›è¡Œç‚ºï¼Œå¦‚æœé€™å€‹è¡Œç‚ºæˆç«‹ï¼Œé€šå¸¸æœƒä¸ç¬¦åˆä¸‹åˆ—çš„ç¬¬ä¸€é …ã€Œæ¸¬è©¦ç´…ç‡ˆã€ å¯«ä¸€å€‹æ¸¬è©¦ï¼Œæ¸¬è©¦ç´…ç‡ˆ (Write a Test) æ–°åŠ å…¥çš„æ¸¬è©¦æ¡ˆä¾‹æ‡‰è©²æœƒæ˜¯è¦åŠ å…¥ä¸€å€‹æ–°çš„åŠŸèƒ½å¯¦ä½œï¼Œè©²åŠŸèƒ½å¯¦ä½œä¸¦æœªå®Œæˆï¼Œé€™æ™‚å€™é€šå¸¸éƒ½æ˜¯ç´…ç‡ˆ è‹¥æ¸¬è©¦å‰›å»ºç«‹å¥½å°±æ˜¯ç¶ ç‡ˆï¼Œé€šå¸¸æ˜¯ è©²æ¸¬è©¦æ˜¯ç‚ºäº†é©—è­‰æŸå€‹å·²å®ŒæˆåŠŸèƒ½æ˜¯æ­£ç¢ºçš„ è©²æ¸¬è©¦æ¡ˆä¾‹æœ‰å•é¡Œ ç›®å‰å¯¦ä½œæ„å¤–å¯ç¬¦åˆæ­¤æ¸¬è©¦ å®Œæˆå¯¦ä½œï¼Œæ¸¬è©¦ç¶ ç‡ˆ (Make it run) åœ¨æœ€å°ä¿®æ”¹ä¸‹å®Œæˆç¶ ç‡ˆ å¯ä»¥åˆ»æ„è®“æ¸¬è©¦ç¶ ç‡ˆï¼›å¯ä»¥æ•…æ„å¯«ä¸€å€‹å€¼è®“æ¸¬è©¦ç¶ ç‡ˆï¼Œç¢ºèªæ¸¬è©¦æ¡ˆä¾‹çš„è¨­è¨ˆæ­£ç¢º ä¿®æ­£å‰é¢ç‚ºäº†é€šéæ¸¬è©¦è€Œæœ‰çš„é‚è¼¯éŒ¯èª¤ é–‹å§‹é‡æ§‹ (make it Right) æ•´ç†å¯¦ä½œç¨‹å¼ç¢¼ è™•ç†ç¨‹å¼å£å‘³é“ é‡æ§‹ä¿®æ”¹å¾Œéƒ½æ‡‰è·‘ä¸€æ¬¡æ¸¬è©¦ç¢ºä¿é‡æ§‹ä¸¦æœªå½±éŸ¿åŠŸèƒ½ é‡æ§‹æ¸¬è©¦ æ•´ç†å–®å…ƒæ¸¬è©¦çš„å¯¦ä½œç¨‹å¼ç¢¼ è™•ç†ç¨‹å¼å£å‘³é“ åŠŸèƒ½å®Œæˆ ","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:3:0","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#tdd-æµç¨‹"},{"categories":["Development"],"content":" 4 è‡ªå·±å¯¦å‹™ä¸Šæœ€å¸¸ç¢°åˆ°çš„å•é¡Œ è³‡æ–™ä¾†æºéæ–¼è¤‡é›œï¼Œåœ¨æ’°å¯«æ¸¬è©¦çš„æ™‚å€™éå¸¸ä¸å¥½å¯« å› ç‚ºæˆ‘è‡ªå·±åœ¨å¯¦å‹™ä¸Šä¸»è¦ä½¿ç”¨ EF Core æ“ä½œè³‡æ–™åº«ï¼Œå†æ­é… UnitOfWork \u0026 Repository\u003cT\u003e æ“ä½œæ¯å¼µè³‡æ–™è¡¨ï¼Œç•¶è³‡æ–™è¡¨çµ„åˆè¼ƒè¤‡é›œæ™‚ï¼Œæœƒç™¼ç”Ÿæ¸¬è©¦ä¸­éœ€è¦æ’°å¯«éå¸¸å¤šçš„è³‡æ–™è¨­å®šçš„ç‹€æ³ã€‚ç›®å‰é‚„åœ¨æ€è€ƒè©²å¦‚ä½•åœ¨æœ‰è¤‡é›œçš„è³‡æ–™çµ„åˆçš„æƒ…å¢ƒä¸‹é †åˆ©çš„å®Œæˆ TDD æµç¨‹ã€‚ ","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:4:0","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#è‡ªå·±å¯¦å‹™ä¸Šæœ€å¸¸ç¢°åˆ°çš„å•é¡Œ"},{"categories":["Development"],"content":" 5 åƒè€ƒè³‡æ–™","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:5:0","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#åƒè€ƒè³‡æ–™"},{"categories":["Development"],"content":" 5.1 91 æ¸¬è©¦èª²ç¨‹ 91 é‡å°éºç•™ä»£ç¢¼åŠ å…¥å–®å…ƒæ¸¬è©¦çš„è—è¡“ 91 TDD èˆ‡ æŒçºŒé‡æ§‹ 91 TDD å½±éŸ³èª² ","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:5:1","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#91-æ¸¬è©¦èª²ç¨‹"},{"categories":["Development"],"content":" 5.2 æ›¸ç± Kent Beck çš„æ¸¬è©¦é©…å‹•é–‹ç™¼ï¼šæ¡ˆä¾‹å°å‘çš„é€æ­¥è§£æ±ºä¹‹é“ Working Effectively with Legacy Code : ç®¡ç†ã€ä¿®æ”¹ã€é‡æ§‹éºç•™ç¨‹å¼ç¢¼çš„è—è¡“ é‡æ§‹ï½œæ”¹å–„æ—¢æœ‰ç¨‹å¼çš„è¨­è¨ˆ, 2/e (ç¹ä¸­å¹³è£ç‰ˆ) é‡æ§‹èˆ‡æ¨¡å¼ (Refactoring to Patterns) ","date":"2022-02-01","objectID":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/:5:2","series":[],"tags":["TDD"],"title":"æ¸¬è©¦é©…å‹•é–‹ç™¼ç­†è¨˜","uri":"/2022/02/%E6%B8%AC%E8%A9%A6%E9%A9%85%E5%8B%95%E9%96%8B%E7%99%BC%E7%AD%86%E8%A8%98/#æ›¸ç±"},{"categories":["Version Control"],"content":"Git GUI Tools Memo","date":"2021-08-20","objectID":"/2021/08/git-gui-tools-memo/","series":[],"tags":["git"],"title":"Git GUI Tools Memo","uri":"/2021/08/git-gui-tools-memo/"},{"categories":["Version Control"],"content":"æ­¤ç¯‡ç­†è¨˜éå¾€ç°¡å–®æ¸¬è©¦éçš„ä¸€äº› git gui å·¥å…·ï¼Œæ™‚è‡³ä»Šæ—¥æ‡‰å·²æœ‰è¨±å¤šè®Šé©ï¼Œæ­¤æ–‡åƒ…ä½œåƒè€ƒã€‚ ","date":"2021-08-20","objectID":"/2021/08/git-gui-tools-memo/:0:0","series":[],"tags":["git"],"title":"Git GUI Tools Memo","uri":"/2021/08/git-gui-tools-memo/#"},{"categories":["Version Control"],"content":" Git å·¥å…· æ’°å¯«æ–¼ 2021 / 08 / 20 ","date":"2021-08-20","objectID":"/2021/08/git-gui-tools-memo/:0:0","series":[],"tags":["git"],"title":"Git GUI Tools Memo","uri":"/2021/08/git-gui-tools-memo/#git-å·¥å…·"},{"categories":["Version Control"],"content":" 1 é¦–æ¨æ­¤ç¯€ä»‹ç´¹çš„å·¥å…·ç‚ºå»ºè­°ä½¿ç”¨å·¥å…·ï¼ŒåŸºæœ¬ä½¿ç”¨é«”é©—è‰¯å¥½ Git cli (å‘½ä»¤åˆ—) å®Œå…¨å…è²» æœ€ç›´æ¥çš„ Git æ“ä½œæ–¹å¼ éœ€è¦ç†Ÿè¨˜ç›¸é—œå‘½ä»¤ å°æ–¼æ“·é¸è¦åŠ å…¥çš„å…§å®¹é€™ä»¶äº‹æƒ…æ¯”è¼ƒéº»ç…© Fork æ”¶è²»è»Ÿé«”ï¼Œå·²å…¬é–‹å ±åƒ¹ç‚º 49.99 ç¾å…ƒï¼Œå…è²»ç‰ˆåƒ…ä½œç‚ºè©•ä¼°ç”¨ï¼Œä½†æ˜¯ä¸¦æœªå¼·åˆ¶æ”¶è²»ï¼Œåƒ…æœƒä¸å®šæ™‚æé†’ Donate æ“ä½œæµæš¢ æ–¹ä¾¿ç¢ºèªè®Šæ›´å…§å®¹èˆ‡ç™¼ä½ˆ commit ","date":"2021-08-20","objectID":"/2021/08/git-gui-tools-memo/:1:0","series":[],"tags":["git"],"title":"Git GUI Tools Memo","uri":"/2021/08/git-gui-tools-memo/#é¦–æ¨"},{"categories":["Version Control"],"content":" 2 æ¬¡æ¨æ­¤ç¯€ä»‹ç´¹çš„å·¥å…·æ™®éé«”é©—è‰¯å¥½ï¼Œä½†æœ‰éƒ¨åˆ†å•é¡Œå°è‡´è©•åƒ¹ä¸‹é™ (æœƒåœ¨å…§å®¹èªªæ˜) GitKraken éƒ¨åˆ†å…è²» å…è²»ç‰ˆç„¡æ³•é€£ç·šåˆ°ç§äºº Git Server / Repository æ­¤é»å°è‡´æ­¤è»Ÿé«”çš„è©•åƒ¹ä¸‹é™è‡³æ¬¡æ¨ï¼Œå› ç‚ºé€™å€‹é™åˆ¶æœƒå°è‡´éœ€è¦ä»˜è²»æ‰å¯åœ¨å…¬å¸ç’°å¢ƒä½¿ç”¨ éå¸¸ç¾è§€ æ“ä½œé †æš¢ SourceTree å®Œå…¨å…è²» æ™®éæ¨è–¦çš„è»Ÿé«” ä»‹é¢ç¾è§€ å®¹æ˜“é–±è®€ commit éœ€è¦å»ºç«‹ä»–å€‘å¹³å°çš„å¸³è™Ÿæ‰èƒ½ä½¿ç”¨ æ­¤é»å°è‡´æ­¤è»Ÿé«”çš„è©•åƒ¹ä¸‹é™è‡³æ¬¡æ¨ï¼Œå› ç‚ºé€™å€‹é™åˆ¶æœƒå°è‡´ç‚ºäº†ä½¿ç”¨é€™å¥—è»Ÿé«”è€Œè¨»å†Šå¸³è™Ÿï¼Œè¼ƒç‚ºä¸ä¾¿ ","date":"2021-08-20","objectID":"/2021/08/git-gui-tools-memo/:2:0","series":[],"tags":["git"],"title":"Git GUI Tools Memo","uri":"/2021/08/git-gui-tools-memo/#æ¬¡æ¨"},{"categories":["Version Control"],"content":" 3 ä¾å€‹äººç¿’æ…£å¯é¸æ“‡ Visual Studio å…§å»ºåŠå…¶æ“´å……åŠŸèƒ½ Visual Studio ä¸­å° Git çš„æ“ä½œæµç¨‹ç¨å·® æœ‰è¨±å¤šæ“´å……å¥—ä»¶å¯ä»¥æ“´å……å° Git æ“ä½œçš„æ–¹ä¾¿æ€§ å®‰è£éå¤šå¥—ä»¶æœƒå°è‡´æ•ˆèƒ½ä½è½ æœ‰æ…£ç”¨ ReSharper çš„äººä¸æœƒæƒ³è¦åœ¨ VS ä¸Šå®‰è£å…¶ä»–å¥—ä»¶è®“ VS æ›´æ…¢ èˆ‡ TFS æœ‰è‰¯å¥½æ•´åˆæ€§ï¼Œæ–¹ä¾¿æ“ä½œ TFS ä¸Šçš„åŠŸèƒ½ æ“´å……å¥—ä»¶ : GitFlow for Visual Studio åœ¨ Visual Studio å…§ä½¿ç”¨ Git Flow æ™‚éœ€è¦çš„å¥—ä»¶ Visual Studio Code åŠå…¶æ“´å……åŠŸèƒ½ å»ºè­°å¥—ä»¶ : Git Graphã€GitLens JetBrains Rider åŠå…¶æ“´å……åŠŸèƒ½ ä»˜è²»å·¥å…· æ“ä½œä¸Šéœ€è¦ç‰¹åˆ¥é–‹å°ˆæ¡ˆæˆ–é¸æ“‡è³‡æ–™å¤¾å¾Œå†æ“ä½œï¼Œç¨å«Œä¸ä¾¿ ","date":"2021-08-20","objectID":"/2021/08/git-gui-tools-memo/:3:0","series":[],"tags":["git"],"title":"Git GUI Tools Memo","uri":"/2021/08/git-gui-tools-memo/#ä¾å€‹äººç¿’æ…£å¯é¸æ“‡"},{"categories":["Version Control"],"content":" 4 å¾…ä½¿ç”¨è€…æä¾›å¿ƒå¾— sublimemerge ä»˜è²» (99 é‚) åè²´ï¼Œä¹Ÿæœ‰èªªæ˜å¯å…è²»è©•ä¼°ï¼Œä¸ç¢ºå®šæ˜¯ä¸æ˜¯æ‰“ç®—èµ°è·Ÿ Fork ç›¸åŒçš„å¥—è·¯ æ“ä½œé«”é©—å¯èƒ½æ˜¯ Fork / GitKraken çš„å¼·å¤§ç«¶çˆ­è€… (ä¾æ“šå®˜æ–¹æä¾›çš„è³‡è¨Šåˆ¤æ–·) GitFiend UI è¨­è¨ˆé‚„å¯ä»¥ï¼Œç„¡æ“ä½œç¶“é©— Cong ä¸»æ‰“æŒ‡ä»¤æ“ä½œï¼Œç„¡æŒ‰éˆ• (æœªæœ‰å¤ªå¤šä½¿ç”¨ç¶“é©—) Git Extensions æ’°æ–‡è€…ä¸å–œæ­¡é€™å¥—ï¼ŒUI è¨­è¨ˆä¹Ÿå¾ˆå¼± GitBlade åŸºæœ¬åŠŸèƒ½å…è²»ï¼Œä¸å°‘å¸¸ç”¨çš„åŠŸèƒ½éƒ½æ˜¯ä»˜è²»çš„ï¼Œä¸å¦‚ç›´æ¥ä½¿ç”¨ Git cli Git GUI å®‰è£ Git for Windows æ™‚æœƒä¸€åŒå®‰è£ï¼Œå±¬æ–¼å®˜æ–¹è‡ªå·±çš„ Windows Desktop å·¥å…·ï¼Œé‚„ç®—å ªç”¨ ","date":"2021-08-20","objectID":"/2021/08/git-gui-tools-memo/:4:0","series":[],"tags":["git"],"title":"Git GUI Tools Memo","uri":"/2021/08/git-gui-tools-memo/#å¾…ä½¿ç”¨è€…æä¾›å¿ƒå¾—"},{"categories":["Version Control"],"content":" 5 æœ€å¾Œæœ€å¾Œæé†’ä¸€ä»¶äº‹æƒ… ä¸å»ºè­°ä½¿ç”¨ TortoiseGit æ“ä½œGit èƒ½ç†è§£å¾ SVN è½‰æ›éä¾†çš„ä½¿ç”¨è€…æœƒåå¥½ TortoiseGit çš„æ“ä½œæ¨¡å¼ï¼Œä½†æ˜¯å…¶å¯¦ Git çš„æ ¸å¿ƒä½œæ¥­æ¨¡å¼èˆ‡ SVN ä¸¦ä¸ç›¸åŒï¼Œå› æ­¤ä¸å»ºè­°ä½¿ç”¨ TortoiseGit ä¾†æ“ä½œ Gitï¼Œé€™æœƒå°è‡´ç„¡æ³•äº«å—åˆ° Git çš„è¨±å¤šå„ªå‹¢ã€‚ ","date":"2021-08-20","objectID":"/2021/08/git-gui-tools-memo/:5:0","series":[],"tags":["git"],"title":"Git GUI Tools Memo","uri":"/2021/08/git-gui-tools-memo/#æœ€å¾Œ"},{"categories":["Development-Tools"],"content":"Refactor Command in Ide","date":"2021-08-20","objectID":"/2021/08/refactor-command-in-ide/","series":[],"tags":["refactor","IDE-hotkey"],"title":"Refactor Command in Ide","uri":"/2021/08/refactor-command-in-ide/"},{"categories":["Development-Tools"],"content":"IDE å¸¸ç”¨é‡æ§‹å¿«æ·éµ ","date":"2021-08-20","objectID":"/2021/08/refactor-command-in-ide/:0:0","series":[],"tags":["refactor","IDE-hotkey"],"title":"Refactor Command in Ide","uri":"/2021/08/refactor-command-in-ide/#"},{"categories":["Development-Tools"],"content":" IDE ä¸­æä¾›çš„é‡æ§‹æ–¹æ³•æ­¤æ–‡ä»¶æ‰€ä½¿ç”¨çš„ IDE ç’°å¢ƒç‚º Visual Studio 2019 + JetBrains ReSharper JetBrains Rider è‹¥ç‚º Visual Studio åŸç”Ÿå¯ä½¿ç”¨çš„åŠŸèƒ½æœƒåœ¨è©²åŠŸèƒ½ä¸‹è¨»è¨˜ï¼Œä½†åŸç”ŸåŠŸèƒ½ä¸ä¸€å®šæœƒè·Ÿ ReSharper æ‰€æä¾›çš„åŠŸèƒ½æœ‰ç›¸åŒçš„æ–¹ä¾¿æ€§ Tips: ReSharper/Rider å¯ä»¥ç”¨ Ctrl + Shift + R ä¾†å«å‡ºé‡æ§‹ç”¨é¸å–® æ­¤æ–‡ä»¶åƒ…åˆ—å‡ºå¸¸ç”¨çš„é‡æ§‹å‘½ä»¤ï¼Œè€Œé€™äº›å¸¸ç”¨çš„é‡æ§‹å‘½ä»¤åœ¨ä¸åŒæƒ…å¢ƒä¸‹æœƒæœ‰ä¸åŒçš„æ•ˆæœ å°‡é¸å–çš„å…§å®¹æŠ½ç‚ºæ–¹æ³•ï¼šCtrl + R -\u003e Ctrl + M VS å¿«æ·éµè¨­å®šåç¨±ï¼šé‡æ§‹-æå–æ–¹æ³• (Refactor.ExtractMethod) å°‡é¸å–çš„è®Šæ•¸ã€åƒæ•¸é‡æ–°å‘½åï¼šCtrl + R -\u003e Ctrl + R VS å¿«æ·éµè¨­å®šåç¨±ï¼šé‡æ§‹-é‡æ–°å‘½å (Refactor.Rename) å°‡é¸å–æ–¹æ³•æ‹‰åˆ°æ–°çš„ä»‹é¢ (ç›®å‰é¡åˆ¥æœƒæ›ä¸Šæ–°çš„ä»‹é¢)ï¼šCtrl + Shift + R -\u003e X VS å¿«æ·éµè¨­å®šåç¨±ï¼šé‡æ§‹-æå–ä»‹é¢ (Refactor.ExtractInterface) æå–é¡åˆ¥ï¼šCtrl + Shift + R -\u003e E å°‡ç›®å‰è®Šæ•¸ã€æ–¹æ³•æ”¤å›åˆ°ä½¿ç”¨ç«¯ (Inline)ï¼šCtrl + R + I å®‰å…¨åˆªé™¤è®Šæ•¸æˆ–åƒæ•¸ï¼šAlt + Del å¯ä»¥å¿«é€Ÿåˆªé™¤ä¸ä½¿ç”¨çš„è®Šæ•¸ï¼Œåœ¨æœ‰è¢«ä½¿ç”¨çš„è®Šæ•¸ä¸Šä¸å»ºè­°ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œå› ç‚ºå¯èƒ½å¼•ç™¼å¼•ç”¨å•é¡Œ å°‡æ–¹æ³•åƒæ•¸æ•´åˆç‚ºä¸€å€‹é¡åˆ¥ åœ¨æ–¹æ³•å®£å‘Šä¸Šä½¿ç”¨ Alt + Enter å¾Œè¼¸å…¥ TranP å¯æ‰¾åˆ° â€œTransform parametersâ€ åœ¨æ–¹æ³•å®£å‘Šä¸Šä½¿ç”¨ Ctrl + Shift + R -\u003e é¸æ“‡ Transform parameters (æˆ–è€…æŒ‰ P) ","date":"2021-08-20","objectID":"/2021/08/refactor-command-in-ide/:0:0","series":[],"tags":["refactor","IDE-hotkey"],"title":"Refactor Command in Ide","uri":"/2021/08/refactor-command-in-ide/#ide-ä¸­æä¾›çš„é‡æ§‹æ–¹æ³•"},{"categories":["Development-Tools"],"content":"Visual Studio Code å¥½ç”¨çš„å¥—ä»¶","date":"2021-08-20","objectID":"/2021/08/visual-studio-code-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/","series":[],"tags":["extensions","Visual-Studio-Code"],"title":"Visual Studio Code å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-code-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/"},{"categories":["Development-Tools"],"content":" Visual Studio Code å»ºè­°ä½¿ç”¨çš„æ“´å……å¥—ä»¶","date":"2021-08-20","objectID":"/2021/08/visual-studio-code-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/:0:0","series":[],"tags":["extensions","Visual-Studio-Code"],"title":"Visual Studio Code å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-code-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/#visual-studio-code-å»ºè­°ä½¿ç”¨çš„æ“´å……å¥—ä»¶"},{"categories":["Development-Tools"],"content":" 1 æ–‡å­—ç·¨è¼¯é¡ Code Spell Checker å–®å­—æª¢æŸ¥å™¨ GitHub ","date":"2021-08-20","objectID":"/2021/08/visual-studio-code-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/:1:0","series":[],"tags":["extensions","Visual-Studio-Code"],"title":"Visual Studio Code å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-code-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/#æ–‡å­—ç·¨è¼¯é¡"},{"categories":["Development-Tools"],"content":" 2 å·¥å…·é¡ Git Graph åœ¨ Visual Studio Code ä¸­æŸ¥çœ‹ Git ç·šåœ– GitHub GitLens â€” Git supercharged æä¾›æ–‡ä»¶çš„ Git æŠ¬é ­é¡¯ç¤ºå™¨ï¼Œå¯ä»¥ä»¥æŠ¬é ­é¡¯ç¤ºå™¨çš„å½¢å¼æŸ¥çœ‹æ–‡ä»¶ä¸­çš„è®Šæ›´ç´€éŒ„ GitHub REST Client åˆ©ç”¨ Visual Studio Code æ¸¬è©¦ WebAPI GitHub ERD Editor åˆ©ç”¨ Visual Studio Code ç¹ªè£½è³‡æ–™åº« Table é—œè¯åœ– GitHub ","date":"2021-08-20","objectID":"/2021/08/visual-studio-code-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/:2:0","series":[],"tags":["extensions","Visual-Studio-Code"],"title":"Visual Studio Code å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-code-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/#å·¥å…·é¡"},{"categories":["Development-Tools"],"content":"Visual Studio å¥½ç”¨çš„å¥—ä»¶","date":"2021-08-20","objectID":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/","series":[],"tags":["extensions","Visual-Studio"],"title":"Visual Studio å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/"},{"categories":["Development-Tools"],"content":" æ¨è–¦å®‰è£ CodeMaid å…è²» ç¨‹å¼ç¢¼æ’ç‰ˆ GitHub GhostDoc ç¤¾ç¾¤å…è²»ç‰ˆ / å°ˆæ¥­ä»˜è²»ç‰ˆ å”åŠ©è™•è£¡å„å€‹æ–¹æ³•çš„ Summary æ¨™ç±¤çš„å·¥å…· AceJump å…è²» æ¸¸æ¨™ç§»å‹•çš„è¼”åŠ©å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿåœ°å°‡æ¸¸æ¨™ç§»å‹•åˆ°ç‰¹å®šä½ç½® GitHub Roslynator 2022 å…è²» éœæ…‹ç¨‹å¼ç¢¼åˆ†æèˆ‡ä¿®æ”¹å»ºè­°å·¥å…·ï¼Œé€Ÿåº¦ç›¸è¼ƒæ–¼ ReSharper å¿« GitHub ","date":"2021-08-20","objectID":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/:0:0","series":[],"tags":["extensions","Visual-Studio"],"title":"Visual Studio å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/#æ¨è–¦å®‰è£"},{"categories":["Development-Tools"],"content":" æ¨è–¦å­¸ç¿’èˆ‡å®‰è£ VsVim (æ¨è–¦) å…è²» æ­¤å¥—æœƒå½±éŸ¿ IDE æ“ä½œï¼Œå»ºè­°é å…ˆå­¸ç¿’å¾Œå†å®‰è£ è‹¥æœ‰å­¸ç¿’éœ€æ±‚å¯æ‰¾ å°ä½‘ (é­ä½‘å˜‰-G6994) / å° Ray (è¨±è‚²ç‘-G6993) GitHub ","date":"2021-08-20","objectID":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/:0:0","series":[],"tags":["extensions","Visual-Studio"],"title":"Visual Studio å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/#æ¨è–¦å­¸ç¿’èˆ‡å®‰è£"},{"categories":["Development-Tools"],"content":" ä¾æ“šå°ˆæ¡ˆéœ€æ±‚å®‰è£ SlowCheetah å…è²» ä¾æ“šå»ºç½®è¨­å®šæ›¿æ›è¨­å®šæª”å…§å®¹å€¼çš„å·¥å…· (ä½¿ç”¨å¾Œæœƒå¹«å°ˆæ¡ˆå®‰è£ç›¸é—œçš„ nuget å¥—ä»¶) GitHub EF Core Power Tools å…è²» æ“ä½œ EF Core çš„å·¥å…· GitHub ","date":"2021-08-20","objectID":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/:0:0","series":[],"tags":["extensions","Visual-Studio"],"title":"Visual Studio å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/#ä¾æ“šå°ˆæ¡ˆéœ€æ±‚å®‰è£"},{"categories":["Development-Tools"],"content":" æ¨è–¦ä»˜è²»è³¼è²· ReSharper (æ¨è–¦) ReSharper ä¹Ÿæœ‰å¥—ä»¶æ©Ÿåˆ¶ï¼Œçµ•å¤§éƒ¨åˆ†èˆ‡ Rider ç›¸åŒï¼Œå› æ­¤å¯åƒç…§ Rider Extensions è¨‚é–±è³‡è¨Šï¼š è¨‚é–±è³‡è¨Šç¶²å€ï¼šhttps://www.jetbrains.com/store/#personal?billing=yearly ç”¢å“ï¼šdotUitimate (ReSharper + Rider \u0026 å…¶å®ƒ .net é–‹ç™¼ç”¨å·¥å…·ï¼ŒåŒ…å«æ•ˆèƒ½åˆ†æã€åçµ„è­¯ç­‰åŠŸèƒ½) é¦–å¹´ 149 ç¾é‡‘ (4,340 NTD - 2022/04/18 åŒ¯ç‡ - æœªåŒ…å«è·¨åœ‹åˆ·å¡æ‰‹çºŒè²») ç¬¬äºŒå¹´ 119 ç¾é‡‘ (3,466 NTD - 2022/04/18 åŒ¯ç‡ - æœªåŒ…å«è·¨åœ‹åˆ·å¡æ‰‹çºŒè²») ç¬¬ä¸‰å¹´ä»¥å¾Œ 89 ç¾é‡‘ (2,592 NTD - 2022/04/18 åŒ¯ç‡ - æœªåŒ…å«è·¨åœ‹åˆ·å¡æ‰‹çºŒè²») JetBrains çš„å€‹äººè¨‚é–±èªäººä¸èªç”¨é€”ï¼Œå¯æ”¾å¿ƒæ–¼å„ç¨®ç’°å¢ƒå®‰è£ä½¿ç”¨ ","date":"2021-08-20","objectID":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/:0:0","series":[],"tags":["extensions","Visual-Studio"],"title":"Visual Studio å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/#æ¨è–¦ä»˜è²»è³¼è²·"},{"categories":["Development-Tools"],"content":" 1 ReSharper å°ˆç”¨å¥—ä»¶ä»¥ä¸‹åˆ—å‡º Rider ä¸­æ²’æœ‰çš„å¥—ä»¶ Enhanced Tool Tip æ›¿æµ®å‹•è¦–çª—ä¸Šè‰²ï¼Œå®¹æ˜“æª¢è¦–æ–¹æ³•ç°½ç«  (Rider å·²å…§å»ºç›¸é—œåŠŸèƒ½) GitHub ","date":"2021-08-20","objectID":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/:1:0","series":[],"tags":["extensions","Visual-Studio"],"title":"Visual Studio å¥½ç”¨çš„å¥—ä»¶","uri":"/2021/08/visual-studio-%E5%A5%BD%E7%94%A8%E7%9A%84%E5%A5%97%E4%BB%B6/#resharper-å°ˆç”¨å¥—ä»¶"},{"categories":["Development-Tools"],"content":"Visual Studio å¸¸ç”¨å¿«æ·éµ","date":"2021-08-20","objectID":"/2021/08/visual-studio-%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%8D%B5/","series":[],"tags":["refactor","IDE-hotkey"],"title":"Visual Studio å¸¸ç”¨å¿«æ·éµ","uri":"/2021/08/visual-studio-%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%8D%B5/"},{"categories":["Development-Tools"],"content":" Visual Studio å¸¸ç”¨å‘½ä»¤å› æ¯å€‹äººçš„é–‹ç™¼ç’°å¢ƒè¨­å®šä¸ç›¡ç›¸åŒï¼Œå¯èƒ½æŸäº›å¿«æ·éµè¡Œç‚ºèˆ‡æ­¤è™•åˆ—å‡ºçš„åŠŸèƒ½æœ‰æ‰€å·®ç•°ï¼Œå¾Œé¢æœ‰é™„å¸¶ç›¸é—œåŠŸèƒ½åœ¨ VS å¿«æ·éµè¨­å®šç•«é¢ä¸­çš„ä¸­ã€è‹±æ–‡èªªæ˜ï¼Œå¯å†ä¾æ“šè‡ªå·±çš„æ“ä½œç¿’æ…£é€²è¡Œèª¿æ•´å³å¯ åˆ—å‡ºç›®å‰æ¸¸æ¨™ä½ç½®çš„è®Šæ•¸ã€é¡åˆ¥çš„å¯é¸æˆå“¡ï¼šCtrl + J VS å¿«æ·éµè¨­å®šåç¨±ï¼šç·¨è¼¯.åˆ—å‡ºæˆå“¡ (Edit.ListMembers) é‡è¤‡ç›®å‰æ‰€åœ¨è¡Œ/é¸å–æ–‡å­—ï¼šCtrl + D VS å¿«æ·éµè¨­å®šåç¨±ï¼šç·¨è¼¯.è¤‡è£½ (Edit.Duplicate) è‹¥ Ctrl + D ç„¡ä½œç”¨ï¼Œå¯å˜—è©¦ Ctrl + E -\u003e V æ­¤çµ„å¿«æ·éµ ä¸­æ–‡ç‰ˆé€™å€‹è¨­å®šæœƒæœ‰å…©å€‹ï¼Œæœ‰æ©Ÿæœƒè¨­å®šéŒ¯èª¤ï¼Œé è¨­ Ctrl + E -\u003e V çš„é‚£çµ„è¨­å®šæ‰æ˜¯ å¿«é€Ÿé¸å–ï¼šCtrl + W VS å¿«æ·éµè¨­å®šåç¨±ï¼šç·¨è¼¯-é¸æ“‡ç›®å‰æ–‡å­— (Edit.SelectCurrentWord) é è¨­ç’°å¢ƒä¸‹æ­¤çµ„å¿«æ·éµæ‡‰æ˜¯é–‹å•Ÿå¾®è»Ÿçš„èªªæ˜ç¶²é ï¼Œæœƒéœ€è¦è‡ªè¡Œèª¿æ•´ å¿«é€Ÿç§»å‹•åˆ°ç‰¹å®šå‹åˆ¥ï¼šCtrl + T VS å¿«æ·éµè¨­å®šåç¨±ï¼šç·¨è¼¯-åˆ°å‹åˆ¥ (Edit.GotoType) å¿«é€Ÿç§»å‹•åˆ°ç‰¹å®šæ–¹æ³•æˆå“¡ï¼š(é è¨­æœªç¶å®šå¿«æ·éµ) VS å¿«æ·éµè¨­å®šåç¨±ï¼šç·¨è¼¯-åˆ°æˆå“¡ (Edit.GotoMember) å¿«é€Ÿç§»å‹•åˆ°ç‰¹å®šç³»åˆ— VS å¿«æ·éµè¨­å®šåç¨±ï¼šç·¨è¼¯-åˆ°** (Edit.Goto**) åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ï¼š VS å¿«æ·éµè¨­å®šåç¨±ï¼šTestExplorer.RunAllTests åŸ·è¡Œç›®å‰æ¸¸æ¨™æ‰€åœ¨çš„æ¸¬è©¦é¡åˆ¥ä¸­çš„æ‰€æœ‰æ¸¬è©¦ VS å¿«æ·éµè¨­å®šåç¨±ï¼šTestExplorer.RunAllTestsInContext ","date":"2021-08-20","objectID":"/2021/08/visual-studio-%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%8D%B5/:0:0","series":[],"tags":["refactor","IDE-hotkey"],"title":"Visual Studio å¸¸ç”¨å¿«æ·éµ","uri":"/2021/08/visual-studio-%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%8D%B5/#visual-studio-å¸¸ç”¨å‘½ä»¤"},{"categories":null,"content":" æ–½å·¥ä¸­ å…¶å¯¦æ˜¯æˆ‘ä¸çŸ¥é“é€™é æ€éº¼å¯«æ¯”è¼ƒå¥½ ","date":"0001-01-01","objectID":"/about/:0:0","series":null,"tags":null,"title":"é—œæ–¼æˆ‘","uri":"/about/#æ–½å·¥ä¸­"}]